<?xml version="1.0" encoding="UTF-8"?>
<project name="Ant for Tom-examples" default="dist.examples" basedir=".">
	<description>
		This script prepare a bundle of Tom examples
	</description>

	<property environment="env" />
	<!-- some used directory location -->
	<property name="examples.dir" location="."/>
	<property name="examples.dist" location="dist"/>

	<!-- Examples to build and distribute -->
	<property name="adressbook.dir" location="${examples.dir}/AddressBook" />


	<!-- tasks for building src -->
	<taskdef name="adt" classname="jtom.tools.ant.ApigenTask"/>
	<taskdef name="tom" classname="jtom.tools.ant.TomTask" />

	<target name="prepare.examples">
		<mkdir dir="${examples.dist}"/>
	</target>
	
	<!-- target debug to help finding properties problems -->
	<target name="debug"> 
		<echoproperties/>
	</target>

	<target name="clean.examples" description="Cleans examples directory">
		<delete>
			<fileset dir="${examples.dir}" includes="**/*.class" />
		</delete>
		<!-- deletes java files generated by tom -->
		<delete>
			<fileset dir="${examples.dir}" includes="**/*.java">
				<present targetdir="${examples.dir}">
					<mapper type="glob" from="*.java" to="*.t"/>
				</present>
			</fileset>
		</delete>
	</target>

	<target name="addressbook">
		<!-- build adt -->
		<adt file="${adressbook.dir}/data.adt" 
				 factory="data" 
				 package="adt.address" 
				 destdir="${adressbook.dir}"/>
		<!-- build tom -->
		<tom srcdir="${adressbook.dir}" 
				 destdir="${adressbook.dir}" 
				 options="-I ${env.TOM_HOME}/share/jtom">
			<include name="**/*.t"/>
		</tom>
		<!-- compile java -->
		<javac srcdir="${adressbook.dir}" destdir="${adressbook.dir}">
			<include name="**/*.java"/>
		</javac>
	</target>
	
	<target name="build.examples" 
					description="Builds the examples (at least some)"
					depends="addressbook">
	</target>
	
	<target name="dist.examples" description="Prepare a
		distribution of examples" depends="prepare.examples">
		<tar tarfile="${examples.dist}/jtom-examples.tar">
			<tarfileset dir="${adressbook.dir}">
				<include name="*.t"/>
				<include name="*.adt"/>
			</tarfileset>
		</tar>
	</target>

	<target name="distclean" description="Mr proper" depends="cleanall">
		<delete dir="${dist.examples.dir}"/>
	</target>

	<target name="cleanall" 
					description="Cleans everything in the project" 
					depends="clean.examples">
	</target>	

</project>
