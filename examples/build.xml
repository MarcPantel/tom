<?xml version="1.0" encoding="UTF-8"?>
<project name="Ant for Tom-examples" default="examples" basedir=".">
  <description>
    This script prepare a bundle of Tom examples
  </description>

  <!-- current version of TOM -->
  <property name="version" value="2.0"/>

  <property name="nowarnings" value="false"/>
  <property name="optimize" value="off"/>

  <property environment="env" />
  <property name="tom.home" value="${env.TOM_HOME}"/>
  <!-- some used directory location -->
  <property name="examples.dir" location="."/>
  <property name="examples.dist" location="dist"/>

  <property name="examples.lib" value="lib"/>

  <!-- where the examples a build: javac destDir -->
  <property name="examples.gen" location="gen"/>
  <property name="examples.build" location="build"/>

  <!-- Examples to build and distribute -->
  <property name="cell" value="cell"/>
  <property name="cell.dir" location="${examples.dir}/${cell}" />

  <property name="addressbook" value="addressbook"/>
  <property name="addressbook.dir" location="${examples.dir}/${addressbook}" />

  <property name="apireach" value="apireach"/>
  <property name="apireach.dir" location="${examples.dir}/${apireach}" />

  <property name="boulderdash" value="boulderdash"/>
  <property name="boulderdash.dir" location="${examples.dir}/${boulderdash}" />

  <property name="builtin" value="builtin"/>
  <property name="builtin.dir" location="${examples.dir}/${builtin}" />

  <property name="caml" value="caml"/>
  <property name="caml.dir" location="${examples.dir}/${caml}" />

  <property name="dom" value="dom"/>
  <property name="dom.dir" location="${examples.dir}/${dom}" />

  <property name="expression" value="expression"/>
  <property name="expression.dir" location="${examples.dir}/${expression}" />

  <property name="gtree" value="gtree"/>
  <property name="gtree.dir" location="${examples.dir}/${gtree}" />

  <property name="integerc" value="integerc"/>
  <property name="integerc.dir" location="${examples.dir}/${integerc}" />

  <property name="list" value="list"/>
  <property name="list.dir" location="${examples.dir}/${list}" />

  <property name="lsystem" value="lsystems"/>
  <property name="lsystem.dir" location="${examples.dir}/${lsystem}" />

  <property name="nspk" value="nspk"/>
  <property name="nspk.dir" location="${examples.dir}/${nspk}" />

  <property name="p3p" value="p3p"/>
  <property name="p3p.dir" location="${examples.dir}/${p3p}" />

  <property name="peano" value="peano"/>
  <property name="peano.dir" location="${examples.dir}/${peano}" />

  <property name="pnspk" value="pnspk"/>
  <property name="pnspk.dir" location="${examples.dir}/${pnspk}" />

  <property name="poly" value="poly"/>
  <property name="poly.dir" location="${examples.dir}/${poly}" />

  <property name="pqueens" value="pqueens"/>
  <property name="pqueens.dir" location="${examples.dir}/${pqueens}" />

  <property name="prodrule" value="prodrule"/>
  <property name="prodrule.dir" location="${examples.dir}/${prodrule}" />

  <property name="propp" value="propp"/>
  <property name="propp.dir" location="${examples.dir}/${propp}" />

  <property name="rbtree" value="rbtree"/>
  <property name="rbtree.dir" location="${examples.dir}/${rbtree}" />

  <property name="set" value="set"/>
  <property name="set.dir" location="${examples.dir}/${set}" />

  <property name="tutorial" value="tutorial"/>
  <property name="tutorial.dir" location="${examples.dir}/${tutorial}" />

  <property name="vas" value="vas"/>
  <property name="vas.dir" location="${examples.dir}/${vas}" />

  <property name="xml" value="xml"/>
  <property name="xml.dir" location="${examples.dir}/${xml}" />

  <property name="xquery" value="xquery"/>
  <property name="xquery.dir" location="${examples.dir}/${xquery}" />

  <target name="testdistexist">
    <available file="${tom.home}/lib" type="dir" property="distexist"/>
  </target>
  
  <target name="init" if="examples.build">
    <mkdir dir="${examples.build}"/>
    <mkdir dir="${examples.gen}"/>
    <!-- Define classpath for building stable and source  -->
    <path id="tom.classpath">
      <fileset dir="${examples.dir}/${examples.lib}">
        <include name="*.jar"/>
      </fileset>
      <fileset dir="${tom.home}/lib">
        <include name="*.jar"/>
      </fileset>

    </path>
    
    <!-- tasks for building -->
    <taskdef name="adt" 
             classname="jtom.tools.ant.ApigenTask"
             classpathref="tom.classpath"/>
    <taskdef name="tom" 
             classname="jtom.tools.ant.TomTask"
             classpathref="tom.classpath"/>
    <taskdef name="tomantlr" 
             classname="org.apache.tools.ant.taskdefs.optional.ANTLR">
      <classpath refid="tom.classpath"/>
    </taskdef>
  </target>
  
  <target name="prepare.examples">
    <mkdir dir="${examples.dist}"/>
  </target>
  
  <!-- target debug to help finding properties problems -->
  <target name="debug"> 
    <echoproperties/>
  </target>

  <target name="clean.examples" description="Cleans examples directory">
    <delete dir="${examples.gen}"/>
    <delete dir="${examples.build}"/>
  </target>

  <target name="addressbook" depends="init">
    <!-- build adt -->
    <adt file="${addressbook.dir}/data.adt" 
         factory="data" 
         package="${addressbook}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}"
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${addressbook}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" 
           destdir="${examples.build}" 
           optimize="${optimize}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${addressbook}/**/*.java"/>
    </javac>
  </target>

  <target name="apireach" depends="init">
    <!-- build adt -->
    <adt file="${apireach.dir}/reach.adt" 
         factory="reach" 
         package="${apireach}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}"         
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${apireach}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${apireach}/**/*.java"/>
    </javac>
  </target>

  <target name="boulderdash" depends="init">
    <!-- build adt -->
    <adt file="${boulderdash.dir}/boulder.adt" 
         factory="boulder" 
         package="${boulderdash}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${boulderdash}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac destdir="${examples.build}"
           nowarn="${nowarnings}">
      <src path="${examples.dir}"/>
      <src path="${examples.gen}"/>
      <classpath refid="tom.classpath"/>
      <include name="${boulderdash}/**/*.java"/>
    </javac>
    <!-- copy resources in build -->
    <copy todir="${examples.build}/${boulderdash}">
      <fileset dir="${examples.dir}/${boulderdash}">
        <include name="*.gif"/>
        <include name="*.html"/>
      </fileset>
    </copy>
  </target>

  <target name="builtin" depends="init">
    <!-- build adt -->
    <adt file="${builtin.dir}/term.adt" 
         factory="term" 
         package="${builtin}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}"
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${builtin}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac destdir="${examples.build}"
           nowarn="${nowarnings}">
      <src path="${examples.dir}"/>
      <src path="${examples.gen}"/>
      <classpath refid="tom.classpath"/>
      <include name="${builtin}/**/*.java"/>
    </javac>
  </target>

  <target name="caml" depends="init">
		<mkdir dir="${examples.gen}/${caml}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}/${caml}"
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="--camlCode -I ${tom.home}/share/jtom">
      <include name="${caml}/**/*.t"/>
    </tom>
    <!-- copy resources in build -->
    <copy todir="${examples.build}/${caml}">
      <fileset dir="${examples.dir}/${caml}">
        <include name="*.ml"/>
        <include name="Makefile"/>
        <include name="README"/>
      </fileset>
    </copy>
  </target>

  <target name="cell" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}"
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${cell}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac destdir="${examples.build}"
           nowarn="${nowarnings}">
      <src path="${examples.dir}"/>
      <src path="${examples.gen}"/>
      <classpath refid="tom.classpath"/>
      <include name="${cell}/**/*.java"/>
    </javac>
    <!-- copy resources in build -->
    <copy todir="${examples.build}/${cell}">
      <fileset dir="${examples.dir}/${cell}">
        <include name="*.gif"/>
      </fileset>
    </copy>
  </target>

  <target name="dom" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${dom}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.dir}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${dom}/**/*.java"/>
    </javac>
    <!-- copy resourses -->
    <copy todir="${examples.build}/${dom}">
      <fileset dir="${examples.dir}/${dom}">
        <include name="*.xml"/>
      </fileset>
    </copy>
  </target>
  
  <target name="expression" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom --lazyType">
      <include name="${expression}/**/Record.t"/>
    </tom>
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${expression}/**/RecordStrict.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.dir}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${expression}/**/*.java"/>
    </javac>
  </target>

  <target name="gtree" depends="init">
    <!-- build adt -->
    <adt file="${gtree.dir}/term.adt" 
         factory="term" 
         package="${gtree}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${gtree}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.dir}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${gtree}/**/*.java"/>
    </javac>
  </target>

  <target name="list" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${list}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${list}/**/*.java"/>
    </javac>
  </target>

  <target name="lsystem" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${lsystem}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.dir}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${lsystem}/**/*.java"/>
    </javac>
  </target>

  <target name="nspk" depends="init">
    <!-- build adt -->
    <adt file="${nspk.dir}/term.adt" 
         factory="term" 
         package="${nspk}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${nspk}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${nspk}/**/*.java"/>
    </javac>
  </target>
  
  <target name="p3p" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${p3p}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${p3p}/**/*.java"/>
    </javac>
  </target>

  <target name="peano" depends="init">
    <!-- build adt -->
    <adt file="${peano.dir}/peano.adt" 
         factory="peano" 
         package="${peano}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${peano}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${peano}/**/*.java"/>
    </javac>
  </target>

  <target name="pnspk" depends="init">
    <!-- build adt -->
    <adt file="${pnspk.dir}/term.adt" 
         factory="term" 
         package="${pnspk}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${pnspk}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${pnspk}/**/*.java"/>
    </javac>
  </target>
  
  <target name="poly" depends="init">
    <!-- build adt -->
    <adt file="${poly.dir}/expression.adt" 
         factory="expression" 
         package="${poly}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${poly}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${poly}/**/*.java"/>
    </javac>
  </target>

  <target name="pqueens" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${pqueens}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${pqueens}/**/*.java"/>
    </javac>
  </target>

  <target name="prodrule" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${prodrule}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac destdir="${examples.build}"
           nowarn="${nowarnings}">
      <src path="${examples.dir}"/>
      <src path="${examples.gen}"/>
      <classpath refid="tom.classpath"/>
      <include name="${prodrule}/**/*.java"/>
    </javac>
  </target>

  <target name="propp" depends="init">
    <!-- build adt -->
    <adt file="${propp.dir}/seq.adt" 
         factory="seq" 
         package="${propp}" 
         destdir="${examples.gen}"/>
    <!-- build parser -->
    <tomantlr target="${propp.dir}/SeqParser.g"
              outputdirectory="${examples.gen}/${propp}">
      <classpath refid="tom.classpath"/>
    </tomantlr>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${propp}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath>
        <path refid="tom.classpath"/>
      </classpath>
      <include name="${propp}/**/*.java"/>
    </javac>
    <!-- copy resourses -->
    <copy todir="${examples.build}/${propp}">
      <fileset dir="${examples.dir}/${propp}">
        <include name="examples"/>
        <include name="*.sty"/>
      </fileset>
    </copy>
  </target>

  <target name="rbtree" depends="init">
    <!-- build adt -->
    <adt file="${rbtree.dir}/tree.adt" 
         factory="tree" 
         package="${rbtree}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${rbtree}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${rbtree}/**/*.java"/>
    </javac>
  </target>

  <target name="set" depends="init">
    <!-- build adt -->
    <adt file="${set.dir}/jgset.adt" 
         factory="jgset" 
         package="${set}" 
         destdir="${examples.gen}"/>
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${set}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${set}/**/*.java"/>
    </javac>
  </target>

  <target name="tutorial" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${tutorial}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${tutorial}/**/*.java"/>
    </javac>
  </target>

  <target name="vas" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${vas}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${vas}/**/*.java"/>
    </javac>
  </target>

  <target name="xml" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${xml}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${xml}/**/*.java"/>
    </javac>
    <!-- copy resourses -->
    <copy todir="${examples.build}/${xml}">
      <fileset dir="${examples.dir}/${xml}">
        <include name="*.xml"/>
        <include name="*.html"/>
      </fileset>
    </copy>

  </target>

  <target name="xquery" depends="init">
    <!-- build tom -->
    <tom srcdir="${examples.dir}" 
         destdir="${examples.gen}" 
         nowarn="${nowarnings}"
         optimize="${optimize}"
         options="-I ${tom.home}/share/jtom">
      <include name="${xquery}/**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${examples.gen}" destdir="${examples.build}"
           nowarn="${nowarnings}">
      <classpath refid="tom.classpath"/>
      <include name="${xquery}/**/*.java"/>
    </javac>
    <!-- copy resourses -->
    <copy todir="${examples.build}/${xquery}">
      <fileset dir="${examples.dir}/${xquery}">
        <include name="*.xquery"/>
        <include name="*.html"/>
      </fileset>
    </copy>

  </target>
  
  <!--
    <target name="examples" 
            description="Builds the examples (at least some)"
            depends="addressbook, apireach, boulderdash, builtin, dom,
            expression, gtree, list, nspk, p3p, peano, pnspk, poly, pqueens,
            prodrule, propp, rbtree, set, vas, xml, xquery">
      -->
      <target name="examples" 
              description="Builds the examples (at least some)"
              depends="xml, vas, tutorial, set, rbtree, propp, prodrule,
              addressbook, caml, apireach, boulderdash, builtin, dom,
              expression, gtree, list, nspk, p3p, peano, pnspk, poly, pqueens">
      </target>
      
			<target name="dist.examples" 
							description="Prepare a distribution of examples" 
							depends="prepare.examples">
        <tar tarfile="${examples.dist}/jtom-${version}-examples.tar.gz" 
						 compression="gzip">
          <tarfileset dir="${examples.dir}" prefix="examples" mode="755">
            <include name="README"/>
            <include name="build.xml"/>
            <include name="build.sh"/>
            <include name="${examples.lib}/*.jar"/>

            <include name="${addressbook}/README"/>
            <include name="${addressbook}/*.t"/>
            <include name="${addressbook}/*.adt"/>

            <include name="${apireach}/README"/>
            <include name="${apireach}/*.t"/>
            <include name="${apireach}/*.adt"/>

            <include name="${boulderdash}/README"/>
            <include name="${boulderdash}/*.t"/>
            <include name="${boulderdash}/*.adt"/>
            <include name="${boulderdash}/*.gif"/>
            <include name="${boulderdash}/*.html"/>
            <include name="${boulderdash}/*.java"/>

            <include name="${builtin}/README"/>
            <include name="${builtin}/*.t"/>
            <include name="${builtin}/*.adt"/>

            <include name="${caml}/README"/>
            <include name="${caml}/Makefile"/>
            <include name="${caml}/*.t"/>
            <include name="${caml}/peanotype.ml"/>
            <include name="${caml}/tomExtension.ml"/>
            <include name="${caml}/tomList.ml"/>

            <include name="${cell}/*.t"/>
            <include name="${cell}/*.java"/>
            <include name="${cell}/*.gif"/>

            <include name="${dom}/README"/>
            <include name="${dom}/*.t"/>
            <include name="${dom}/*.adt"/>
            <include name="${dom}/*.xml"/>

            <include name="${expression}/README"/>
            <include name="${expression}/*.t"/>
            <include name="${expression}/*.java"/>

            <include name="${gtree}/README"/>
            <include name="${gtree}/*.t"/>
            <include name="${gtree}/*.adt"/>

            <include name="${integerc}/README"/>
            <include name="${integerc}/*.t"/>
            <include name="${integerc}/*.adt"/>

            <include name="${list}/README"/>
            <include name="${list}/*.t"/>
            <include name="${list}/*.adt"/>

            <include name="${nspk}/README"/>
            <include name="${nspk}/*.t"/>
            <include name="${nspk}/*.adt"/>

            <include name="${p3p}/README"/>
            <include name="${p3p}/*.t"/>
            <include name="${p3p}/*.xml"/>

            <include name="${peano}/README"/>
            <include name="${peano}/*.adt"/>
            <include name="${peano}/*.t"/>

            <include name="${pnspk}/README"/>
            <include name="${pnspk}/*.t"/>
            <include name="${pnspk}/*.adt"/>

            <include name="${poly}/README"/>
            <include name="${poly}/*.t"/>
            <include name="${poly}/Poly.signature"/>
            <include name="${poly}/*.adt"/>
            <include name="${poly}/*.java"/>

            <include name="${pqueens}/README"/>
            <include name="${pqueens}/*.t"/>
            <include name="${pqueens}/*.tom"/>

            <include name="${prodrule}/README"/>
            <include name="${prodrule}/*.t"/>

            <include name="${propp}/README"/>
            <include name="${propp}/*.t"/>
            <include name="${propp}/*.adt"/>
            <include name="${propp}/*.g"/>
            <include name="${propp}/*.sty"/>
            <include name="${propp}/examples"/>

            <include name="${rbtree}/README"/>
            <include name="${rbtree}/*.t"/>
            <include name="${rbtree}/*.adt"/>

            <include name="${set}/README"/>
            <include name="${set}/*.t"/>
            <include name="${set}/*.adt"/>

            <include name="${tutorial}/README"/>
            <include name="${tutorial}/*.t"/>
            <include name="${tutorial}/*.xml"/>

            <include name="${vas}/README"/>
            <include name="${vas}/*.t"/>

            <include name="${xml}/README"/>
            <include name="${xml}/*.t"/>
            <include name="${xml}/*.adt"/>
            <include name="${xml}/*.xml"/>
            <include name="${xml}/*.html"/>

            <include name="${xquery}/README"/>
            <include name="${xquery}/*.t"/>
            <include name="${xquery}/*.xml"/>
            <include name="${xquery}/*.xquery"/>
            <include name="${xquery}/*.html"/>

            <not>
              <present targetdir="${examples.dir}">
                <mapper type="glob" 
                        from="**/*.java" 
                        to="**/*.t"/>
              </present>
            </not>
          </tarfileset>
        </tar>
      </target>

      <target name="clean.dist" description="Mr proper" depends="clean">
        <delete dir="${examples.dist}"/>
      </target>

      <target name="clean" 
              description="Cleans everything in the project" 
              depends="clean.examples">
      </target> 

      <target name="initjunit">
        <taskdef name="tomjunit" classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask">
          <classpath refid="tom.classpath"/>
        </taskdef>
      </target>

      <target name="junit" description="Runs junit acceptance tests" depends="examples, initjunit">
        <tomjunit printsummary="yes"
                  fork="true"
                  haltonfailure="false"
                  failureproperty="tests.failed"
                  showoutput="true">
          <classpath>
            <path refid="tom.classpath"/>
            <pathelement location="${examples.build}"/>
          </classpath>
          <batchtest>
            <fileset dir="${examples.gen}">
              <include name="**/Test*.java"/>
            </fileset>
            <fileset dir="${examples.dir}">
              <include name="**/Test*.java"/>
              <exclude name="gen/**/*"/>
            </fileset>
          </batchtest>
        </tomjunit>

        <fail if="tests.failed">
          ****************************************************
          ****************************************************
          One or more tests failed. Check the output...
          ****************************************************
          ****************************************************
        </fail>
      </target>

      <target name="all" depends="clean">
        <antcall target="junit"/>
        <antcall target="clean"/>
        <antcall target="dist.examples"/>
      </target>

    </project>
