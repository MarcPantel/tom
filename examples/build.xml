<?xml version="1.0" encoding="UTF-8"?>
<project name="Ant for Tom-examples" default="dist.examples" basedir=".">
  <description>
    This script prepare a bundle of Tom examples
  </description>

  <property environment="env" />
  <!-- some used directory location -->
  <property name="examples.dir" location="."/>
  <property name="examples.dist" location="dist"/>

  <!-- Examples to build and distribute -->
  <property name="addressbook" value="AddressBook"/>
  <property name="addressbook.dir" location="${examples.dir}/${addressbook}" />

  <property name="apireach" value="ApiReach"/>
  <property name="apireach.dir" location="${examples.dir}/${apireach}" />

  <property name="boulderdash" value="BoulderDash"/>
  <property name="boulderdash.dir" location="${examples.dir}/${boulderdash}" />

  <property name="builtin" value="Builtin"/>
  <property name="builtin.dir" location="${examples.dir}/${builtin}" />

  <property name="dom" value="Dom"/>
  <property name="dom.dir" location="${examples.dir}/${dom}" />

  <property name="expression" value="Expression"/>
  <property name="expression.dir" location="${examples.dir}/${expression}" />

  <property name="gtree" value="GTree"/>
  <property name="gtree.dir" location="${examples.dir}/${gtree}" />

  <property name="lsystem" value="Lsystems"/>
  <property name="lsystem.dir" location="${examples.dir}/${lsystem}" />

  <property name="nspk" value="Nspk"/>
  <property name="nspk.dir" location="${examples.dir}/${nspk}" />

  <property name="pnspk" value="PNspk"/>
  <property name="pnspk.dir" location="${examples.dir}/${pnspk}" />

  <property name="pqueens" value="PQueens"/>
  <property name="pqueens.dir" location="${examples.dir}/${pqueens}" />

  <property name="rbtree" value="RBTree"/>
  <property name="rbtree.dir" location="${examples.dir}/${rbtree}" />

  <property name="reach" value="api_reach"/>
  <property name="reach.dir" location="${examples.dir}/${reach}" />

  <property name="set" value="Set"/>
  <property name="set.dir" location="${examples.dir}/${set}" />

  <property name="vas" value="Vas"/>
  <property name="vas.dir" location="${examples.dir}/${vas}" />

  <property name="xml" value="Xml"/>
  <property name="xml.dir" location="${examples.dir}/${xml}" />

  <!-- Define classpath for building stable and source  -->
  <path id="tom.classpath">
    <fileset dir="${env.TOM_HOME}/lib">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <!-- tasks for building -->
  <taskdef name="adt" 
           classname="jtom.tools.ant.ApigenTask"
           classpathref="tom.classpath"/>
  <taskdef name="tom" 
           classname="jtom.tools.ant.TomTask"
           classpathref="tom.classpath"/>

  <target name="prepare.examples">
    <mkdir dir="${examples.dist}"/>
  </target>
  
  <!-- target debug to help finding properties problems -->
  <target name="debug"> 
    <echoproperties/>
  </target>

  <target name="clean.examples" description="Cleans examples directory">
    <delete>
      <fileset dir="${examples.dir}" includes="**/*.class" />
    </delete>
    <!-- deletes java files generated by tom -->
    <delete>
      <fileset dir="${examples.dir}" includes="**/*.java">
        <present targetdir="${examples.dir}">
          <mapper type="glob" from="*.java" to="*.t"/>
        </present>
      </fileset>
    </delete>
  </target>

  <target name="addressbook">
    <!-- build adt -->
    <adt file="${addressbook.dir}/data.adt" 
         factory="data" 
         package="adt.address" 
         destdir="${addressbook.dir}"/>
    <!-- build tom -->
    <tom srcdir="${addressbook.dir}" 
         destdir="${addressbook.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${addressbook.dir}" destdir="${addressbook.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="apireach">
    <!-- build adt -->
    <adt file="${apireach.dir}/reach.adt" 
         factory="reach" 
         package="adt.apireach" 
         destdir="${apireach.dir}"/>
    <!-- build tom -->
    <tom srcdir="${apireach.dir}" 
         destdir="${apireach.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${apireach.dir}" destdir="${apireach.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="boulderdash">
    <!-- build adt -->
    <adt file="${boulderdash.dir}/boulder.adt" 
         factory="boulder" 
         package="adt.boulder" 
         destdir="${boulderdash.dir}"/>
    <!-- build tom -->
    <tom srcdir="${boulderdash.dir}" 
         destdir="${boulderdash.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${boulderdash.dir}" destdir="${boulderdash.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="builtin">
    <!-- build adt -->
    <adt file="${builtin.dir}/term.adt" 
         factory="term" 
         package="adt.builtin" 
         destdir="${builtin.dir}"/>
    <!-- build tom -->
    <tom srcdir="${builtin.dir}" 
         destdir="${builtin.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${builtin.dir}" destdir="${builtin.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>
  
  <target name="dom">
    <!-- build tom -->
    <tom srcdir="${dom.dir}" 
         destdir="${dom.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${dom.dir}" destdir="${dom.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>
  
  <target name="expression">
    <!-- build tom -->
    <tom srcdir="${expression.dir}" 
         destdir="${expression.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom --lazyType">
      <include name="**/Record.t"/>
    </tom>
    <tom srcdir="${expression.dir}" 
         destdir="${expression.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/RecordStrict.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${expression.dir}" destdir="${expression.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="gtree">
    <!-- build adt -->
    <adt file="${gtree.dir}/term.adt" 
         factory="term" 
         package="adt.gtree" 
         destdir="${gtree.dir}"/>
    <!-- build tom -->
    <tom srcdir="${gtree.dir}" 
         destdir="${gtree.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${gtree.dir}" destdir="${gtree.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="lsystem">
    <!-- build tom -->
    <tom srcdir="${lsystem.dir}" 
         destdir="${lsystem.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${lsystem.dir}" destdir="${lsystem.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="nspk">
    <!-- build adt -->
    <adt file="${nspk.dir}/term.adt" 
         factory="term" 
         package="adt.nsh" 
         destdir="${nspk.dir}"/>
    <!-- build tom -->
    <tom srcdir="${nspk.dir}" 
         destdir="${nspk.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${nspk.dir}" destdir="${nspk.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>
  
  <target name="pnspk">
    <!-- build adt -->
    <adt file="${pnspk.dir}/term.adt" 
         factory="term" 
         package="adt.pnsh" 
         destdir="${pnspk.dir}"/>
    <!-- build tom -->
    <tom srcdir="${pnspk.dir}" 
         destdir="${pnspk.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${pnspk.dir}" destdir="${pnspk.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  
  <target name="pqueens">
    <!-- build tom -->
    <tom srcdir="${pqueens.dir}" 
         destdir="${pqueens.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${pqueens.dir}" destdir="${pqueens.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="rbtree">
    <!-- build adt -->
    <adt file="${rbtree.dir}/tree.adt" 
         factory="tree" 
         package="adt.rbtree" 
         destdir="${rbtree.dir}"/>
    <!-- build tom -->
    <tom srcdir="${rbtree.dir}" 
         destdir="${rbtree.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${rbtree.dir}" destdir="${rbtree.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  
  <target name="reach">
    <!-- build adt -->
    <adt file="${reach.dir}/reach.adt" 
         factory="reach" 
         package="adt" 
         destdir="${reach.dir}"/>
    <!-- build tom -->
    <tom srcdir="${reach.dir}" 
         destdir="${reach.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${reach.dir}" destdir="${reach.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

 
  <target name="set">
    <!-- build adt -->
    <adt file="${set.dir}/set.adt" 
         factory="Set" 
         package="adt" 
         destdir="${set.dir}"/>
    <!-- build tom -->
    <tom srcdir="${set.dir}" 
         destdir="${set.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom --lazyType">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${set.dir}" destdir="${set.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="vas">
    <!-- build tom -->
    <tom srcdir="${vas.dir}" 
         destdir="${vas.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${vas.dir}" destdir="${vas.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>

  <target name="xml">
    <!-- build tom -->
    <tom srcdir="${xml.dir}" 
         destdir="${xml.dir}" 
         options="-I ${env.TOM_HOME}/share/jtom">
      <include name="**/*.t"/>
    </tom>
    <!-- build java source -->
    <javac srcdir="${xml.dir}" destdir="${xml.dir}">
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac>
  </target>
  
  
  <target name="build.examples" 
          description="Builds the examples (at least some)"
          depends="addressbook, apireach, boulderdash, builtin, dom,
          expression, gtree, nspk, pnspk, pqueens, rbtree, reach, vas, xml">
  </target>
  
  <target name="dist.examples" description="Prepare a
    distribution of examples" depends="prepare.examples">
    <tar tarfile="${examples.dist}/jtom-examples.tar">
      <tarfileset dir="${examples.dir}">
        <include name="${addressbook}/README"/>
        <include name="${addressbook}/*.t"/>
        <include name="${addressbook}/*.adt"/>

        <include name="${apireach}/README"/>
        <include name="${apireach}/*.t"/>
        <include name="${apireach}/*.adt"/>

        <include name="${boulderdash}/README"/>
        <include name="${boulderdash}/*.t"/>
        <include name="${boulderdash}/*.adt"/>
        <include name="${boulderdash}/*.java"/>

        <include name="${builtin}/README"/>
        <include name="${builtin}/*.t"/>
        <include name="${builtin}/*.adt"/>

        <include name="${dom}/README"/>
        <include name="${dom}/*.t"/>
        <include name="${dom}/*.adt"/>
        <include name="${dom}/*.xml"/>

        <include name="${expression}/README"/>
        <include name="${expression}/*.t"/>
        <include name="${expression}/*.java"/>

        <include name="${gtree}/README"/>
        <include name="${gtree}/*.t"/>
        <include name="${gtree}/*.adt"/>

        <include name="${nspk}/README"/>
        <include name="${nspk}/*.t"/>
        <include name="${nspk}/*.adt"/>

        <include name="${pnspk}/README"/>
        <include name="${pnspk}/*.t"/>
        <include name="${pnspk}/*.adt"/>

        <include name="${pqueens}/README"/>
        <include name="${pqueens}/*.t"/>
        <include name="${pqueens}/*.tom"/>

        <include name="${rbtree}/README"/>
        <include name="${rbtree}/*.t"/>
        <include name="${rbtree}/*.adt"/>

        <include name="${reach}/README"/>
        <include name="${reach}/*.t"/>
        <include name="${reach}/*.adt"/>

        <include name="${vas}/README"/>
        <include name="${vas}/*.t"/>

        <include name="${xml}/README"/>
        <include name="${xml}/*.t"/>
        <include name="${xml}/*.adt"/>
        <include name="${xml}/*.xml"/>
        <include name="${xml}/*.html"/>

        <not>
          <present targetdir="${examples.dir}">
            <mapper type="glob" 
                    from="**/*.java" 
                    to="**/*.t"/>
          </present>
        </not>
      </tarfileset>
    </tar>
    <gzip zipfile="${examples.dist}/jtom-examples.tar.gz" 
          src="${examples.dist}/jtom-examples.tar"/>
    <delete file="${examples.dist}/jtom-examples.tar"/>
  </target>

  <target name="clean.dist" description="Mr proper" depends="cleanall">
    <delete dir="${examples.dist}"/>
  </target>

  <target name="cleanall" 
          description="Cleans everything in the project" 
          depends="clean.examples">
  </target> 

</project>
