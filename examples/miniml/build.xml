<?xml version="1.0" encoding="UTF-8"?>
<project name="miniml" default="build" basedir="..">
  <description>
    ml to tom proof of concept 
  </description>
 
  <import file="../common.xml"/>

  <property name="miniml" value="miniml"/>
  <property name="miniml.dir"      location="${examples.dir}/${miniml}"/>
  <property name="miniml.src"      location="${miniml.dir}/src"/>
  <property name="miniml.gen"      location="${examples.gen}/${miniml}"/>
  <property name="miniml.build"    location="${examples.build}/${miniml}"/>

  <target name="init" depends="tom.init">
    <mkdir dir="${miniml.build}"/>
    <mkdir dir="${miniml.gen}"/>
  </target>

  <target name="build" depends="init">
    <gom.preset config="${gomconfigfile}"
         srcdir="${miniml.src}"
         destdir="${miniml.gen}">
      <include name="*.gom"/>
    </gom.preset>
    <tom.preset outputfile="${miniml.gen}/MlWalker.g"
                options="-I ${miniml.gen}"
                srcdir="${miniml.src}"> 
      <include name="MlWalker.g.t"/>
    </tom.preset>
   <taskdef name="antlr3"
             classname="org.apache.tools.ant.antlr.ANTLR3">
      <classpath refid="tom.classpath"/>
    </taskdef>
    <tom.preset srcdir="${miniml.src}"
      destdir="${miniml.gen}">
      <include name="**/*.t"/>
      <exclude name="**/*.g.t"/>
    </tom.preset>
    <antlr3 target="${miniml.src}/Ml.g"
            outputdirectory="${miniml.gen}">
	    <classpath refid="tom.classpath"/>
    </antlr3>
    <antlr3 target="${miniml.gen}/MlWalker.g"
            outputdirectory="${miniml.gen}">
	    <classpath refid="tom.classpath"/>
    </antlr3>
    
    <javac.preset destdir="${miniml.build}">
      <src path="${miniml.gen}:${miniml.src}"/>
      <classpath refid="tom.classpath"/>
      <include name="**/*.java"/>
    </javac.preset>

    <copy todir="${miniml.build}/tests">
      <fileset dir="${miniml.dir}/tests" />
    </copy>
  </target>

  <target name="clean" description="make clean">
    <delete dir="${miniml.gen}"/>
    <delete dir="${miniml.build}"/>
  </target>
</project>
