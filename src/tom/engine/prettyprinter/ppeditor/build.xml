<?xml version="1.0" encoding="UTF-8"?>
<project name="monProjet" basedir="." default="compile">

<property name="src.dir" value="src"/>
<property name="testsrc.dir" value="${src.dir}/test"/>
<property name="build.dir" value="build"/>
<property name="app.name" value="ppeditor"/>
<property name="dist.dir" value="dist"/>
<property name="jar.junit" value="/usr/share/java/junit.jar"/>
	
  <target name="clean">
    <delete dir="${dist.dir}"/>
  </target>

  <target name="cleanall" depends="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="JUNIT" description="Tester si le classpath contient bien le jar de JUnit">
    <available property="junit.present" classname="junit.framework.TestCase" />
  </target>

  <target name="jar" depends="clean, compile" description="Créer un jar contenant seulement les classes normales (pas celles de test)">
<mkdir dir="${dist.dir}"/>
<jar jarfile="${dist.dir}/${app.name}.jar" basedir="${build.dir}"/>
  </target>


<target name="compiletests" depends="jar" description="Créer le jar de l'application et compiler les tests dans le répertoire ${testbuild.dir}">
<javac srcdir="${src.dir}" destdir="${build.dir}" excludes="Main.java">
<classpath>
<pathelement location="${dist.dir}/${app.name}.jar" />
<pathelement location="${jar.junit}"/>
</classpath>
</javac>
</target> 

<target name="compile" depends="JUNIT">
<mkdir dir="${build.dir}"/>
<javac srcdir="${src.dir}" destdir="${build.dir}" excludes="test/** Main.java"/>
</target>

<target name="runtests" depends="compiletests" if="junit.present" description="Compiler l'appli, créer le .jar, compiler les tests et lancer tous les tests du TestSuite *AllTests* en mode console">
<java fork="true" classname="junit.textui.TestRunner" taskname="junit" failonerror="false">
<classpath>
<pathelement path="${java.class.path}" />
<pathelement location="${build.dir}/ppeditor" />
<pathelement location="${build.dir}"/>
</classpath>
<arg value="ppeditor.test.AllTests"/>
</java>
</target>

<target name="ppmain" depends="compile">
<java classname="ppeditor.Main">
<classpath>
<pathelement location="${build.dir}"/>
<pathelement path="${java.class.path}" />
</classpath>
</java>
</target>


</project>
