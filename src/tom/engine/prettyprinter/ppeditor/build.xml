<?xml version="1.0" encoding="UTF-8"?>
<project name="monProjet" basedir="." default="compile">

<property name="src.dir" value="src"/>
<property name="testsrc.dir" value="${src.dir}/test"/>
<property name="build.dir" value="build"/>
<property name="app.name" value="ppeditor"/>
<property name="dist.dir" value="dist"/>
<property name="jar.junit" value="/usr/share/java/junit.jar"/>
	
  <target name="clean">
    <delete dir="${dist.dir}"/>
  </target>

  <target name="cleanall" depends="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="JUNIT" description="Tester si le classpath contient bien le jar de JUnit">
    <available property="junit.present" classname="org.junit.Test" />
  </target>

  <target name="jar" depends="clean, compile" description="CrÃ©er un jar contenant seulement les classes normales (pas celles de test)">
    <mkdir dir="${dist.dir}"/>
    <jar jarfile="${dist.dir}/${app.name}.jar" basedir="${build.dir}"/>
  </target>

  <target name="compiletests" depends="jar">
    <javac fork="true" srcdir="${src.dir}/test" destdir="${build.dir}" debug="on" includes="*.java">
      <classpath>
        <pathelement path="${java.class.path}" />
        <pathelement location="${build.dir}/ppeditor" />
        <pathelement location="${dist.dir}/${app.name}.jar"/>
        <pathelement location="${jar.junit}"/>
      </classpath>
    </javac>
  </target> 

  <target name="compile" depends="JUNIT">
    <mkdir dir="${build.dir}"/>
    <javac fork="true" srcdir="${src.dir}" destdir="${build.dir}" excludes="test/*.java"/>
  </target>

  <target name="runtests" depends="compiletests">
    <junit haltonfailure="yes">
      <assertions>
        <enable/>
      </assertions>
      <classpath>
        <pathelement location="${build.dir}/ppeditor" />
        <pathelement location="${build.dir}"/>
        <pathelement location="${build.dir}/ppeditor/test"/>
        <pathelement path="${java.class.path}" />
        <pathelement location="${jar.junit}"/>
      </classpath>
      <formatter
        type="brief"
        usefile="false"
      />
      <test name="ppeditor.test.AllTests"/>
    </junit>
  </target>

  <target name="ppmain" depends="compile">
    <java classname="ppeditor.Main">
      <classpath>
        <pathelement location="${build.dir}"/>
        <pathelement path="${java.class.path}" />
      </classpath>
    </java>
  </target>

</project>
