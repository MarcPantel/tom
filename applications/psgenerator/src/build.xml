<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- ANT-Makefile for PSGenerator (C) 2004 Mr. Soft                                -->
<!-- ======================================================================= -->

<project name="Production System Generator" default="main" basedir="..">

  <!-- ===================================================================== -->
  <!-- PROPERTIES                                                            -->
  <!-- ===================================================================== -->
  <property name="name" value="psgen" />
  <property name="Name" value="Production System Generator" />
  <property name="version" value="0.1" />

  <property name="psgen.home" value="." />

  <property name="build.dir" value="build" />
  <property name="dist.dir" value="dist" />
  <property name="docs.dir" value="docs" />
  <property name="javadocs.dir" value="docs/api" />
  <property name="lib.dir" value="lib" />
  <property name="src.dir" value="src" />
  <property name="bin.dir" value="exe" />
  <property name="examples.dir" value="examples" />

  <path id="classpath">
    <fileset dir="${lib.dir}">
      <include name="**/*.jar"/>
    </fileset>
  </path>
		
  <!-- ===================================================================== -->
  <!-- COMPILER: classic (JDK 1.1 & 1.2), modern or jikes                    -->
  <!-- ===================================================================== -->
  <property name="build.compiler" value="modern" />

  <property name="manifest" value="${src.dir}/${name}.manifest" />
  <property name="packages" value="fr.loria.protheo.psgenerator.*" />
  <property name="stable.dir" value="fr/loria/protheo/psgenerator" />
	
  <!-- ===================================================================== -->
  <!-- MAIN                                                                  -->
  <!-- ===================================================================== -->

  <target name="main" depends="compile">
  </target>

  <!-- ===================================================================== -->
  <!-- PREPARE BUILD                                                         -->
  <!-- ===================================================================== -->

  <target name="prepare">
    <mkdir dir="${build.dir}" />
  </target>

  <!-- ===================================================================== -->
  <!-- COMPILE                                                               -->
  <!-- ===================================================================== -->

  <target name="compile" depends="prepare">
  	<copy todir="${build.dir}">
      <fileset dir="${src.dir}" >
        <patternset>
          <include name="**/*.gif" />
          <include name="**/*.properties" />
          <include name="$**/classlist" />
        </patternset>
      </fileset>
    </copy>
  	<javac srcdir="${src.dir}" destdir="${build.dir}"
           debug="off" deprecation="on" optimize="on" >
  		<!--compilerarg value="-Xlint:unchecked"/-->
  		<classpath refid="classpath" /> 
  		<include name="${stable.dir}/**" />
    </javac>
  </target>

  <!-- ===================================================================== -->
  <!-- JAR FILE                                                              -->
  <!-- ===================================================================== -->

  <target name="jar" depends="compile">
    <mkdir dir="${lib.dir}" />
    <delete file="${lib.dir}/${name}.jar" />
    <jar jarfile="${lib.dir}/${name}.jar" compress="yes"
         basedir="${build.dir}" includes="${stable.dir}/**"
         manifest="${manifest}"
    />
  </target>

  <!-- ===================================================================== -->
  <!-- JAVADOC                                                               -->
  <!-- ===================================================================== -->

  <target name="javadocs" depends="prepare">
    <mkdir dir="${javadocs.dir}" />
    <javadoc packagenames="${packages}"
             sourcepath="${basedir}/${src.dir}"
             destdir="${javadocs.dir}"
             author="true"
             version="true"
             windowtitle="${Name} API"
             doctitle="${Name}"
             bottom="Copyright &#169; 2004 Protheo Team. Loria" >
    	<classpath refid="classpath" />
    </javadoc>
  </target>

  <!-- ===================================================================== -->
  <!-- DISTRIBUTION                                                          -->
  <!-- ===================================================================== -->

  <target name="dist" depends="cleanall,jar,javadocs">
    <buildnumber/>
    <tstamp>
    	<format property="modified" pattern="dd. MMMM yyyy HH:mm" locale="en" />
    </tstamp>
  	
    <filter token="VERSION" value="${version}" />
    <filter token="MODIFIED" value="${modified}" />
    <filter token="BUILD" value="${build.number}" />

    <mkdir dir="${dist.dir}" />
    <mkdir dir="${dist.dir}/bin" />
    <mkdir dir="${dist.dir}/lib" />
    <mkdir dir="${dist.dir}/docs" />
    <mkdir dir="${dist.dir}/docs/api" />
    <mkdir dir="${dist.dir}/docs/freehep" />
    <mkdir dir="${dist.dir}/src" />
    <mkdir dir="${dist.dir}/examples" />

    <copy todir="${dist.dir}/src">
        <fileset dir="${src.dir}" >
          <patternset>
            <include name="**/*.gif" />
            <include name="**/*.properties" />
            <include name="**/*.java" />
          </patternset>
        </fileset>
    </copy>
    <copy todir="${dist.dir}/lib">
      <fileset dir="${lib.dir}"  />
    </copy>
    <copy todir="${dist.dir}/bin">
      <fileset dir="${bin.dir}" />
    </copy>
    <copy todir="${dist.dir}/docs/api">
      <fileset dir="${docs.dir}/api" />
    </copy>
    <copy todir="${dist.dir}/docs/freehep">
      <fileset dir="${docs.dir}/freehep" />
    </copy>
    <copy todir="${dist.dir}/docs" filtering="yes" >
      <fileset dir="${docs.dir}/base" />
    </copy>
    <copy todir="${dist.dir}/examples">
      <fileset dir="${examples.dir}" />
    </copy>

    <!-- create a zip file -->
    <zip zipfile="${name}.zip" >
      <zipfileset dir="${dist.dir}" >
	     <include name="**" />
	  </zipfileset>
    </zip>    
  </target>

  <!-- =================================================================== -->
  <!-- CLEAN                                                               -->
  <!-- =================================================================== -->

  <target name="clean">
    <delete dir="${build.dir}" />
    <delete dir="${dist.dir}" />
    <delete dir="${javadocs.dir}" />
  </target>

  <!-- =================================================================== -->
  <!-- CLEAN ALL                                                           -->
  <!-- =================================================================== -->

  <target name="cleanall" depends="clean" >
    <delete file="${psgen.home}/${name}.zip" />
    <delete file="${lib.dir}/${name}.jar" />
  </target>

</project>

<!-- End of build.xml -->

