/* Generated by TOM (version 2.6alpha): Do not edit this file *//*
 *
 * TOM - To One Matching Compiler
 *
 * Copyright (c) 2000-2008, INRIA
 * Nancy, France.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 *
 * Pierre-Etienne Moreau  e-mail: Pierre-Etienne.Moreau@loria.fr
 * Antoine Reilles        e-mail: Antoine.Reilles@loria.fr
 *
 **/

package tom.engine.verifier;

import tom.engine.*;
import aterm.*;
import java.util.*;
import tom.engine.tools.SymbolTable;

import tom.engine.adt.tomsignature.*;
import tom.engine.adt.tomconstraint.types.*;
import tom.engine.adt.tomdeclaration.types.*;
import tom.engine.adt.tomexpression.types.*;
import tom.engine.adt.tominstruction.types.*;
import tom.engine.adt.tomname.types.*;
import tom.engine.adt.tomoption.types.*;
import tom.engine.adt.tomsignature.types.*;
import tom.engine.adt.tomterm.types.*;
import tom.engine.adt.tomslot.types.*;
import tom.engine.adt.tomtype.types.*;
import tom.engine.adt.il.*;
import tom.engine.adt.il.types.*;
import tom.library.sl.Strategy;
import tom.library.sl.VisitFailure;
import tom.library.sl.Introspector;
import tom.library.sl.BasicStrategy;

import tom.engine.exception.TomRuntimeException;

public class Verifier {

  // ------------------------------------------------------------
  /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */  /* Generated by TOM (version 2.6alpha): Do not edit this file */    private static   tom.engine.adt.tominstruction.types.InstructionList  tom_append_list_concInstruction( tom.engine.adt.tominstruction.types.InstructionList l1,  tom.engine.adt.tominstruction.types.InstructionList  l2) {     if( l1.isEmptyconcInstruction() ) {       return l2;     } else if( l2.isEmptyconcInstruction() ) {       return l1;     } else if(  l1.getTailconcInstruction() .isEmptyconcInstruction() ) {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,l2) ;     } else {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,tom_append_list_concInstruction( l1.getTailconcInstruction() ,l2)) ;     }   }   private static   tom.engine.adt.tominstruction.types.InstructionList  tom_get_slice_concInstruction( tom.engine.adt.tominstruction.types.InstructionList  begin,  tom.engine.adt.tominstruction.types.InstructionList  end, tom.engine.adt.tominstruction.types.InstructionList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyconcInstruction()  ||  (end== tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( begin.getHeadconcInstruction() ,( tom.engine.adt.tominstruction.types.InstructionList )tom_get_slice_concInstruction( begin.getTailconcInstruction() ,end,tail)) ;   }    /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */     private static   tom.engine.adt.il.types.InstrList  tom_append_list_semicolon( tom.engine.adt.il.types.InstrList l1,  tom.engine.adt.il.types.InstrList  l2) {     if( l1.isEmptysemicolon() ) {       return l2;     } else if( l2.isEmptysemicolon() ) {       return l1;     } else if(  l1.getTailsemicolon() .isEmptysemicolon() ) {       return  tom.engine.adt.il.types.instrlist.Conssemicolon.make( l1.getHeadsemicolon() ,l2) ;     } else {       return  tom.engine.adt.il.types.instrlist.Conssemicolon.make( l1.getHeadsemicolon() ,tom_append_list_semicolon( l1.getTailsemicolon() ,l2)) ;     }   }   private static   tom.engine.adt.il.types.InstrList  tom_get_slice_semicolon( tom.engine.adt.il.types.InstrList  begin,  tom.engine.adt.il.types.InstrList  end, tom.engine.adt.il.types.InstrList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptysemicolon()  ||  (end== tom.engine.adt.il.types.instrlist.Emptysemicolon.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.il.types.instrlist.Conssemicolon.make( begin.getHeadsemicolon() ,( tom.engine.adt.il.types.InstrList )tom_get_slice_semicolon( begin.getTailsemicolon() ,end,tail)) ;   }      private static   tom.engine.adt.il.types.ExprList  tom_append_list_concExpr( tom.engine.adt.il.types.ExprList l1,  tom.engine.adt.il.types.ExprList  l2) {     if( l1.isEmptyconcExpr() ) {       return l2;     } else if( l2.isEmptyconcExpr() ) {       return l1;     } else if(  l1.getTailconcExpr() .isEmptyconcExpr() ) {       return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make( l1.getHeadconcExpr() ,l2) ;     } else {       return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make( l1.getHeadconcExpr() ,tom_append_list_concExpr( l1.getTailconcExpr() ,l2)) ;     }   }   private static   tom.engine.adt.il.types.ExprList  tom_get_slice_concExpr( tom.engine.adt.il.types.ExprList  begin,  tom.engine.adt.il.types.ExprList  end, tom.engine.adt.il.types.ExprList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyconcExpr()  ||  (end== tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make( begin.getHeadconcExpr() ,( tom.engine.adt.il.types.ExprList )tom_get_slice_concExpr( begin.getTailconcExpr() ,end,tail)) ;   }      private static   tom.engine.adt.il.types.SubstitutionList  tom_append_list_subs( tom.engine.adt.il.types.SubstitutionList l1,  tom.engine.adt.il.types.SubstitutionList  l2) {     if( l1.isEmptysubs() ) {       return l2;     } else if( l2.isEmptysubs() ) {       return l1;     } else if(  l1.getTailsubs() .isEmptysubs() ) {       return  tom.engine.adt.il.types.substitutionlist.Conssubs.make( l1.getHeadsubs() ,l2) ;     } else {       return  tom.engine.adt.il.types.substitutionlist.Conssubs.make( l1.getHeadsubs() ,tom_append_list_subs( l1.getTailsubs() ,l2)) ;     }   }   private static   tom.engine.adt.il.types.SubstitutionList  tom_get_slice_subs( tom.engine.adt.il.types.SubstitutionList  begin,  tom.engine.adt.il.types.SubstitutionList  end, tom.engine.adt.il.types.SubstitutionList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptysubs()  ||  (end== tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.il.types.substitutionlist.Conssubs.make( begin.getHeadsubs() ,( tom.engine.adt.il.types.SubstitutionList )tom_get_slice_subs( begin.getTailsubs() ,end,tail)) ;   }      private static   tom.engine.adt.il.types.TermList  tom_append_list_concTerm( tom.engine.adt.il.types.TermList l1,  tom.engine.adt.il.types.TermList  l2) {     if( l1.isEmptyconcTerm() ) {       return l2;     } else if( l2.isEmptyconcTerm() ) {       return l1;     } else if(  l1.getTailconcTerm() .isEmptyconcTerm() ) {       return  tom.engine.adt.il.types.termlist.ConsconcTerm.make( l1.getHeadconcTerm() ,l2) ;     } else {       return  tom.engine.adt.il.types.termlist.ConsconcTerm.make( l1.getHeadconcTerm() ,tom_append_list_concTerm( l1.getTailconcTerm() ,l2)) ;     }   }   private static   tom.engine.adt.il.types.TermList  tom_get_slice_concTerm( tom.engine.adt.il.types.TermList  begin,  tom.engine.adt.il.types.TermList  end, tom.engine.adt.il.types.TermList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyconcTerm()  ||  (end== tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.il.types.termlist.ConsconcTerm.make( begin.getHeadconcTerm() ,( tom.engine.adt.il.types.TermList )tom_get_slice_concTerm( begin.getTailconcTerm() ,end,tail)) ;   }    /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */   private static   tom.library.sl.Strategy  tom_append_list_Sequence( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Sequence) )) {       if(( ((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Sequence(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Sequence( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin):new tom.library.sl.Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)) );   }      private static   tom.library.sl.Strategy  tom_append_list_Choice( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 ==null )) {       return l2;     } else if(( l2 ==null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Choice) )) {       if(( ((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )) ==null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Choice(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Choice( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end ==null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin):new tom.library.sl.Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)) );   }      private static   tom.library.sl.Strategy  tom_append_list_SequenceId( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.SequenceId) )) {       if(( ((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.SequenceId(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_SequenceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin):new tom.library.sl.SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)) );   }    /* Generated by TOM (version 2.6alpha): Do not edit this file */ /* Generated by TOM (version 2.6alpha): Do not edit this file */private static  tom.library.sl.Strategy  tom_make_Try( tom.library.sl.Strategy  v) { return ( ( (( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )==null)?v:new tom.library.sl.Choice(v,( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )) ) );}private static  tom.library.sl.Strategy  tom_make_TopDown( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}private static  tom.library.sl.Strategy  tom_make_InnermostId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )) )) ) );}   /* Generated by TOM (version 2.6alpha): Do not edit this file */ 











  // ------------------------------------------------------------

  private SymbolTable symbolTable;
  private boolean camlsemantics = false;

  public Verifier(boolean camlsemantics) {
    super();
    this.camlsemantics = camlsemantics;
  }

  public void setSymbolTable(SymbolTable symbolTable) {
    this.symbolTable = symbolTable;
  }

  public SymbolTable getSymbolTable() {
    return symbolTable;
  }

  public boolean isCamlSemantics() {
    return camlsemantics;
  }

  public Term termFromTomTerm(TomTerm tomterm) {
    {if ( (tomterm instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch292NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tomterm);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch292NameNumber_freshVar_1=tomMatch292NameNumberfreshSubject_1;if ( (tomMatch292NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch292NameNumber_freshVar_0= tomMatch292NameNumber_freshVar_1.getAstExpression() ;if ( true ) {

        return termFromExpresssion(tomMatch292NameNumber_freshVar_0);
      }}}}}}if ( (tomterm instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch292NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tomterm);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch292NameNumber_freshVar_3=tomMatch292NameNumberfreshSubject_1;if ( (tomMatch292NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch292NameNumber_freshVar_2= tomMatch292NameNumber_freshVar_3.getAstName() ;if ( true ) {

        return termFromTomName(tomMatch292NameNumber_freshVar_2);
      }}}}}}}

    System.out.println("termFromTomTerm don't know how to handle this: " + tomterm);
    return  tom.engine.adt.il.types.term.repr.make("foirade") ;
  }

  Variable variableFromTomName(TomName name) {
    {if ( (name instanceof tom.engine.adt.tomname.types.TomName) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )name);{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumber_freshVar_1=tomMatch293NameNumberfreshSubject_1;if ( (tomMatch293NameNumber_freshVar_1 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch293NameNumber_freshVar_0= tomMatch293NameNumber_freshVar_1.getString() ;if ( true ) {

        return  tom.engine.adt.il.types.variable.var.make(tomMatch293NameNumber_freshVar_0) ;
      }}}}}}if ( (name instanceof tom.engine.adt.tomname.types.TomName) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )name);{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumber_freshVar_3=tomMatch293NameNumberfreshSubject_1;if ( (tomMatch293NameNumber_freshVar_3 instanceof tom.engine.adt.tomname.types.tomname.PositionName) ) {{  tom.engine.adt.tomname.types.TomNumberList  tomMatch293NameNumber_freshVar_2= tomMatch293NameNumber_freshVar_3.getNumberList() ;if ( true ) {

        return  tom.engine.adt.il.types.variable.var.make(TomBase.tomNumberListToString(tomMatch293NameNumber_freshVar_2)) ;
      }}}}}}if ( (name instanceof tom.engine.adt.tomname.types.TomName) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )name);{  tom.engine.adt.tomname.types.TomName  tomMatch293NameNumber_freshVar_4=tomMatch293NameNumberfreshSubject_1;if ( (tomMatch293NameNumber_freshVar_4 instanceof tom.engine.adt.tomname.types.tomname.EmptyName) ) {if ( true ) {

        return  tom.engine.adt.il.types.variable.var.make("emptyName") ;
      }}}}}}

    return  tom.engine.adt.il.types.variable.var.make("error while building variable name") ;
  }

  Term termFromTomName(TomName name) {
    return  tom.engine.adt.il.types.term.tau.make( tom.engine.adt.il.types.absterm.absvar.make(variableFromTomName(name)) ) ;
  }

  public Term termFromExpresssion(Expression expression) {
    {if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_3=tomMatch294NameNumberfreshSubject_1;if ( (tomMatch294NameNumber_freshVar_3 instanceof tom.engine.adt.tomexpression.types.expression.GetSlot) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_0= tomMatch294NameNumber_freshVar_3.getAstName() ;{  String  tomMatch294NameNumber_freshVar_1= tomMatch294NameNumber_freshVar_3.getSlotNameString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_2= tomMatch294NameNumber_freshVar_3.getVariable() ;{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_5=tomMatch294NameNumber_freshVar_0;if ( (tomMatch294NameNumber_freshVar_5 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch294NameNumber_freshVar_4= tomMatch294NameNumber_freshVar_5.getString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_7=tomMatch294NameNumber_freshVar_2;if ( (tomMatch294NameNumber_freshVar_7 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_6= tomMatch294NameNumber_freshVar_7.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch294NameNumber_freshVar_6);
        return  tom.engine.adt.il.types.term.slot.make( tom.engine.adt.il.types.symbol.fsymbol.make(tomMatch294NameNumber_freshVar_4) , term, tomMatch294NameNumber_freshVar_1) ;
      }}}}}}}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_11=tomMatch294NameNumberfreshSubject_1;if ( (tomMatch294NameNumber_freshVar_11 instanceof tom.engine.adt.tomexpression.types.expression.GetSlot) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_8= tomMatch294NameNumber_freshVar_11.getAstName() ;{  String  tomMatch294NameNumber_freshVar_9= tomMatch294NameNumber_freshVar_11.getSlotNameString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_10= tomMatch294NameNumber_freshVar_11.getVariable() ;{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_13=tomMatch294NameNumber_freshVar_8;if ( (tomMatch294NameNumber_freshVar_13 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch294NameNumber_freshVar_12= tomMatch294NameNumber_freshVar_13.getString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_15=tomMatch294NameNumber_freshVar_10;if ( (tomMatch294NameNumber_freshVar_15 instanceof tom.engine.adt.tomterm.types.tomterm.Ref) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_14= tomMatch294NameNumber_freshVar_15.getTomTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_17=tomMatch294NameNumber_freshVar_14;if ( (tomMatch294NameNumber_freshVar_17 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_16= tomMatch294NameNumber_freshVar_17.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch294NameNumber_freshVar_16);
        return  tom.engine.adt.il.types.term.slot.make( tom.engine.adt.il.types.symbol.fsymbol.make(tomMatch294NameNumber_freshVar_12) , term, tomMatch294NameNumber_freshVar_9) ;
      }}}}}}}}}}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_19=tomMatch294NameNumberfreshSubject_1;if ( (tomMatch294NameNumber_freshVar_19 instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_18= tomMatch294NameNumber_freshVar_19.getAstTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_21=tomMatch294NameNumber_freshVar_18;if ( (tomMatch294NameNumber_freshVar_21 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_20= tomMatch294NameNumber_freshVar_21.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch294NameNumber_freshVar_20);
        return term;
      }}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_23=tomMatch294NameNumberfreshSubject_1;if ( (tomMatch294NameNumber_freshVar_23 instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_22= tomMatch294NameNumber_freshVar_23.getAstTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_25=tomMatch294NameNumber_freshVar_22;if ( (tomMatch294NameNumber_freshVar_25 instanceof tom.engine.adt.tomterm.types.tomterm.Ref) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_24= tomMatch294NameNumber_freshVar_25.getTomTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch294NameNumber_freshVar_27=tomMatch294NameNumber_freshVar_24;if ( (tomMatch294NameNumber_freshVar_27 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch294NameNumber_freshVar_26= tomMatch294NameNumber_freshVar_27.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch294NameNumber_freshVar_26);
        return term;
      }}}}}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_29=tomMatch294NameNumberfreshSubject_1;if ( (tomMatch294NameNumber_freshVar_29 instanceof tom.engine.adt.tomexpression.types.expression.Cast) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch294NameNumber_freshVar_28= tomMatch294NameNumber_freshVar_29.getSource() ;if ( true ) {

        return termFromExpresssion(tomMatch294NameNumber_freshVar_28);
      }}}}}}}

    System.out.println("termFromExpresssion don't know how to handle this: " + expression);
    return  tom.engine.adt.il.types.term.repr.make("autre foirade avec " + expression) ;
  }

  public Expr exprFromExpression(Expression expression) {
    {if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_0=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_0 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {
 return  tom.engine.adt.il.types.expr.iltrue.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ) ; }}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_1=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_1 instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {if ( true ) {
 return  tom.engine.adt.il.types.expr.ilfalse.make() ; }}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_4=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_4 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_2= tomMatch295NameNumber_freshVar_4.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_3= tomMatch295NameNumber_freshVar_4.getVariable() ;{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_6=tomMatch295NameNumber_freshVar_2;if ( (tomMatch295NameNumber_freshVar_6 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch295NameNumber_freshVar_5= tomMatch295NameNumber_freshVar_6.getString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_8=tomMatch295NameNumber_freshVar_3;if ( (tomMatch295NameNumber_freshVar_8 instanceof tom.engine.adt.tomterm.types.tomterm.Ref) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_7= tomMatch295NameNumber_freshVar_8.getTomTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_10=tomMatch295NameNumber_freshVar_7;if ( (tomMatch295NameNumber_freshVar_10 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_9= tomMatch295NameNumber_freshVar_10.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch295NameNumber_freshVar_9);
        return  tom.engine.adt.il.types.expr.isfsym.make(term,  tom.engine.adt.il.types.symbol.fsymbol.make(tomMatch295NameNumber_freshVar_5) ) ;
      }}}}}}}}}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_13=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_13 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_11= tomMatch295NameNumber_freshVar_13.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_12= tomMatch295NameNumber_freshVar_13.getVariable() ;{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_15=tomMatch295NameNumber_freshVar_11;if ( (tomMatch295NameNumber_freshVar_15 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch295NameNumber_freshVar_14= tomMatch295NameNumber_freshVar_15.getString() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_17=tomMatch295NameNumber_freshVar_12;if ( (tomMatch295NameNumber_freshVar_17 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch295NameNumber_freshVar_16= tomMatch295NameNumber_freshVar_17.getAstName() ;if ( true ) {

        Term term = termFromTomName(tomMatch295NameNumber_freshVar_16);
        return  tom.engine.adt.il.types.expr.isfsym.make(term,  tom.engine.adt.il.types.symbol.fsymbol.make(tomMatch295NameNumber_freshVar_14) ) ;
      }}}}}}}}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_20=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_20 instanceof tom.engine.adt.tomexpression.types.expression.EqualTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_18= tomMatch295NameNumber_freshVar_20.getKid1() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch295NameNumber_freshVar_19= tomMatch295NameNumber_freshVar_20.getKid2() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.eq.make(termFromTomTerm(tomMatch295NameNumber_freshVar_18), termFromTomTerm(tomMatch295NameNumber_freshVar_19)) ;
      }}}}}}}if ( (expression instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )expression);{  tom.engine.adt.tomexpression.types.Expression  tomMatch295NameNumber_freshVar_21=tomMatch295NameNumberfreshSubject_1;if ( (tomMatch295NameNumber_freshVar_21 instanceof tom.engine.adt.tomexpression.types.expression.IsSort) ) {if ( true ) {
 return  tom.engine.adt.il.types.expr.iltrue.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ) ; }}}}}}

    System.out.println("exprFromExpression don't know how to handle this: " + expression);
    return  tom.engine.adt.il.types.expr.ilfalse.make() ;
  }

  public Instr instrFromInstructionList(InstructionList instrlist) {
    InstrList list =  tom.engine.adt.il.types.instrlist.Emptysemicolon.make() ;
    while (!instrlist.isEmptyconcInstruction()) {
      Instruction i = (Instruction) instrlist.getHeadconcInstruction();
      instrlist = instrlist.getTailconcInstruction();
      list = tom_append_list_semicolon(list, tom.engine.adt.il.types.instrlist.Conssemicolon.make(instrFromInstruction(i), tom.engine.adt.il.types.instrlist.Emptysemicolon.make() ) );
    }
    return  tom.engine.adt.il.types.instr.sequence.make(list) ;
  }

  public Instr instrFromInstruction(Instruction automata) {
    {if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_2=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {{  tom.engine.adt.tomconstraint.types.Constraint  tomMatch296NameNumber_freshVar_0= tomMatch296NameNumber_freshVar_2.getPositivePattern() ;{  tom.engine.adt.tomconstraint.types.ConstraintList  tomMatch296NameNumber_freshVar_1= tomMatch296NameNumber_freshVar_2.getNegativePatternList() ;if ( true ) {

        return  tom.engine.adt.il.types.instr.accept.make(tomMatch296NameNumber_freshVar_0.toATerm(), tomMatch296NameNumber_freshVar_1.toATerm()) ;
      }}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_6=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_6 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch296NameNumber_freshVar_3= tomMatch296NameNumber_freshVar_6.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_4= tomMatch296NameNumber_freshVar_6.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_5= tomMatch296NameNumber_freshVar_6.getFailureInst() ;if ( true ) {


        return  tom.engine.adt.il.types.instr.ITE.make(exprFromExpression(tomMatch296NameNumber_freshVar_3), instrFromInstruction(tomMatch296NameNumber_freshVar_4), instrFromInstruction(tomMatch296NameNumber_freshVar_5)) 

;
      }}}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_10=tomMatch296NameNumberfreshSubject_1;{ boolean tomMatch296NameNumber_freshVar_13= false ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_9= null ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch296NameNumber_freshVar_8= null ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch296NameNumber_freshVar_7= null ;if ( (tomMatch296NameNumber_freshVar_10 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{tomMatch296NameNumber_freshVar_13= true ;tomMatch296NameNumber_freshVar_7= tomMatch296NameNumber_freshVar_10.getVariable() ;tomMatch296NameNumber_freshVar_8= tomMatch296NameNumber_freshVar_10.getSource() ;tomMatch296NameNumber_freshVar_9= tomMatch296NameNumber_freshVar_10.getAstInstruction() ;}} else {if ( (tomMatch296NameNumber_freshVar_10 instanceof tom.engine.adt.tominstruction.types.instruction.LetRef) ) {{tomMatch296NameNumber_freshVar_13= true ;tomMatch296NameNumber_freshVar_7= tomMatch296NameNumber_freshVar_10.getVariable() ;tomMatch296NameNumber_freshVar_8= tomMatch296NameNumber_freshVar_10.getSource() ;tomMatch296NameNumber_freshVar_9= tomMatch296NameNumber_freshVar_10.getAstInstruction() ;}} else {if ( (tomMatch296NameNumber_freshVar_10 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{tomMatch296NameNumber_freshVar_13= true ;tomMatch296NameNumber_freshVar_7= tomMatch296NameNumber_freshVar_10.getVariable() ;tomMatch296NameNumber_freshVar_8= tomMatch296NameNumber_freshVar_10.getSource() ;tomMatch296NameNumber_freshVar_9= tomMatch296NameNumber_freshVar_10.getAstInstruction() ;}}}}if ( tomMatch296NameNumber_freshVar_13== true  ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch296NameNumber_freshVar_12=tomMatch296NameNumber_freshVar_7;if ( (tomMatch296NameNumber_freshVar_12 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch296NameNumber_freshVar_11= tomMatch296NameNumber_freshVar_12.getAstName() ;if ( true ) {

        Variable thevar = variableFromTomName(tomMatch296NameNumber_freshVar_11);
        return  tom.engine.adt.il.types.instr.ILLet.make(thevar, termFromExpresssion(tomMatch296NameNumber_freshVar_8), instrFromInstruction(tomMatch296NameNumber_freshVar_9)) 

;
      }}}}}}}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_17=tomMatch296NameNumberfreshSubject_1;{ boolean tomMatch296NameNumber_freshVar_19= false ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_16= null ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch296NameNumber_freshVar_15= null ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch296NameNumber_freshVar_14= null ;if ( (tomMatch296NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{tomMatch296NameNumber_freshVar_19= true ;tomMatch296NameNumber_freshVar_14= tomMatch296NameNumber_freshVar_17.getVariable() ;tomMatch296NameNumber_freshVar_15= tomMatch296NameNumber_freshVar_17.getSource() ;tomMatch296NameNumber_freshVar_16= tomMatch296NameNumber_freshVar_17.getAstInstruction() ;}} else {if ( (tomMatch296NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{tomMatch296NameNumber_freshVar_19= true ;tomMatch296NameNumber_freshVar_14= tomMatch296NameNumber_freshVar_17.getVariable() ;tomMatch296NameNumber_freshVar_15= tomMatch296NameNumber_freshVar_17.getSource() ;tomMatch296NameNumber_freshVar_16= tomMatch296NameNumber_freshVar_17.getAstInstruction() ;}} else {if ( (tomMatch296NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.LetRef) ) {{tomMatch296NameNumber_freshVar_19= true ;tomMatch296NameNumber_freshVar_14= tomMatch296NameNumber_freshVar_17.getVariable() ;tomMatch296NameNumber_freshVar_15= tomMatch296NameNumber_freshVar_17.getSource() ;tomMatch296NameNumber_freshVar_16= tomMatch296NameNumber_freshVar_17.getAstInstruction() ;}}}}if ( tomMatch296NameNumber_freshVar_19== true  ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch296NameNumber_freshVar_18=tomMatch296NameNumber_freshVar_14;if ( (tomMatch296NameNumber_freshVar_18 instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariable) ) {if ( true ) {

        return instrFromInstruction(tomMatch296NameNumber_freshVar_16);
      }}}}}}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_21=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_21 instanceof tom.engine.adt.tominstruction.types.instruction.CompiledPattern) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_20= tomMatch296NameNumber_freshVar_21.getAutomataInst() ;if ( true ) {

        return instrFromInstruction(tomMatch296NameNumber_freshVar_20);
      }}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_23=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_23 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch296NameNumber_freshVar_22= tomMatch296NameNumber_freshVar_23.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch296NameNumber_freshVar_24=tomMatch296NameNumber_freshVar_22;if ( ((tomMatch296NameNumber_freshVar_24 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch296NameNumber_freshVar_24 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if (!( tomMatch296NameNumber_freshVar_24.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tom_instr= tomMatch296NameNumber_freshVar_24.getHeadconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch296NameNumber_freshVar_25= tomMatch296NameNumber_freshVar_24.getTailconcInstruction() ;if ( tomMatch296NameNumber_freshVar_25.isEmptyconcInstruction() ) {if ( true ) {

        return instrFromInstruction(tom_instr);
      }}}}}}}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_27=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_27 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch296NameNumber_freshVar_26= tomMatch296NameNumber_freshVar_27.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch296NameNumber_freshVar_28=tomMatch296NameNumber_freshVar_26;if ( ((tomMatch296NameNumber_freshVar_28 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch296NameNumber_freshVar_28 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if ( true ) {

        return instrFromInstructionList(tomMatch296NameNumber_freshVar_28);
      }}}}}}}}if ( (automata instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )automata);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch296NameNumber_freshVar_30=tomMatch296NameNumberfreshSubject_1;if ( (tomMatch296NameNumber_freshVar_30 instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {if ( true ) {

        // tom uses nop in the iffalse part of ITE
        return  tom.engine.adt.il.types.instr.refuse.make() ;
      }}}}}}

    System.out.println("instrFromInstruction don't know how to handle this : " + automata);
    return  tom.engine.adt.il.types.instr.refuse.make() ;
  }

  private SubstitutionList abstractSubstitutionFromAccept(Instr instr) {
    SubstitutionList substitution =  tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ;
    {if ( (instr instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch297NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )instr);{  tom.engine.adt.il.types.Instr  tomMatch297NameNumber_freshVar_2=tomMatch297NameNumberfreshSubject_1;if ( (tomMatch297NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.instr.accept) ) {{  aterm.ATerm  tomMatch297NameNumber_freshVar_0= tomMatch297NameNumber_freshVar_2.getPositive() ;{  aterm.ATerm  tomMatch297NameNumber_freshVar_1= tomMatch297NameNumber_freshVar_2.getNegative() ;if ( true ) {

        Constraint positivePattern = Constraint.fromTerm(tomMatch297NameNumber_freshVar_0);
        ArrayList<TomTerm> subjectList = new ArrayList<TomTerm>();
        try{
          tom_make_TopDown(tom_make_CollectSubjects(subjectList)).visitLight(positivePattern);
        }catch(VisitFailure e){
          throw new TomRuntimeException("VisitFailure in Verifier.abstractSubstitutionFromAccept:" + e.getMessage()); 
        }
        for(TomTerm subject: subjectList){
          {if ( (subject instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch298NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )subject);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch298NameNumber_freshVar_1=tomMatch298NameNumberfreshSubject_1;if ( (tomMatch298NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch298NameNumber_freshVar_0= tomMatch298NameNumber_freshVar_1.getAstName() ;if ( true ) {

              substitution = tom_append_list_subs(substitution, tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.is.make(variableFromTomName(tomMatch298NameNumber_freshVar_0), termFromTomTerm(subject)) , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) )


;
            }}}}}}}
          
        }
      }}}}}}}}

    return substitution;
  }

  private static class CollectSubjects extends tom.library.sl.BasicStrategy {private  java.util.List  list;public CollectSubjects( java.util.List  list) {super(( new tom.library.sl.Identity() ));this.list=list;}public  java.util.List  getlist() {return list;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomconstraint.types.Constraint  visit_Constraint( tom.engine.adt.tomconstraint.types.Constraint  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomconstraint.types.Constraint) ) {{  tom.engine.adt.tomconstraint.types.Constraint  tomMatch299NameNumberfreshSubject_1=(( tom.engine.adt.tomconstraint.types.Constraint )tom__arg);{  tom.engine.adt.tomconstraint.types.Constraint  tomMatch299NameNumber_freshVar_2=tomMatch299NameNumberfreshSubject_1;if ( (tomMatch299NameNumber_freshVar_2 instanceof tom.engine.adt.tomconstraint.types.constraint.MatchConstraint) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch299NameNumber_freshVar_0= tomMatch299NameNumber_freshVar_2.getPattern() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch299NameNumber_freshVar_1= tomMatch299NameNumber_freshVar_2.getSubject() ;if ( true ) {


        list.add(tomMatch299NameNumber_freshVar_1);
      }}}}}}}}return _visit_Constraint(tom__arg,introspector); }public  tom.engine.adt.tomconstraint.types.Constraint  _visit_Constraint( tom.engine.adt.tomconstraint.types.Constraint  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.tomconstraint.types.Constraint )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomconstraint.types.Constraint )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomconstraint.types.Constraint) ) {return visit_Constraint((( tom.engine.adt.tomconstraint.types.Constraint )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_CollectSubjects( java.util.List  t0) { return new CollectSubjects(t0);}



  public Collection build_tree(Instruction automata) {
    // System.out.println("Build derivation tree for: " + automata);

    // collects the accept in the automata
    Collection localAccepts = collectAccept(automata);

    Iterator iter = localAccepts.iterator();
    Collection treeList = new HashSet();
    while(iter.hasNext()) {
      Instr localAccept = (Instr) iter.next();

      // builds the initial abstract substitution
      SubstitutionList initialsubstitution = abstractSubstitutionFromAccept(localAccept);
      Environment startingenv =  tom.engine.adt.il.types.environment.env.make(initialsubstitution, instrFromInstruction(automata)) 
;

      Deriv startingderiv =  tom.engine.adt.il.types.deriv.ebs.make(startingenv,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , localAccept) ) 
;

      Collection treeListPre = applySemanticsRules(startingderiv);
      // replace substitutions in trees
      Iterator it = treeListPre.iterator();
      while(it.hasNext()) {
        DerivTree tree = (DerivTree) it.next();
        SubstitutionList outputsubst = getOutputSubstitution(tree);
        tree = replaceUndefinedSubstitution(tree,outputsubst);
        treeList.add(tree);
      }
    }

    return treeList;
  }

  public Map getConstraints(Instruction automata) {
    // collects the accept in the automata
    Collection localAccepts = collectAccept(automata);

    Iterator iter = localAccepts.iterator();
    Map constraintList = new HashMap();
    while(iter.hasNext()) {
      Instr localAccept = (Instr) iter.next();

      // builds the initial abstract substitution
      SubstitutionList initialsubstitution = abstractSubstitutionFromAccept(localAccept);
      Expr constraints = buildConstraint(initialsubstitution,
          instrFromInstruction(automata),
          localAccept);
      constraintList.put(localAccept,constraints);
    }
    return constraintList;
  }

  private static class substitutionCollector extends tom.library.sl.BasicStrategy {private  SubstRef  outsubst;public substitutionCollector( SubstRef  outsubst) {super(( new tom.library.sl.Identity() ));this.outsubst=outsubst;}public  SubstRef  getoutsubst() {return outsubst;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.il.types.Expr  visit_Expr( tom.engine.adt.il.types.Expr  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch300NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )tom__arg);{  tom.engine.adt.il.types.Expr  tomMatch300NameNumber_freshVar_1=tomMatch300NameNumberfreshSubject_1;if ( (tomMatch300NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.expr.iltrue) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch300NameNumber_freshVar_0= tomMatch300NameNumber_freshVar_1.getSubst() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch300NameNumber_freshVar_2=tomMatch300NameNumber_freshVar_0;if ( ((tomMatch300NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch300NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch300NameNumber_freshVar_2.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch300NameNumber_freshVar_4= tomMatch300NameNumber_freshVar_2.getHeadsubs() ;if ( (tomMatch300NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch300NameNumber_freshVar_3= tomMatch300NameNumber_freshVar_2.getTailsubs() ;if ( tomMatch300NameNumber_freshVar_3.isEmptysubs() ) {if ( true ) {( new tom.library.sl.Fail() )


.visitLight(tomMatch300NameNumberfreshSubject_1);
      }}}}}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch300NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )tom__arg);{  tom.engine.adt.il.types.Expr  tomMatch300NameNumber_freshVar_6=tomMatch300NameNumberfreshSubject_1;if ( (tomMatch300NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.expr.iltrue) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch300NameNumber_freshVar_5= tomMatch300NameNumber_freshVar_6.getSubst() ;if ( true ) {

        outsubst.set(tomMatch300NameNumber_freshVar_5);
      }}}}}}}return _visit_Expr(tom__arg,introspector); }public  tom.engine.adt.il.types.Expr  _visit_Expr( tom.engine.adt.il.types.Expr  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.il.types.Expr )any.visit(environment,introspector));} else {return (( tom.engine.adt.il.types.Expr )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.il.types.Expr) ) {return visit_Expr((( tom.engine.adt.il.types.Expr )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_substitutionCollector( SubstRef  t0) { return new substitutionCollector(t0);}


  public SubstitutionList collectSubstitutionInConstraint(Expr expr) {
    SubstRef output = new SubstRef( tom.engine.adt.il.types.substitutionlist.Emptysubs.make() );
    try {
      ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("x") ),tom_make_Try(( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ),( null )) )==null)?tom_make_substitutionCollector(output):new tom.library.sl.Sequence(tom_make_substitutionCollector(output),( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ),( null )) )) ))) ).visitLight(expr);
    } catch (tom.library.sl.VisitFailure e) {
      throw new TomRuntimeException("Strategy substitutionCollector failed");
    }
    return output.get();
  }

  private static class outputSubstitutionCollector extends tom.library.sl.BasicStrategy {private  SubstRef  outsubst;public outputSubstitutionCollector( SubstRef  outsubst) {super(( new tom.library.sl.Identity() ));this.outsubst=outsubst;}public  SubstRef  getoutsubst() {return outsubst;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.il.types.Deriv  visit_Deriv( tom.engine.adt.il.types.Deriv  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch301NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )tom__arg);{  tom.engine.adt.il.types.Deriv  tomMatch301NameNumber_freshVar_2=tomMatch301NameNumberfreshSubject_1;if ( (tomMatch301NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch301NameNumber_freshVar_0= tomMatch301NameNumber_freshVar_2.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch301NameNumber_freshVar_1= tomMatch301NameNumber_freshVar_2.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch301NameNumber_freshVar_5=tomMatch301NameNumber_freshVar_0;if ( (tomMatch301NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch301NameNumber_freshVar_3= tomMatch301NameNumber_freshVar_5.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch301NameNumber_freshVar_4= tomMatch301NameNumber_freshVar_5.getI() ;{  tom.engine.adt.il.types.Instr  tomMatch301NameNumber_freshVar_6=tomMatch301NameNumber_freshVar_4;if ( (tomMatch301NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.instr.accept) ) {{  tom.engine.adt.il.types.Environment  tomMatch301NameNumber_freshVar_9=tomMatch301NameNumber_freshVar_1;if ( (tomMatch301NameNumber_freshVar_9 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch301NameNumber_freshVar_7= tomMatch301NameNumber_freshVar_9.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch301NameNumber_freshVar_8= tomMatch301NameNumber_freshVar_9.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch301NameNumber_freshVar_11=tomMatch301NameNumber_freshVar_7;if ( ((tomMatch301NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch301NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch301NameNumber_freshVar_11.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch301NameNumber_freshVar_13= tomMatch301NameNumber_freshVar_11.getHeadsubs() ;if ( (tomMatch301NameNumber_freshVar_13 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch301NameNumber_freshVar_12= tomMatch301NameNumber_freshVar_11.getTailsubs() ;if ( tomMatch301NameNumber_freshVar_12.isEmptysubs() ) {{  tom.engine.adt.il.types.Instr  tomMatch301NameNumber_freshVar_10=tomMatch301NameNumber_freshVar_8;if ( (tomMatch301NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.instr.accept) ) {if ( true ) {


        outsubst.set(tomMatch301NameNumber_freshVar_3);
      }}}}}}}}}}}}}}}}}}}}}}}}}}}return _visit_Deriv(tom__arg,introspector); }public  tom.engine.adt.il.types.Deriv  _visit_Deriv( tom.engine.adt.il.types.Deriv  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.il.types.Deriv )any.visit(environment,introspector));} else {return (( tom.engine.adt.il.types.Deriv )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.il.types.Deriv) ) {return visit_Deriv((( tom.engine.adt.il.types.Deriv )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_outputSubstitutionCollector( SubstRef  t0) { return new outputSubstitutionCollector(t0);}



  public SubstitutionList getOutputSubstitution(DerivTree subject) {
    SubstRef output = new SubstRef( tom.engine.adt.il.types.substitutionlist.Emptysubs.make() );
    try {
      tom_make_TopDown(tom_make_outputSubstitutionCollector(output)).visitLight(subject);
    } catch (tom.library.sl.VisitFailure e) {
      throw new TomRuntimeException("Strategy outputSubstitutionCollector failed");
    }
    return output.get();
  }

  private static class acceptCollector extends tom.library.sl.BasicStrategy {private  java.util.Collection  store;public acceptCollector( java.util.Collection  store) {super(( new tom.library.sl.Identity() ));this.store=store;}public  java.util.Collection  getstore() {return store;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch302NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch302NameNumber_freshVar_2=tomMatch302NameNumberfreshSubject_1;if ( (tomMatch302NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {{  tom.engine.adt.tomconstraint.types.Constraint  tomMatch302NameNumber_freshVar_0= tomMatch302NameNumber_freshVar_2.getPositivePattern() ;{  tom.engine.adt.tomconstraint.types.ConstraintList  tomMatch302NameNumber_freshVar_1= tomMatch302NameNumber_freshVar_2.getNegativePatternList() ;if ( true ) {


        store.add( tom.engine.adt.il.types.instr.accept.make(tomMatch302NameNumber_freshVar_0.toATerm(), tomMatch302NameNumber_freshVar_1.toATerm()) );
      }}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_acceptCollector( java.util.Collection  t0) { return new acceptCollector(t0);}



  public Collection collectAccept(Instruction subject) {
    Collection result = new HashSet();
    try {
      tom_make_TopDown(tom_make_acceptCollector(result)).visitLight(subject);
    } catch (tom.library.sl.VisitFailure e) {
      throw new TomRuntimeException("Strategy collectAccept failed");
    }
    return result;
  }


  /**
   * The axioms the mapping has to verify
   */
  protected Seq seqFromTerm(Term sp) {
    TermList ded =  tom.engine.adt.il.types.termlist.ConsconcTerm.make(sp, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ;
    {if ( (sp instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch303NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )sp);{  tom.engine.adt.il.types.Term  tomMatch303NameNumber_freshVar_0=tomMatch303NameNumberfreshSubject_1;if ( (tomMatch303NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.term.appSubsT) ) {if ( true ) {

        TermList follow = applyMappingRules(replaceVariablesInTerm(sp));
        ded = tom_append_list_concTerm(ded,tom_append_list_concTerm(follow, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ));
      }}}}}}

    return  tom.engine.adt.il.types.seq.dedterm.make(tom_append_list_concTerm(ded, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() )) ;
  }

  protected ExprList exprListFromExpr(Expr sp) {
    ExprList ded =  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(sp, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ;
    {if ( (sp instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch304NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )sp);{  tom.engine.adt.il.types.Expr  tomMatch304NameNumber_freshVar_0=tomMatch304NameNumberfreshSubject_1;if ( (tomMatch304NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.expr.appSubsE) ) {if ( true ) {

        ExprList follow = applyExprRules(replaceVariablesInExpr(sp));
        ded = tom_append_list_concExpr(ded,tom_append_list_concExpr(follow, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ));
      }}}}}}


    // System.out.println("dedexpr gives: " + ded);
    return ded;
  }

  protected SubstitutionList reduceSubstitutionWithMappingRules(SubstitutionList subst) {
    {if ( (subst instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )subst);{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumber_freshVar_0=tomMatch305NameNumberfreshSubject_1;if ( ((tomMatch305NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch305NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if ( tomMatch305NameNumber_freshVar_0.isEmptysubs() ) {if ( true ) {

        return subst;
      }}}}}}if ( (subst instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )subst);{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumber_freshVar_1=tomMatch305NameNumberfreshSubject_1;if ( ((tomMatch305NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch305NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch305NameNumber_freshVar_1.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch305NameNumber_freshVar_6= tomMatch305NameNumber_freshVar_1.getHeadsubs() ;if ( (tomMatch305NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.substitution.is) ) {{  tom.engine.adt.il.types.Variable  tomMatch305NameNumber_freshVar_4= tomMatch305NameNumber_freshVar_6.getVar() ;{  tom.engine.adt.il.types.Term  tomMatch305NameNumber_freshVar_5= tomMatch305NameNumber_freshVar_6.getTerm() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumber_freshVar_2= tomMatch305NameNumber_freshVar_1.getTailsubs() ;if ( true ) {

        SubstitutionList tail = reduceSubstitutionWithMappingRules(tomMatch305NameNumber_freshVar_2);
        return  tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.is.make(tomMatch305NameNumber_freshVar_4, reduceTermWithMappingRules(replaceVariablesInTerm( tom.engine.adt.il.types.term.appSubsT.make(tail, tomMatch305NameNumber_freshVar_5) ))) ,tom_append_list_subs(tail, tom.engine.adt.il.types.substitutionlist.Emptysubs.make() )) ;
      }}}}}}}}}}}if ( (subst instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )subst);{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumber_freshVar_7=tomMatch305NameNumberfreshSubject_1;if ( ((tomMatch305NameNumber_freshVar_7 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch305NameNumber_freshVar_7 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch305NameNumber_freshVar_7.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch305NameNumber_freshVar_10= tomMatch305NameNumber_freshVar_7.getHeadsubs() ;if ( (tomMatch305NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch305NameNumber_freshVar_8= tomMatch305NameNumber_freshVar_7.getTailsubs() ;if ( true ) {

        SubstitutionList tail = reduceSubstitutionWithMappingRules(tomMatch305NameNumber_freshVar_8);
        return  tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() ,tom_append_list_subs(tail, tom.engine.adt.il.types.substitutionlist.Emptysubs.make() )) ;
      }}}}}}}}}}

    return subst;
  }
  protected Expr reduceWithMappingRules(Expr ex) {
    {if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_2=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.expr.eq) ) {{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_0= tomMatch306NameNumber_freshVar_2.getLt() ;{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_1= tomMatch306NameNumber_freshVar_2.getRt() ;{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_4=tomMatch306NameNumber_freshVar_0;if ( (tomMatch306NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch306NameNumber_freshVar_3= tomMatch306NameNumber_freshVar_4.getAbst() ;{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_6=tomMatch306NameNumber_freshVar_1;if ( (tomMatch306NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch306NameNumber_freshVar_5= tomMatch306NameNumber_freshVar_6.getAbst() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.teq.make(tomMatch306NameNumber_freshVar_3, tomMatch306NameNumber_freshVar_5) ;
      }}}}}}}}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_9=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_9 instanceof tom.engine.adt.il.types.expr.isfsym) ) {{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_7= tomMatch306NameNumber_freshVar_9.getT() ;{  tom.engine.adt.il.types.Symbol  tomMatch306NameNumber_freshVar_8= tomMatch306NameNumber_freshVar_9.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_11=tomMatch306NameNumber_freshVar_7;if ( (tomMatch306NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch306NameNumber_freshVar_10= tomMatch306NameNumber_freshVar_11.getAbst() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.tisfsym.make(tomMatch306NameNumber_freshVar_10, tomMatch306NameNumber_freshVar_8) ;
      }}}}}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_14=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.expr.eq) ) {{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_12= tomMatch306NameNumber_freshVar_14.getLt() ;{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_13= tomMatch306NameNumber_freshVar_14.getRt() ;if ( true ) {

        // first reduce the argument
        return reduceWithMappingRules( tom.engine.adt.il.types.expr.eq.make(reduceTermWithMappingRules(tomMatch306NameNumber_freshVar_12), reduceTermWithMappingRules(tomMatch306NameNumber_freshVar_13)) );
      }}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_17=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_17 instanceof tom.engine.adt.il.types.expr.isfsym) ) {{  tom.engine.adt.il.types.Term  tomMatch306NameNumber_freshVar_15= tomMatch306NameNumber_freshVar_17.getT() ;{  tom.engine.adt.il.types.Symbol  tomMatch306NameNumber_freshVar_16= tomMatch306NameNumber_freshVar_17.getSymbol() ;if ( true ) {

        return reduceWithMappingRules( tom.engine.adt.il.types.expr.isfsym.make(reduceTermWithMappingRules(tomMatch306NameNumber_freshVar_15), tomMatch306NameNumber_freshVar_16) );
      }}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_19=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_19 instanceof tom.engine.adt.il.types.expr.ilnot) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_18= tomMatch306NameNumber_freshVar_19.getExp() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.ilnot.make(reduceWithMappingRules(tomMatch306NameNumber_freshVar_18)) ;
      }}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_21=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_21 instanceof tom.engine.adt.il.types.expr.iltrue) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch306NameNumber_freshVar_20= tomMatch306NameNumber_freshVar_21.getSubst() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.iltrue.make(reduceSubstitutionWithMappingRules(tomMatch306NameNumber_freshVar_20)) ;
      }}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_22=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_22 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

        return ex;
      }}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_25=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_25 instanceof tom.engine.adt.il.types.expr.iland) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_23= tomMatch306NameNumber_freshVar_25.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_24= tomMatch306NameNumber_freshVar_25.getRight() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.iland.make(reduceWithMappingRules(tomMatch306NameNumber_freshVar_23), reduceWithMappingRules(tomMatch306NameNumber_freshVar_24)) ;
      }}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_28=tomMatch306NameNumberfreshSubject_1;if ( (tomMatch306NameNumber_freshVar_28 instanceof tom.engine.adt.il.types.expr.ilor) ) {{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_26= tomMatch306NameNumber_freshVar_28.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch306NameNumber_freshVar_27= tomMatch306NameNumber_freshVar_28.getRight() ;if ( true ) {

        return  tom.engine.adt.il.types.expr.ilor.make(reduceWithMappingRules(tomMatch306NameNumber_freshVar_26), reduceWithMappingRules(tomMatch306NameNumber_freshVar_27)) ;
      }}}}}}}}

    System.out.println("reduceWithMappingRules : nothing applies to:" + ex);
    return ex;
  }

  protected Term reduceTermWithMappingRules(Term trm) {
    {if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch307NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_0=tomMatch307NameNumberfreshSubject_1;if ( (tomMatch307NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.term.tau) ) {if ( true ) {

        return trm;
      }}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch307NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_4=tomMatch307NameNumberfreshSubject_1;if ( (tomMatch307NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.term.subterm) ) {{  tom.engine.adt.il.types.Symbol  tomMatch307NameNumber_freshVar_1= tomMatch307NameNumber_freshVar_4.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_2= tomMatch307NameNumber_freshVar_4.getT() ;{  int  tomMatch307NameNumber_freshVar_3= tomMatch307NameNumber_freshVar_4.getIndex() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_5=tomMatch307NameNumber_freshVar_2;if ( (tomMatch307NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.term.subterm) ) {if ( true ) {

        return reduceTermWithMappingRules( tom.engine.adt.il.types.term.subterm.make(tomMatch307NameNumber_freshVar_1, reduceTermWithMappingRules(tomMatch307NameNumber_freshVar_2), tomMatch307NameNumber_freshVar_3) );
      }}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch307NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_9=tomMatch307NameNumberfreshSubject_1;if ( (tomMatch307NameNumber_freshVar_9 instanceof tom.engine.adt.il.types.term.slot) ) {{  tom.engine.adt.il.types.Symbol  tomMatch307NameNumber_freshVar_6= tomMatch307NameNumber_freshVar_9.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_7= tomMatch307NameNumber_freshVar_9.getT() ;{  String  tomMatch307NameNumber_freshVar_8= tomMatch307NameNumber_freshVar_9.getName() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_10=tomMatch307NameNumber_freshVar_7;if ( (tomMatch307NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.term.slot) ) {if ( true ) {

        return reduceTermWithMappingRules( tom.engine.adt.il.types.term.slot.make(tomMatch307NameNumber_freshVar_6, reduceTermWithMappingRules(tomMatch307NameNumber_freshVar_7), tomMatch307NameNumber_freshVar_8) );
      }}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch307NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_14=tomMatch307NameNumberfreshSubject_1;if ( (tomMatch307NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.term.subterm) ) {{  tom.engine.adt.il.types.Symbol  tomMatch307NameNumber_freshVar_11= tomMatch307NameNumber_freshVar_14.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_12= tomMatch307NameNumber_freshVar_14.getT() ;{  int  tomMatch307NameNumber_freshVar_13= tomMatch307NameNumber_freshVar_14.getIndex() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_16=tomMatch307NameNumber_freshVar_12;if ( (tomMatch307NameNumber_freshVar_16 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch307NameNumber_freshVar_15= tomMatch307NameNumber_freshVar_16.getAbst() ;if ( true ) {

        // we shall test if term t has symbol s
        AbsTerm term =  tom.engine.adt.il.types.absterm.st.make(tomMatch307NameNumber_freshVar_11, tomMatch307NameNumber_freshVar_15, tomMatch307NameNumber_freshVar_13) ;
        return  tom.engine.adt.il.types.term.tau.make(term) ;
      }}}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch307NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_20=tomMatch307NameNumberfreshSubject_1;if ( (tomMatch307NameNumber_freshVar_20 instanceof tom.engine.adt.il.types.term.slot) ) {{  tom.engine.adt.il.types.Symbol  tomMatch307NameNumber_freshVar_17= tomMatch307NameNumber_freshVar_20.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_18= tomMatch307NameNumber_freshVar_20.getT() ;{  String  tomMatch307NameNumber_freshVar_19= tomMatch307NameNumber_freshVar_20.getName() ;{  tom.engine.adt.il.types.Term  tomMatch307NameNumber_freshVar_22=tomMatch307NameNumber_freshVar_18;if ( (tomMatch307NameNumber_freshVar_22 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch307NameNumber_freshVar_21= tomMatch307NameNumber_freshVar_22.getAbst() ;if ( true ) {

        // we shall test if term t has symbol s
        AbsTerm term =  tom.engine.adt.il.types.absterm.sl.make(tomMatch307NameNumber_freshVar_17, tomMatch307NameNumber_freshVar_21, tomMatch307NameNumber_freshVar_19) ;
        return  tom.engine.adt.il.types.term.tau.make(term) ;
      }}}}}}}}}}}}

    System.out.println("reduceTermWithMappingRules : nothing applies to:" + trm);
    return trm;
  }

  protected TermList applyMappingRules(Term trm) {
    {if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch308NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_0=tomMatch308NameNumberfreshSubject_1;if ( (tomMatch308NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.term.tau) ) {if ( true ) {

        return  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ;
      }}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch308NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_4=tomMatch308NameNumberfreshSubject_1;if ( (tomMatch308NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.term.subterm) ) {{  tom.engine.adt.il.types.Symbol  tomMatch308NameNumber_freshVar_1= tomMatch308NameNumber_freshVar_4.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_2= tomMatch308NameNumber_freshVar_4.getT() ;{  int  tomMatch308NameNumber_freshVar_3= tomMatch308NameNumber_freshVar_4.getIndex() ;{  tom.engine.adt.il.types.Symbol  tom_s=tomMatch308NameNumber_freshVar_1;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_5=tomMatch308NameNumber_freshVar_2;if ( (tomMatch308NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.term.subterm) ) {{  int  tom_index=tomMatch308NameNumber_freshVar_3;if ( true ) {

        // first reduce the argument
        TermList reduced = applyMappingRules(tomMatch308NameNumber_freshVar_2);
        TermList res =  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ;
        while(!reduced.isEmptyconcTerm()) {
          Term head = reduced.getHeadconcTerm();
          if (head.istau()) {
            TermList hl = applyMappingRules(head);
            while(!hl.isEmptyconcTerm()) {
              Term h = hl.getHeadconcTerm();
              res = tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.subterm.make(tom_s, h, tom_index) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) );
              hl = hl.getTailconcTerm();
            }
          } else {
            res = tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.subterm.make(tom_s, head, tom_index) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) );
          }
          reduced = reduced.getTailconcTerm();
        }
        return tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() );
      }}}}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch308NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_9=tomMatch308NameNumberfreshSubject_1;if ( (tomMatch308NameNumber_freshVar_9 instanceof tom.engine.adt.il.types.term.slot) ) {{  tom.engine.adt.il.types.Symbol  tomMatch308NameNumber_freshVar_6= tomMatch308NameNumber_freshVar_9.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_7= tomMatch308NameNumber_freshVar_9.getT() ;{  String  tomMatch308NameNumber_freshVar_8= tomMatch308NameNumber_freshVar_9.getName() ;{  tom.engine.adt.il.types.Symbol  tom_s=tomMatch308NameNumber_freshVar_6;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_10=tomMatch308NameNumber_freshVar_7;if ( (tomMatch308NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.term.slot) ) {{  String  tom_slotName=tomMatch308NameNumber_freshVar_8;if ( true ) {

        // first reduce the argument
        TermList reduced = applyMappingRules(tomMatch308NameNumber_freshVar_7);
        TermList res =  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ;
        while(!reduced.isEmptyconcTerm()) {
          Term head = reduced.getHeadconcTerm();
          if (head.istau()) {
            TermList hl = applyMappingRules(head);
            while(!hl.isEmptyconcTerm()) {
              Term h = hl.getHeadconcTerm();
              res = tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.slot.make(tom_s, h, tom_slotName) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) );
              hl = hl.getTailconcTerm();
            }
          } else {
            res = tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.slot.make(tom_s, head, tom_slotName) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) );
          }
          reduced = reduced.getTailconcTerm();
        }
        return tom_append_list_concTerm(res, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() );
      }}}}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch308NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_14=tomMatch308NameNumberfreshSubject_1;if ( (tomMatch308NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.term.subterm) ) {{  tom.engine.adt.il.types.Symbol  tomMatch308NameNumber_freshVar_11= tomMatch308NameNumber_freshVar_14.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_12= tomMatch308NameNumber_freshVar_14.getT() ;{  int  tomMatch308NameNumber_freshVar_13= tomMatch308NameNumber_freshVar_14.getIndex() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_16=tomMatch308NameNumber_freshVar_12;if ( (tomMatch308NameNumber_freshVar_16 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch308NameNumber_freshVar_15= tomMatch308NameNumber_freshVar_16.getAbst() ;if ( true ) {

        // we shall test if term t has symbol s
        AbsTerm term =  tom.engine.adt.il.types.absterm.st.make(tomMatch308NameNumber_freshVar_11, tomMatch308NameNumber_freshVar_15, tomMatch308NameNumber_freshVar_13) ;
        return  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.tau.make(term) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ) ;
      }}}}}}}}}}}if ( (trm instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch308NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )trm);{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_20=tomMatch308NameNumberfreshSubject_1;if ( (tomMatch308NameNumber_freshVar_20 instanceof tom.engine.adt.il.types.term.slot) ) {{  tom.engine.adt.il.types.Symbol  tomMatch308NameNumber_freshVar_17= tomMatch308NameNumber_freshVar_20.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_18= tomMatch308NameNumber_freshVar_20.getT() ;{  String  tomMatch308NameNumber_freshVar_19= tomMatch308NameNumber_freshVar_20.getName() ;{  tom.engine.adt.il.types.Term  tomMatch308NameNumber_freshVar_22=tomMatch308NameNumber_freshVar_18;if ( (tomMatch308NameNumber_freshVar_22 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch308NameNumber_freshVar_21= tomMatch308NameNumber_freshVar_22.getAbst() ;if ( true ) {

        // we shall test if term t has symbol s
        AbsTerm term =  tom.engine.adt.il.types.absterm.sl.make(tomMatch308NameNumber_freshVar_17, tomMatch308NameNumber_freshVar_21, tomMatch308NameNumber_freshVar_19) ;
        return  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.ConsconcTerm.make( tom.engine.adt.il.types.term.tau.make(term) , tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ) ;
      }}}}}}}}}}}}

    System.out.println("apply TermRules : nothing applies to:" + trm);
    return  tom.engine.adt.il.types.termlist.ConsconcTerm.make(trm, tom.engine.adt.il.types.termlist.EmptyconcTerm.make() ) ;
  }

  protected ExprList applyExprRules(Expr ex) {
    {if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_2=tomMatch309NameNumberfreshSubject_1;if ( (tomMatch309NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.expr.eq) ) {{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_0= tomMatch309NameNumber_freshVar_2.getLt() ;{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_1= tomMatch309NameNumber_freshVar_2.getRt() ;{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_4=tomMatch309NameNumber_freshVar_0;if ( (tomMatch309NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch309NameNumber_freshVar_3= tomMatch309NameNumber_freshVar_4.getAbst() ;{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_6=tomMatch309NameNumber_freshVar_1;if ( (tomMatch309NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch309NameNumber_freshVar_5= tomMatch309NameNumber_freshVar_6.getAbst() ;if ( true ) {

        return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.teq.make(tomMatch309NameNumber_freshVar_3, tomMatch309NameNumber_freshVar_5) , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ) ;
      }}}}}}}}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_9=tomMatch309NameNumberfreshSubject_1;if ( (tomMatch309NameNumber_freshVar_9 instanceof tom.engine.adt.il.types.expr.isfsym) ) {{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_7= tomMatch309NameNumber_freshVar_9.getT() ;{  tom.engine.adt.il.types.Symbol  tomMatch309NameNumber_freshVar_8= tomMatch309NameNumber_freshVar_9.getSymbol() ;{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_11=tomMatch309NameNumber_freshVar_7;if ( (tomMatch309NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch309NameNumber_freshVar_10= tomMatch309NameNumber_freshVar_11.getAbst() ;if ( true ) {

        return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.tisfsym.make(tomMatch309NameNumber_freshVar_10, tomMatch309NameNumber_freshVar_8) , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ) ;
      }}}}}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_14=tomMatch309NameNumberfreshSubject_1;if ( (tomMatch309NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.expr.eq) ) {{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_12= tomMatch309NameNumber_freshVar_14.getLt() ;{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_13= tomMatch309NameNumber_freshVar_14.getRt() ;if ( true ) {

        // first reduce the argument
        Term reducedl = applyMappingRules(tomMatch309NameNumber_freshVar_12).reverse().getHeadconcTerm();
        Term reducedr = applyMappingRules(tomMatch309NameNumber_freshVar_13).reverse().getHeadconcTerm();

        ExprList taill = applyExprRules( tom.engine.adt.il.types.expr.eq.make(reducedl, reducedr) );
        ExprList res =  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex,tom_append_list_concExpr(taill, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() )) ;
      }}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_17=tomMatch309NameNumberfreshSubject_1;if ( (tomMatch309NameNumber_freshVar_17 instanceof tom.engine.adt.il.types.expr.isfsym) ) {{  tom.engine.adt.il.types.Term  tomMatch309NameNumber_freshVar_15= tomMatch309NameNumber_freshVar_17.getT() ;{  tom.engine.adt.il.types.Symbol  tomMatch309NameNumber_freshVar_16= tomMatch309NameNumber_freshVar_17.getSymbol() ;if ( true ) {

        // first reduce the argument
        TermList reduced = applyMappingRules(tomMatch309NameNumber_freshVar_15);
        ExprList res =  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ;
        while(!reduced.isEmptyconcTerm()) {
          Term head = reduced.getHeadconcTerm();
          res = tom_append_list_concExpr(res, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.isfsym.make(head, tomMatch309NameNumber_freshVar_16) , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) );
          reduced = reduced.getTailconcTerm();
        }
        {if ( (res instanceof tom.engine.adt.il.types.ExprList) ) {{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumberfreshSubject_1=(( tom.engine.adt.il.types.ExprList )res);{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumber_freshVar_0=tomMatch310NameNumberfreshSubject_1;if ( ((tomMatch310NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.exprlist.ConsconcExpr) || (tomMatch310NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.exprlist.EmptyconcExpr)) ) {{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumber_begin_2=tomMatch310NameNumber_freshVar_0;{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumber_end_3=tomMatch310NameNumber_freshVar_0;do {{{  tom.engine.adt.il.types.ExprList  tom_hl=tom_get_slice_concExpr(tomMatch310NameNumber_begin_2,tomMatch310NameNumber_end_3, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() );{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumber_freshVar_1=tomMatch310NameNumber_end_3;if (!( tomMatch310NameNumber_freshVar_1.isEmptyconcExpr() )) {{  tom.engine.adt.il.types.Expr  tom_tail= tomMatch310NameNumber_freshVar_1.getHeadconcExpr() ;{  tom.engine.adt.il.types.ExprList  tomMatch310NameNumber_freshVar_4= tomMatch310NameNumber_freshVar_1.getTailconcExpr() ;if ( tomMatch310NameNumber_freshVar_4.isEmptyconcExpr() ) {if ( true ) {

            ExprList taill = applyExprRules(tom_tail);
            return tom_append_list_concExpr(tom_hl,tom_append_list_concExpr(taill, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ));
          }}}}}}}if ( tomMatch310NameNumber_end_3.isEmptyconcExpr() ) {tomMatch310NameNumber_end_3=tomMatch310NameNumber_begin_2;} else {tomMatch310NameNumber_end_3= tomMatch310NameNumber_end_3.getTailconcExpr() ;}}} while(!( (tomMatch310NameNumber_end_3==tomMatch310NameNumber_begin_2) ));}}}}}}}

      }}}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_19=tomMatch309NameNumberfreshSubject_1;if ( (tomMatch309NameNumber_freshVar_19 instanceof tom.engine.adt.il.types.expr.ilnot) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_18= tomMatch309NameNumber_freshVar_19.getExp() ;if ( true ) {

        ExprList exprList = applyExprRules(tomMatch309NameNumber_freshVar_18);
        ExprList newExprList =  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ;
        while(!exprList.isEmptyconcExpr()) {
          Expr localExpr = exprList.getHeadconcExpr();
          exprList = exprList.getTailconcExpr();
          newExprList = tom_append_list_concExpr(newExprList, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.ilnot.make(localExpr) , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) );
        }
        return newExprList;
      }}}}}}if ( (ex instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch309NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )ex);{  tom.engine.adt.il.types.Expr  tomMatch309NameNumber_freshVar_20=tomMatch309NameNumberfreshSubject_1;{ boolean tomMatch309NameNumber_freshVar_21= false ;if ( (tomMatch309NameNumber_freshVar_20 instanceof tom.engine.adt.il.types.expr.iltrue) ) {tomMatch309NameNumber_freshVar_21= true ;} else {if ( (tomMatch309NameNumber_freshVar_20 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {tomMatch309NameNumber_freshVar_21= true ;}}if ( tomMatch309NameNumber_freshVar_21== true  ) {if ( true ) {

        return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ;
      }}}}}}}

    System.out.println("apply ExprRules : nothing applies to:" + ex);
    return  tom.engine.adt.il.types.exprlist.ConsconcExpr.make(ex, tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) ;
  }

  protected Expr buildConstraint(SubstitutionList substitution, Instr pil,Instr goal) {
    {if ( (pil instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch311NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )pil);{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_1=tomMatch311NameNumberfreshSubject_1;if ( (tomMatch311NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.instr.sequence) ) {{  tom.engine.adt.il.types.InstrList  tomMatch311NameNumber_freshVar_0= tomMatch311NameNumber_freshVar_1.getInstrlist() ;{  tom.engine.adt.il.types.InstrList  tomMatch311NameNumber_freshVar_2=tomMatch311NameNumber_freshVar_0;if ( ((tomMatch311NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.instrlist.Conssemicolon) || (tomMatch311NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.instrlist.Emptysemicolon)) ) {if (!( tomMatch311NameNumber_freshVar_2.isEmptysemicolon() )) {{  tom.engine.adt.il.types.Instr  tom_h= tomMatch311NameNumber_freshVar_2.getHeadsemicolon() ;{  tom.engine.adt.il.types.InstrList  tomMatch311NameNumber_freshVar_3= tomMatch311NameNumber_freshVar_2.getTailsemicolon() ;{  tom.engine.adt.il.types.InstrList  tom_t=tomMatch311NameNumber_freshVar_3;if ( true ) {

        Expr goalFromHead = buildConstraint(substitution,tom_h,goal);
        if (!tom_t.isEmptysemicolon()) {
          Expr refuseFromHead = buildConstraint(substitution,tom_h, tom.engine.adt.il.types.instr.refuse.make() );
          Expr goalFromTail = buildConstraint(substitution, tom.engine.adt.il.types.instr.sequence.make(tom_t) ,goal);
          if(this.isCamlSemantics()) {
            return  tom.engine.adt.il.types.expr.ilor.make(goalFromHead,  tom.engine.adt.il.types.expr.iland.make(refuseFromHead, goalFromTail) ) ;
          } else {
            return  tom.engine.adt.il.types.expr.ilor.make(goalFromHead, goalFromTail) ;
          }
        } else {
          return goalFromHead;
        }
      }}}}}}}}}}}}if ( (pil instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch311NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )pil);{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_8=tomMatch311NameNumberfreshSubject_1;if ( (tomMatch311NameNumber_freshVar_8 instanceof tom.engine.adt.il.types.instr.ILLet) ) {{  tom.engine.adt.il.types.Variable  tomMatch311NameNumber_freshVar_5= tomMatch311NameNumber_freshVar_8.getVar() ;{  tom.engine.adt.il.types.Term  tomMatch311NameNumber_freshVar_6= tomMatch311NameNumber_freshVar_8.getT() ;{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_7= tomMatch311NameNumber_freshVar_8.getBody() ;if ( true ) {

        // update the substitution
        Term t = replaceVariablesInTerm( tom.engine.adt.il.types.term.appSubsT.make(substitution, tomMatch311NameNumber_freshVar_6) );
        substitution = tom_append_list_subs(substitution, tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.is.make(tomMatch311NameNumber_freshVar_5, t) , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) );
        //return `iland(eq(tau(absvar(x)),u),buildConstraint(substitution,i,goal));
        return buildConstraint(substitution,tomMatch311NameNumber_freshVar_7,goal);
      }}}}}}}}if ( (pil instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch311NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )pil);{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_12=tomMatch311NameNumberfreshSubject_1;if ( (tomMatch311NameNumber_freshVar_12 instanceof tom.engine.adt.il.types.instr.ITE) ) {{  tom.engine.adt.il.types.Expr  tomMatch311NameNumber_freshVar_9= tomMatch311NameNumber_freshVar_12.getE() ;{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_10= tomMatch311NameNumber_freshVar_12.getIft() ;{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_11= tomMatch311NameNumber_freshVar_12.getIff() ;if ( true ) {

        Expr closedExpr = replaceVariablesInExpr( tom.engine.adt.il.types.expr.appSubsE.make(substitution, tomMatch311NameNumber_freshVar_9) );
        Expr constraintTrue  =  tom.engine.adt.il.types.expr.iland.make(closedExpr, buildConstraint(substitution,tomMatch311NameNumber_freshVar_10,goal)) ;
        Expr constraintFalse =  tom.engine.adt.il.types.expr.iland.make( tom.engine.adt.il.types.expr.ilnot.make(closedExpr) , buildConstraint(substitution,tomMatch311NameNumber_freshVar_11,goal)) ;
        return  tom.engine.adt.il.types.expr.ilor.make(constraintTrue, constraintFalse) ;
      }}}}}}}}if ( (pil instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch311NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )pil);{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_13=tomMatch311NameNumberfreshSubject_1;if ( (tomMatch311NameNumber_freshVar_13 instanceof tom.engine.adt.il.types.instr.refuse) ) {if ( true ) {

        if (pil == goal) {
          return  tom.engine.adt.il.types.expr.iltrue.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ) ;
        } else {
          return  tom.engine.adt.il.types.expr.ilfalse.make() ;
        }
      }}}}}if ( (pil instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch311NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )pil);{  tom.engine.adt.il.types.Instr  tomMatch311NameNumber_freshVar_14=tomMatch311NameNumberfreshSubject_1;if ( (tomMatch311NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.instr.accept) ) {if ( true ) {

        if (pil == goal) {
          return  tom.engine.adt.il.types.expr.iltrue.make(substitution) ;
        } else {
          return  tom.engine.adt.il.types.expr.ilfalse.make() ;
        }
      }}}}}}

    // default case, should not happen
    return  tom.engine.adt.il.types.expr.ilfalse.make() ;
  }

  protected Collection applySemanticsRules(Deriv post) {
    Collection c = new HashSet();
    {if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumber_freshVar_2=tomMatch312NameNumberfreshSubject_1;if ( (tomMatch312NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_0= tomMatch312NameNumber_freshVar_2.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_1= tomMatch312NameNumber_freshVar_2.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_5=tomMatch312NameNumber_freshVar_0;if ( (tomMatch312NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_3= tomMatch312NameNumber_freshVar_5.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_4= tomMatch312NameNumber_freshVar_5.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tom_e=tomMatch312NameNumber_freshVar_3;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_7=tomMatch312NameNumber_freshVar_4;if ( (tomMatch312NameNumber_freshVar_7 instanceof tom.engine.adt.il.types.instr.sequence) ) {{  tom.engine.adt.il.types.InstrList  tomMatch312NameNumber_freshVar_6= tomMatch312NameNumber_freshVar_7.getInstrlist() ;{  tom.engine.adt.il.types.InstrList  tomMatch312NameNumber_freshVar_11=tomMatch312NameNumber_freshVar_6;if ( ((tomMatch312NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.instrlist.Conssemicolon) || (tomMatch312NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.instrlist.Emptysemicolon)) ) {if (!( tomMatch312NameNumber_freshVar_11.isEmptysemicolon() )) {{  tom.engine.adt.il.types.Instr  tom_h= tomMatch312NameNumber_freshVar_11.getHeadsemicolon() ;{  tom.engine.adt.il.types.InstrList  tomMatch312NameNumber_freshVar_12= tomMatch312NameNumber_freshVar_11.getTailsemicolon() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_10=tomMatch312NameNumber_freshVar_1;if ( (tomMatch312NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_8= tomMatch312NameNumber_freshVar_10.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_9= tomMatch312NameNumber_freshVar_10.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_14=tomMatch312NameNumber_freshVar_8;if ( ((tomMatch312NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch312NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch312NameNumber_freshVar_14.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch312NameNumber_freshVar_16= tomMatch312NameNumber_freshVar_14.getHeadsubs() ;if ( (tomMatch312NameNumber_freshVar_16 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_15= tomMatch312NameNumber_freshVar_14.getTailsubs() ;if ( tomMatch312NameNumber_freshVar_15.isEmptysubs() ) {{  tom.engine.adt.il.types.Instr  tom_ip=tomMatch312NameNumber_freshVar_9;if ( true ) {

        if(instructionContains(tom_h,tom_ip)) {
          // ends the derivation
          Deriv up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_e, tom_h) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , tom_ip) ) ;
          Collection pre_list = applySemanticsRules(up);

          Iterator it = pre_list.iterator();
          while(it.hasNext()) {
            DerivTree pre = (DerivTree) it.next();
            c.add( tom.engine.adt.il.types.derivtree.derivrule.make("seqa", post, pre,  tom.engine.adt.il.types.seq.seq.make() ) );
          }
        } else {
          // continue the derivation with t
          Deriv up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_e,  tom.engine.adt.il.types.instr.sequence.make(tomMatch312NameNumber_freshVar_12) ) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , tom_ip) ) ;
          Collection post_list = applySemanticsRules(up);

          if(this.isCamlSemantics()) {
            up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_e, tom_h) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ,  tom.engine.adt.il.types.instr.refuse.make() ) ) ;
            Collection pre_list = applySemanticsRules(up);
            Iterator it = pre_list.iterator();
            while(it.hasNext()) {
              DerivTree pre = (DerivTree) it.next();
              Iterator it2 = post_list.iterator();
              while(it2.hasNext()) {
                DerivTree pre2 = (DerivTree) it2.next();
                c.add( tom.engine.adt.il.types.derivtree.derivrule2.make("seqb", post, pre, pre2,  tom.engine.adt.il.types.seq.seq.make() ) );
              }
            }
          } else {
            Iterator it = post_list.iterator();
            while(it.hasNext()) {
              DerivTree pre = (DerivTree) it.next();
              c.add( tom.engine.adt.il.types.derivtree.derivrule2.make("seqb", post,  tom.engine.adt.il.types.derivtree.endderiv.make() , pre,  tom.engine.adt.il.types.seq.seq.make() ) );
            }
          }
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumber_freshVar_19=tomMatch312NameNumberfreshSubject_1;if ( (tomMatch312NameNumber_freshVar_19 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_17= tomMatch312NameNumber_freshVar_19.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_18= tomMatch312NameNumber_freshVar_19.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_22=tomMatch312NameNumber_freshVar_17;if ( (tomMatch312NameNumber_freshVar_22 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_20= tomMatch312NameNumber_freshVar_22.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_21= tomMatch312NameNumber_freshVar_22.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tom_e=tomMatch312NameNumber_freshVar_20;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_26=tomMatch312NameNumber_freshVar_21;if ( (tomMatch312NameNumber_freshVar_26 instanceof tom.engine.adt.il.types.instr.ILLet) ) {{  tom.engine.adt.il.types.Variable  tomMatch312NameNumber_freshVar_23= tomMatch312NameNumber_freshVar_26.getVar() ;{  tom.engine.adt.il.types.Term  tomMatch312NameNumber_freshVar_24= tomMatch312NameNumber_freshVar_26.getT() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_25= tomMatch312NameNumber_freshVar_26.getBody() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_29=tomMatch312NameNumber_freshVar_18;if ( (tomMatch312NameNumber_freshVar_29 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_27= tomMatch312NameNumber_freshVar_29.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_28= tomMatch312NameNumber_freshVar_29.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_30=tomMatch312NameNumber_freshVar_27;if ( ((tomMatch312NameNumber_freshVar_30 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch312NameNumber_freshVar_30 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch312NameNumber_freshVar_30.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch312NameNumber_freshVar_32= tomMatch312NameNumber_freshVar_30.getHeadsubs() ;if ( (tomMatch312NameNumber_freshVar_32 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_31= tomMatch312NameNumber_freshVar_30.getTailsubs() ;if ( tomMatch312NameNumber_freshVar_31.isEmptysubs() ) {if ( true ) {


        // build condition
        Seq cond = seqFromTerm( tom.engine.adt.il.types.term.appSubsT.make(tom_e, tomMatch312NameNumber_freshVar_24) );
        // find "t"
        Term t = null;
        {if ( (cond instanceof tom.engine.adt.il.types.Seq) ) {{  tom.engine.adt.il.types.Seq  tomMatch313NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Seq )cond);{  tom.engine.adt.il.types.Seq  tomMatch313NameNumber_freshVar_1=tomMatch313NameNumberfreshSubject_1;if ( (tomMatch313NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.seq.dedterm) ) {{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_freshVar_0= tomMatch313NameNumber_freshVar_1.getTerms() ;{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_freshVar_2=tomMatch313NameNumber_freshVar_0;if ( ((tomMatch313NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.termlist.ConsconcTerm) || (tomMatch313NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.termlist.EmptyconcTerm)) ) {{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_begin_4=tomMatch313NameNumber_freshVar_2;{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_end_5=tomMatch313NameNumber_freshVar_2;do {{{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_freshVar_3=tomMatch313NameNumber_end_5;if (!( tomMatch313NameNumber_freshVar_3.isEmptyconcTerm() )) {{  tom.engine.adt.il.types.Term  tom_r= tomMatch313NameNumber_freshVar_3.getHeadconcTerm() ;{  tom.engine.adt.il.types.TermList  tomMatch313NameNumber_freshVar_6= tomMatch313NameNumber_freshVar_3.getTailconcTerm() ;if ( tomMatch313NameNumber_freshVar_6.isEmptyconcTerm() ) {if ( true ) {
 t = tom_r; }}}}}}if ( tomMatch313NameNumber_end_5.isEmptyconcTerm() ) {tomMatch313NameNumber_end_5=tomMatch313NameNumber_begin_4;} else {tomMatch313NameNumber_end_5= tomMatch313NameNumber_end_5.getTailconcTerm() ;}}} while(!( (tomMatch313NameNumber_end_5==tomMatch313NameNumber_begin_4) ));}}}}}}}}}if ( (cond instanceof tom.engine.adt.il.types.Seq) ) {{  tom.engine.adt.il.types.Seq  tomMatch313NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Seq )cond);if ( true ) {
 if (t == null) {
            System.out.println("seqFromTerm has a problem with " + cond);
          }
          }}}}

        Deriv up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_append_list_subs(tom_e, tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.is.make(tomMatch312NameNumber_freshVar_23, t) , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ), tomMatch312NameNumber_freshVar_25) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , tomMatch312NameNumber_freshVar_28) 
            ) 


;
        Collection pre_list = applySemanticsRules(up);
        Iterator it = pre_list.iterator();
        while(it.hasNext()) {
          DerivTree pre = (DerivTree) it.next();
          c.add( tom.engine.adt.il.types.derivtree.derivrule.make("let", post, pre, cond) );
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}}}}if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumber_freshVar_35=tomMatch312NameNumberfreshSubject_1;if ( (tomMatch312NameNumber_freshVar_35 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_33= tomMatch312NameNumber_freshVar_35.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_34= tomMatch312NameNumber_freshVar_35.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_38=tomMatch312NameNumber_freshVar_33;if ( (tomMatch312NameNumber_freshVar_38 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_36= tomMatch312NameNumber_freshVar_38.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_37= tomMatch312NameNumber_freshVar_38.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tom_e=tomMatch312NameNumber_freshVar_36;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_42=tomMatch312NameNumber_freshVar_37;if ( (tomMatch312NameNumber_freshVar_42 instanceof tom.engine.adt.il.types.instr.ITE) ) {{  tom.engine.adt.il.types.Expr  tomMatch312NameNumber_freshVar_39= tomMatch312NameNumber_freshVar_42.getE() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_40= tomMatch312NameNumber_freshVar_42.getIft() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_41= tomMatch312NameNumber_freshVar_42.getIff() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_45=tomMatch312NameNumber_freshVar_34;if ( (tomMatch312NameNumber_freshVar_45 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_43= tomMatch312NameNumber_freshVar_45.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_44= tomMatch312NameNumber_freshVar_45.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_46=tomMatch312NameNumber_freshVar_43;if ( ((tomMatch312NameNumber_freshVar_46 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch312NameNumber_freshVar_46 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch312NameNumber_freshVar_46.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch312NameNumber_freshVar_48= tomMatch312NameNumber_freshVar_46.getHeadsubs() ;if ( (tomMatch312NameNumber_freshVar_48 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_47= tomMatch312NameNumber_freshVar_46.getTailsubs() ;if ( tomMatch312NameNumber_freshVar_47.isEmptysubs() ) {{  tom.engine.adt.il.types.Instr  tom_ip=tomMatch312NameNumber_freshVar_44;if ( true ) {


        // build condition
        ExprList cond = exprListFromExpr( tom.engine.adt.il.types.expr.appSubsE.make(tom_e, tomMatch312NameNumber_freshVar_39) );

        Deriv up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_e, tomMatch312NameNumber_freshVar_40) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , tom_ip) ) ;
        String rulename = "iftrue";

        Collection pre_list = applySemanticsRules(up);
        Iterator it = pre_list.iterator();
        while(it.hasNext()) {
          DerivTree pre = (DerivTree) it.next();
          c.add( tom.engine.adt.il.types.derivtree.derivrule.make(rulename, post, pre,  tom.engine.adt.il.types.seq.dedexpr.make(tom_append_list_concExpr(cond, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.iltrue.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ) , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) )) ) );
        }

        up =  tom.engine.adt.il.types.deriv.ebs.make( tom.engine.adt.il.types.environment.env.make(tom_e, tomMatch312NameNumber_freshVar_41) ,  tom.engine.adt.il.types.environment.env.make( tom.engine.adt.il.types.substitutionlist.Conssubs.make( tom.engine.adt.il.types.substitution.undefsubs.make() , tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) , tom_ip) ) ;
        rulename = "iffalse";

        pre_list = applySemanticsRules(up);
        it = pre_list.iterator();
        while(it.hasNext()) {
          DerivTree pre = (DerivTree) it.next();
          c.add( tom.engine.adt.il.types.derivtree.derivrule.make(rulename, post, pre,  tom.engine.adt.il.types.seq.dedexpr.make(tom_append_list_concExpr(cond, tom.engine.adt.il.types.exprlist.ConsconcExpr.make( tom.engine.adt.il.types.expr.ilfalse.make() , tom.engine.adt.il.types.exprlist.EmptyconcExpr.make() ) )) ) );
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}}}}}if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumber_freshVar_51=tomMatch312NameNumberfreshSubject_1;if ( (tomMatch312NameNumber_freshVar_51 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_49= tomMatch312NameNumber_freshVar_51.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_50= tomMatch312NameNumber_freshVar_51.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_54=tomMatch312NameNumber_freshVar_49;if ( (tomMatch312NameNumber_freshVar_54 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_52= tomMatch312NameNumber_freshVar_54.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_53= tomMatch312NameNumber_freshVar_54.getI() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_55=tomMatch312NameNumber_freshVar_53;if ( (tomMatch312NameNumber_freshVar_55 instanceof tom.engine.adt.il.types.instr.accept) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_58=tomMatch312NameNumber_freshVar_50;if ( (tomMatch312NameNumber_freshVar_58 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_56= tomMatch312NameNumber_freshVar_58.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_57= tomMatch312NameNumber_freshVar_58.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_60=tomMatch312NameNumber_freshVar_56;if ( ((tomMatch312NameNumber_freshVar_60 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch312NameNumber_freshVar_60 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch312NameNumber_freshVar_60.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch312NameNumber_freshVar_62= tomMatch312NameNumber_freshVar_60.getHeadsubs() ;if ( (tomMatch312NameNumber_freshVar_62 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_61= tomMatch312NameNumber_freshVar_60.getTailsubs() ;if ( tomMatch312NameNumber_freshVar_61.isEmptysubs() ) {{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_59=tomMatch312NameNumber_freshVar_57;if ( (tomMatch312NameNumber_freshVar_59 instanceof tom.engine.adt.il.types.instr.accept) ) {if ( true ) {


        c.add( tom.engine.adt.il.types.derivtree.derivrule.make("axiom_accept", post,  tom.engine.adt.il.types.derivtree.endderiv.make() ,  tom.engine.adt.il.types.seq.seq.make() ) );
      }}}}}}}}}}}}}}}}}}}}}}}}}}if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumber_freshVar_65=tomMatch312NameNumberfreshSubject_1;if ( (tomMatch312NameNumber_freshVar_65 instanceof tom.engine.adt.il.types.deriv.ebs) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_63= tomMatch312NameNumber_freshVar_65.getLhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_64= tomMatch312NameNumber_freshVar_65.getRhs() ;{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_68=tomMatch312NameNumber_freshVar_63;if ( (tomMatch312NameNumber_freshVar_68 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_66= tomMatch312NameNumber_freshVar_68.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_67= tomMatch312NameNumber_freshVar_68.getI() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_69=tomMatch312NameNumber_freshVar_67;if ( (tomMatch312NameNumber_freshVar_69 instanceof tom.engine.adt.il.types.instr.refuse) ) {{  tom.engine.adt.il.types.Environment  tomMatch312NameNumber_freshVar_72=tomMatch312NameNumber_freshVar_64;if ( (tomMatch312NameNumber_freshVar_72 instanceof tom.engine.adt.il.types.environment.env) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_70= tomMatch312NameNumber_freshVar_72.getSubs() ;{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_71= tomMatch312NameNumber_freshVar_72.getI() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_74=tomMatch312NameNumber_freshVar_70;if ( ((tomMatch312NameNumber_freshVar_74 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch312NameNumber_freshVar_74 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch312NameNumber_freshVar_74.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch312NameNumber_freshVar_76= tomMatch312NameNumber_freshVar_74.getHeadsubs() ;if ( (tomMatch312NameNumber_freshVar_76 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch312NameNumber_freshVar_75= tomMatch312NameNumber_freshVar_74.getTailsubs() ;if ( tomMatch312NameNumber_freshVar_75.isEmptysubs() ) {{  tom.engine.adt.il.types.Instr  tomMatch312NameNumber_freshVar_73=tomMatch312NameNumber_freshVar_71;if ( (tomMatch312NameNumber_freshVar_73 instanceof tom.engine.adt.il.types.instr.refuse) ) {if ( true ) {

        c.add( tom.engine.adt.il.types.derivtree.derivrule.make("axiom_refuse", post,  tom.engine.adt.il.types.derivtree.endderiv.make() ,  tom.engine.adt.il.types.seq.seq.make() ) );
      }}}}}}}}}}}}}}}}}}}}}}}}}}if ( (post instanceof tom.engine.adt.il.types.Deriv) ) {{  tom.engine.adt.il.types.Deriv  tomMatch312NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Deriv )post);if ( true ) {

        if (c.isEmpty()) {
          //System.out.println("Error " + post);
        }
      }}}}

    return c;
  }

  private static class stratInstructionContains extends tom.library.sl.BasicStrategy {private  tom.engine.adt.il.types.Instr  goal;private  java.util.Collection  c;public stratInstructionContains( tom.engine.adt.il.types.Instr  goal,  java.util.Collection  c) {super(( new tom.library.sl.Identity() ));this.goal=goal;this.c=c;}public  tom.engine.adt.il.types.Instr  getgoal() {return goal;}public  java.util.Collection  getc() {return c;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.il.types.Instr  visit_Instr( tom.engine.adt.il.types.Instr  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.il.types.Instr) ) {{  tom.engine.adt.il.types.Instr  tomMatch314NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Instr )tom__arg);{  tom.engine.adt.il.types.Instr  tom_x=tomMatch314NameNumberfreshSubject_1;if ( true ) {


        if (tom_x== goal) {
          c.add(goal);
          ( new tom.library.sl.Fail() ).visitLight(tom_x);
        }
      }}}}}return _visit_Instr(tom__arg,introspector); }public  tom.engine.adt.il.types.Instr  _visit_Instr( tom.engine.adt.il.types.Instr  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.il.types.Instr )any.visit(environment,introspector));} else {return (( tom.engine.adt.il.types.Instr )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.il.types.Instr) ) {return visit_Instr((( tom.engine.adt.il.types.Instr )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_stratInstructionContains( tom.engine.adt.il.types.Instr  t0,  java.util.Collection  t1) { return new stratInstructionContains(t0,t1);}


  protected boolean instructionContains(Instr i, Instr goal) {
    Collection collect = new HashSet();
    try {
      ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("x") ),tom_make_Try(( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ),( null )) )==null)?tom_make_stratInstructionContains(goal,collect):new tom.library.sl.Sequence(tom_make_stratInstructionContains(goal,collect),( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("x") )) ),( null )) )) ))) ).visitLight(i);
    } catch(tom.library.sl.VisitFailure e) {
      System.out.println("strategy instructionContains failed");
    }
    return !collect.isEmpty();
  }

  /**
   * To replace undefsubst in tree by the computed value
   * which leads to axiom
   */
  private static class replaceUndefsubs extends tom.library.sl.BasicStrategy {private  tom.engine.adt.il.types.SubstitutionList  arg;public replaceUndefsubs( tom.engine.adt.il.types.SubstitutionList  arg) {super(( new tom.library.sl.Identity() ));this.arg=arg;}public  tom.engine.adt.il.types.SubstitutionList  getarg() {return arg;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.il.types.SubstitutionList  visit_SubstitutionList( tom.engine.adt.il.types.SubstitutionList  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch315NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )tom__arg);{  tom.engine.adt.il.types.SubstitutionList  tomMatch315NameNumber_freshVar_0=tomMatch315NameNumberfreshSubject_1;if ( ((tomMatch315NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch315NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch315NameNumber_freshVar_0.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch315NameNumber_freshVar_2= tomMatch315NameNumber_freshVar_0.getHeadsubs() ;if ( (tomMatch315NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch315NameNumber_freshVar_1= tomMatch315NameNumber_freshVar_0.getTailsubs() ;if ( tomMatch315NameNumber_freshVar_1.isEmptysubs() ) {if ( true ) {


        return arg;
      }}}}}}}}}}}return _visit_SubstitutionList(tom__arg,introspector); }public  tom.engine.adt.il.types.SubstitutionList  _visit_SubstitutionList( tom.engine.adt.il.types.SubstitutionList  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.il.types.SubstitutionList )any.visit(environment,introspector));} else {return (( tom.engine.adt.il.types.SubstitutionList )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.il.types.SubstitutionList) ) {return visit_SubstitutionList((( tom.engine.adt.il.types.SubstitutionList )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_replaceUndefsubs( tom.engine.adt.il.types.SubstitutionList  t0) { return new replaceUndefsubs(t0);}



  private DerivTree replaceUndefinedSubstitution(DerivTree subject,
      SubstitutionList subs) {
    try {
      subject = (DerivTree) tom_make_TopDown(tom_make_replaceUndefsubs(subs)).visitLight(subject);
    } catch (tom.library.sl.VisitFailure e) {
      throw new TomRuntimeException("Strategy replaceUndefsubs failed");
    }
    return subject;
  }

  



  static private class SubstRef {
    private SubstitutionList sublist;
    public SubstRef(SubstitutionList slist) {
      sublist = slist;
    }
    public void set(SubstitutionList ssublist) {
      this.sublist = ssublist;
    }
    public SubstitutionList get() {
      return sublist;
    }
  }

  /**
   * These functions deals with substitution application
   */
  private static class replaceVariableByTerm extends tom.library.sl.BasicStrategy {private  java.util.Map  map;public replaceVariableByTerm( java.util.Map  map) {super(( new tom.library.sl.Identity() ));this.map=map;}public  java.util.Map  getmap() {return map;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.il.types.Term  visit_Term( tom.engine.adt.il.types.Term  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch316NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )tom__arg);{  tom.engine.adt.il.types.Term  tomMatch316NameNumber_freshVar_1=tomMatch316NameNumberfreshSubject_1;if ( (tomMatch316NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.term.tau) ) {{  tom.engine.adt.il.types.AbsTerm  tomMatch316NameNumber_freshVar_0= tomMatch316NameNumber_freshVar_1.getAbst() ;{  tom.engine.adt.il.types.AbsTerm  tomMatch316NameNumber_freshVar_3=tomMatch316NameNumber_freshVar_0;if ( (tomMatch316NameNumber_freshVar_3 instanceof tom.engine.adt.il.types.absterm.absvar) ) {{  tom.engine.adt.il.types.Variable  tomMatch316NameNumber_freshVar_2= tomMatch316NameNumber_freshVar_3.getVarname() ;{  tom.engine.adt.il.types.Variable  tomMatch316NameNumber_freshVar_4=tomMatch316NameNumber_freshVar_2;if ( (tomMatch316NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.variable.var) ) {{  tom.engine.adt.il.types.Variable  tom_v=tomMatch316NameNumber_freshVar_2;if ( true ) {


        if (map.containsKey(tom_v)) {
          return (Term)map.get(tom_v);
        }
        return tomMatch316NameNumberfreshSubject_1;
      }}}}}}}}}}}}}return _visit_Term(tom__arg,introspector); }public  tom.engine.adt.il.types.Term  _visit_Term( tom.engine.adt.il.types.Term  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!( environment== null  )) {return (( tom.engine.adt.il.types.Term )any.visit(environment,introspector));} else {return (( tom.engine.adt.il.types.Term )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.il.types.Term) ) {return visit_Term((( tom.engine.adt.il.types.Term )v),introspector);}if (!( environment== null  )) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_replaceVariableByTerm( java.util.Map  t0) { return new replaceVariableByTerm(t0);}



  public Term replaceVariablesInTerm(Term subject) {
    {if ( (subject instanceof tom.engine.adt.il.types.Term) ) {{  tom.engine.adt.il.types.Term  tomMatch317NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Term )subject);{  tom.engine.adt.il.types.Term  tomMatch317NameNumber_freshVar_2=tomMatch317NameNumberfreshSubject_1;if ( (tomMatch317NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.term.appSubsT) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch317NameNumber_freshVar_0= tomMatch317NameNumber_freshVar_2.getSubs() ;{  tom.engine.adt.il.types.Term  tomMatch317NameNumber_freshVar_1= tomMatch317NameNumber_freshVar_2.getT() ;{  tom.engine.adt.il.types.Term  tom_term=tomMatch317NameNumber_freshVar_1;if ( true ) {

        Map map = buildVariableMap(tomMatch317NameNumber_freshVar_0, new HashMap());
        Term t = tom_term;
        try {
          t = (Term) tom_make_TopDown(tom_make_replaceVariableByTerm(map)).visitLight(tom_term);
        } catch (tom.library.sl.VisitFailure e) {
          throw new TomRuntimeException("Strategy replaceVariableByTerm failed");
        }
        return t;
      }}}}}}}}}

    return subject;
  }

  public Expr replaceVariablesInExpr(Expr subject) {
    {if ( (subject instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch318NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )subject);{  tom.engine.adt.il.types.Expr  tomMatch318NameNumber_freshVar_2=tomMatch318NameNumberfreshSubject_1;if ( (tomMatch318NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.expr.appSubsE) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch318NameNumber_freshVar_0= tomMatch318NameNumber_freshVar_2.getSubs() ;{  tom.engine.adt.il.types.Expr  tomMatch318NameNumber_freshVar_1= tomMatch318NameNumber_freshVar_2.getE() ;{  tom.engine.adt.il.types.Expr  tom_term=tomMatch318NameNumber_freshVar_1;if ( true ) {

        Map map = buildVariableMap(tomMatch318NameNumber_freshVar_0, new HashMap());
        Expr t = tom_term;
        try {
          t = (Expr) tom_make_TopDown(tom_make_replaceVariableByTerm(map)).visitLight(tom_term);
        } catch (tom.library.sl.VisitFailure e) {
          throw new TomRuntimeException("Strategy replaceVariableByTerm failed");
        }
        return t;
      }}}}}}}}}

    return subject;
  }

  private Map buildVariableMap(SubstitutionList sublist, Map map) {
    {if ( (sublist instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )sublist);{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumber_freshVar_0=tomMatch319NameNumberfreshSubject_1;if ( ((tomMatch319NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch319NameNumber_freshVar_0 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if ( tomMatch319NameNumber_freshVar_0.isEmptysubs() ) {if ( true ) {
 return map; }}}}}}if ( (sublist instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )sublist);{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumber_freshVar_1=tomMatch319NameNumberfreshSubject_1;if ( ((tomMatch319NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch319NameNumber_freshVar_1 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch319NameNumber_freshVar_1.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch319NameNumber_freshVar_4= tomMatch319NameNumber_freshVar_1.getHeadsubs() ;if ( (tomMatch319NameNumber_freshVar_4 instanceof tom.engine.adt.il.types.substitution.undefsubs) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumber_freshVar_2= tomMatch319NameNumber_freshVar_1.getTailsubs() ;if ( true ) {
 return buildVariableMap(tomMatch319NameNumber_freshVar_2,map);}}}}}}}}}if ( (sublist instanceof tom.engine.adt.il.types.SubstitutionList) ) {{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumberfreshSubject_1=(( tom.engine.adt.il.types.SubstitutionList )sublist);{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumber_freshVar_5=tomMatch319NameNumberfreshSubject_1;if ( ((tomMatch319NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.substitutionlist.Conssubs) || (tomMatch319NameNumber_freshVar_5 instanceof tom.engine.adt.il.types.substitutionlist.Emptysubs)) ) {if (!( tomMatch319NameNumber_freshVar_5.isEmptysubs() )) {{  tom.engine.adt.il.types.Substitution  tomMatch319NameNumber_freshVar_10= tomMatch319NameNumber_freshVar_5.getHeadsubs() ;if ( (tomMatch319NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.substitution.is) ) {{  tom.engine.adt.il.types.Variable  tomMatch319NameNumber_freshVar_8= tomMatch319NameNumber_freshVar_10.getVar() ;{  tom.engine.adt.il.types.Term  tomMatch319NameNumber_freshVar_9= tomMatch319NameNumber_freshVar_10.getTerm() ;{  tom.engine.adt.il.types.SubstitutionList  tomMatch319NameNumber_freshVar_6= tomMatch319NameNumber_freshVar_5.getTailsubs() ;if ( true ) {

        map.put(tomMatch319NameNumber_freshVar_8,tomMatch319NameNumber_freshVar_9);
        return buildVariableMap(tomMatch319NameNumber_freshVar_6,map);
      }}}}}}}}}}}}

    return null;
  }

  public void mappingReduce(Map input) {
    Iterator it = input.keySet().iterator();
    while(it.hasNext()) {
      Object key = it.next();
      Expr value = (Expr) input.get(key);
      input.put(key,reduceWithMappingRules(value));
    }
  }

  public void booleanReduce(Map input) {
    Iterator it = input.keySet().iterator();
    while(it.hasNext()) {
      Object key = it.next();
      Expr value = (Expr) input.get(key);
      input.put(key,booleanSimplify(value));
    }
  }

  public Expr booleanSimplify(Expr expr) {
    Strategy booleanSimplifier = new BooleanSimplifier();
    Expr res =  tom.engine.adt.il.types.expr.ilfalse.make() ;
    try {
      res = (Expr) tom_make_InnermostId(booleanSimplifier).visitLight(expr);
    } catch (tom.library.sl.VisitFailure e) {
      System.out.println("humm");
    }
    return res;
  }

  public class BooleanSimplifier extends BasicStrategy {
    public BooleanSimplifier() {
      super(( new tom.library.sl.Identity() ));
    }

    public Object visitLight(Object o, Introspector i) throws tom.library.sl.VisitFailure {
      if (o instanceof Expr) {
        Expr arg = (Expr) o;
        {if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_2=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_2 instanceof tom.engine.adt.il.types.expr.iland) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_0= tomMatch320NameNumber_freshVar_2.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_1= tomMatch320NameNumber_freshVar_2.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_3=tomMatch320NameNumber_freshVar_0;if ( (tomMatch320NameNumber_freshVar_3 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

            return  tom.engine.adt.il.types.expr.ilfalse.make() ;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_6=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_6 instanceof tom.engine.adt.il.types.expr.iland) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_4= tomMatch320NameNumber_freshVar_6.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_5= tomMatch320NameNumber_freshVar_6.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_7=tomMatch320NameNumber_freshVar_5;if ( (tomMatch320NameNumber_freshVar_7 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

            return  tom.engine.adt.il.types.expr.ilfalse.make() ;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_10=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_10 instanceof tom.engine.adt.il.types.expr.ilor) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_8= tomMatch320NameNumber_freshVar_10.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_9= tomMatch320NameNumber_freshVar_10.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_11=tomMatch320NameNumber_freshVar_8;if ( (tomMatch320NameNumber_freshVar_11 instanceof tom.engine.adt.il.types.expr.iltrue) ) {if ( true ) {

            return tomMatch320NameNumber_freshVar_8;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_14=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_14 instanceof tom.engine.adt.il.types.expr.ilor) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_12= tomMatch320NameNumber_freshVar_14.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_13= tomMatch320NameNumber_freshVar_14.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_15=tomMatch320NameNumber_freshVar_13;if ( (tomMatch320NameNumber_freshVar_15 instanceof tom.engine.adt.il.types.expr.iltrue) ) {if ( true ) {

            return tomMatch320NameNumber_freshVar_13;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_18=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_18 instanceof tom.engine.adt.il.types.expr.ilor) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_16= tomMatch320NameNumber_freshVar_18.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_17= tomMatch320NameNumber_freshVar_18.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_19=tomMatch320NameNumber_freshVar_16;if ( (tomMatch320NameNumber_freshVar_19 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

            return tomMatch320NameNumber_freshVar_17;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_22=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_22 instanceof tom.engine.adt.il.types.expr.ilor) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_20= tomMatch320NameNumber_freshVar_22.getLeft() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_21= tomMatch320NameNumber_freshVar_22.getRight() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_23=tomMatch320NameNumber_freshVar_21;if ( (tomMatch320NameNumber_freshVar_23 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

            return tomMatch320NameNumber_freshVar_20;
          }}}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_25=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_25 instanceof tom.engine.adt.il.types.expr.ilnot) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_24= tomMatch320NameNumber_freshVar_25.getExp() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_26=tomMatch320NameNumber_freshVar_24;if ( (tomMatch320NameNumber_freshVar_26 instanceof tom.engine.adt.il.types.expr.iltrue) ) {if ( true ) {

            return  tom.engine.adt.il.types.expr.ilfalse.make() ;
          }}}}}}}}if ( (arg instanceof tom.engine.adt.il.types.Expr) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumberfreshSubject_1=(( tom.engine.adt.il.types.Expr )arg);{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_28=tomMatch320NameNumberfreshSubject_1;if ( (tomMatch320NameNumber_freshVar_28 instanceof tom.engine.adt.il.types.expr.ilnot) ) {{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_27= tomMatch320NameNumber_freshVar_28.getExp() ;{  tom.engine.adt.il.types.Expr  tomMatch320NameNumber_freshVar_29=tomMatch320NameNumber_freshVar_27;if ( (tomMatch320NameNumber_freshVar_29 instanceof tom.engine.adt.il.types.expr.ilfalse) ) {if ( true ) {

            return  tom.engine.adt.il.types.expr.iltrue.make( tom.engine.adt.il.types.substitutionlist.Emptysubs.make() ) ;
          }}}}}}}}}

      }
      return any.visitLight(o,i);
    }
  }

}
