/* Generated by TOM (version 2.5alpha): Do not edit this file *//*
 *
 * TOM - To One Matching Compiler
 * 
 * Copyright (c) 2000-2007, INRIA
 * Nancy, France.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 * 
 * Pierre-Etienne Moreau  e-mail: Pierre-Etienne.Moreau@loria.fr
 *
 **/

package tom.engine.compiler;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;
import java.util.logging.Level;
import java.util.logging.Logger;

import tom.engine.TomBase;
import tom.engine.TomMessage;
import tom.engine.exception.TomRuntimeException;

import tom.engine.adt.tomsignature.*;
import tom.engine.adt.tomconstraint.types.*;
import tom.engine.adt.tomdeclaration.types.*;
import tom.engine.adt.tomexpression.types.*;
import tom.engine.adt.tominstruction.types.*;
import tom.engine.adt.tomname.types.*;
import tom.engine.adt.tomoption.types.*;
import tom.engine.adt.tomsignature.types.*;
import tom.engine.adt.tomterm.types.*;
import tom.engine.adt.tomslot.types.*;
import tom.engine.adt.tomtype.types.*;

import tom.engine.tools.SymbolTable;
import tom.engine.tools.ASTFactory;
import aterm.ATerm;

import tom.library.sl.*;

public class TomKernelExpander {

  /* Generated by TOM (version 2.5alpha): Do not edit this file */private static boolean tom_equal_term_Strategy(Object t1, Object t2) { return t1.equals(t2);}private static boolean tom_is_sort_Strategy(Object t) { return  t instanceof tom.library.sl.Strategy ;}/* Generated by TOM (version 2.5alpha): Do not edit this file *//* Generated by TOM (version 2.5alpha): Do not edit this file */private static boolean tom_equal_term_int(int t1, int t2) { return  (t1==t2) ;} /* Generated by TOM (version 2.5alpha): Do not edit this file *//* Generated by TOM (version 2.5alpha): Do not edit this file */ private static boolean tom_equal_term_String(String t1, String t2) { return  (t1.equals(t2)) ;}private static boolean tom_is_sort_String(String t) { return  t instanceof String ;}  private static  tom.library.sl.Strategy  tom_make_mu( tom.library.sl.Strategy  var,  tom.library.sl.Strategy  v) { return  new tom.library.sl.Mu(var,v) ; }private static  tom.library.sl.Strategy  tom_make_MuVar( String  name) { return  new tom.library.sl.MuVar(name) ; }private static  tom.library.sl.Strategy  tom_make_Identity() { return  new tom.library.sl.Identity() ; }private static  tom.library.sl.Strategy  tom_make_All( tom.library.sl.Strategy  v) { return  new tom.library.sl.All(v) ; }private static  tom.library.sl.Strategy  tom_make_ChoiceId( tom.library.sl.Strategy  first,  tom.library.sl.Strategy  then) { return  new tom.library.sl.ChoiceId(first,then) ; } /* Generated by TOM (version 2.5alpha): Do not edit this file */ /* Generated by TOM (version 2.5alpha): Do not edit this file */   private static boolean tom_is_sort_TomKernelExpander(Object t) { return 



 t instanceof TomKernelExpander ;}private static  tom.library.sl.Strategy  tom_make_ChoiceTopDown( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("x"),tom_make_ChoiceId(v,tom_make_All(tom_make_MuVar("x"))))



 ; }


  private SymbolTable symbolTable;

  public TomKernelExpander() {
    super();
  }

  public void setSymbolTable(SymbolTable symbolTable) {
    this.symbolTable = symbolTable;
  }

  private SymbolTable getSymbolTable() {
    return symbolTable;
  }

  protected TomSymbol getSymbolFromName(String tomName) {
    return TomBase.getSymbolFromName(tomName, getSymbolTable());
  }

  protected TomSymbol getSymbolFromType(TomType tomType) {
    return TomBase.getSymbolFromType(tomType, getSymbolTable());
  }
  // ------------------------------------------------------------
  /* Generated by TOM (version 2.5alpha): Do not edit this file */private static boolean tom_equal_term_Instruction(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Instruction(Object t) { return  t instanceof tom.engine.adt.tominstruction.types.Instruction ;}private static boolean tom_equal_term_TomTypeList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomTypeList(Object t) { return  t instanceof tom.engine.adt.tomtype.types.TomTypeList ;}private static boolean tom_equal_term_TomType(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomType(Object t) { return  t instanceof tom.engine.adt.tomtype.types.TomType ;}private static boolean tom_equal_term_TomVisit(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomVisit(Object t) { return  t instanceof tom.engine.adt.tomsignature.types.TomVisit ;}private static boolean tom_equal_term_Position(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Position(Object t) { return  t instanceof tom.engine.adt.tomsignature.types.Position ;}private static boolean tom_equal_term_TargetLanguage(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TargetLanguage(Object t) { return  t instanceof tom.engine.adt.tomsignature.types.TargetLanguage ;}private static boolean tom_equal_term_TomSymbol(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomSymbol(Object t) { return  t instanceof tom.engine.adt.tomsignature.types.TomSymbol ;}private static boolean tom_equal_term_TomNameList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomNameList(Object t) { return  t instanceof tom.engine.adt.tomname.types.TomNameList ;}private static boolean tom_equal_term_TomName(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomName(Object t) { return  t instanceof tom.engine.adt.tomname.types.TomName ;}private static boolean tom_equal_term_PatternInstructionList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_PatternInstructionList(Object t) { return  t instanceof tom.engine.adt.tomterm.types.PatternInstructionList ;}private static boolean tom_equal_term_PatternInstruction(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_PatternInstruction(Object t) { return  t instanceof tom.engine.adt.tomterm.types.PatternInstruction ;}private static boolean tom_equal_term_Pattern(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Pattern(Object t) { return  t instanceof tom.engine.adt.tomterm.types.Pattern ;}private static boolean tom_equal_term_TomList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomList(Object t) { return  t instanceof tom.engine.adt.tomterm.types.TomList ;}private static boolean tom_equal_term_TomTerm(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomTerm(Object t) { return  t instanceof tom.engine.adt.tomterm.types.TomTerm ;}private static boolean tom_equal_term_Option(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Option(Object t) { return  t instanceof tom.engine.adt.tomoption.types.Option ;}private static boolean tom_equal_term_OptionList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_OptionList(Object t) { return  t instanceof tom.engine.adt.tomoption.types.OptionList ;}private static boolean tom_equal_term_ConstraintList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_ConstraintList(Object t) { return  t instanceof tom.engine.adt.tomconstraint.types.ConstraintList ;}private static boolean tom_equal_term_PairNameDeclList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_PairNameDeclList(Object t) { return  t instanceof tom.engine.adt.tomslot.types.PairNameDeclList ;}private static boolean tom_equal_term_SlotList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_SlotList(Object t) { return  t instanceof tom.engine.adt.tomslot.types.SlotList ;}private static boolean tom_equal_term_Slot(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Slot(Object t) { return  t instanceof tom.engine.adt.tomslot.types.Slot ;}private static boolean tom_is_fun_sym_Match( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.Match ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_make_Match( tom.engine.adt.tomterm.types.TomTerm  t0,  tom.engine.adt.tomterm.types.PatternInstructionList  t1,  tom.engine.adt.tomoption.types.OptionList  t2) { return  tom.engine.adt.tominstruction.types.instruction.Match.make(t0, t1, t2) ; }private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_Match_SubjectList( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSubjectList() ;}private static  tom.engine.adt.tomterm.types.PatternInstructionList  tom_get_slot_Match_AstPatternInstructionList( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getAstPatternInstructionList() ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_Match_Option( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getOption() ;}private static boolean tom_is_fun_sym_Type( tom.engine.adt.tomtype.types.TomType  t) { return  t instanceof tom.engine.adt.tomtype.types.tomtype.Type ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_Type_TomType( tom.engine.adt.tomtype.types.TomType  t) { return  t.getTomType() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_Type_TlType( tom.engine.adt.tomtype.types.TomType  t) { return  t.getTlType() ;}private static boolean tom_is_fun_sym_TomTypeAlone( tom.engine.adt.tomtype.types.TomType  t) { return  t instanceof tom.engine.adt.tomtype.types.tomtype.TomTypeAlone ;}private static  String  tom_get_slot_TomTypeAlone_String( tom.engine.adt.tomtype.types.TomType  t) { return  t.getString() ;}private static boolean tom_is_fun_sym_TypesToType( tom.engine.adt.tomtype.types.TomType  t) { return  t instanceof tom.engine.adt.tomtype.types.tomtype.TypesToType ;}private static  tom.engine.adt.tomtype.types.TomTypeList  tom_get_slot_TypesToType_Domain( tom.engine.adt.tomtype.types.TomType  t) { return  t.getDomain() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_TypesToType_Codomain( tom.engine.adt.tomtype.types.TomType  t) { return  t.getCodomain() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_make_EmptyType() { return  tom.engine.adt.tomtype.types.tomtype.EmptyType.make() ; }private static boolean tom_is_fun_sym_TypeList( tom.engine.adt.tomtype.types.TomType  t) { return  t instanceof tom.engine.adt.tomtype.types.tomtype.TypeList ;}private static  tom.engine.adt.tomtype.types.TomType  tom_make_TypeList( tom.engine.adt.tomtype.types.TomTypeList  t0) { return  tom.engine.adt.tomtype.types.tomtype.TypeList.make(t0) ; }private static  tom.engine.adt.tomtype.types.TomTypeList  tom_get_slot_TypeList_TypeList( tom.engine.adt.tomtype.types.TomType  t) { return  t.getTypeList() ;}private static boolean tom_is_fun_sym_VisitTerm( tom.engine.adt.tomsignature.types.TomVisit  t) { return  t instanceof tom.engine.adt.tomsignature.types.tomvisit.VisitTerm ;}private static  tom.engine.adt.tomsignature.types.TomVisit  tom_make_VisitTerm( tom.engine.adt.tomtype.types.TomType  t0,  tom.engine.adt.tomterm.types.PatternInstructionList  t1,  tom.engine.adt.tomoption.types.OptionList  t2) { return  tom.engine.adt.tomsignature.types.tomvisit.VisitTerm.make(t0, t1, t2) ; }private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_VisitTerm_VNode( tom.engine.adt.tomsignature.types.TomVisit  t) { return  t.getVNode() ;}private static  tom.engine.adt.tomterm.types.PatternInstructionList  tom_get_slot_VisitTerm_AstPatternInstructionList( tom.engine.adt.tomsignature.types.TomVisit  t) { return  t.getAstPatternInstructionList() ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_VisitTerm_Option( tom.engine.adt.tomsignature.types.TomVisit  t) { return  t.getOption() ;}private static boolean tom_is_fun_sym_TL( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t instanceof tom.engine.adt.tomsignature.types.targetlanguage.TL ;}private static  String  tom_get_slot_TL_Code( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t.getCode() ;}private static  tom.engine.adt.tomsignature.types.Position  tom_get_slot_TL_Start( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t.getStart() ;}private static  tom.engine.adt.tomsignature.types.Position  tom_get_slot_TL_End( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t.getEnd() ;}private static boolean tom_is_fun_sym_ITL( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t instanceof tom.engine.adt.tomsignature.types.targetlanguage.ITL ;}private static  String  tom_get_slot_ITL_Code( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t.getCode() ;}private static boolean tom_is_fun_sym_Comment( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t instanceof tom.engine.adt.tomsignature.types.targetlanguage.Comment ;}private static  String  tom_get_slot_Comment_Code( tom.engine.adt.tomsignature.types.TargetLanguage  t) { return  t.getCode() ;}private static boolean tom_is_fun_sym_emptySymbol( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t instanceof tom.engine.adt.tomsignature.types.tomsymbol.emptySymbol ;}private static  tom.engine.adt.tomsignature.types.TomSymbol  tom_make_emptySymbol() { return  tom.engine.adt.tomsignature.types.tomsymbol.emptySymbol.make() ; }private static boolean tom_is_fun_sym_Symbol( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t instanceof tom.engine.adt.tomsignature.types.tomsymbol.Symbol ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_Symbol_AstName( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_Symbol_TypesToType( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t.getTypesToType() ;}private static  tom.engine.adt.tomslot.types.PairNameDeclList  tom_get_slot_Symbol_PairNameDeclList( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t.getPairNameDeclList() ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_Symbol_Option( tom.engine.adt.tomsignature.types.TomSymbol  t) { return  t.getOption() ;}private static boolean tom_is_fun_sym_Name( tom.engine.adt.tomname.types.TomName  t) { return  t instanceof tom.engine.adt.tomname.types.tomname.Name ;}private static  String  tom_get_slot_Name_String( tom.engine.adt.tomname.types.TomName  t) { return  t.getString() ;}private static boolean tom_is_fun_sym_PatternInstruction( tom.engine.adt.tomterm.types.PatternInstruction  t) { return  t instanceof tom.engine.adt.tomterm.types.patterninstruction.PatternInstruction ;}private static  tom.engine.adt.tomterm.types.Pattern  tom_get_slot_PatternInstruction_Pattern( tom.engine.adt.tomterm.types.PatternInstruction  t) { return  t.getPattern() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_PatternInstruction_Action( tom.engine.adt.tomterm.types.PatternInstruction  t) { return  t.getAction() ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_PatternInstruction_Option( tom.engine.adt.tomterm.types.PatternInstruction  t) { return  t.getOption() ;}private static boolean tom_is_fun_sym_Pattern( tom.engine.adt.tomterm.types.Pattern  t) { return  t instanceof tom.engine.adt.tomterm.types.pattern.Pattern ;}private static  tom.engine.adt.tomterm.types.Pattern  tom_make_Pattern( tom.engine.adt.tomterm.types.TomList  t0,  tom.engine.adt.tomterm.types.TomList  t1,  tom.engine.adt.tomterm.types.TomList  t2) { return  tom.engine.adt.tomterm.types.pattern.Pattern.make(t0, t1, t2) ; }private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_Pattern_SubjectList( tom.engine.adt.tomterm.types.Pattern  t) { return  t.getSubjectList() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_Pattern_TomList( tom.engine.adt.tomterm.types.Pattern  t) { return  t.getTomList() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_Pattern_Guards( tom.engine.adt.tomterm.types.Pattern  t) { return  t.getGuards() ;}private static boolean tom_is_fun_sym_TermAppl( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.TermAppl ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_TermAppl_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomNameList  tom_get_slot_TermAppl_NameList( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getNameList() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_TermAppl_Args( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getArgs() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_TermAppl_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_RecordAppl( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.RecordAppl ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_RecordAppl( tom.engine.adt.tomoption.types.OptionList  t0,  tom.engine.adt.tomname.types.TomNameList  t1,  tom.engine.adt.tomslot.types.SlotList  t2,  tom.engine.adt.tomconstraint.types.ConstraintList  t3) { return  tom.engine.adt.tomterm.types.tomterm.RecordAppl.make(t0, t1, t2, t3) ; }private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_RecordAppl_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomNameList  tom_get_slot_RecordAppl_NameList( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getNameList() ;}private static  tom.engine.adt.tomslot.types.SlotList  tom_get_slot_RecordAppl_Slots( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getSlots() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_RecordAppl_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_Variable( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.Variable ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_Variable( tom.engine.adt.tomoption.types.OptionList  t0,  tom.engine.adt.tomname.types.TomName  t1,  tom.engine.adt.tomtype.types.TomType  t2,  tom.engine.adt.tomconstraint.types.ConstraintList  t3) { return  tom.engine.adt.tomterm.types.tomterm.Variable.make(t0, t1, t2, t3) ; }private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_Variable_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_Variable_AstName( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_Variable_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_Variable_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_VariableStar( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_VariableStar( tom.engine.adt.tomoption.types.OptionList  t0,  tom.engine.adt.tomname.types.TomName  t1,  tom.engine.adt.tomtype.types.TomType  t2,  tom.engine.adt.tomconstraint.types.ConstraintList  t3) { return  tom.engine.adt.tomterm.types.tomterm.VariableStar.make(t0, t1, t2, t3) ; }private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_VariableStar_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_VariableStar_AstName( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_VariableStar_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_VariableStar_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_UnamedVariable( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariable ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_UnamedVariable_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_UnamedVariable_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_UnamedVariable_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_UnamedVariableStar( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariableStar ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_UnamedVariableStar( tom.engine.adt.tomoption.types.OptionList  t0,  tom.engine.adt.tomtype.types.TomType  t1,  tom.engine.adt.tomconstraint.types.ConstraintList  t2) { return  tom.engine.adt.tomterm.types.tomterm.UnamedVariableStar.make(t0, t1, t2) ; }private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_UnamedVariableStar_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_UnamedVariableStar_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_UnamedVariableStar_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_SubjectList( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.SubjectList ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_SubjectList( tom.engine.adt.tomterm.types.TomList  t0) { return  tom.engine.adt.tomterm.types.tomterm.SubjectList.make(t0) ; }private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_SubjectList_TomList( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getTomList() ;}private static boolean tom_is_fun_sym_AntiTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.AntiTerm ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_AntiTerm_TomTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getTomTerm() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_BuildReducedTerm( tom.engine.adt.tomterm.types.TomTerm  t0,  tom.engine.adt.tomtype.types.TomType  t1) { return  tom.engine.adt.tomterm.types.tomterm.BuildReducedTerm.make(t0, t1) ; }private static boolean tom_is_fun_sym_OriginTracking( tom.engine.adt.tomoption.types.Option  t) { return  t instanceof tom.engine.adt.tomoption.types.option.OriginTracking ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_OriginTracking_AstName( tom.engine.adt.tomoption.types.Option  t) { return  t.getAstName() ;}private static  int  tom_get_slot_OriginTracking_Line( tom.engine.adt.tomoption.types.Option  t) { return  t.getLine() ;}private static  String  tom_get_slot_OriginTracking_FileName( tom.engine.adt.tomoption.types.Option  t) { return  t.getFileName() ;}private static boolean tom_is_fun_sym_PairSlotAppl( tom.engine.adt.tomslot.types.Slot  t) { return  t instanceof tom.engine.adt.tomslot.types.slot.PairSlotAppl ;}private static  tom.engine.adt.tomslot.types.Slot  tom_make_PairSlotAppl( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomterm.types.TomTerm  t1) { return  tom.engine.adt.tomslot.types.slot.PairSlotAppl.make(t0, t1) ; }private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_PairSlotAppl_SlotName( tom.engine.adt.tomslot.types.Slot  t) { return  t.getSlotName() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_PairSlotAppl_Appl( tom.engine.adt.tomslot.types.Slot  t) { return  t.getAppl() ;}private static boolean tom_is_fun_sym_concTomType( tom.engine.adt.tomtype.types.TomTypeList  t) { return  t instanceof tom.engine.adt.tomtype.types.tomtypelist.ConsconcTomType || t instanceof tom.engine.adt.tomtype.types.tomtypelist.EmptyconcTomType ;}private static  tom.engine.adt.tomtype.types.TomTypeList  tom_empty_list_concTomType() { return  tom.engine.adt.tomtype.types.tomtypelist.EmptyconcTomType.make() ; }private static  tom.engine.adt.tomtype.types.TomTypeList  tom_cons_list_concTomType( tom.engine.adt.tomtype.types.TomType  e,  tom.engine.adt.tomtype.types.TomTypeList  l) { return  tom.engine.adt.tomtype.types.tomtypelist.ConsconcTomType.make(e,l) ; }private static  tom.engine.adt.tomtype.types.TomType  tom_get_head_concTomType_TomTypeList( tom.engine.adt.tomtype.types.TomTypeList  l) { return  l.getHeadconcTomType() ;}private static  tom.engine.adt.tomtype.types.TomTypeList  tom_get_tail_concTomType_TomTypeList( tom.engine.adt.tomtype.types.TomTypeList  l) { return  l.getTailconcTomType() ;}private static boolean tom_is_empty_concTomType_TomTypeList( tom.engine.adt.tomtype.types.TomTypeList  l) { return  l.isEmptyconcTomType() ;}   private static   tom.engine.adt.tomtype.types.TomTypeList  tom_append_list_concTomType( tom.engine.adt.tomtype.types.TomTypeList l1,  tom.engine.adt.tomtype.types.TomTypeList  l2) {     if(tom_is_empty_concTomType_TomTypeList(l1)) {       return l2;     } else if(tom_is_empty_concTomType_TomTypeList(l2)) {       return l1;     } else if(tom_is_empty_concTomType_TomTypeList(tom_get_tail_concTomType_TomTypeList(l1))) {       return ( tom.engine.adt.tomtype.types.TomTypeList )tom_cons_list_concTomType(tom_get_head_concTomType_TomTypeList(l1),l2);     } else {       return ( tom.engine.adt.tomtype.types.TomTypeList )tom_cons_list_concTomType(tom_get_head_concTomType_TomTypeList(l1),tom_append_list_concTomType(tom_get_tail_concTomType_TomTypeList(l1),l2));     }   }   private static   tom.engine.adt.tomtype.types.TomTypeList  tom_get_slice_concTomType( tom.engine.adt.tomtype.types.TomTypeList  begin,  tom.engine.adt.tomtype.types.TomTypeList  end, tom.engine.adt.tomtype.types.TomTypeList  tail) {     if(tom_equal_term_TomTypeList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomtype.types.TomTypeList )tom_cons_list_concTomType(tom_get_head_concTomType_TomTypeList(begin),( tom.engine.adt.tomtype.types.TomTypeList )tom_get_slice_concTomType(tom_get_tail_concTomType_TomTypeList(begin),end,tail));     }   }   private static boolean tom_is_fun_sym_concTomName( tom.engine.adt.tomname.types.TomNameList  t) { return  t instanceof tom.engine.adt.tomname.types.tomnamelist.ConsconcTomName || t instanceof tom.engine.adt.tomname.types.tomnamelist.EmptyconcTomName ;}private static  tom.engine.adt.tomname.types.TomNameList  tom_empty_list_concTomName() { return  tom.engine.adt.tomname.types.tomnamelist.EmptyconcTomName.make() ; }private static  tom.engine.adt.tomname.types.TomNameList  tom_cons_list_concTomName( tom.engine.adt.tomname.types.TomName  e,  tom.engine.adt.tomname.types.TomNameList  l) { return  tom.engine.adt.tomname.types.tomnamelist.ConsconcTomName.make(e,l) ; }private static  tom.engine.adt.tomname.types.TomName  tom_get_head_concTomName_TomNameList( tom.engine.adt.tomname.types.TomNameList  l) { return  l.getHeadconcTomName() ;}private static  tom.engine.adt.tomname.types.TomNameList  tom_get_tail_concTomName_TomNameList( tom.engine.adt.tomname.types.TomNameList  l) { return  l.getTailconcTomName() ;}private static boolean tom_is_empty_concTomName_TomNameList( tom.engine.adt.tomname.types.TomNameList  l) { return  l.isEmptyconcTomName() ;}   private static   tom.engine.adt.tomname.types.TomNameList  tom_append_list_concTomName( tom.engine.adt.tomname.types.TomNameList l1,  tom.engine.adt.tomname.types.TomNameList  l2) {     if(tom_is_empty_concTomName_TomNameList(l1)) {       return l2;     } else if(tom_is_empty_concTomName_TomNameList(l2)) {       return l1;     } else if(tom_is_empty_concTomName_TomNameList(tom_get_tail_concTomName_TomNameList(l1))) {       return ( tom.engine.adt.tomname.types.TomNameList )tom_cons_list_concTomName(tom_get_head_concTomName_TomNameList(l1),l2);     } else {       return ( tom.engine.adt.tomname.types.TomNameList )tom_cons_list_concTomName(tom_get_head_concTomName_TomNameList(l1),tom_append_list_concTomName(tom_get_tail_concTomName_TomNameList(l1),l2));     }   }   private static   tom.engine.adt.tomname.types.TomNameList  tom_get_slice_concTomName( tom.engine.adt.tomname.types.TomNameList  begin,  tom.engine.adt.tomname.types.TomNameList  end, tom.engine.adt.tomname.types.TomNameList  tail) {     if(tom_equal_term_TomNameList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomname.types.TomNameList )tom_cons_list_concTomName(tom_get_head_concTomName_TomNameList(begin),( tom.engine.adt.tomname.types.TomNameList )tom_get_slice_concTomName(tom_get_tail_concTomName_TomNameList(begin),end,tail));     }   }   private static boolean tom_is_fun_sym_concPatternInstruction( tom.engine.adt.tomterm.types.PatternInstructionList  t) { return  t instanceof tom.engine.adt.tomterm.types.patterninstructionlist.ConsconcPatternInstruction || t instanceof tom.engine.adt.tomterm.types.patterninstructionlist.EmptyconcPatternInstruction ;}private static  tom.engine.adt.tomterm.types.PatternInstructionList  tom_empty_list_concPatternInstruction() { return  tom.engine.adt.tomterm.types.patterninstructionlist.EmptyconcPatternInstruction.make() ; }private static  tom.engine.adt.tomterm.types.PatternInstructionList  tom_cons_list_concPatternInstruction( tom.engine.adt.tomterm.types.PatternInstruction  e,  tom.engine.adt.tomterm.types.PatternInstructionList  l) { return  tom.engine.adt.tomterm.types.patterninstructionlist.ConsconcPatternInstruction.make(e,l) ; }private static  tom.engine.adt.tomterm.types.PatternInstruction  tom_get_head_concPatternInstruction_PatternInstructionList( tom.engine.adt.tomterm.types.PatternInstructionList  l) { return  l.getHeadconcPatternInstruction() ;}private static  tom.engine.adt.tomterm.types.PatternInstructionList  tom_get_tail_concPatternInstruction_PatternInstructionList( tom.engine.adt.tomterm.types.PatternInstructionList  l) { return  l.getTailconcPatternInstruction() ;}private static boolean tom_is_empty_concPatternInstruction_PatternInstructionList( tom.engine.adt.tomterm.types.PatternInstructionList  l) { return  l.isEmptyconcPatternInstruction() ;}   private static   tom.engine.adt.tomterm.types.PatternInstructionList  tom_append_list_concPatternInstruction( tom.engine.adt.tomterm.types.PatternInstructionList l1,  tom.engine.adt.tomterm.types.PatternInstructionList  l2) {     if(tom_is_empty_concPatternInstruction_PatternInstructionList(l1)) {       return l2;     } else if(tom_is_empty_concPatternInstruction_PatternInstructionList(l2)) {       return l1;     } else if(tom_is_empty_concPatternInstruction_PatternInstructionList(tom_get_tail_concPatternInstruction_PatternInstructionList(l1))) {       return ( tom.engine.adt.tomterm.types.PatternInstructionList )tom_cons_list_concPatternInstruction(tom_get_head_concPatternInstruction_PatternInstructionList(l1),l2);     } else {       return ( tom.engine.adt.tomterm.types.PatternInstructionList )tom_cons_list_concPatternInstruction(tom_get_head_concPatternInstruction_PatternInstructionList(l1),tom_append_list_concPatternInstruction(tom_get_tail_concPatternInstruction_PatternInstructionList(l1),l2));     }   }   private static   tom.engine.adt.tomterm.types.PatternInstructionList  tom_get_slice_concPatternInstruction( tom.engine.adt.tomterm.types.PatternInstructionList  begin,  tom.engine.adt.tomterm.types.PatternInstructionList  end, tom.engine.adt.tomterm.types.PatternInstructionList  tail) {     if(tom_equal_term_PatternInstructionList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomterm.types.PatternInstructionList )tom_cons_list_concPatternInstruction(tom_get_head_concPatternInstruction_PatternInstructionList(begin),( tom.engine.adt.tomterm.types.PatternInstructionList )tom_get_slice_concPatternInstruction(tom_get_tail_concPatternInstruction_PatternInstructionList(begin),end,tail));     }   }   private static boolean tom_is_fun_sym_concTomTerm( tom.engine.adt.tomterm.types.TomList  t) { return  t instanceof tom.engine.adt.tomterm.types.tomlist.ConsconcTomTerm || t instanceof tom.engine.adt.tomterm.types.tomlist.EmptyconcTomTerm ;}private static  tom.engine.adt.tomterm.types.TomList  tom_empty_list_concTomTerm() { return  tom.engine.adt.tomterm.types.tomlist.EmptyconcTomTerm.make() ; }private static  tom.engine.adt.tomterm.types.TomList  tom_cons_list_concTomTerm( tom.engine.adt.tomterm.types.TomTerm  e,  tom.engine.adt.tomterm.types.TomList  l) { return  tom.engine.adt.tomterm.types.tomlist.ConsconcTomTerm.make(e,l) ; }private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_head_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.getHeadconcTomTerm() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_tail_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.getTailconcTomTerm() ;}private static boolean tom_is_empty_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.isEmptyconcTomTerm() ;}   private static   tom.engine.adt.tomterm.types.TomList  tom_append_list_concTomTerm( tom.engine.adt.tomterm.types.TomList l1,  tom.engine.adt.tomterm.types.TomList  l2) {     if(tom_is_empty_concTomTerm_TomList(l1)) {       return l2;     } else if(tom_is_empty_concTomTerm_TomList(l2)) {       return l1;     } else if(tom_is_empty_concTomTerm_TomList(tom_get_tail_concTomTerm_TomList(l1))) {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(l1),l2);     } else {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(l1),tom_append_list_concTomTerm(tom_get_tail_concTomTerm_TomList(l1),l2));     }   }   private static   tom.engine.adt.tomterm.types.TomList  tom_get_slice_concTomTerm( tom.engine.adt.tomterm.types.TomList  begin,  tom.engine.adt.tomterm.types.TomList  end, tom.engine.adt.tomterm.types.TomList  tail) {     if(tom_equal_term_TomList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(begin),( tom.engine.adt.tomterm.types.TomList )tom_get_slice_concTomTerm(tom_get_tail_concTomTerm_TomList(begin),end,tail));     }   }   private static boolean tom_is_fun_sym_concSlot( tom.engine.adt.tomslot.types.SlotList  t) { return  t instanceof tom.engine.adt.tomslot.types.slotlist.ConsconcSlot || t instanceof tom.engine.adt.tomslot.types.slotlist.EmptyconcSlot ;}private static  tom.engine.adt.tomslot.types.SlotList  tom_empty_list_concSlot() { return  tom.engine.adt.tomslot.types.slotlist.EmptyconcSlot.make() ; }private static  tom.engine.adt.tomslot.types.SlotList  tom_cons_list_concSlot( tom.engine.adt.tomslot.types.Slot  e,  tom.engine.adt.tomslot.types.SlotList  l) { return  tom.engine.adt.tomslot.types.slotlist.ConsconcSlot.make(e,l) ; }private static  tom.engine.adt.tomslot.types.Slot  tom_get_head_concSlot_SlotList( tom.engine.adt.tomslot.types.SlotList  l) { return  l.getHeadconcSlot() ;}private static  tom.engine.adt.tomslot.types.SlotList  tom_get_tail_concSlot_SlotList( tom.engine.adt.tomslot.types.SlotList  l) { return  l.getTailconcSlot() ;}private static boolean tom_is_empty_concSlot_SlotList( tom.engine.adt.tomslot.types.SlotList  l) { return  l.isEmptyconcSlot() ;}   private static   tom.engine.adt.tomslot.types.SlotList  tom_append_list_concSlot( tom.engine.adt.tomslot.types.SlotList l1,  tom.engine.adt.tomslot.types.SlotList  l2) {     if(tom_is_empty_concSlot_SlotList(l1)) {       return l2;     } else if(tom_is_empty_concSlot_SlotList(l2)) {       return l1;     } else if(tom_is_empty_concSlot_SlotList(tom_get_tail_concSlot_SlotList(l1))) {       return ( tom.engine.adt.tomslot.types.SlotList )tom_cons_list_concSlot(tom_get_head_concSlot_SlotList(l1),l2);     } else {       return ( tom.engine.adt.tomslot.types.SlotList )tom_cons_list_concSlot(tom_get_head_concSlot_SlotList(l1),tom_append_list_concSlot(tom_get_tail_concSlot_SlotList(l1),l2));     }   }   private static   tom.engine.adt.tomslot.types.SlotList  tom_get_slice_concSlot( tom.engine.adt.tomslot.types.SlotList  begin,  tom.engine.adt.tomslot.types.SlotList  end, tom.engine.adt.tomslot.types.SlotList  tail) {     if(tom_equal_term_SlotList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomslot.types.SlotList )tom_cons_list_concSlot(tom_get_head_concSlot_SlotList(begin),( tom.engine.adt.tomslot.types.SlotList )tom_get_slice_concSlot(tom_get_tail_concSlot_SlotList(begin),end,tail));     }   }    
  // ------------------------------------------------------------

  /*
   * The "expandVariable" phase expands RecordAppl into Variable
   * we focus on
   * - Match
   *
   * The types of subjects are inferred from the patterns
   *
   * Variable and TermAppl are expanded in the TomTerm case
   */

  private static class replace_expandVariable extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.engine.adt.tomtype.types.TomType  contextType; private  TomKernelExpander  expander; public replace_expandVariable( tom.engine.adt.tomtype.types.TomType  contextType,  TomKernelExpander  expander) { super(tom_make_Identity());this.contextType=contextType;this.expander=expander;}public  tom.engine.adt.tomtype.types.TomType  getcontextType() { return contextType;}public  TomKernelExpander  getexpander() { return expander;}public int getChildCount() { return 1; }public jjtraveler.Visitable getChildAt(int i) {switch (i) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public jjtraveler.Visitable setChildAt(int i, jjtraveler.Visitable child) {switch (i) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomoption.types.Option  visit_Option( tom.engine.adt.tomoption.types.Option  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_Option(tom__arg)) {{  tom.engine.adt.tomoption.types.Option  tomMatch1Position1=(( tom.engine.adt.tomoption.types.Option )tom__arg);if ( ( tom_is_fun_sym_OriginTracking(tomMatch1Position1) ||  false  ) ) {if ( true ) {


 return tomMatch1Position1; }}}}return super.visit_Option(tom__arg); }public  tom.engine.adt.tomsignature.types.TargetLanguage  visit_TargetLanguage( tom.engine.adt.tomsignature.types.TargetLanguage  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_TargetLanguage(tom__arg)) {{  tom.engine.adt.tomsignature.types.TargetLanguage  tomMatch2Position1=(( tom.engine.adt.tomsignature.types.TargetLanguage )tom__arg);if ( ( tom_is_fun_sym_TL(tomMatch2Position1) ||  false  ) ) {if ( true ) {



 return tomMatch2Position1; }}if ( ( tom_is_fun_sym_ITL(tomMatch2Position1) ||  false  ) ) {if ( true ) {
 return tomMatch2Position1; }}if ( ( tom_is_fun_sym_Comment(tomMatch2Position1) ||  false  ) ) {if ( true ) {
 return tomMatch2Position1; }}}}return super.visit_TargetLanguage(tom__arg); }public  tom.engine.adt.tomtype.types.TomType  visit_TomType( tom.engine.adt.tomtype.types.TomType  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_TomType(tom__arg)) {{  tom.engine.adt.tomtype.types.TomType  tomMatch3Position1=(( tom.engine.adt.tomtype.types.TomType )tom__arg);if ( ( tom_is_fun_sym_TomTypeAlone(tomMatch3Position1) ||  false  ) ) {if ( true ) {




	TomType type = expander.getType(tom_get_slot_TomTypeAlone_String(tomMatch3Position1));
	if(type != null) {
	  return type;
	} else {
	  return tomMatch3Position1; // useful for TomTypeAlone("unknown type")
	}
      }}}}return super.visit_TomType(tom__arg); }public  tom.engine.adt.tomsignature.types.TomVisit  visit_TomVisit( tom.engine.adt.tomsignature.types.TomVisit  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_TomVisit(tom__arg)) {{  tom.engine.adt.tomsignature.types.TomVisit  tomMatch4Position1=(( tom.engine.adt.tomsignature.types.TomVisit )tom__arg);if ( ( tom_is_fun_sym_VisitTerm(tomMatch4Position1) ||  false  ) ) {if ( true ) {




        TomType newType = (TomType)expander.expandVariable(contextType,tom_get_slot_VisitTerm_VNode(tomMatch4Position1));
        PatternInstructionList newPatternInstructionList = (PatternInstructionList)expander.expandVariable(newType,tom_get_slot_VisitTerm_AstPatternInstructionList(tomMatch4Position1));
        return tom_make_VisitTerm(newType,newPatternInstructionList,tom_get_slot_VisitTerm_Option(tomMatch4Position1));
      }}}}return super.visit_TomVisit(tom__arg); }public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch5Position1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if ( ( tom_is_fun_sym_Match(tomMatch5Position1) ||  false  ) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch5Position1NameNumberSubjectList=tom_get_slot_Match_SubjectList(tomMatch5Position1);if ( ( tom_is_fun_sym_SubjectList(tomMatch5Position1NameNumberSubjectList) ||  false  ) ) {{  tom.engine.adt.tomterm.types.TomList  tom_tomSubjectList=tom_get_slot_SubjectList_TomList(tomMatch5Position1NameNumberSubjectList);{  tom.engine.adt.tomterm.types.PatternInstructionList  tom_patternInstructionList=tom_get_slot_Match_AstPatternInstructionList(tomMatch5Position1);if ( true ) {









	/*
	 * Try to guess types for tomSubjectList
	 */
	ArrayList newSubjectList = new ArrayList();
	TomTypeList typeList = tom_empty_list_concTomType();
	int index = 0;
	while(!tom_tomSubjectList.isEmptyconcTomTerm()) {
	  TomTerm subject = tom_tomSubjectList.getHeadconcTomTerm();
matchBlock: {
	      if (tom_is_sort_TomTerm(subject)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch6Position1=(( tom.engine.adt.tomterm.types.TomTerm )subject);if ( ( tom_is_fun_sym_Variable(tomMatch6Position1) ||  false  ) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch6Position1NameNumberAstName=tom_get_slot_Variable_AstName(tomMatch6Position1);{  tom.engine.adt.tomtype.types.TomType  tomMatch6Position1NameNumberAstType=tom_get_slot_Variable_AstType(tomMatch6Position1);if ( ( tom_is_fun_sym_Name(tomMatch6Position1NameNumberAstName) ||  false  ) ) {if ( ( tom_is_fun_sym_TomTypeAlone(tomMatch6Position1NameNumberAstType) ||  false  ) ) {if ( true ) {

		  TomTerm newVariable = null;
		  if(expander.getType(tom_get_slot_TomTypeAlone_String(tomMatch6Position1NameNumberAstType)) == null) {
		    /* the subject is a variable with an unknown type */
		    TomType newType = expander.guessTypeFromPatterns(tom_patternInstructionList,index);
		    if(newType!=null) {
		      newVariable = tom_make_Variable(tom_get_slot_Variable_Option(tomMatch6Position1),tomMatch6Position1NameNumberAstName,newType,tom_get_slot_Variable_Constraints(tomMatch6Position1));
		    } else {
		      throw new TomRuntimeException("No symbol found for name '" + tom_get_slot_Name_String(tomMatch6Position1NameNumberAstName)+ "'");
		    }
		  } else {
		    newVariable = subject;
		  }
		  if(newVariable == null) {
		    throw new TomRuntimeException("Type cannot be guessed for '" + subject + "'");
		  } else {
		    newSubjectList.add(newVariable);
		    typeList = tom_append_list_concTomType(typeList,tom_cons_list_concTomType(newVariable.getAstType(),tom_empty_list_concTomType()));
		  }

		  break matchBlock;
		}}}}}}{ boolean tomNameNumberboolMatch6Position1= false ;{  tom.engine.adt.tomname.types.TomNameList  tomMatch6Position1NameNumberNameList= null ;if (tom_is_fun_sym_TermAppl(tomMatch6Position1)) {tomNameNumberboolMatch6Position1= true ;tomMatch6Position1NameNumberNameList=tom_get_slot_TermAppl_NameList(tomMatch6Position1);} else {if (tom_is_fun_sym_RecordAppl(tomMatch6Position1)) {tomNameNumberboolMatch6Position1= true ;tomMatch6Position1NameNumberNameList=tom_get_slot_RecordAppl_NameList(tomMatch6Position1);}}if (tomNameNumberboolMatch6Position1) {if ( ( tom_is_fun_sym_concTomName(tomMatch6Position1NameNumberNameList) ||  false  ) ) {{ int tomMatch6Position1NameNumberNameListIndex1=0;{  tom.engine.adt.tomname.types.TomNameList  tomMatch6Position1NameNumberNameListList1=tomMatch6Position1NameNumberNameList;{  tom.engine.adt.tomname.types.TomNameList  tomMatch6Position1NameNumberNameListSave1=tomMatch6Position1NameNumberNameListList1;{if (!(tom_is_empty_concTomName_TomNameList(tomMatch6Position1NameNumberNameListList1))) {{  tom.engine.adt.tomname.types.TomName  tomMatch6Position1NameNumberNameListPosition1=tom_get_head_concTomName_TomNameList(tomMatch6Position1NameNumberNameListList1);tomMatch6Position1NameNumberNameListIndex1=tomMatch6Position1NameNumberNameListIndex1 + 1;tomMatch6Position1NameNumberNameListList1=tom_get_tail_concTomName_TomNameList(tomMatch6Position1NameNumberNameListList1);if ( ( tom_is_fun_sym_Name(tomMatch6Position1NameNumberNameListPosition1) ||  false  ) ) {{  String  tom_name=tom_get_slot_Name_String(tomMatch6Position1NameNumberNameListPosition1);if ( true ) {


		  TomSymbol symbol = expander.getSymbolFromName(tom_name);
		  TomType type = null;
		  if(symbol!=null) {
		    type = TomBase.getSymbolCodomain(symbol);
		  } else {
		    // unknown function call
		    type = expander.guessTypeFromPatterns(tom_patternInstructionList,index);
		  }
		  if(type!=null) {
		    newSubjectList.add(tom_make_BuildReducedTerm(tomMatch6Position1,type));
		  } else {
		    throw new TomRuntimeException("No symbol found for name '" + tom_name+ "'");
		  }
		  typeList = tom_append_list_concTomType(typeList,tom_cons_list_concTomType(type,tom_empty_list_concTomType()));
		}}}}}tomMatch6Position1NameNumberNameListList1=tomMatch6Position1NameNumberNameListSave1;}}}}}}}}}}


	    } // end matchBlock
	    index++;
	    tom_tomSubjectList=tom_tomSubjectList.getTailconcTomTerm();
	}

      TomTerm newTomSubjectList = (TomTerm)expander.expandVariable(contextType, tom_make_SubjectList(ASTFactory.makeList(newSubjectList)));
      //System.out.println("newTomSubjectList = " + newTomSubjectList);
      TomType newTypeList = tom_make_TypeList((TomTypeList)expander.expandVariable(contextType,typeList));

      PatternInstructionList newPatternInstructionList = (PatternInstructionList)expander.expandVariable(newTypeList,tom_patternInstructionList);
      //System.out.println("newPatternInstructionList = " + newPatternInstructionList);
      return tom_make_Match(newTomSubjectList,newPatternInstructionList,tom_get_slot_Match_Option(tomMatch5Position1));
    }}}}}}}}return super.visit_Instruction(tom__arg); }public  tom.engine.adt.tomterm.types.Pattern  visit_Pattern( tom.engine.adt.tomterm.types.Pattern  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_Pattern(tom__arg)) {{  tom.engine.adt.tomterm.types.Pattern  tomMatch7Position1=(( tom.engine.adt.tomterm.types.Pattern )tom__arg);if ( ( tom_is_fun_sym_Pattern(tomMatch7Position1) ||  false  ) ) {{  tom.engine.adt.tomterm.types.TomList  tom_termList=tom_get_slot_Pattern_TomList(tomMatch7Position1);{  tom.engine.adt.tomterm.types.TomList  tom_guardList=tom_get_slot_Pattern_Guards(tomMatch7Position1);if ( true ) {if (tom_is_sort_TomType(contextType)) {{  tom.engine.adt.tomtype.types.TomType  tomMatch8Position1=(( tom.engine.adt.tomtype.types.TomType )contextType);if ( ( tom_is_fun_sym_TypeList(tomMatch8Position1) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomTypeList  tom_typeList=tom_get_slot_TypeList_TypeList(tomMatch8Position1);if ( true ) {












	  //System.out.println("expandVariable.9: "+l1+"(" + termList + ")");

	  // process a list of subterms
	  ArrayList list = new ArrayList();
	  while(!tom_termList.isEmptyconcTomTerm()) {
	    //System.out.println("type: " + `typeList.getHeadconcTomType());
	    //System.out.println("term: " + `termList.getHeadconcTomTerm());
	    list.add((TomTerm)expander.expandVariable(tom_typeList.getHeadconcTomType(), tom_termList.getHeadconcTomTerm()));
	    tom_termList= tom_termList.getTailconcTomTerm();
	    tom_typeList= tom_typeList.getTailconcTomType();
	  }
	  TomList newTermList = ASTFactory.makeList(list);

	  // process a list of guards
	  list.clear();
	  // build the list of variables that occur in the lhs
	  HashSet set = new HashSet();
	  TomBase.collectVariable(set,newTermList);
	  TomList varList = ASTFactory.makeList(set);
	  //System.out.println("varList = " + varList);
	  while(!tom_guardList.isEmptyconcTomTerm()) {
	    list.add((TomTerm)expander.replaceInstantiatedVariable(varList, tom_guardList.getHeadconcTomTerm()));
	    tom_guardList= tom_guardList.getTailconcTomTerm();
	  }
	  TomList newGuardList = ASTFactory.makeList(list);
	  //System.out.println("newGuardList = " + newGuardList);
	  return tom_make_Pattern(tom_get_slot_Pattern_SubjectList(tomMatch7Position1),newTermList,newGuardList);
	}}}}}

    }}}}}}return super.visit_Pattern(tom__arg); }public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch9Position1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);if ( ( tom_is_fun_sym_RecordAppl(tomMatch9Position1) ||  false  ) ) {{  tom.engine.adt.tomname.types.TomNameList  tomMatch9Position1NameNumberNameList=tom_get_slot_RecordAppl_NameList(tomMatch9Position1);{  tom.engine.adt.tomoption.types.OptionList  tom_option=tom_get_slot_RecordAppl_Option(tomMatch9Position1);if ( ( tom_is_fun_sym_concTomName(tomMatch9Position1NameNumberNameList) ||  false  ) ) {{ int tomMatch9Position1NameNumberNameListIndex1=0;{  tom.engine.adt.tomname.types.TomNameList  tomMatch9Position1NameNumberNameListList1=tomMatch9Position1NameNumberNameList;{  tom.engine.adt.tomname.types.TomNameList  tomMatch9Position1NameNumberNameListSave1=tomMatch9Position1NameNumberNameListList1;{if (!(tom_is_empty_concTomName_TomNameList(tomMatch9Position1NameNumberNameListList1))) {{  tom.engine.adt.tomname.types.TomName  tomMatch9Position1NameNumberNameListPosition1=tom_get_head_concTomName_TomNameList(tomMatch9Position1NameNumberNameListList1);tomMatch9Position1NameNumberNameListIndex1=tomMatch9Position1NameNumberNameListIndex1 + 1;tomMatch9Position1NameNumberNameListList1=tom_get_tail_concTomName_TomNameList(tomMatch9Position1NameNumberNameListList1);if ( ( tom_is_fun_sym_Name(tomMatch9Position1NameNumberNameListPosition1) ||  false  ) ) {{  String  tom_tomName=tom_get_slot_Name_String(tomMatch9Position1NameNumberNameListPosition1);{  tom.engine.adt.tomname.types.TomNameList  tom_nameList=tomMatch9Position1NameNumberNameList;{  tom.engine.adt.tomslot.types.SlotList  tom_slotList=tom_get_slot_RecordAppl_Slots(tomMatch9Position1);{  tom.engine.adt.tomconstraint.types.ConstraintList  tom_constraints=tom_get_slot_RecordAppl_Constraints(tomMatch9Position1);if ( true ) {




      TomSymbol tomSymbol = null;
      if(tom_tomName.equals("")) {
	try {
	  tomSymbol = expander.getSymbolFromType(contextType);
	  if(tomSymbol==null) {
	    throw new TomRuntimeException("No symbol found for type '" + contextType + "'");
	  }
	  tom_nameList= tom_cons_list_concTomName(tomSymbol.getAstName(),tom_empty_list_concTomName());
	} catch(UnsupportedOperationException e) {
	  // contextType has no AstType slot
	  tomSymbol = null;
	}
      } else {
	tomSymbol = expander.getSymbolFromName(tom_tomName);
      }

      if(tomSymbol != null) {
	SlotList subterm = expander.expandVariableList(tomSymbol, tom_slotList);
	ConstraintList newConstraints = (ConstraintList)expander.expandVariable(TomBase.getSymbolCodomain(tomSymbol),tom_constraints);
	return tom_make_RecordAppl(tom_option,tom_nameList,subterm,newConstraints);
      } else {
	if (tom_is_sort_TomType(contextType)) {{  tom.engine.adt.tomtype.types.TomType  tomMatch10Position1=(( tom.engine.adt.tomtype.types.TomType )contextType);if ( ( tom_is_fun_sym_Type(tomMatch10Position1) ||  false  ) ) {if ( true ) {

	    SlotList subterm = expander.expandVariableList(tom_make_emptySymbol(), tom_slotList);
	    ConstraintList newConstraints = (ConstraintList)expander.expandVariable(tomMatch10Position1,tom_constraints);
	    return tom_make_RecordAppl(tom_option,tom_nameList,subterm,newConstraints);
	  }}if ( true ) {


	    // do nothing
	    //System.out.println("contextType = " + contextType);
	    //System.out.println("subject        = " + subject);
	  }}}

      }
    }}}}}}}}tomMatch9Position1NameNumberNameListList1=tomMatch9Position1NameNumberNameListSave1;}}}}}}}}{ boolean tomNameNumberboolMatch9Position1= false ;{  tom.engine.adt.tomtype.types.TomType  tomMatch9Position1NameNumberAstType= null ;{  tom.engine.adt.tomconstraint.types.ConstraintList  tomMatch9Position1NameNumberConstraints= null ;if (tom_is_fun_sym_Variable(tomMatch9Position1)) {tomNameNumberboolMatch9Position1= true ;tomMatch9Position1NameNumberAstType=tom_get_slot_Variable_AstType(tomMatch9Position1);tomMatch9Position1NameNumberConstraints=tom_get_slot_Variable_Constraints(tomMatch9Position1);} else {if (tom_is_fun_sym_UnamedVariable(tomMatch9Position1)) {tomNameNumberboolMatch9Position1= true ;tomMatch9Position1NameNumberAstType=tom_get_slot_UnamedVariable_AstType(tomMatch9Position1);tomMatch9Position1NameNumberConstraints=tom_get_slot_UnamedVariable_Constraints(tomMatch9Position1);}}if (tomNameNumberboolMatch9Position1) {if ( ( tom_is_fun_sym_TomTypeAlone(tomMatch9Position1NameNumberAstType) ||  false  ) ) {{  tom.engine.adt.tomterm.types.TomTerm  tom_var=tomMatch9Position1;if ( true ) {


      TomType localType = expander.getType(tom_get_slot_TomTypeAlone_String(tomMatch9Position1NameNumberAstType));
      if(localType != null) {
	// The variable has already a known type
	return tom_var.setAstType(localType);
      }

      if (tom_is_sort_TomType(contextType)) {{  tom.engine.adt.tomtype.types.TomType  tomMatch11Position1=(( tom.engine.adt.tomtype.types.TomType )contextType);if ( ( tom_is_fun_sym_Type(tomMatch11Position1) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomType  tom_type=tomMatch11Position1;if ( true ) {

	  ConstraintList newConstraints = (ConstraintList)expander.expandVariable(tom_type,tomMatch9Position1NameNumberConstraints);
	  return tom_var.setAstType(tom_type).setConstraints(newConstraints);
	}}}}}

    }}}}}}}}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_replace_expandVariable( tom.engine.adt.tomtype.types.TomType  t0,  TomKernelExpander  t1) { return new replace_expandVariable(t0,t1); }




/**
 * @param index the column-index of the type that has to be infered
 */
private TomType guessTypeFromPatterns(PatternInstructionList patternInstructionList, int index) {
  if (tom_is_sort_PatternInstructionList(patternInstructionList)) {{  tom.engine.adt.tomterm.types.PatternInstructionList  tomMatch12Position1=(( tom.engine.adt.tomterm.types.PatternInstructionList )patternInstructionList);if ( ( tom_is_fun_sym_concPatternInstruction(tomMatch12Position1) ||  false  ) ) {{ int tomMatch12Position1Index1=0;{  tom.engine.adt.tomterm.types.PatternInstructionList  tomMatch12Position1List1=tomMatch12Position1;{  tom.engine.adt.tomterm.types.PatternInstructionList  tomMatch12Position1Begin1=tomMatch12Position1List1;{  tom.engine.adt.tomterm.types.PatternInstructionList  tomMatch12Position1End1=tomMatch12Position1List1;{while (!(tom_is_empty_concPatternInstruction_PatternInstructionList(tomMatch12Position1End1))) {tomMatch12Position1List1=tomMatch12Position1End1;{{  tom.engine.adt.tomterm.types.PatternInstructionList  tomMatch12Position1Save2=tomMatch12Position1List1;{{  tom.engine.adt.tomterm.types.PatternInstruction  tomMatch12Position1Position2=tom_get_head_concPatternInstruction_PatternInstructionList(tomMatch12Position1List1);tomMatch12Position1Index1=tomMatch12Position1Index1 + 1;tomMatch12Position1List1=tom_get_tail_concPatternInstruction_PatternInstructionList(tomMatch12Position1List1);if ( ( tom_is_fun_sym_PatternInstruction(tomMatch12Position1Position2) ||  false  ) ) {{  tom.engine.adt.tomterm.types.Pattern  tomMatch12Position1Position2NameNumberPattern=tom_get_slot_PatternInstruction_Pattern(tomMatch12Position1Position2);if ( ( tom_is_fun_sym_Pattern(tomMatch12Position1Position2NameNumberPattern) ||  false  ) ) {{  tom.engine.adt.tomterm.types.TomList  tomMatch12Position1Position2NameNumberPatternNameNumberTomList=tom_get_slot_Pattern_TomList(tomMatch12Position1Position2NameNumberPattern);if ( ( tom_is_fun_sym_concTomTerm(tomMatch12Position1Position2NameNumberPatternNameNumberTomList) ||  false  ) ) {{ int tomMatch12Position1Position2NameNumberPatternNameNumberTomListIndex1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1=tomMatch12Position1Position2NameNumberPatternNameNumberTomList;{  tom.engine.adt.tomterm.types.TomList  tomMatch12Position1Position2NameNumberPatternNameNumberTomListBegin1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1;{  tom.engine.adt.tomterm.types.TomList  tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1;{while (!(tom_is_empty_concTomTerm_TomList(tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1))) {tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1;{{  tom.engine.adt.tomterm.types.TomList  tomMatch12Position1Position2NameNumberPatternNameNumberTomListSave2=tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1;{{  tom.engine.adt.tomterm.types.TomTerm  tom_tmpSubject=tom_get_head_concTomTerm_TomList(tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1);tomMatch12Position1Position2NameNumberPatternNameNumberTomListIndex1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListIndex1 + 1;tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1=tom_get_tail_concTomTerm_TomList(tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1);if ( true ) {

      TomTerm subject = tom_tmpSubject;
      if (tom_is_sort_TomTerm(subject)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch13Position1=(( tom.engine.adt.tomterm.types.TomTerm )subject);if ( ( tom_is_fun_sym_AntiTerm(tomMatch13Position1) ||  false  ) ) {if ( true ) {
 subject = tom_get_slot_AntiTerm_TomTerm(tomMatch13Position1); }}}}if (tom_is_sort_TomTerm(subject)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch14Position1=(( tom.engine.adt.tomterm.types.TomTerm )subject);{ boolean tomNameNumberboolMatch14Position1= false ;{  tom.engine.adt.tomname.types.TomNameList  tomMatch14Position1NameNumberNameList= null ;if (tom_is_fun_sym_TermAppl(tomMatch14Position1)) {tomNameNumberboolMatch14Position1= true ;tomMatch14Position1NameNumberNameList=tom_get_slot_TermAppl_NameList(tomMatch14Position1);} else {if (tom_is_fun_sym_RecordAppl(tomMatch14Position1)) {tomNameNumberboolMatch14Position1= true ;tomMatch14Position1NameNumberNameList=tom_get_slot_RecordAppl_NameList(tomMatch14Position1);}}if (tomNameNumberboolMatch14Position1) {if ( ( tom_is_fun_sym_concTomName(tomMatch14Position1NameNumberNameList) ||  false  ) ) {{ int tomMatch14Position1NameNumberNameListIndex1=0;{  tom.engine.adt.tomname.types.TomNameList  tomMatch14Position1NameNumberNameListList1=tomMatch14Position1NameNumberNameList;{  tom.engine.adt.tomname.types.TomNameList  tomMatch14Position1NameNumberNameListSave1=tomMatch14Position1NameNumberNameListList1;{if (!(tom_is_empty_concTomName_TomNameList(tomMatch14Position1NameNumberNameListList1))) {{  tom.engine.adt.tomname.types.TomName  tomMatch14Position1NameNumberNameListPosition1=tom_get_head_concTomName_TomNameList(tomMatch14Position1NameNumberNameListList1);tomMatch14Position1NameNumberNameListIndex1=tomMatch14Position1NameNumberNameListIndex1 + 1;tomMatch14Position1NameNumberNameListList1=tom_get_tail_concTomName_TomNameList(tomMatch14Position1NameNumberNameListList1);if ( ( tom_is_fun_sym_Name(tomMatch14Position1NameNumberNameListPosition1) ||  false  ) ) {if ( true ) {



          //System.out.println("X.length = " + `X*.length());
          if(tom_get_slice_concTomTerm(tomMatch12Position1Position2NameNumberPatternNameNumberTomListBegin1,tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1,tom_empty_list_concTomTerm()).length() == index) {
            TomSymbol symbol = getSymbolFromName(tom_get_slot_Name_String(tomMatch14Position1NameNumberNameListPosition1));
            //System.out.println("name = " + `name);
            if(symbol!=null) {
              TomType newType = TomBase.getSymbolCodomain(symbol);
              //System.out.println("newType = " + `newType);
              return newType;
            } else {
              return null;
            }
          }
        }}}}tomMatch14Position1NameNumberNameListList1=tomMatch14Position1NameNumberNameListSave1;}}}}}}}}}}

    }}tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListSave2;}}tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1=tom_get_tail_concTomTerm_TomList(tomMatch12Position1Position2NameNumberPatternNameNumberTomListEnd1);}}tomMatch12Position1Position2NameNumberPatternNameNumberTomListList1=tomMatch12Position1Position2NameNumberPatternNameNumberTomListBegin1;}}}}}}}}}}}tomMatch12Position1List1=tomMatch12Position1Save2;}}tomMatch12Position1End1=tom_get_tail_concPatternInstruction_PatternInstructionList(tomMatch12Position1End1);}}tomMatch12Position1List1=tomMatch12Position1Begin1;}}}}}}}}

  return null;
}

protected jjtraveler.Visitable expandVariable(TomType contextType, jjtraveler.Visitable subject) {
  if(contextType == null) {
    throw new TomRuntimeException("expandVariable: null contextType");
  }
  try{
    return tom_make_ChoiceTopDown(tom_make_replace_expandVariable(contextType,this)).visit(subject);
  } catch(jjtraveler.VisitFailure e) {
    return subject;
  }
}

private TomType getTypeFromVariableList(TomName name, TomList list) {

  //System.out.println("name = " + name);
  //System.out.println("list = " + list);

  if (tom_is_sort_TomList(list)) {{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1=(( tom.engine.adt.tomterm.types.TomList )list);if ( ( tom_is_fun_sym_concTomTerm(tomMatch15Position1) ||  false  ) ) {{ int tomMatch15Position1Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1List1=tomMatch15Position1;if (tom_is_empty_concTomTerm_TomList(tomMatch15Position1List1)) {if ( true ) {

      System.out.println("getTypeFromVariableList. Stange case '" + name + "' not found");
      throw new TomRuntimeException("getTypeFromVariableList. Stange case '" + name + "' not found");
    }}}}}if ( ( tom_is_fun_sym_concTomTerm(tomMatch15Position1) ||  false  ) ) {{ int tomMatch15Position1Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1List1=tomMatch15Position1;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1Save1=tomMatch15Position1List1;{if (!(tom_is_empty_concTomTerm_TomList(tomMatch15Position1List1))) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch15Position1Position1=tom_get_head_concTomTerm_TomList(tomMatch15Position1List1);tomMatch15Position1Index1=tomMatch15Position1Index1 + 1;tomMatch15Position1List1=tom_get_tail_concTomTerm_TomList(tomMatch15Position1List1);if ( ( tom_is_fun_sym_Variable(tomMatch15Position1Position1) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomType  tomMatch15Position1Position1NameNumberAstType=tom_get_slot_Variable_AstType(tomMatch15Position1Position1);if ( ( tom_is_fun_sym_Type(tomMatch15Position1Position1NameNumberAstType) ||  false  ) ) {if ( true ) {

 if(name==tom_get_slot_Variable_AstName(tomMatch15Position1Position1)) return tomMatch15Position1Position1NameNumberAstType; }}}}}}tomMatch15Position1List1=tomMatch15Position1Save1;}}}}}if ( ( tom_is_fun_sym_concTomTerm(tomMatch15Position1) ||  false  ) ) {{ int tomMatch15Position1Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1List1=tomMatch15Position1;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1Save1=tomMatch15Position1List1;{if (!(tom_is_empty_concTomTerm_TomList(tomMatch15Position1List1))) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch15Position1Position1=tom_get_head_concTomTerm_TomList(tomMatch15Position1List1);tomMatch15Position1Index1=tomMatch15Position1Index1 + 1;tomMatch15Position1List1=tom_get_tail_concTomTerm_TomList(tomMatch15Position1List1);if ( ( tom_is_fun_sym_VariableStar(tomMatch15Position1Position1) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomType  tomMatch15Position1Position1NameNumberAstType=tom_get_slot_VariableStar_AstType(tomMatch15Position1Position1);if ( ( tom_is_fun_sym_Type(tomMatch15Position1Position1NameNumberAstType) ||  false  ) ) {if ( true ) {
 if(name==tom_get_slot_VariableStar_AstName(tomMatch15Position1Position1)) return tomMatch15Position1Position1NameNumberAstType; }}}}}}tomMatch15Position1List1=tomMatch15Position1Save1;}}}}}if ( ( tom_is_fun_sym_concTomTerm(tomMatch15Position1) ||  false  ) ) {{ int tomMatch15Position1Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1List1=tomMatch15Position1;{  tom.engine.adt.tomterm.types.TomList  tomMatch15Position1Save1=tomMatch15Position1List1;{if (!(tom_is_empty_concTomTerm_TomList(tomMatch15Position1List1))) {tomMatch15Position1Index1=tomMatch15Position1Index1 + 1;tomMatch15Position1List1=tom_get_tail_concTomTerm_TomList(tomMatch15Position1List1);if ( true ) {
 return getTypeFromVariableList(name,tomMatch15Position1List1); }}tomMatch15Position1List1=tomMatch15Position1Save1;}}}}}}}


  return null;
}

/*
 * perform type inference of subterms (subtermList)
 * under a given operator (symbol)
 */
private SlotList expandVariableList(TomSymbol symbol, SlotList subtermList) {
  if(symbol == null) {
    throw new TomRuntimeException("expandVariableList: null symbol");
  }

  if(subtermList.isEmptyconcSlot()) {
    return tom_empty_list_concSlot();
  }

  //System.out.println("symbol = " + subject.getastname());
  if (tom_is_sort_TomSymbol(symbol)) {{  tom.engine.adt.tomsignature.types.TomSymbol  tomMatch16Position1=(( tom.engine.adt.tomsignature.types.TomSymbol )symbol);if (tom_is_sort_SlotList(subtermList)) {{  tom.engine.adt.tomslot.types.SlotList  tomMatch16Position2=(( tom.engine.adt.tomslot.types.SlotList )subtermList);if ( ( tom_is_fun_sym_emptySymbol(tomMatch16Position1) ||  false  ) ) {if ( ( tom_is_fun_sym_concSlot(tomMatch16Position2) ||  false  ) ) {{ int tomMatch16Position2Index1=0;{  tom.engine.adt.tomslot.types.SlotList  tomMatch16Position2List1=tomMatch16Position2;{  tom.engine.adt.tomslot.types.SlotList  tomMatch16Position2Save1=tomMatch16Position2List1;{if (!(tom_is_empty_concSlot_SlotList(tomMatch16Position2List1))) {{  tom.engine.adt.tomslot.types.Slot  tomMatch16Position2Position1=tom_get_head_concSlot_SlotList(tomMatch16Position2List1);tomMatch16Position2Index1=tomMatch16Position2Index1 + 1;tomMatch16Position2List1=tom_get_tail_concSlot_SlotList(tomMatch16Position2List1);if ( ( tom_is_fun_sym_PairSlotAppl(tomMatch16Position2Position1) ||  false  ) ) {if ( true ) {

      /*
       * if the top symbol is unknown, the subterms
       * are expanded in an empty context
       */
      SlotList sl = expandVariableList(symbol,tomMatch16Position2List1);
      return tom_cons_list_concSlot(tom_make_PairSlotAppl(tom_get_slot_PairSlotAppl_SlotName(tomMatch16Position2Position1),(TomTerm)expandVariable(tom_make_EmptyType(),tom_get_slot_PairSlotAppl_Appl(tomMatch16Position2Position1))),tom_append_list_concSlot(sl,tom_empty_list_concSlot()));
    }}}}tomMatch16Position2List1=tomMatch16Position2Save1;}}}}}}if ( ( tom_is_fun_sym_Symbol(tomMatch16Position1) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomType  tomMatch16Position1NameNumberTypesToType=tom_get_slot_Symbol_TypesToType(tomMatch16Position1);if ( ( tom_is_fun_sym_TypesToType(tomMatch16Position1NameNumberTypesToType) ||  false  ) ) {{  tom.engine.adt.tomtype.types.TomType  tom_codomain=tom_get_slot_TypesToType_Codomain(tomMatch16Position1NameNumberTypesToType);{  tom.engine.adt.tomsignature.types.TomSymbol  tom_symb=tomMatch16Position1;if ( ( tom_is_fun_sym_concSlot(tomMatch16Position2) ||  false  ) ) {{ int tomMatch16Position2Index1=0;{  tom.engine.adt.tomslot.types.SlotList  tomMatch16Position2List1=tomMatch16Position2;{  tom.engine.adt.tomslot.types.SlotList  tomMatch16Position2Save1=tomMatch16Position2List1;{if (!(tom_is_empty_concSlot_SlotList(tomMatch16Position2List1))) {{  tom.engine.adt.tomslot.types.Slot  tomMatch16Position2Position1=tom_get_head_concSlot_SlotList(tomMatch16Position2List1);tomMatch16Position2Index1=tomMatch16Position2Index1 + 1;tomMatch16Position2List1=tom_get_tail_concSlot_SlotList(tomMatch16Position2List1);if ( ( tom_is_fun_sym_PairSlotAppl(tomMatch16Position2Position1) ||  false  ) ) {{  tom.engine.adt.tomname.types.TomName  tom_slotName=tom_get_slot_PairSlotAppl_SlotName(tomMatch16Position2Position1);{  tom.engine.adt.tomterm.types.TomTerm  tom_slotAppl=tom_get_slot_PairSlotAppl_Appl(tomMatch16Position2Position1);{  tom.engine.adt.tomslot.types.SlotList  tom_tail=tomMatch16Position2List1;if ( true ) {



	// process a list of subterms and a list of types
	if(TomBase.isListOperator(tom_symb) || TomBase.isArrayOperator(tom_symb)) {
	  /*
	   * todo:
	   * when the symbol is an associative operator,
	   * the signature has the form: list conc( element* )
	   * the list of types is reduced to the singleton { element }
	   *
	   * consider a pattern: conc(e1*,x,e2*,y,e3*)
	   *  assign the type "element" to each subterm: x and y
	   *  assign the type "list" to each subtermlist: e1*,e2* and e3*
	   */

	  //System.out.println("listoperator: " + symb);
	  //System.out.println("subtermlist: " + subtermlist);

	  if (tom_is_sort_TomTerm(tom_slotAppl)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch17Position1=(( tom.engine.adt.tomterm.types.TomTerm )tom_slotAppl);if ( ( tom_is_fun_sym_VariableStar(tomMatch17Position1) ||  false  ) ) {if ( true ) {

	      ConstraintList newconstraints = (ConstraintList)expandVariable(tom_codomain,tom_get_slot_VariableStar_Constraints(tomMatch17Position1));
	      SlotList sl = expandVariableList(symbol,tom_tail);
	      return tom_cons_list_concSlot(tom_make_PairSlotAppl(tom_slotName,tom_make_VariableStar(tom_get_slot_VariableStar_Option(tomMatch17Position1),tom_get_slot_VariableStar_AstName(tomMatch17Position1),tom_codomain,newconstraints)),tom_append_list_concSlot(sl,tom_empty_list_concSlot()));
	    }}if ( ( tom_is_fun_sym_UnamedVariableStar(tomMatch17Position1) ||  false  ) ) {if ( true ) {


	      ConstraintList newconstraints = (ConstraintList)expandVariable(tom_codomain,tom_get_slot_UnamedVariableStar_Constraints(tomMatch17Position1));
	      SlotList sl = expandVariableList(symbol,tom_tail);
	      return tom_cons_list_concSlot(tom_make_PairSlotAppl(tom_slotName,tom_make_UnamedVariableStar(tom_get_slot_UnamedVariableStar_Option(tomMatch17Position1),tom_codomain,newconstraints)),tom_append_list_concSlot(sl,tom_empty_list_concSlot()));
	    }}if ( true ) {


	      TomType domaintype = tom_get_slot_TypesToType_Domain(tomMatch16Position1NameNumberTypesToType).getHeadconcTomType();
	      SlotList sl = expandVariableList(symbol,tom_tail);
	      return tom_cons_list_concSlot(tom_make_PairSlotAppl(tom_slotName,(TomTerm)expandVariable(domaintype,tom_slotAppl)),tom_append_list_concSlot(sl,tom_empty_list_concSlot()));

	    }}}

	} else {
	  SlotList sl = expandVariableList(symbol,tom_tail);
	  return tom_cons_list_concSlot(tom_make_PairSlotAppl(tom_slotName,(TomTerm)expandVariable(TomBase.getSlotType(tom_symb,tom_slotName),tom_slotAppl)),tom_append_list_concSlot(sl,tom_empty_list_concSlot()));
	}
      }}}}}}}tomMatch16Position2List1=tomMatch16Position2Save1;}}}}}}}}}}}}}}

  System.out.println("expandVariableList: strange case: '" + symbol + "'");
  throw new TomRuntimeException("expandVariableList: strange case: '" + symbol + "'");
}

private static class replace_replaceInstantiatedVariable extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.engine.adt.tomterm.types.TomList  instantiatedVariable; public replace_replaceInstantiatedVariable( tom.engine.adt.tomterm.types.TomList  instantiatedVariable) { super(tom_make_Identity());this.instantiatedVariable=instantiatedVariable;}public  tom.engine.adt.tomterm.types.TomList  getinstantiatedVariable() { return instantiatedVariable;}public int getChildCount() { return 1; }public jjtraveler.Visitable getChildAt(int i) {switch (i) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public jjtraveler.Visitable setChildAt(int i, jjtraveler.Visitable child) {switch (i) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws jjtraveler.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tom_subject=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);if ( true ) {if (tom_is_sort_TomTerm(tom_subject)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch19Position1=(( tom.engine.adt.tomterm.types.TomTerm )tom_subject);if (tom_is_sort_TomList(instantiatedVariable)) {{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2=(( tom.engine.adt.tomterm.types.TomList )instantiatedVariable);if ( ( tom_is_fun_sym_RecordAppl(tomMatch19Position1) ||  false  ) ) {{  tom.engine.adt.tomname.types.TomNameList  tomMatch19Position1NameNumberNameList=tom_get_slot_RecordAppl_NameList(tomMatch19Position1);{  tom.engine.adt.tomslot.types.SlotList  tomMatch19Position1NameNumberSlots=tom_get_slot_RecordAppl_Slots(tomMatch19Position1);if ( ( tom_is_fun_sym_concTomName(tomMatch19Position1NameNumberNameList) ||  false  ) ) {{ int tomMatch19Position1NameNumberNameListIndex1=0;{  tom.engine.adt.tomname.types.TomNameList  tomMatch19Position1NameNumberNameListList1=tomMatch19Position1NameNumberNameList;{  tom.engine.adt.tomname.types.TomNameList  tomMatch19Position1NameNumberNameListSave1=tomMatch19Position1NameNumberNameListList1;{if (!(tom_is_empty_concTomName_TomNameList(tomMatch19Position1NameNumberNameListList1))) {{  tom.engine.adt.tomname.types.TomName  tom_opNameAST=tom_get_head_concTomName_TomNameList(tomMatch19Position1NameNumberNameListList1);tomMatch19Position1NameNumberNameListIndex1=tomMatch19Position1NameNumberNameListIndex1 + 1;tomMatch19Position1NameNumberNameListList1=tom_get_tail_concTomName_TomNameList(tomMatch19Position1NameNumberNameListList1);if (tom_is_empty_concTomName_TomNameList(tomMatch19Position1NameNumberNameListList1)) {if ( ( tom_is_fun_sym_concSlot(tomMatch19Position1NameNumberSlots) ||  false  ) ) {{ int tomMatch19Position1NameNumberSlotsIndex1=0;{  tom.engine.adt.tomslot.types.SlotList  tomMatch19Position1NameNumberSlotsList1=tomMatch19Position1NameNumberSlots;if (tom_is_empty_concSlot_SlotList(tomMatch19Position1NameNumberSlotsList1)) {if ( ( tom_is_fun_sym_concTomTerm(tomMatch19Position2) ||  false  ) ) {{ int tomMatch19Position2Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2List1=tomMatch19Position2;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Begin1=tomMatch19Position2List1;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2End1=tomMatch19Position2List1;{while (!(tom_is_empty_concTomTerm_TomList(tomMatch19Position2End1))) {tomMatch19Position2List1=tomMatch19Position2End1;{{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Save2=tomMatch19Position2List1;{{  tom.engine.adt.tomterm.types.TomTerm  tomMatch19Position2Position2=tom_get_head_concTomTerm_TomList(tomMatch19Position2List1);tomMatch19Position2Index1=tomMatch19Position2Index1 + 1;tomMatch19Position2List1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2List1);{ boolean tomNameNumberboolMatch19Position2Position2= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch19Position2Position2NameNumberAstName= null ;if (tom_is_fun_sym_Variable(tomMatch19Position2Position2)) {tomNameNumberboolMatch19Position2Position2= true ;tomMatch19Position2Position2NameNumberAstName=tom_get_slot_Variable_AstName(tomMatch19Position2Position2);} else {if (tom_is_fun_sym_VariableStar(tomMatch19Position2Position2)) {tomNameNumberboolMatch19Position2Position2= true ;tomMatch19Position2Position2NameNumberAstName=tom_get_slot_VariableStar_AstName(tomMatch19Position2Position2);}}if (tomNameNumberboolMatch19Position2Position2) {if (tom_equal_term_TomName(tom_opNameAST, tomMatch19Position2Position2NameNumberAstName)) {if ( true ) {




	  return tomMatch19Position2Position2;
	}}}}}}tomMatch19Position2List1=tomMatch19Position2Save2;}}tomMatch19Position2End1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2End1);}}tomMatch19Position2List1=tomMatch19Position2Begin1;}}}}}}}}}}}}}tomMatch19Position1NameNumberNameListList1=tomMatch19Position1NameNumberNameListSave1;}}}}}}}}if ( ( tom_is_fun_sym_Variable(tomMatch19Position1) ||  false  ) ) {if ( ( tom_is_fun_sym_concTomTerm(tomMatch19Position2) ||  false  ) ) {{ int tomMatch19Position2Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2List1=tomMatch19Position2;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Begin1=tomMatch19Position2List1;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2End1=tomMatch19Position2List1;{while (!(tom_is_empty_concTomTerm_TomList(tomMatch19Position2End1))) {tomMatch19Position2List1=tomMatch19Position2End1;{{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Save2=tomMatch19Position2List1;{{  tom.engine.adt.tomterm.types.TomTerm  tomMatch19Position2Position2=tom_get_head_concTomTerm_TomList(tomMatch19Position2List1);tomMatch19Position2Index1=tomMatch19Position2Index1 + 1;tomMatch19Position2List1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2List1);if ( ( tom_is_fun_sym_Variable(tomMatch19Position2Position2) ||  false  ) ) {if (tom_equal_term_TomName(tom_get_slot_Variable_AstName(tomMatch19Position1), tom_get_slot_Variable_AstName(tomMatch19Position2Position2))) {if ( true ) {

	  return tomMatch19Position2Position2;
	}}}}tomMatch19Position2List1=tomMatch19Position2Save2;}}tomMatch19Position2End1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2End1);}}tomMatch19Position2List1=tomMatch19Position2Begin1;}}}}}}}if ( ( tom_is_fun_sym_VariableStar(tomMatch19Position1) ||  false  ) ) {if ( ( tom_is_fun_sym_concTomTerm(tomMatch19Position2) ||  false  ) ) {{ int tomMatch19Position2Index1=0;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2List1=tomMatch19Position2;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Begin1=tomMatch19Position2List1;{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2End1=tomMatch19Position2List1;{while (!(tom_is_empty_concTomTerm_TomList(tomMatch19Position2End1))) {tomMatch19Position2List1=tomMatch19Position2End1;{{  tom.engine.adt.tomterm.types.TomList  tomMatch19Position2Save2=tomMatch19Position2List1;{{  tom.engine.adt.tomterm.types.TomTerm  tomMatch19Position2Position2=tom_get_head_concTomTerm_TomList(tomMatch19Position2List1);tomMatch19Position2Index1=tomMatch19Position2Index1 + 1;tomMatch19Position2List1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2List1);if ( ( tom_is_fun_sym_VariableStar(tomMatch19Position2Position2) ||  false  ) ) {if (tom_equal_term_TomName(tom_get_slot_VariableStar_AstName(tomMatch19Position1), tom_get_slot_VariableStar_AstName(tomMatch19Position2Position2))) {if ( true ) {

	  return tomMatch19Position2Position2;
	}}}}tomMatch19Position2List1=tomMatch19Position2Save2;}}tomMatch19Position2End1=tom_get_tail_concTomTerm_TomList(tomMatch19Position2End1);}}tomMatch19Position2List1=tomMatch19Position2Begin1;}}}}}}}}}}}

    }}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_replace_replaceInstantiatedVariable( tom.engine.adt.tomterm.types.TomList  t0) { return new replace_replaceInstantiatedVariable(t0); }



protected jjtraveler.Visitable replaceInstantiatedVariable(TomList instantiatedVariable, jjtraveler.Visitable subject) {
  if(instantiatedVariable == null) {
    throw new TomRuntimeException("replaceInstantiatedVariable: null instantiatedVariable");
  }
  try {
    return tom_make_ChoiceTopDown(tom_make_replace_replaceInstantiatedVariable(instantiatedVariable)).visit(subject);
  } catch(jjtraveler.VisitFailure e) {
    return subject;
  }
}

private TomType getType(String tomName) {
  TomType tomType = getSymbolTable().getType(tomName);
  return tomType;
}

}
