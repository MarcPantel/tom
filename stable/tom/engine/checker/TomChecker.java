/*  Generated by TOM: Do not edit this file */  /*
  
    TOM - To One Matching Compiler

    Copyright (C) 2000-2003  LORIA (CNRS, INPL, INRIA, UHP, U-Nancy 2)
			     Nancy, France.

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA

    Pierre-Etienne Moreau	e-mail: Pierre-Etienne.Moreau@loria.fr
    Christophe Mayer            ESIAL Student
    Julien Guyon

*/

package jtom.checker;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;

import jtom.TomBase;
import jtom.adt.*;
import jtom.runtime.Collect1;
import jtom.tools.TomTask;
import aterm.ATerm;
import jtom.TomEnvironment;
import jtom.tools.TomTaskInput;
import jtom.xml.Constants;
import jtom.exception.*;
import java.lang.Throwable;

abstract class TomChecker extends TomBase implements TomTask {
	// ------------------------------------------------------------
/*  Generated by TOM: Do not edit this file */    
	// ------------------------------------------------------------
	class TermDescription {
		int termClass, decLine;
		String name, type;
		public TermDescription(int termClass, String name, int decLine, String type) {
			this.termClass = termClass;
			this.decLine = decLine;
			this.name = name;
			this.type = type;
		}
	}
	
		// TomTask Interface 
	public void addTask(TomTask task) { this.nextTask = task; }
	public TomTask getTask() { return nextTask; }

	
	protected TomTaskInput input;
	protected TomTask nextTask;
	protected boolean strictType = false, warningAll = false, noWarning = false;
  private Option currentTomStructureOrgTrack;
  private int nullInteger = -1;
  private List errorMessage = new ArrayList();
	private ArrayList alreadyStudiedSymbol =  new ArrayList();
	private ArrayList alreadyStudiedType =  new ArrayList();  
  private final static int APPL = 0;
	private final static int RECORD_APPL = 1;
	private final static int XML_APPL = 2;
	private final static int VARIABLE_STAR = 3;
	private final static int UNAMED_VARIABLE_STAR = 4;
	private final static int PLACE_HOLDER = 5;
	private final static String OPERATOR = "%op";
	private final static String OP_ARRAY = "%oparray";
	private final static String OP_LIST = "%oplist";
	private final static String TYPE_TERM = "%typeterm";
	private final static String TYPE_ARRAY = "%typearray";
	private final static String TYPE_LIST = "%typelist";
	
	private final static String GET_FUN_SYM = "get_fun_sym";
	private final static String CMP_FUN_SYM = "cmp_fun_sym";
	private final static String EQUALS = "equals";
	private final static String GET_SUBTERM = "get_subterm";
	private final static String GET_ELEMENT = "get_element";
	private final static String GET_SIZE = "get_size";
	private final static String GET_HEAD = "get_head";
	private final static String GET_TAIL = "get_tail";
	private final static String IS_EMPTY = "is_empty";
	private final static String MAKE_APPEND = "make_append";
	private final static String MAKE_EMPTY = "make_empty";
	private final static String MAKE_INSERT = "make_insert";
	private final static String MAKE = "make";
  
  public TomChecker(TomEnvironment environment) { 
    super(environment);
  }
 
  public int getNumberFoundError() {
    return errorMessage.size();
  }
  
  public String getMessage(int n) {
    return (String)errorMessage.get(n);
  }
  
		/** Main syntax checking entry point: We check all interesting Tom Structure */
  protected void checkSyntax(TomTerm parsedTerm) {
    Collect1 collectAndVerify = new Collect1() {  
        public boolean apply(ATerm subject) {
          if(subject instanceof TomTerm) {
             {  TomTerm tom_match1_1 = null; tom_match1_1 = ( TomTerm) subject;_match1_pattern1: {  Declaration declaration = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match1_1)) {  Declaration tom_match1_1_1 = null; tom_match1_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match1_1); declaration = ( Declaration) tom_match1_1_1;
  verifyDeclaration(declaration); return false;  }}_match1_pattern2: {  TomList matchArgsList = null;  OptionList list = null;  TomList patternActionList = null; if(tom_is_fun_sym_Match(tom_match1_1)) {  TomTerm tom_match1_1_1 = null;  TomTerm tom_match1_1_2 = null;  Option tom_match1_1_3 = null; tom_match1_1_1 = ( TomTerm) tom_get_slot_Match_subjectList(tom_match1_1); tom_match1_1_2 = ( TomTerm) tom_get_slot_Match_patternList(tom_match1_1); tom_match1_1_3 = ( Option) tom_get_slot_Match_option(tom_match1_1); if(tom_is_fun_sym_SubjectList(tom_match1_1_1)) {  TomList tom_match1_1_1_1 = null; tom_match1_1_1_1 = ( TomList) tom_get_slot_SubjectList_tomList(tom_match1_1_1); matchArgsList = ( TomList) tom_match1_1_1_1; if(tom_is_fun_sym_PatternList(tom_match1_1_2)) {  TomList tom_match1_1_2_1 = null; tom_match1_1_2_1 = ( TomList) tom_get_slot_PatternList_tomList(tom_match1_1_2); patternActionList = ( TomList) tom_match1_1_2_1; if(tom_is_fun_sym_Option(tom_match1_1_3)) {  OptionList tom_match1_1_3_1 = null; tom_match1_1_3_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match1_1_3); list = ( OptionList) tom_match1_1_3_1;
   
                currentTomStructureOrgTrack = findOriginTracking(list);
                verifyMatch(matchArgsList, patternActionList); return true;
               } } } }}_match1_pattern3: {  TomRuleList list = null;  Option orgTrack = null; if(tom_is_fun_sym_RuleSet(tom_match1_1)) {  TomRuleList tom_match1_1_1 = null;  Option tom_match1_1_2 = null; tom_match1_1_1 = ( TomRuleList) tom_get_slot_RuleSet_ruleList(tom_match1_1); tom_match1_1_2 = ( Option) tom_get_slot_RuleSet_orgTrack(tom_match1_1); list = ( TomRuleList) tom_match1_1_1; orgTrack = ( Option) tom_match1_1_2;
 
								currentTomStructureOrgTrack = orgTrack;
								verifyRule(list); return false;
							 }}_match1_pattern4: {  TomTerm backquote = null; if(tom_is_fun_sym_BackQuoteAppl(tom_match1_1)) { backquote = ( TomTerm) tom_match1_1;
  
								permissiveVerify(backquote); return false; 
							 }}_match1_pattern5: {  TomList args = null;  OptionList options = null;  String name = null; if(tom_is_fun_sym_Appl(tom_match1_1)) {  Option tom_match1_1_1 = null;  TomName tom_match1_1_2 = null;  TomList tom_match1_1_3 = null; tom_match1_1_1 = ( Option) tom_get_slot_Appl_option(tom_match1_1); tom_match1_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match1_1); tom_match1_1_3 = ( TomList) tom_get_slot_Appl_args(tom_match1_1); if(tom_is_fun_sym_Option(tom_match1_1_1)) {  OptionList tom_match1_1_1_1 = null; tom_match1_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match1_1_1); options = ( OptionList) tom_match1_1_1_1; if(tom_is_fun_sym_Name(tom_match1_1_2)) {  String tom_match1_1_2_1 = null; tom_match1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match1_1_2); name = ( String) tom_match1_1_2_1; args = ( TomList) tom_match1_1_3;
  
              	verifyApplStructure(options, name, args); return true; 
               } } }}_match1_pattern6: {  TomList args = null;  OptionList options = null;  String name = null; if(tom_is_fun_sym_RecordAppl(tom_match1_1)) {  Option tom_match1_1_1 = null;  TomName tom_match1_1_2 = null;  TomList tom_match1_1_3 = null; tom_match1_1_1 = ( Option) tom_get_slot_RecordAppl_option(tom_match1_1); tom_match1_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match1_1); tom_match1_1_3 = ( TomList) tom_get_slot_RecordAppl_args(tom_match1_1); if(tom_is_fun_sym_Option(tom_match1_1_1)) {  OptionList tom_match1_1_1_1 = null; tom_match1_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match1_1_1); options = ( OptionList) tom_match1_1_1_1; if(tom_is_fun_sym_Name(tom_match1_1_2)) {  String tom_match1_1_2_1 = null; tom_match1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match1_1_2); name = ( String) tom_match1_1_2_1; args = ( TomList) tom_match1_1_3;
 
                verifyRecordStructure(options, name, args); return true;
               } } }}_match1_pattern7: {  String name = null;  TomList list1 = null;  OptionList options = null;  TomList list2 = null; if(tom_is_fun_sym_XMLAppl(tom_match1_1)) {  Option tom_match1_1_1 = null;  TomName tom_match1_1_2 = null;  TomList tom_match1_1_3 = null;  TomList tom_match1_1_4 = null; tom_match1_1_1 = ( Option) tom_get_slot_XMLAppl_option(tom_match1_1); tom_match1_1_2 = ( TomName) tom_get_slot_XMLAppl_astName(tom_match1_1); tom_match1_1_3 = ( TomList) tom_get_slot_XMLAppl_attrList(tom_match1_1); tom_match1_1_4 = ( TomList) tom_get_slot_XMLAppl_childList(tom_match1_1); if(tom_is_fun_sym_Option(tom_match1_1_1)) {  OptionList tom_match1_1_1_1 = null; tom_match1_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match1_1_1); options = ( OptionList) tom_match1_1_1_1; if(tom_is_fun_sym_Name(tom_match1_1_2)) {  String tom_match1_1_2_1 = null; tom_match1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match1_1_2); name = ( String) tom_match1_1_2_1; list1 = ( TomList) tom_match1_1_3; list2 = ( TomList) tom_match1_1_4;
 
								verifyXMLApplStructure(options, name, list1, list2); return true;
							 } } }}_match1_pattern8: {
  return true; } }
 
          } else {
            return true;
          }
        }// end apply
      }; // end new
    traversal().genericCollect(parsedTerm, collectAndVerify);   
  }

		/** SYMBOL AND TYPE CONCERNS */
  private void verifyDeclaration(Declaration declaration) {
  	
		 {  Declaration tom_match2_1 = null; tom_match2_1 = ( Declaration) declaration;_match2_pattern1: {  String tomName = null; if(tom_is_fun_sym_SymbolDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null; tom_match2_1_1 = ( TomName) tom_get_slot_SymbolDecl_astName(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1;
 
				TomSymbol tomSymbol = getSymbol(tomName);
				verifySymbol(OPERATOR, tomSymbol);
			 } }}_match2_pattern2: {  String tomName = null; if(tom_is_fun_sym_ArraySymbolDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null; tom_match2_1_1 = ( TomName) tom_get_slot_ArraySymbolDecl_astName(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1;
 
				TomSymbol tomSymbol = getSymbol(tomName);
				verifySymbol(OP_ARRAY, tomSymbol);
			 } }}_match2_pattern3: {  String tomName = null; if(tom_is_fun_sym_ListSymbolDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null; tom_match2_1_1 = ( TomName) tom_get_slot_ListSymbolDecl_astName(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1;
 
				TomSymbol tomSymbol = getSymbol(tomName);
				verifySymbol(OP_LIST, tomSymbol);
			 } }}_match2_pattern4: {  Option orgTrack = null;  TomList tomList = null;  String tomName = null; if(tom_is_fun_sym_TypeTermDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null;  TomList tom_match2_1_2 = null;  Option tom_match2_1_3 = null; tom_match2_1_1 = ( TomName) tom_get_slot_TypeTermDecl_astName(tom_match2_1); tom_match2_1_2 = ( TomList) tom_get_slot_TypeTermDecl_keywordList(tom_match2_1); tom_match2_1_3 = ( Option) tom_get_slot_TypeTermDecl_orgTrack(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1; tomList = ( TomList) tom_match2_1_2; orgTrack = ( Option) tom_match2_1_3;
 
				currentTomStructureOrgTrack = orgTrack;
				verifyMultipleDefinitionOfType(tomName,alreadyStudiedType);
				verifyTypeDecl(TYPE_TERM, tomList);
			 } }}_match2_pattern5: {  Option orgTrack = null;  TomList tomList = null;  String tomName = null; if(tom_is_fun_sym_TypeListDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null;  TomList tom_match2_1_2 = null;  Option tom_match2_1_3 = null; tom_match2_1_1 = ( TomName) tom_get_slot_TypeListDecl_astName(tom_match2_1); tom_match2_1_2 = ( TomList) tom_get_slot_TypeListDecl_keywordList(tom_match2_1); tom_match2_1_3 = ( Option) tom_get_slot_TypeListDecl_orgTrack(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1; tomList = ( TomList) tom_match2_1_2; orgTrack = ( Option) tom_match2_1_3;

 
				currentTomStructureOrgTrack = orgTrack;
				verifyMultipleDefinitionOfType(tomName,alreadyStudiedType);
				verifyTypeDecl(TYPE_LIST, tomList);
			 } }}_match2_pattern6: {  Option orgTrack = null;  TomList tomList = null;  String tomName = null; if(tom_is_fun_sym_TypeArrayDecl(tom_match2_1)) {  TomName tom_match2_1_1 = null;  TomList tom_match2_1_2 = null;  Option tom_match2_1_3 = null; tom_match2_1_1 = ( TomName) tom_get_slot_TypeArrayDecl_astName(tom_match2_1); tom_match2_1_2 = ( TomList) tom_get_slot_TypeArrayDecl_keywordList(tom_match2_1); tom_match2_1_3 = ( Option) tom_get_slot_TypeArrayDecl_orgTrack(tom_match2_1); if(tom_is_fun_sym_Name(tom_match2_1_1)) {  String tom_match2_1_1_1 = null; tom_match2_1_1_1 = ( String) tom_get_slot_Name_string(tom_match2_1_1); tomName = ( String) tom_match2_1_1_1; tomList = ( TomList) tom_match2_1_2; orgTrack = ( Option) tom_match2_1_3;

 
				currentTomStructureOrgTrack = orgTrack;
				verifyMultipleDefinitionOfType(tomName,alreadyStudiedType);
				verifyTypeDecl(TYPE_ARRAY, tomList);
			 } }} }
 
	}

		/** TYPE DECLARATION CONCERNS */
	private void verifyTypeDecl(String declType, TomList listOfDeclaration) {
		ArrayList verifyList = new ArrayList();
		verifyList.add(GET_FUN_SYM);
		verifyList.add(CMP_FUN_SYM);
		verifyList.add(EQUALS);
		
		if(declType == TYPE_TERM)	{
			verifyList.add(GET_SUBTERM);
		} else if(declType == TYPE_ARRAY) {
			verifyList.add(GET_ELEMENT);
			verifyList.add(GET_SIZE);
		} else if(declType == TYPE_LIST) {
			verifyList.add(GET_HEAD);
			verifyList.add(GET_TAIL);
			verifyList.add(IS_EMPTY);
		} else {
			System.out.println("Invalid verifyTypeDecl parameter: "+declType);return;
		}
 	   
		while(!listOfDeclaration.isEmpty()) {
			TomTerm term = listOfDeclaration.getHead();
			 {  TomTerm tom_match3_1 = null; tom_match3_1 = ( TomTerm) term;_match3_pattern1: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetFunctionSymbolDecl(tom_match3_1_1)) {  Option tom_match3_1_1_3 = null; tom_match3_1_1_3 = ( Option) tom_get_slot_GetFunctionSymbolDecl_orgTrack(tom_match3_1_1); orgTrack = ( Option) tom_match3_1_1_3;
 
					checkField(GET_FUN_SYM,verifyList,orgTrack, declType);
				 } }}_match3_pattern2: {  String name1 = null;  Option orgTrack = null;  String name2 = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_CompareFunctionSymbolDecl(tom_match3_1_1)) {  TomTerm tom_match3_1_1_1 = null;  TomTerm tom_match3_1_1_2 = null;  Option tom_match3_1_1_4 = null; tom_match3_1_1_1 = ( TomTerm) tom_get_slot_CompareFunctionSymbolDecl_symbolArg1(tom_match3_1_1); tom_match3_1_1_2 = ( TomTerm) tom_get_slot_CompareFunctionSymbolDecl_symbolArg2(tom_match3_1_1); tom_match3_1_1_4 = ( Option) tom_get_slot_CompareFunctionSymbolDecl_orgTrack(tom_match3_1_1); if(tom_is_fun_sym_Variable(tom_match3_1_1_1)) {  TomName tom_match3_1_1_1_2 = null; tom_match3_1_1_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_1); if(tom_is_fun_sym_Name(tom_match3_1_1_1_2)) {  String tom_match3_1_1_1_2_1 = null; tom_match3_1_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_1_2); name1 = ( String) tom_match3_1_1_1_2_1; if(tom_is_fun_sym_Variable(tom_match3_1_1_2)) {  TomName tom_match3_1_1_2_2 = null; tom_match3_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_2); if(tom_is_fun_sym_Name(tom_match3_1_1_2_2)) {  String tom_match3_1_1_2_2_1 = null; tom_match3_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_2_2); name2 = ( String) tom_match3_1_1_2_2_1; orgTrack = ( Option) tom_match3_1_1_4;
 
					checkFieldAndLinearArgs(CMP_FUN_SYM,verifyList,orgTrack,name1,name2, declType);
				 } } } } } }}_match3_pattern3: {  Option orgTrack = null;  String name2 = null;  String name1 = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_TermsEqualDecl(tom_match3_1_1)) {  TomTerm tom_match3_1_1_1 = null;  TomTerm tom_match3_1_1_2 = null;  Option tom_match3_1_1_4 = null; tom_match3_1_1_1 = ( TomTerm) tom_get_slot_TermsEqualDecl_termArg1(tom_match3_1_1); tom_match3_1_1_2 = ( TomTerm) tom_get_slot_TermsEqualDecl_termArg2(tom_match3_1_1); tom_match3_1_1_4 = ( Option) tom_get_slot_TermsEqualDecl_orgTrack(tom_match3_1_1); if(tom_is_fun_sym_Variable(tom_match3_1_1_1)) {  TomName tom_match3_1_1_1_2 = null; tom_match3_1_1_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_1); if(tom_is_fun_sym_Name(tom_match3_1_1_1_2)) {  String tom_match3_1_1_1_2_1 = null; tom_match3_1_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_1_2); name1 = ( String) tom_match3_1_1_1_2_1; if(tom_is_fun_sym_Variable(tom_match3_1_1_2)) {  TomName tom_match3_1_1_2_2 = null; tom_match3_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_2); if(tom_is_fun_sym_Name(tom_match3_1_1_2_2)) {  String tom_match3_1_1_2_2_1 = null; tom_match3_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_2_2); name2 = ( String) tom_match3_1_1_2_2_1; orgTrack = ( Option) tom_match3_1_1_4;
 
					checkFieldAndLinearArgs(EQUALS,verifyList,orgTrack,name1,name2, declType);
				 } } } } } }}_match3_pattern4: {  String name1 = null;  Option orgTrack = null;  String name2 = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetSubtermDecl(tom_match3_1_1)) {  TomTerm tom_match3_1_1_1 = null;  TomTerm tom_match3_1_1_2 = null;  Option tom_match3_1_1_4 = null; tom_match3_1_1_1 = ( TomTerm) tom_get_slot_GetSubtermDecl_termArg(tom_match3_1_1); tom_match3_1_1_2 = ( TomTerm) tom_get_slot_GetSubtermDecl_variable(tom_match3_1_1); tom_match3_1_1_4 = ( Option) tom_get_slot_GetSubtermDecl_orgTrack(tom_match3_1_1); if(tom_is_fun_sym_Variable(tom_match3_1_1_1)) {  TomName tom_match3_1_1_1_2 = null; tom_match3_1_1_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_1); if(tom_is_fun_sym_Name(tom_match3_1_1_1_2)) {  String tom_match3_1_1_1_2_1 = null; tom_match3_1_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_1_2); name1 = ( String) tom_match3_1_1_1_2_1; if(tom_is_fun_sym_Variable(tom_match3_1_1_2)) {  TomName tom_match3_1_1_2_2 = null; tom_match3_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_2); if(tom_is_fun_sym_Name(tom_match3_1_1_2_2)) {  String tom_match3_1_1_2_2_1 = null; tom_match3_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_2_2); name2 = ( String) tom_match3_1_1_2_2_1; orgTrack = ( Option) tom_match3_1_1_4;

 
					checkFieldAndLinearArgs(GET_SUBTERM,verifyList,orgTrack,name1,name2, declType);
				 } } } } } }}_match3_pattern5: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetHeadDecl(tom_match3_1_1)) {  Option tom_match3_1_1_3 = null; tom_match3_1_1_3 = ( Option) tom_get_slot_GetHeadDecl_orgTrack(tom_match3_1_1); orgTrack = ( Option) tom_match3_1_1_3;

 
					checkField(GET_HEAD,verifyList,orgTrack, declType);
				 } }}_match3_pattern6: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetTailDecl(tom_match3_1_1)) {  Option tom_match3_1_1_3 = null; tom_match3_1_1_3 = ( Option) tom_get_slot_GetTailDecl_orgTrack(tom_match3_1_1); orgTrack = ( Option) tom_match3_1_1_3;
 
					checkField(GET_TAIL,verifyList,orgTrack, declType);
				 } }}_match3_pattern7: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_IsEmptyDecl(tom_match3_1_1)) {  Option tom_match3_1_1_3 = null; tom_match3_1_1_3 = ( Option) tom_get_slot_IsEmptyDecl_orgTrack(tom_match3_1_1); orgTrack = ( Option) tom_match3_1_1_3;
 
					checkField(IS_EMPTY,verifyList,orgTrack, declType);
				 } }}_match3_pattern8: {  String name2 = null;  Option orgTrack = null;  String name1 = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetElementDecl(tom_match3_1_1)) {  TomTerm tom_match3_1_1_1 = null;  TomTerm tom_match3_1_1_2 = null;  Option tom_match3_1_1_4 = null; tom_match3_1_1_1 = ( TomTerm) tom_get_slot_GetElementDecl_kid1(tom_match3_1_1); tom_match3_1_1_2 = ( TomTerm) tom_get_slot_GetElementDecl_kid2(tom_match3_1_1); tom_match3_1_1_4 = ( Option) tom_get_slot_GetElementDecl_orgTrack(tom_match3_1_1); if(tom_is_fun_sym_Variable(tom_match3_1_1_1)) {  TomName tom_match3_1_1_1_2 = null; tom_match3_1_1_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_1); if(tom_is_fun_sym_Name(tom_match3_1_1_1_2)) {  String tom_match3_1_1_1_2_1 = null; tom_match3_1_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_1_2); name1 = ( String) tom_match3_1_1_1_2_1; if(tom_is_fun_sym_Variable(tom_match3_1_1_2)) {  TomName tom_match3_1_1_2_2 = null; tom_match3_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match3_1_1_2); if(tom_is_fun_sym_Name(tom_match3_1_1_2_2)) {  String tom_match3_1_1_2_2_1 = null; tom_match3_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match3_1_1_2_2); name2 = ( String) tom_match3_1_1_2_2_1; orgTrack = ( Option) tom_match3_1_1_4;

  
					checkFieldAndLinearArgs(GET_ELEMENT,verifyList,orgTrack,name1,name2, declType);
				 } } } } } }}_match3_pattern9: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToTomTerm(tom_match3_1)) {  Declaration tom_match3_1_1 = null; tom_match3_1_1 = ( Declaration) tom_get_slot_DeclarationToTomTerm_astDeclaration(tom_match3_1); if(tom_is_fun_sym_GetSizeDecl(tom_match3_1_1)) {  Option tom_match3_1_1_3 = null; tom_match3_1_1_3 = ( Option) tom_get_slot_GetSizeDecl_orgTrack(tom_match3_1_1); orgTrack = ( Option) tom_match3_1_1_3;
 
					checkField(GET_SIZE,verifyList,orgTrack, declType);
				 } }} }
 
			listOfDeclaration = listOfDeclaration.getTail();
		}
 	   
		if(verifyList.contains(EQUALS)) {
			verifyList.remove(verifyList.indexOf(EQUALS));
		}    
		if(!verifyList.isEmpty()) {
			messageMissingMacroFunctions(declType, verifyList);
		}
	}
  
	private void verifyMultipleDefinitionOfType(String name, ArrayList alreadyStudiedType) {
		if(alreadyStudiedType.contains(name)) {
			messageTypeErrorYetDefined(name);
		} else {
			alreadyStudiedType.add(name);
		}
	}
 	 
	private void messageTypeErrorYetDefined(String name) {
		int declLine = currentTomStructureOrgTrack.getLine();
		String s = "Multiple definition of type: Type '"+ name +"' is already defined";
		messageError(declLine, s);
	}
 	 
		/** SYMBOL DECLARATION CONCERNS */
	private void verifySymbol(String symbolType, TomSymbol tomSymbol){
		int nbArgs=0;
		OptionList optionList = tomSymbol.getOption().getOptionList();
			// We save first the origin tracking of the symbol declaration
		currentTomStructureOrgTrack = findOriginTracking(optionList);
		TomTypeList l = getSymbolDomain(tomSymbol);
		TomType type = getSymbolCodomain(tomSymbol);
		String name = tomSymbol.getAstName().getString();
		int line  = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		SlotList slotList = tomSymbol.getSlotList();
		verifyMultipleDefinitionOfSymbol(name, line, alreadyStudiedSymbol);
		verifySymbolCodomain(type.getString(), name, line);
		verifySymbolArguments(l, name, line);
		verifySymbolOptions(symbolType, optionList);
	}
 	 
	private void verifyMultipleDefinitionOfSymbol(String name, int line, ArrayList alreadyStudiedSymbol) {
		if(alreadyStudiedSymbol.contains(name)) {
			messageOperatorErrorYetDefined(name,line);
		} else {
			alreadyStudiedSymbol.add(name);
		}
	}
 	 
	private void messageOperatorErrorYetDefined(String name, int line) {
		String s = "Multiple definition of operator: Operator '"+ name +"' is already defined";
		messageError(line, s);
	}
 	 
	private void verifySymbolCodomain(String returnTypeName, String symbName, int symbLine) {
		if (symbolTable().getType(returnTypeName) == null){
			messageTypeOperatorError(returnTypeName, symbName, symbLine);
		}
	}
 	 
	private void messageTypeOperatorError(String type, String name, int line) {
		String s = "Operator '" + name + "' has an unknown return type: '" + type + "'";
		messageError(line,s);
	}
 	 
	private void verifySymbolArguments(TomTypeList args, String symbName, int symbLine) {
		TomType type;
		int nbArgs = 0;
		while(!args.isEmpty()) {
			type = args.getHead();
			verifyTypeExist(type.getString(), nbArgs, symbName, symbLine);
			nbArgs++;
			args = args.getTail();
		}
	}
 	 
	private void verifyTypeExist(String typeName, int slotPosition, String symbName, int symbLine) {
		if (symbolTable().getType(typeName) == null){
			messageTypesOperatorError(typeName, slotPosition, symbName, symbLine);
		}
	}
 	 
	private void messageTypesOperatorError(String type, int slotPosition, String name, int line) {
		String s = "Slot "+slotPosition + " in operator '"+ name + "' signature has an unknown type: '" + type + "'";
		messageError(line,s);
	}
 	 
	private void verifySymbolOptions(String symbType, OptionList list) {
		ArrayList verifyList = new ArrayList();
		boolean foundOpMake = false;
		if(symbType == OPERATOR){
		} else if(symbType == OP_ARRAY ) {
			verifyList.add(MAKE_EMPTY);
			verifyList.add(MAKE_APPEND);
		} else if(symbType == OP_LIST) {
			verifyList.add(MAKE_EMPTY);
			verifyList.add(MAKE_INSERT); 
		} else {
			System.out.println("Invalid verifySymbolOptions parameter: "+symbType);
		}
 	   
		while(!list.isEmpty()) {
			Option term = list.getHead();
			 {  Option tom_match4_1 = null; tom_match4_1 = ( Option) term;_match4_pattern1: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToOption(tom_match4_1)) {  Declaration tom_match4_1_1 = null; tom_match4_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match4_1); if(tom_is_fun_sym_MakeEmptyArray(tom_match4_1_1)) {  Option tom_match4_1_1_4 = null; tom_match4_1_1_4 = ( Option) tom_get_slot_MakeEmptyArray_orgTrack(tom_match4_1_1); orgTrack = ( Option) tom_match4_1_1_4;

  
					checkField(MAKE_EMPTY,verifyList,orgTrack, symbType);
				 } }}_match4_pattern2: {  String name2 = null;  Option orgTrack = null;  String name1 = null; if(tom_is_fun_sym_DeclarationToOption(tom_match4_1)) {  Declaration tom_match4_1_1 = null; tom_match4_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match4_1); if(tom_is_fun_sym_MakeAddArray(tom_match4_1_1)) {  TomTerm tom_match4_1_1_2 = null;  TomTerm tom_match4_1_1_3 = null;  Option tom_match4_1_1_5 = null; tom_match4_1_1_2 = ( TomTerm) tom_get_slot_MakeAddArray_varElt(tom_match4_1_1); tom_match4_1_1_3 = ( TomTerm) tom_get_slot_MakeAddArray_varList(tom_match4_1_1); tom_match4_1_1_5 = ( Option) tom_get_slot_MakeAddArray_orgTrack(tom_match4_1_1); if(tom_is_fun_sym_Variable(tom_match4_1_1_2)) {  TomName tom_match4_1_1_2_2 = null; tom_match4_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match4_1_1_2); if(tom_is_fun_sym_Name(tom_match4_1_1_2_2)) {  String tom_match4_1_1_2_2_1 = null; tom_match4_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match4_1_1_2_2); name2 = ( String) tom_match4_1_1_2_2_1; if(tom_is_fun_sym_Variable(tom_match4_1_1_3)) {  TomName tom_match4_1_1_3_2 = null; tom_match4_1_1_3_2 = ( TomName) tom_get_slot_Variable_astName(tom_match4_1_1_3); if(tom_is_fun_sym_Name(tom_match4_1_1_3_2)) {  String tom_match4_1_1_3_2_1 = null; tom_match4_1_1_3_2_1 = ( String) tom_get_slot_Name_string(tom_match4_1_1_3_2); name1 = ( String) tom_match4_1_1_3_2_1; orgTrack = ( Option) tom_match4_1_1_5;
 
					checkFieldAndLinearArgs(MAKE_APPEND, verifyList, orgTrack, name1, name2, symbType);
				 } } } } } }}_match4_pattern3: {  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToOption(tom_match4_1)) {  Declaration tom_match4_1_1 = null; tom_match4_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match4_1); if(tom_is_fun_sym_MakeEmptyList(tom_match4_1_1)) {  Option tom_match4_1_1_3 = null; tom_match4_1_1_3 = ( Option) tom_get_slot_MakeEmptyList_orgTrack(tom_match4_1_1); orgTrack = ( Option) tom_match4_1_1_3;

 
					checkField(MAKE_EMPTY,verifyList,orgTrack, symbType);         
				 } }}_match4_pattern4: {  String name1 = null;  Option orgTrack = null;  String name2 = null; if(tom_is_fun_sym_DeclarationToOption(tom_match4_1)) {  Declaration tom_match4_1_1 = null; tom_match4_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match4_1); if(tom_is_fun_sym_MakeAddList(tom_match4_1_1)) {  TomTerm tom_match4_1_1_2 = null;  TomTerm tom_match4_1_1_3 = null;  Option tom_match4_1_1_5 = null; tom_match4_1_1_2 = ( TomTerm) tom_get_slot_MakeAddList_varElt(tom_match4_1_1); tom_match4_1_1_3 = ( TomTerm) tom_get_slot_MakeAddList_varList(tom_match4_1_1); tom_match4_1_1_5 = ( Option) tom_get_slot_MakeAddList_orgTrack(tom_match4_1_1); if(tom_is_fun_sym_Variable(tom_match4_1_1_2)) {  TomName tom_match4_1_1_2_2 = null; tom_match4_1_1_2_2 = ( TomName) tom_get_slot_Variable_astName(tom_match4_1_1_2); if(tom_is_fun_sym_Name(tom_match4_1_1_2_2)) {  String tom_match4_1_1_2_2_1 = null; tom_match4_1_1_2_2_1 = ( String) tom_get_slot_Name_string(tom_match4_1_1_2_2); name2 = ( String) tom_match4_1_1_2_2_1; if(tom_is_fun_sym_Variable(tom_match4_1_1_3)) {  TomName tom_match4_1_1_3_2 = null; tom_match4_1_1_3_2 = ( TomName) tom_get_slot_Variable_astName(tom_match4_1_1_3); if(tom_is_fun_sym_Name(tom_match4_1_1_3_2)) {  String tom_match4_1_1_3_2_1 = null; tom_match4_1_1_3_2_1 = ( String) tom_get_slot_Name_string(tom_match4_1_1_3_2); name1 = ( String) tom_match4_1_1_3_2_1; orgTrack = ( Option) tom_match4_1_1_5;
 
					checkFieldAndLinearArgs(MAKE_INSERT, verifyList, orgTrack, name1, name2, symbType);
				 } } } } } }}_match4_pattern5: {  Option orgTrack = null;  TomList makeArgsList = null; if(tom_is_fun_sym_DeclarationToOption(tom_match4_1)) {  Declaration tom_match4_1_1 = null; tom_match4_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match4_1); if(tom_is_fun_sym_MakeDecl(tom_match4_1_1)) {  TomList tom_match4_1_1_3 = null;  Option tom_match4_1_1_5 = null; tom_match4_1_1_3 = ( TomList) tom_get_slot_MakeDecl_args(tom_match4_1_1); tom_match4_1_1_5 = ( Option) tom_get_slot_MakeDecl_orgTrack(tom_match4_1_1); makeArgsList = ( TomList) tom_match4_1_1_3; orgTrack = ( Option) tom_match4_1_1_5;

 
					if (!foundOpMake) {
						foundOpMake = true;
						verifyMakeDeclArgs(makeArgsList, orgTrack, symbType);
					} else {
						messageMacroFunctionRepeated(MAKE, orgTrack, symbType);
					}
				 } }}_match4_pattern6: {
       list = list.getTail();} }
 
		}
		if(!verifyList.isEmpty()) {
			messageMissingMacroFunctions(symbType, verifyList);
		}
	}
	
	private void verifyMakeDeclArgs(TomList argsList, Option orgTrack, String symbType){
		// we test the necessity to use different names for each variable-parameter.
		ArrayList listVar = new ArrayList();
		while(!argsList.isEmpty()) {
			TomTerm termVar = argsList.getHead();
			 {  TomTerm tom_match5_1 = null; tom_match5_1 = ( TomTerm) termVar;_match5_pattern1: {  OptionList listOption = null;  String name = null; if(tom_is_fun_sym_Variable(tom_match5_1)) {  Option tom_match5_1_1 = null;  TomName tom_match5_1_2 = null; tom_match5_1_1 = ( Option) tom_get_slot_Variable_option(tom_match5_1); tom_match5_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match5_1); if(tom_is_fun_sym_Option(tom_match5_1_1)) {  OptionList tom_match5_1_1_1 = null; tom_match5_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match5_1_1); listOption = ( OptionList) tom_match5_1_1_1; if(tom_is_fun_sym_Name(tom_match5_1_2)) {  String tom_match5_1_2_1 = null; tom_match5_1_2_1 = ( String) tom_get_slot_Name_string(tom_match5_1_2); name = ( String) tom_match5_1_2_1;
 
					if(listVar.contains(name)) {
						messageTwoSameNameVariableError("make", name, orgTrack, symbType);
					} else {
						listVar.add(name);
					}
				 } } }} }
 
			argsList = argsList.getTail();
		}
	}
	
	private void checkField(String field, ArrayList findFunctions, Option orgTrack, String declType) {
		if(findFunctions.contains(field)) {
			findFunctions.remove(findFunctions.indexOf(field)); 
		} else {
			messageMacroFunctionRepeated(field, orgTrack, declType);
		}
	}
 	 
	private void checkFieldAndLinearArgs(String field, ArrayList findFunctions, Option orgTrack, String name1, String name2, String declType) {
		checkField(field,findFunctions, orgTrack, declType);
		if(name1.equals(name2)) { 
			messageTwoSameNameVariableError(field, name1, orgTrack, declType);
		}
	}
 	 
	private void messageMacroFunctionRepeated(String nameFunction, Option orgTrack, String declType) {
		int line = orgTrack.getLine(), declLine = currentTomStructureOrgTrack.getLine();
		String nameDecl = currentTomStructureOrgTrack.getAstName().getString();
		String s = "Repeated macro-function '"+nameFunction+"' in '"+declType+" "+nameDecl+"' declared line "+declLine;
		messageError(line, s);
	}
 	 
	private void messageTwoSameNameVariableError(String nameFunction, String nameVar, Option orgTrack, String declType) {
		int line = orgTrack.getLine(), declLine = currentTomStructureOrgTrack.getLine();
		String nameDecl = currentTomStructureOrgTrack.getAstName().getString();
		String s =  "Arguments must be linear in method '"+nameFunction+"' of '"+declType+" "+nameDecl+"' declared at line "+declLine+" :Variable '"+nameVar+"' is repeated";
		messageError(line, s);
	}
 	 
	private void messageMissingMacroFunctions(String nameConstruct, ArrayList list) {
		int line = currentTomStructureOrgTrack.getLine();
		String name = currentTomStructureOrgTrack.getAstName().getString();
		String s = "Missing macro-function(s) "+list+" in '"+nameConstruct+" "+name+"'";
		messageError(line, s);
	}
 	 
    /** MATCH VERIFICATION CONCERNS */
    // Given a MatchConstruct's subject list and pattern-action list
  private void verifyMatch(TomList subjectList, TomList patternList) {
    ArrayList typeMatchArgs = new ArrayList();
			// From the subjects list(match definition), we test each used type and keep them in memory
		 {  TomList tom_match6_1 = null; tom_match6_1 = ( TomList) subjectList;_match6_pattern1: {  TomTerm tom_absvar1 = null; if(tom_is_fun_sym_concTomTerm(tom_match6_1)) {  TomList tom_match6_1_begin1 = null;  TomList tom_match6_1_end1 = null;  TomList tom_match6_1_list1 = null; tom_match6_1_list1 = ( TomList) tom_match6_1; tom_match6_1_begin1 = ( TomList) tom_match6_1_list1; tom_match6_1_end1 = ( TomList) tom_match6_1_list1; do { if(!(tom_is_empty_TomList(tom_match6_1_list1))) { tom_absvar1 = ( TomTerm) tom_get_head_TomList(tom_match6_1_list1); tom_match6_1_list1 = ( TomList) tom_get_tail_TomList(tom_match6_1_list1); {  TomTerm tom_match7_1 = null; tom_match7_1 = ( TomTerm) tom_absvar1;_match7_pattern1: {  String name = null;  String type = null; if(tom_is_fun_sym_TLVar(tom_match7_1)) {  String tom_match7_1_1 = null;  TomType tom_match7_1_2 = null; tom_match7_1_1 = ( String) tom_get_slot_TLVar_strName(tom_match7_1); tom_match7_1_2 = ( TomType) tom_get_slot_TLVar_astType(tom_match7_1); name = ( String) tom_match7_1_1; if(tom_is_fun_sym_TomTypeAlone(tom_match7_1_2)) {  String tom_match7_1_2_1 = null; tom_match7_1_2_1 = ( String) tom_get_slot_TomTypeAlone_string(tom_match7_1_2); type = ( String) tom_match7_1_2_1;
 
				if(symbolTable().getType(type) == null) {
					messageMatchTypeVariableError(name, type);
				}
				typeMatchArgs.add(type);				
			 } }} } } if(!(tom_is_empty_TomList(tom_match6_1_end1))) { tom_match6_1_end1 = ( TomList) tom_get_tail_TomList(tom_match6_1_end1); } tom_match6_1_list1 = ( TomList) tom_match6_1_end1; } while(!(tom_is_empty_TomList(tom_match6_1_list1))); }} }
 	
		int nbExpectedArgs = typeMatchArgs.size();
		// Then control each pattern vs the match definition
		 {  TomList tom_match8_1 = null; tom_match8_1 = ( TomList) patternList;_match8_pattern1: {  TomTerm tom_absvar2 = null; if(tom_is_fun_sym_concTomTerm(tom_match8_1)) {  TomList tom_match8_1_begin1 = null;  TomList tom_match8_1_end1 = null;  TomList tom_match8_1_list1 = null; tom_match8_1_list1 = ( TomList) tom_match8_1; tom_match8_1_begin1 = ( TomList) tom_match8_1_list1; tom_match8_1_end1 = ( TomList) tom_match8_1_list1; do { if(!(tom_is_empty_TomList(tom_match8_1_list1))) { tom_absvar2 = ( TomTerm) tom_get_head_TomList(tom_match8_1_list1); tom_match8_1_list1 = ( TomList) tom_get_tail_TomList(tom_match8_1_list1); {  TomTerm tom_match9_1 = null; tom_match9_1 = ( TomTerm) tom_absvar2;_match9_pattern1: {  TomList terms = null; if(tom_is_fun_sym_PatternAction(tom_match9_1)) {  TomTerm tom_match9_1_1 = null; tom_match9_1_1 = ( TomTerm) tom_get_slot_PatternAction_termList(tom_match9_1); if(tom_is_fun_sym_TermList(tom_match9_1_1)) {  TomList tom_match9_1_1_1 = null; tom_match9_1_1_1 = ( TomList) tom_get_slot_TermList_tomList(tom_match9_1_1); terms = ( TomList) tom_match9_1_1_1;
 
				verifyMatchPattern(terms, typeMatchArgs, nbExpectedArgs);
			 } }} } } if(!(tom_is_empty_TomList(tom_match8_1_end1))) { tom_match8_1_end1 = ( TomList) tom_get_tail_TomList(tom_match8_1_end1); } tom_match8_1_list1 = ( TomList) tom_match8_1_end1; } while(!(tom_is_empty_TomList(tom_match8_1_list1))); }} }
 
  }

    // For each Pattern we count and collect type information
    // but also we test that terms are well formed
    // No top variable star are allowed
  private void verifyMatchPattern(TomList termList, ArrayList typeMatchArgs, int nbExpectedArgs) {
    ArrayList foundTypeMatch = new ArrayList();
    int line = nullInteger;
    int nbFoundArgs = 0;
    
		 {  TomList tom_match10_1 = null; tom_match10_1 = ( TomList) termList;_match10_pattern1: {  TomTerm term = null; if(tom_is_fun_sym_concTomTerm(tom_match10_1)) {  TomList tom_match10_1_begin1 = null;  TomList tom_match10_1_end1 = null;  TomList tom_match10_1_list1 = null; tom_match10_1_list1 = ( TomList) tom_match10_1; tom_match10_1_begin1 = ( TomList) tom_match10_1_list1; tom_match10_1_end1 = ( TomList) tom_match10_1_list1; do { if(!(tom_is_empty_TomList(tom_match10_1_list1))) { term = ( TomTerm) tom_get_head_TomList(tom_match10_1_list1); tom_match10_1_list1 = ( TomList) tom_get_tail_TomList(tom_match10_1_list1);
 
				line = findOriginTrackingLine(term.getOption().getOptionList());
                                ensureOriginTrackingLine(line);
				nbFoundArgs++;
				if(nbFoundArgs > nbExpectedArgs) {
					messageMatchErrorNumberArgument(nbExpectedArgs, nbFoundArgs, line);
			 		return;
				}
				TermDescription termDesc = analyseTomTerm(term);
				// Var* and _* are not allowed as top leftmost symbol
				if(termDesc.termClass == UNAMED_VARIABLE_STAR || termDesc.termClass == VARIABLE_STAR) {
					messageMatchErrorVariableStar(termDesc.name, termDesc.decLine);
				}
				// ensure type coherence if strictType
				if(strictType) {
					if(termDesc.type != null && !termDesc.type.equals(typeMatchArgs.get(nbFoundArgs-1)) ) {
						messageMatchErrorTypeArgument(nbFoundArgs, (String)typeMatchArgs.get(nbFoundArgs-1), termDesc.type, termDesc.decLine); 
					}
				}
			 } if(!(tom_is_empty_TomList(tom_match10_1_end1))) { tom_match10_1_end1 = ( TomList) tom_get_tail_TomList(tom_match10_1_end1); } tom_match10_1_list1 = ( TomList) tom_match10_1_end1; } while(!(tom_is_empty_TomList(tom_match10_1_list1))); }} }
 
		if(nbFoundArgs < nbExpectedArgs) {
			messageMatchErrorNumberArgument(nbExpectedArgs, nbFoundArgs, line);
		}
  }
  
  private void messageMatchErrorNumberArgument(int nbExpectedVar, int nbFoundVar, int line) {
    int declLine = currentTomStructureOrgTrack.getLine();
    String s = "Bad number of arguments: "+nbExpectedVar+" argument(s) required but "+nbFoundVar+" found in %match structure declared line "+declLine; 
    messageError(line,s);
  }
  
  private void messageMatchErrorTypeArgument(int slotNumber, String expectedType, String givenType, int line) {
    int declLine = currentTomStructureOrgTrack.getLine();
    String s =  "Bad type for slot "+ slotNumber +" :Type '"+expectedType+"' required but Type '"+givenType+"' found in %match declared line "+declLine;
    messageError(line, s);
  }
  
  private void messageMatchTypeVariableError(String name, String type) {
    int declLine = currentTomStructureOrgTrack.getLine();
    String s = "Variable '" + name + "' has an unknown type '"+type+"' in %match construct declared line "+declLine;
    messageError(declLine,s);
  }
  
  private void messageMatchErrorVariableStar(String nameVariableStar, int line) {
    int declLine = currentTomStructureOrgTrack.getLine();
    String s = "Single list variable '"+nameVariableStar+"' is not allowed on left most part of %match structure declared line "+declLine;
    messageError(line,s);
  }
  
	/** RULE VERIFICATION CONCERNS */
	private void verifyRule(TomRuleList ruleList) {
		int ruleNumber = 0;
		String name = "Unknown return type";
		
		 {  TomRuleList tom_match11_1 = null; tom_match11_1 = ( TomRuleList) ruleList;_match11_pattern1: {  TomRule tom_absvar3 = null; if(tom_is_fun_sym_concTomRule(tom_match11_1)) {  TomRuleList tom_match11_1_begin1 = null;  TomRuleList tom_match11_1_end1 = null;  TomRuleList tom_match11_1_list1 = null; tom_match11_1_list1 = ( TomRuleList) tom_match11_1; tom_match11_1_begin1 = ( TomRuleList) tom_match11_1_list1; tom_match11_1_end1 = ( TomRuleList) tom_match11_1_list1; do { if(!(tom_is_empty_TomRuleList(tom_match11_1_list1))) { tom_absvar3 = ( TomRule) tom_get_head_TomRuleList(tom_match11_1_list1); tom_match11_1_list1 = ( TomRuleList) tom_get_tail_TomRuleList(tom_match11_1_list1); {  TomRule tom_match12_1 = null; tom_match12_1 = ( TomRule) tom_absvar3;_match12_pattern1: {  Option option = null;  TomList condList = null;  TomTerm rhs = null;  TomTerm lhs = null; if(tom_is_fun_sym_RewriteRule(tom_match12_1)) {  TomTerm tom_match12_1_1 = null;  TomTerm tom_match12_1_2 = null;  TomList tom_match12_1_3 = null;  Option tom_match12_1_4 = null; tom_match12_1_1 = ( TomTerm) tom_get_slot_RewriteRule_lhs(tom_match12_1); tom_match12_1_2 = ( TomTerm) tom_get_slot_RewriteRule_rhs(tom_match12_1); tom_match12_1_3 = ( TomList) tom_get_slot_RewriteRule_condList(tom_match12_1); tom_match12_1_4 = ( Option) tom_get_slot_RewriteRule_option(tom_match12_1); if(tom_is_fun_sym_Term(tom_match12_1_1)) {  TomTerm tom_match12_1_1_1 = null; tom_match12_1_1_1 = ( TomTerm) tom_get_slot_Term_tomTerm(tom_match12_1_1); lhs = ( TomTerm) tom_match12_1_1_1; if(tom_is_fun_sym_Term(tom_match12_1_2)) {  TomTerm tom_match12_1_2_1 = null; tom_match12_1_2_1 = ( TomTerm) tom_get_slot_Term_tomTerm(tom_match12_1_2); rhs = ( TomTerm) tom_match12_1_2_1; condList = ( TomList) tom_match12_1_3; option = ( Option) tom_match12_1_4;
 
				//Each Lhs shall start with the same production name
				name = verifyLhsRuleAndConstructorEgality(lhs, name, ruleNumber);
				if(ruleNumber == 0) {
						// update the root of lhs: it becomes a defined symbol
					ast().updateDefinedSymbol(symbolTable(),lhs);
				}
				TomType lhsType = getSymbolCodomain(getSymbol(name));
				verifyRhsRuleStructure(rhs, lhsType);
				ruleNumber++;
			 } } }} } } if(!(tom_is_empty_TomRuleList(tom_match11_1_end1))) { tom_match11_1_end1 = ( TomRuleList) tom_get_tail_TomRuleList(tom_match11_1_end1); } tom_match11_1_list1 = ( TomRuleList) tom_match11_1_end1; } while(!(tom_is_empty_TomRuleList(tom_match11_1_list1))); }} }
 
	}
  
	private String verifyLhsRuleAndConstructorEgality(TomTerm lhs, String  ruleName, int ruleNumber) {
		String methodName = "";
		OptionList options = null;

		 {  TomTerm tom_match13_1 = null; tom_match13_1 = ( TomTerm) lhs;_match13_pattern1: {  String name = null;  OptionList optionList = null; if(tom_is_fun_sym_Appl(tom_match13_1)) {  Option tom_match13_1_1 = null;  TomName tom_match13_1_2 = null; tom_match13_1_1 = ( Option) tom_get_slot_Appl_option(tom_match13_1); tom_match13_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1; if(tom_is_fun_sym_Name(tom_match13_1_2)) {  String tom_match13_1_2_1 = null; tom_match13_1_2_1 = ( String) tom_get_slot_Name_string(tom_match13_1_2); name = ( String) tom_match13_1_2_1;

 
				checkSyntax(lhs);
					/* lhs outermost symbol shall have a corresponding make */
				TomSymbol symb = getSymbol(name);
				if (symb == null) {
					messageRuleErrorUnknownSymbol(name);
					return methodName;
				}
				if ( !findMakeDeclOrDefSymbol(getSymbol(name).getOption().getOptionList())) {
					messageNoMakeForSymbol(name, optionList);
				}
				options = optionList;
				methodName = name;
			 } } }}_match13_pattern2: {  String name = null;  OptionList optionList = null; if(tom_is_fun_sym_RecordAppl(tom_match13_1)) {  Option tom_match13_1_1 = null;  TomName tom_match13_1_2 = null; tom_match13_1_1 = ( Option) tom_get_slot_RecordAppl_option(tom_match13_1); tom_match13_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1; if(tom_is_fun_sym_Name(tom_match13_1_2)) {  String tom_match13_1_2_1 = null; tom_match13_1_2_1 = ( String) tom_get_slot_Name_string(tom_match13_1_2); name = ( String) tom_match13_1_2_1;  				checkSyntax(lhs); 					/* lhs outermost symbol shall have a corresponding make */ 				TomSymbol symb = getSymbol(name); 				if (symb == null) { 					messageRuleErrorUnknownSymbol(name); 					return methodName; 				} 				if ( !findMakeDeclOrDefSymbol(getSymbol(name).getOption().getOptionList())) { 					messageNoMakeForSymbol(name, optionList); 				} 				options = optionList; 				methodName = name; 			 } } }}_match13_pattern3: {  String name1 = null;  OptionList optionList = null; if(tom_is_fun_sym_VariableStar(tom_match13_1)) {  Option tom_match13_1_1 = null;  TomName tom_match13_1_2 = null; tom_match13_1_1 = ( Option) tom_get_slot_VariableStar_option(tom_match13_1); tom_match13_1_2 = ( TomName) tom_get_slot_VariableStar_astName(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1; if(tom_is_fun_sym_Name(tom_match13_1_2)) {  String tom_match13_1_2_1 = null; tom_match13_1_2_1 = ( String) tom_get_slot_Name_string(tom_match13_1_2); name1 = ( String) tom_match13_1_2_1;

 
				int line = findOriginTrackingLine(name1,optionList);    
				messageRuleErrorVariableStar(name1, line);
				return ruleName;
			 } } }}_match13_pattern4: {  OptionList optionList = null; if(tom_is_fun_sym_UnamedVariableStar(tom_match13_1)) {  Option tom_match13_1_1 = null; tom_match13_1_1 = ( Option) tom_get_slot_UnamedVariableStar_option(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1;


  
				messageRuleErrorLhsImpossiblePlaceHolder(optionList);
				return ruleName;
			 } }}_match13_pattern5: {  OptionList optionList = null; if(tom_is_fun_sym_Placeholder(tom_match13_1)) {  Option tom_match13_1_1 = null; tom_match13_1_1 = ( Option) tom_get_slot_Placeholder_option(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1;   				messageRuleErrorLhsImpossiblePlaceHolder(optionList); 				return ruleName; 			 } }}_match13_pattern6: {  OptionList optionList = null; if(tom_is_fun_sym_XMLAppl(tom_match13_1)) {  Option tom_match13_1_1 = null; tom_match13_1_1 = ( Option) tom_get_slot_XMLAppl_option(tom_match13_1); if(tom_is_fun_sym_Option(tom_match13_1_1)) {  OptionList tom_match13_1_1_1 = null; tom_match13_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match13_1_1); optionList = ( OptionList) tom_match13_1_1_1;
 
				messageRuleErrorLhsImpossibleXML(optionList);
				return ruleName;
			 } }} }
 
		
		if ( ruleNumber != 0 && !methodName.equals(ruleName)) {   
			messageRuleErrorConstructorEgality(methodName, ruleName, options);
			return ruleName;
		}
		return methodName;
	}

	private void messageRuleErrorUnknownSymbol(String symbolName) {
		int line = currentTomStructureOrgTrack.getLine();
		String s = "Symbol '" +symbolName+ "' has no been declared: see rule declared line "+line;
		messageError(line,s); 
	}
  
	private void messageNoMakeForSymbol(String name, OptionList optionList) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
                String s = "Symbol '" +name+ "' has no 'make' method associated in structure declared line "+declLine;
		messageError(line,s);
	}
 	 
	private void messageRuleErrorVariableStar(String nameVariableStar, int line) {
		int declLine = currentTomStructureOrgTrack.getLine();
		String s = "Single list variable '" +nameVariableStar+ "*' is not allowed on left hand side of structure %rule declared line "+declLine;
		messageError(line,s);
	}
	
	private void messageRuleErrorLhsImpossiblePlaceHolder(OptionList optionList) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		String s = "Alone placeholder is not allowed in left hand side of structure %rule declared line " +declLine;
		messageError(line,s);
	}
	
	private void messageRuleErrorLhsImpossibleXML(OptionList optionList) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		String s = "XML is not allowed in left hand side of structure %rule declared line " +declLine;
		messageError(line,s);		
	}
 	 
	private void messageRuleErrorConstructorEgality(String  name, String nameExpected, OptionList optionList) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(name, optionList);
                String s = "Left most symbol name '" + nameExpected + "' expected, but '" + name + "' found in left hand side of structure %rule declared line " +declLine;
		messageError(line,s);
	}

	  //Rhs shall have no underscore, be a var* nor _*, nor a RecordAppl
	private void verifyRhsRuleStructure(TomTerm ruleRhs, TomType lhsType) {
		matchBlock: {
			 {  TomTerm tom_match14_1 = null; tom_match14_1 = ( TomTerm) ruleRhs;_match14_pattern1: {  TomTerm appl = null;  String name = null;  OptionList options = null;  TomList args = null; if(tom_is_fun_sym_Appl(tom_match14_1)) {  Option tom_match14_1_1 = null;  TomName tom_match14_1_2 = null;  TomList tom_match14_1_3 = null; tom_match14_1_1 = ( Option) tom_get_slot_Appl_option(tom_match14_1); tom_match14_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match14_1); tom_match14_1_3 = ( TomList) tom_get_slot_Appl_args(tom_match14_1); appl = ( TomTerm) tom_match14_1; if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); options = ( OptionList) tom_match14_1_1_1; if(tom_is_fun_sym_Name(tom_match14_1_2)) {  String tom_match14_1_2_1 = null; tom_match14_1_2_1 = ( String) tom_get_slot_Name_string(tom_match14_1_2); name = ( String) tom_match14_1_2_1; args = ( TomList) tom_match14_1_3;
 
					permissiveVerify(appl);
					TomType rhsType = getSymbolCodomain(getSymbol(name));
					if(rhsType != null) {
						if(rhsType != lhsType) {
							messageRuleErrorBadRhsType(options, lhsType, rhsType);
						}
					}
					break matchBlock;
				 } } }}_match14_pattern2: {  OptionList option = null; if(tom_is_fun_sym_UnamedVariableStar(tom_match14_1)) {  Option tom_match14_1_1 = null; tom_match14_1_1 = ( Option) tom_get_slot_UnamedVariableStar_option(tom_match14_1); if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); option = ( OptionList) tom_match14_1_1_1;

 
					messageRuleErrorRhsImpossiblePlaceholder(option);
					break matchBlock;
				 } }}_match14_pattern3: {  OptionList option = null; if(tom_is_fun_sym_Placeholder(tom_match14_1)) {  Option tom_match14_1_1 = null; tom_match14_1_1 = ( Option) tom_get_slot_Placeholder_option(tom_match14_1); if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); option = ( OptionList) tom_match14_1_1_1;  					messageRuleErrorRhsImpossiblePlaceholder(option); 					break matchBlock; 				 } }}_match14_pattern4: {  OptionList option = null;  String name = null; if(tom_is_fun_sym_VariableStar(tom_match14_1)) {  Option tom_match14_1_1 = null;  TomName tom_match14_1_2 = null; tom_match14_1_1 = ( Option) tom_get_slot_VariableStar_option(tom_match14_1); tom_match14_1_2 = ( TomName) tom_get_slot_VariableStar_astName(tom_match14_1); if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); option = ( OptionList) tom_match14_1_1_1; if(tom_is_fun_sym_Name(tom_match14_1_2)) {  String tom_match14_1_2_1 = null; tom_match14_1_2_1 = ( String) tom_get_slot_Name_string(tom_match14_1_2); name = ( String) tom_match14_1_2_1;
 
					messageRuleErrorRhsImpossibleVarStar(option, name);
					break matchBlock;
				 } } }}_match14_pattern5: {  OptionList option = null;  String tomName = null; if(tom_is_fun_sym_RecordAppl(tom_match14_1)) {  Option tom_match14_1_1 = null;  TomName tom_match14_1_2 = null; tom_match14_1_1 = ( Option) tom_get_slot_RecordAppl_option(tom_match14_1); tom_match14_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match14_1); if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); option = ( OptionList) tom_match14_1_1_1; if(tom_is_fun_sym_Name(tom_match14_1_2)) {  String tom_match14_1_2_1 = null; tom_match14_1_2_1 = ( String) tom_get_slot_Name_string(tom_match14_1_2); tomName = ( String) tom_match14_1_2_1;
 
					messageRuleErrorRhsImpossibleRecord(option, tomName);
					break matchBlock;
				 } } }}_match14_pattern6: {  OptionList optionList = null; if(tom_is_fun_sym_XMLAppl(tom_match14_1)) {  Option tom_match14_1_1 = null; tom_match14_1_1 = ( Option) tom_get_slot_XMLAppl_option(tom_match14_1); if(tom_is_fun_sym_Option(tom_match14_1_1)) {  OptionList tom_match14_1_1_1 = null; tom_match14_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match14_1_1); optionList = ( OptionList) tom_match14_1_1_1;
 
					messageRuleErrorRhsImpossibleXML(optionList);
					break matchBlock;
				 } }}_match14_pattern7: {
 
					throw new TomRuntimeException(new Throwable("Strange rule rhs:\n" + ruleRhs));
				} }
 
		}
	}
	
	private void messageRuleErrorBadRhsType(OptionList optionList, TomType lhsType, TomType rhsType) {
		if(!warningAll || noWarning) return;
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		String rhsTypeName, lhsTypeName;
		if(rhsType.isEmptyType()) {rhsTypeName = "Not Type Found";} else {rhsTypeName = rhsType.getString();}
		if(lhsType.isEmptyType()) {lhsTypeName = "Not Type Found";} else {lhsTypeName = lhsType.getString();}
		String s = "Bad right hand side type: `"+rhsTypeName+"` instead of `"+lhsTypeName+"` in structure %rule declared line " +declLine;
		//messageError(line,s);	
		System.out.println(s);
	}
	
	private void messageRuleErrorRhsImpossibleXML(OptionList optionList) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		String s = "XML is not allowed in right hand side of structure %rule declared line " +declLine;
		messageError(line,s);		
	}
	private void messageRuleErrorRhsImpossiblePlaceholder(OptionList optionList) {
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		int declLine = currentTomStructureOrgTrack.getLine();
		String s = "Placeholder is not allowed on right part of structure %rule declared line "+declLine;
		messageError(line,s);
	}
  
	private void messageRuleErrorRhsImpossibleRecord(OptionList optionList, String name) {
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		int declLine = currentTomStructureOrgTrack.getLine();
		String s = "Record '"+name+"[...]' is not allowed on right part of structure %rule declared line "+declLine;
		messageError(line,s);
	}
	
	private void messageRuleErrorRhsImpossibleVarStar(OptionList optionList, String name) {
		int line = findOriginTrackingLine(optionList);
                ensureOriginTrackingLine(line);
		int declLine = currentTomStructureOrgTrack.getLine();
		String s = "Single list variable '"+name+"*' is not allowed in right hand side of structure %rule declared line " +declLine;
		messageError(line,s);
	}
 	     
 	   /** RECORDS CONCERNS */
  private void verifyRecordStructure(OptionList option, String tomName, TomList args)  {
    TomSymbol symbol = getSymbol(tomName);
    if(symbol != null) {
      SlotList slotList = symbol.getSlotList();
        // constants have an emptySlotList
        // the length of the slotList corresponds to the arity of the operator
        // list operator with [] no allowed
      if(slotList.isEmpty() || (args.isEmpty() && (isListOperator(symbol) ||  isArrayOperator(symbol)))) {
        messageBracketError(tomName, option);
      }
      verifyRecordSlots(args,slotList, tomName);
    } else {
      messageSymbolError(tomName, option);
    }
  }
  
    // We test the existence of slotName contained in pairSlotAppl
    // and then the associated term
  private void verifyRecordSlots(TomList listPair, SlotList slotList, String methodName) {
    ArrayList slotIndex = new ArrayList();
    while( !listPair.isEmpty() ) {
      TomTerm pair = listPair.getHead();
      TomName name = pair.getSlotName();
      int index = getSlotIndex(slotList,name);
      if(index < 0) {
        messageSlotNameError(pair,slotList, methodName); 
      } else {
        Integer integerIndex = new Integer(index);
        if(slotIndex.contains(integerIndex)) {
          messageSlotRepeatedError(pair, methodName);
        }
        slotIndex.add(integerIndex);
      }
      listPair = listPair.getTail();
    }
  }

  private void messageSlotNameError(TomTerm pairSlotName, SlotList slotList, String methodName) {
    ArrayList listOfPossibleSlot = new ArrayList();
    while ( !slotList.isEmpty() ) {
      TomName name = slotList.getHead().getSlotName();
      if(!name.isEmptyName()) {
        listOfPossibleSlot.add(name.getString());
      }
      slotList = slotList.getTail();
    }
    int line = nullInteger;
    String s = "";
     {  TomTerm tom_match15_1 = null; tom_match15_1 = ( TomTerm) pairSlotName;_match15_pattern1: {  OptionList list = null;  String name = null; if(tom_is_fun_sym_PairSlotAppl(tom_match15_1)) {  TomName tom_match15_1_1 = null;  TomTerm tom_match15_1_2 = null; tom_match15_1_1 = ( TomName) tom_get_slot_PairSlotAppl_slotName(tom_match15_1); tom_match15_1_2 = ( TomTerm) tom_get_slot_PairSlotAppl_appl(tom_match15_1); if(tom_is_fun_sym_Name(tom_match15_1_1)) {  String tom_match15_1_1_1 = null; tom_match15_1_1_1 = ( String) tom_get_slot_Name_string(tom_match15_1_1); name = ( String) tom_match15_1_1_1; if(tom_is_fun_sym_Appl(tom_match15_1_2)) {  Option tom_match15_1_2_1 = null; tom_match15_1_2_1 = ( Option) tom_get_slot_Appl_option(tom_match15_1_2); if(tom_is_fun_sym_Option(tom_match15_1_2_1)) {  OptionList tom_match15_1_2_1_1 = null; tom_match15_1_2_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match15_1_2_1); list = ( OptionList) tom_match15_1_2_1_1;
 
        line = findOriginTrackingLine(list);
        ensureOriginTrackingLine(line);
        s += "Slot Name '" + name + "' is not correct: See method '"+methodName+ "' -  Line : "+line;
       } } } }} }
 
    s += "\nPossible slot names are : "+listOfPossibleSlot;
    messageError(line, s);
  }
  
  private void messageSlotRepeatedError(TomTerm pairSlotName, String methodName) {
     {  TomTerm tom_match16_1 = null; tom_match16_1 = ( TomTerm) pairSlotName;_match16_pattern1: {  OptionList list = null;  String name = null; if(tom_is_fun_sym_PairSlotAppl(tom_match16_1)) {  TomName tom_match16_1_1 = null;  TomTerm tom_match16_1_2 = null; tom_match16_1_1 = ( TomName) tom_get_slot_PairSlotAppl_slotName(tom_match16_1); tom_match16_1_2 = ( TomTerm) tom_get_slot_PairSlotAppl_appl(tom_match16_1); if(tom_is_fun_sym_Name(tom_match16_1_1)) {  String tom_match16_1_1_1 = null; tom_match16_1_1_1 = ( String) tom_get_slot_Name_string(tom_match16_1_1); name = ( String) tom_match16_1_1_1; if(tom_is_fun_sym_Appl(tom_match16_1_2)) {  Option tom_match16_1_2_1 = null; tom_match16_1_2_1 = ( Option) tom_get_slot_Appl_option(tom_match16_1_2); if(tom_is_fun_sym_Option(tom_match16_1_2_1)) {  OptionList tom_match16_1_2_1_1 = null; tom_match16_1_2_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match16_1_2_1); list = ( OptionList) tom_match16_1_2_1_1;
 
        int line = findOriginTrackingLine(list);
        ensureOriginTrackingLine(line);
        String s = "Same slot names can not be used several times: See method '"+methodName+ "' -  Line : "+line;
        s += "Repeated slot Name : '"+name+"'";
        messageError(line, s);
       } } } }} }
 
  }
  
  private void messageBracketError(String name, OptionList optionList) {
    int line = findOriginTrackingLine(name,optionList);
    String s = "[] are not allowed on lists or arrays nor constants, see: "+name;
    messageError(line,s);
  }

	 /** XMLAPPL CONCERNS */
	private void verifyXMLApplStructure(OptionList optionList, String name, TomList attrList, TomList childList) {
		// TODO Testing XML Appl
		System.out.println("Need verifyXMLApplStructure");
	}

    /** APPL CONCERNS */
  private void verifyApplStructure(OptionList optionList, String name, TomList argsList) {
    if(name.equals("")) {
        // unamed list
      System.out.println("verifyApplStructure: Unamed List");
      return;
    }
    
    TomSymbol symbol = getSymbol(name);
    if(symbol==null) {
      if(hasConstructor(optionList) || !argsList.isEmpty()) {
          //we dont know the symbol but it is called as a constructor or has children
        messageSymbolError(name, optionList);
      }
    } else {
      TomTypeList domain = getSymbolDomain(symbol);
      int nbExpectedArgs = domain.getLength();
      boolean listOrArray =  (isListOperator(symbol) ||  isArrayOperator(symbol));
			
      if(argsList.isEmpty()) {
        if(nbExpectedArgs>0 && !listOrArray) {
            //we know the symbol it is not a list operator 
          int line = findOriginTrackingLine(name,optionList);
          messageNumberArgumentsError(nbExpectedArgs, 0, name, line);
        } else if (!hasConstructor(optionList)) {
            //we know the symbol but it is not called has a constructor and argsList is empty
            // it is not a string or int or double
          String codomain = getTomType(getSymbolCodomain(symbol));
          if( !codomain.equals("String") && !codomain.equals("double") &&
              !codomain.equals("int")) {
            int line = findOriginTrackingLine(name,optionList);
            messageVariableWithConstructorNameError(name, line);
          }
        }
      } else {
          // in case of oparray or oplist, the number of arguments is not tested
          // and no _* nor var * are allowed in the other case
        
        int nbFoundArgs = 0;
        ArrayList foundType = new ArrayList();
        ArrayList foundOptionList = new ArrayList();
          //Map optionMap  = new HashMap();
          // we shall now test the type of each args
         {  TomList tom_match17_1 = null; tom_match17_1 = ( TomList) argsList;_match17_pattern1: {  TomTerm term = null; if(tom_is_fun_sym_concTomTerm(tom_match17_1)) {  TomList tom_match17_1_begin1 = null;  TomList tom_match17_1_end1 = null;  TomList tom_match17_1_list1 = null; tom_match17_1_list1 = ( TomList) tom_match17_1; tom_match17_1_begin1 = ( TomList) tom_match17_1_list1; tom_match17_1_end1 = ( TomList) tom_match17_1_list1; do { if(!(tom_is_empty_TomList(tom_match17_1_list1))) { term = ( TomTerm) tom_get_head_TomList(tom_match17_1_list1); tom_match17_1_list1 = ( TomList) tom_get_tail_TomList(tom_match17_1_list1);
 
            nbFoundArgs++;
            TermDescription termDesc = analyseTomTerm(term);
              // Var* and _* are not allowed in non list symbol
            if(!listOrArray &&(termDesc.termClass == UNAMED_VARIABLE_STAR || termDesc.termClass == VARIABLE_STAR)) {
              int line = findOriginTrackingLine(optionList);
              ensureOriginTrackingLine(line);
              messageVariableStarInNonListOperator(nbFoundArgs, termDesc.name ,name, line);
            }
            foundType.add(termDesc.type);
            foundOptionList.add(term.getOption().getOptionList());
           } if(!(tom_is_empty_TomList(tom_match17_1_end1))) { tom_match17_1_end1 = ( TomList) tom_get_tail_TomList(tom_match17_1_end1); } tom_match17_1_list1 = ( TomList) tom_match17_1_end1; } while(!(tom_is_empty_TomList(tom_match17_1_list1))); }} }
 
        if (!listOrArray) {
            // We test the number of args vs its definition
          if (nbExpectedArgs != nbFoundArgs) {
            int line = findOriginTrackingLine(name,optionList);
            messageNumberArgumentsError(nbExpectedArgs, nbFoundArgs, name, line);
            return;
          }        
            // and the types
          nbFoundArgs = 0;
           {  TomTypeList tom_match18_1 = null; tom_match18_1 = ( TomTypeList) domain;_match18_pattern1: {  TomType type = null; if(tom_is_fun_sym_concTomType(tom_match18_1)) {  TomTypeList tom_match18_1_begin1 = null;  TomTypeList tom_match18_1_end1 = null;  TomTypeList tom_match18_1_list1 = null; tom_match18_1_list1 = ( TomTypeList) tom_match18_1; tom_match18_1_begin1 = ( TomTypeList) tom_match18_1_list1; tom_match18_1_end1 = ( TomTypeList) tom_match18_1_list1; do { if(!(tom_is_empty_TomTypeList(tom_match18_1_list1))) { type = ( TomType) tom_get_head_TomTypeList(tom_match18_1_list1); tom_match18_1_list1 = ( TomTypeList) tom_get_tail_TomTypeList(tom_match18_1_list1);
 
              String s = getTomType(type);
              if ( (foundType.get(nbFoundArgs) != s) && (foundType.get(nbFoundArgs) != null)) {
                int line = findOriginTrackingLine((OptionList)foundOptionList.get(nbFoundArgs));
                ensureOriginTrackingLine(line);
                messageApplErrorTypeArgument(name, nbFoundArgs+1, s, (String) foundType.get(nbFoundArgs), line); 
              }
              nbFoundArgs++;
             } if(!(tom_is_empty_TomTypeList(tom_match18_1_end1))) { tom_match18_1_end1 = ( TomTypeList) tom_get_tail_TomTypeList(tom_match18_1_end1); } tom_match18_1_list1 = ( TomTypeList) tom_match18_1_end1; } while(!(tom_is_empty_TomTypeList(tom_match18_1_list1))); }} }
 
        } else {
            // We worry only about returned types that should always be the same
          String s = getTomType(domain.getHead());  
          for( int slot = 0; slot <foundType.size() ; slot++ ) {
            if ( (foundType.get(slot) != s) && (foundType.get(slot) != null)) {
              int line = findOriginTrackingLine((OptionList) foundOptionList.get(slot));
              ensureOriginTrackingLine(line);
              messageApplErrorTypeArgument(name, slot+1, s, (String) foundType.get(slot), line);
            }
          }
        }
      }
    }
  }

  private void  messageApplErrorTypeArgument(String applName, int slotNumber, String expectedType, String givenType, int line) {
    String s = "Bad type of argument: Argument "+slotNumber+" of method '" + applName + "' has type '"+expectedType+"' required but type '"+givenType+"' found";
    messageError(line,s);
  }
	
	private void messageVariableStarInNonListOperator(int slot, String typeStar, String applName, int line) {
		String s = "Impossible variable star "+typeStar +" as argument "+slot+" of non list operator method '" + applName + "'";
		messageError(line,s);
	}
   
	private void permissiveVerify(TomTerm term) {
		 Collect1 permissiveCollectAndVerify = new Collect1() 
			 {  
				 public boolean apply(ATerm term) {
					 if(term instanceof TomTerm) {
						  {  TomTerm tom_match19_1 = null; tom_match19_1 = ( TomTerm) term;_match19_pattern1: {  OptionList options = null;  TomList args = null;  String name = null; if(tom_is_fun_sym_BackQuoteAppl(tom_match19_1)) {  Option tom_match19_1_1 = null;  TomName tom_match19_1_2 = null;  TomList tom_match19_1_3 = null; tom_match19_1_1 = ( Option) tom_get_slot_BackQuoteAppl_option(tom_match19_1); tom_match19_1_2 = ( TomName) tom_get_slot_BackQuoteAppl_astName(tom_match19_1); tom_match19_1_3 = ( TomList) tom_get_slot_BackQuoteAppl_args(tom_match19_1); if(tom_is_fun_sym_Option(tom_match19_1_1)) {  OptionList tom_match19_1_1_1 = null; tom_match19_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match19_1_1); options = ( OptionList) tom_match19_1_1_1; if(tom_is_fun_sym_Name(tom_match19_1_2)) {  String tom_match19_1_2_1 = null; tom_match19_1_2_1 = ( String) tom_get_slot_Name_string(tom_match19_1_2); name = ( String) tom_match19_1_2_1; args = ( TomList) tom_match19_1_3;
 
								 permissiveVerifyApplStructure(options, name, args);
								 return true;
							  } } }}_match19_pattern2: {  OptionList options = null;  TomList args = null;  String name = null; if(tom_is_fun_sym_Appl(tom_match19_1)) {  Option tom_match19_1_1 = null;  TomName tom_match19_1_2 = null;  TomList tom_match19_1_3 = null; tom_match19_1_1 = ( Option) tom_get_slot_Appl_option(tom_match19_1); tom_match19_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match19_1); tom_match19_1_3 = ( TomList) tom_get_slot_Appl_args(tom_match19_1); if(tom_is_fun_sym_Option(tom_match19_1_1)) {  OptionList tom_match19_1_1_1 = null; tom_match19_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match19_1_1); options = ( OptionList) tom_match19_1_1_1; if(tom_is_fun_sym_Name(tom_match19_1_2)) {  String tom_match19_1_2_1 = null; tom_match19_1_2_1 = ( String) tom_get_slot_Name_string(tom_match19_1_2); name = ( String) tom_match19_1_2_1; args = ( TomList) tom_match19_1_3;
 
								 permissiveVerifyApplStructure(options, name, args);
								 return true;
							  } } }}_match19_pattern3: {  String name = null;  OptionList options = null; if(tom_is_fun_sym_RecordAppl(tom_match19_1)) {  Option tom_match19_1_1 = null;  TomName tom_match19_1_2 = null; tom_match19_1_1 = ( Option) tom_get_slot_RecordAppl_option(tom_match19_1); tom_match19_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match19_1); if(tom_is_fun_sym_Option(tom_match19_1_1)) {  OptionList tom_match19_1_1_1 = null; tom_match19_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match19_1_1); options = ( OptionList) tom_match19_1_1_1; if(tom_is_fun_sym_Name(tom_match19_1_2)) {  String tom_match19_1_2_1 = null; tom_match19_1_2_1 = ( String) tom_get_slot_Name_string(tom_match19_1_2); name = ( String) tom_match19_1_2_1;
 
								 messageRuleErrorRhsImpossibleRecord(options, name);
								 return true;
							  } } }}_match19_pattern4: {  OptionList orgTrack = null; if(tom_is_fun_sym_Placeholder(tom_match19_1)) {  Option tom_match19_1_1 = null; tom_match19_1_1 = ( Option) tom_get_slot_Placeholder_option(tom_match19_1); if(tom_is_fun_sym_Option(tom_match19_1_1)) {  OptionList tom_match19_1_1_1 = null; tom_match19_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match19_1_1); orgTrack = ( OptionList) tom_match19_1_1_1;
 
								 messageRuleErrorRhsImpossiblePlaceholder(orgTrack);
							  } }}_match19_pattern5: {
  return true; } }
 
					 } else {
						 return true;
					 }
				 }// end apply
			 }; // end new
		 traversal().genericCollect(term, permissiveCollectAndVerify);
	 }
	  
  private void permissiveVerifyApplStructure(OptionList optionList, String name, TomList argsList) {
    TomSymbol symbol = getSymbol(name);
    if(symbol==null && !argsList.isEmpty()) {
      messageWarningSymbol(name, optionList);
    } else {
      if(!argsList.isEmpty()) {
          //in case of oparray or oplist, the number of arguments is not tested
        if ( !isListOperator(symbol) &&  !isArrayOperator(symbol) ) {
            // We test the number of args vs its definition
          int nbExpectedArgs = getSymbolDomain(symbol).getLength();
          int nbFoundArgs = length(argsList);
          if (nbExpectedArgs != nbFoundArgs) {
            int line = findOriginTrackingLine(name,optionList);
            messageNumberArgumentsError(nbExpectedArgs, nbFoundArgs, name, line);
          }
        }
          // We ensure that the symbol has a Make declaration if not list nor array
        if (!isListOperator(symbol) &&  !isArrayOperator(symbol)) {
          if ( !findMakeDeclOrDefSymbol(symbol.getOption().getOptionList()) ) {
            messageNoMakeForSymbol(name, optionList);
          }
        }
      }
    }
  }

  private boolean findMakeDeclOrDefSymbol(OptionList list) {
    while(!list.isEmpty()) {
      Option term = list.getHead();
       {  Option tom_match20_1 = null; tom_match20_1 = ( Option) term;_match20_pattern1: {  TomList makeArgsList = null;  Option orgTrack = null; if(tom_is_fun_sym_DeclarationToOption(tom_match20_1)) {  Declaration tom_match20_1_1 = null; tom_match20_1_1 = ( Declaration) tom_get_slot_DeclarationToOption_astDeclaration(tom_match20_1); if(tom_is_fun_sym_MakeDecl(tom_match20_1_1)) {  TomList tom_match20_1_1_3 = null;  Option tom_match20_1_1_5 = null; tom_match20_1_1_3 = ( TomList) tom_get_slot_MakeDecl_args(tom_match20_1_1); tom_match20_1_1_5 = ( Option) tom_get_slot_MakeDecl_orgTrack(tom_match20_1_1); makeArgsList = ( TomList) tom_match20_1_1_3; orgTrack = ( Option) tom_match20_1_1_5;
 
          return true;
         } }}_match20_pattern2: { if(tom_is_fun_sym_DefinedSymbol(tom_match20_1)) {
 return true; }}_match20_pattern3: {
 list = list.getTail();} }
 
    }
    return false;
  }

  private void messageSymbolError(String name, OptionList optionList) {
    int line = findOriginTrackingLine(name, optionList);
    String s = "Symbol method : '" + name + "' not found";
    messageError(line,s);
  }
  
  private void messageWarningSymbol(String name, OptionList optionList) {
    if(!warningAll || noWarning) return;
    String nameDecl = currentTomStructureOrgTrack.getAstName().getString();
    int declLine = currentTomStructureOrgTrack.getLine();
    int line = findOriginTrackingLine(name, optionList);
    System.out.println("\n *** Warning *** Possible error in structure "+nameDecl+" declared line "+declLine);
    System.out.println(" *** Unknown method '"+name+"' : Ensure the type coherence by yourself line : " + line);
  }
  
  private void messageNumberArgumentsError(int nbArg, int nbArg2, String name, int line) {
    String s = "Bad number of arguments for method '" + name + "':" + nbArg + " arguments are required but " + nbArg2 + " are given";
    messageError(line,s);
  }
  
	private void messageVariableWithConstructorNameError(String name, int line) {
		String s = "Ambiguous variable name. Is '" + name  + "' a variable or a constructor? Use " + name + "() if it is a constructor.";
		messageError(line,s);
	}

		/** Main type checking entry point: We check all interesting Tom Structure */
	protected void checkTypeInference(TomTerm expandedTerm) {
		Collect1 collectAndVerify = new Collect1() {  
			public boolean apply(ATerm term) {
				if(term instanceof TomTerm) {
					 {  TomTerm tom_match21_1 = null; tom_match21_1 = ( TomTerm) term;_match21_pattern1: {  OptionList oplist = null;  TomList list = null; if(tom_is_fun_sym_Match(tom_match21_1)) {  TomTerm tom_match21_1_2 = null;  Option tom_match21_1_3 = null; tom_match21_1_2 = ( TomTerm) tom_get_slot_Match_patternList(tom_match21_1); tom_match21_1_3 = ( Option) tom_get_slot_Match_option(tom_match21_1); if(tom_is_fun_sym_PatternList(tom_match21_1_2)) {  TomList tom_match21_1_2_1 = null; tom_match21_1_2_1 = ( TomList) tom_get_slot_PatternList_tomList(tom_match21_1_2); list = ( TomList) tom_match21_1_2_1; if(tom_is_fun_sym_Option(tom_match21_1_3)) {  OptionList tom_match21_1_3_1 = null; tom_match21_1_3_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match21_1_3); oplist = ( OptionList) tom_match21_1_3_1;
   
							currentTomStructureOrgTrack = findOriginTracking(oplist);
							verifyMatchVariable(list);
							return false;
						 } } }}_match21_pattern2: {  Option orgTrack = null;  TomRuleList list = null; if(tom_is_fun_sym_RuleSet(tom_match21_1)) {  TomRuleList tom_match21_1_1 = null;  Option tom_match21_1_2 = null; tom_match21_1_1 = ( TomRuleList) tom_get_slot_RuleSet_ruleList(tom_match21_1); tom_match21_1_2 = ( Option) tom_get_slot_RuleSet_orgTrack(tom_match21_1); list = ( TomRuleList) tom_match21_1_1; orgTrack = ( Option) tom_match21_1_2;
 
							currentTomStructureOrgTrack = orgTrack;
							verifyRuleVariable(list);
							return false;
						 }}_match21_pattern3: {
  return true; } }
 
				} else {
					return true;
				}
			}// end apply
		}; // end new
		traversal().genericCollect(expandedTerm, collectAndVerify);
	}
  
	private void verifyMatchVariable(TomList patternList) {
		while(!patternList.isEmpty()) {
			TomTerm pa = patternList.getHead();
			TomTerm patterns = pa.getTermList();
				// collect variables
			ArrayList variableList = new ArrayList();
			collectVariable(variableList, patterns);      
			verifyVariableType(variableList);
			patternList = patternList.getTail();
		}
	}
  
	private void verifyRuleVariable(TomRuleList list) {
		while(!list.isEmpty()) {
			TomRule rewriteRule = list.getHead();
			TomTerm lhs = rewriteRule.getLhs();
			TomTerm rhs = rewriteRule.getRhs();
			TomList condList = rewriteRule.getCondList();
			Option orgTrack = findOriginTracking(rewriteRule.getOption().getOptionList());
 	     
			ArrayList variableLhs = new ArrayList();
			collectVariable(variableLhs, lhs);
			HashSet lhsSet = verifyVariableType(variableLhs);
 	     
			ArrayList variableRhs = new ArrayList();
			collectVariable(variableRhs, rhs);
			HashSet rhsSet = verifyVariableType(variableRhs);
 	     
			ArrayList variableCond = new ArrayList();
			collectVariable(variableCond, tom_make_Tom(condList) );
			HashSet condSet = verifyVariableType(variableCond);
 	     
			lhsSet.addAll(condSet);
			if(!condSet.isEmpty()) {
				System.out.println("Warning: improve verifyRuleVariable for matchingCondition");
			}
 	     
			if( !lhsSet.containsAll(rhsSet) ) {
				Iterator it = lhsSet.iterator();
				while(it.hasNext()) {
					rhsSet.remove(it.next());
				}
				messageRuleErrorUnknownVariable(rhsSet, orgTrack);
			}
				// case of rhs is a single variable
			 {  TomTerm tom_match22_1 = null; tom_match22_1 = ( TomTerm) rhs;_match22_pattern1: {  String name = null; if(tom_is_fun_sym_Term(tom_match22_1)) {  TomTerm tom_match22_1_1 = null; tom_match22_1_1 = ( TomTerm) tom_get_slot_Term_tomTerm(tom_match22_1); if(tom_is_fun_sym_Variable(tom_match22_1_1)) {  TomName tom_match22_1_1_2 = null; tom_match22_1_1_2 = ( TomName) tom_get_slot_Variable_astName(tom_match22_1_1); if(tom_is_fun_sym_Name(tom_match22_1_1_2)) {  String tom_match22_1_1_2_1 = null; tom_match22_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match22_1_1_2); name = ( String) tom_match22_1_1_2_1;
 
					String methodName = "";
					 {  TomTerm tom_match23_1 = null; tom_match23_1 = ( TomTerm) lhs;_match23_pattern1: {  String name1 = null; if(tom_is_fun_sym_Term(tom_match23_1)) {  TomTerm tom_match23_1_1 = null; tom_match23_1_1 = ( TomTerm) tom_get_slot_Term_tomTerm(tom_match23_1); if(tom_is_fun_sym_Appl(tom_match23_1_1)) {  TomName tom_match23_1_1_2 = null; tom_match23_1_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match23_1_1); if(tom_is_fun_sym_Name(tom_match23_1_1_2)) {  String tom_match23_1_1_2_1 = null; tom_match23_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match23_1_1_2); name1 = ( String) tom_match23_1_1_2_1;
 
							methodName = name1;
						 } } }}_match23_pattern2: {  String name1 = null; if(tom_is_fun_sym_Term(tom_match23_1)) {  TomTerm tom_match23_1_1 = null; tom_match23_1_1 = ( TomTerm) tom_get_slot_Term_tomTerm(tom_match23_1); if(tom_is_fun_sym_RecordAppl(tom_match23_1_1)) {  TomName tom_match23_1_1_2 = null; tom_match23_1_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match23_1_1); if(tom_is_fun_sym_Name(tom_match23_1_1_2)) {  String tom_match23_1_1_2_1 = null; tom_match23_1_1_2_1 = ( String) tom_get_slot_Name_string(tom_match23_1_1_2); name1 = ( String) tom_match23_1_1_2_1;
 
							methodName = name1;
						 } } }} }
 
					TomType typeRhs = getSymbolCodomain(getSymbol(methodName));
					Iterator it = variableLhs.iterator();
					while(it.hasNext()) {
						TomTerm term = (TomTerm)it.next();
						if(term.getAstName().getString() == name) {
							TomType typeLhs = term.getAstType();
							if(typeLhs != typeRhs) {
								messageRuleErrorBadRhsVariable(name, typeRhs.getTomType().getString(), typeLhs.getTomType().getString(), orgTrack);
							}
						}
					}
				 } } }} }
 
			list = list.getTail();
		}
	}
  
	private HashSet verifyVariableType(ArrayList list) {
			// compute multiplicities
		HashSet set = new HashSet();
		HashMap multiplicityMap = new HashMap();
		Iterator it = list.iterator();
		while(it.hasNext()) {
				TomTerm variable = (TomTerm)it.next();
			TomName name = variable.getAstName();
   	   
			if(set.contains(name)) {
				TomTerm var = (TomTerm)multiplicityMap.get(name);
				TomType type = var.getAstType();
				TomType type2 = variable.getAstType();
				if(!(type==type2)) {
					messageErrorIncoherentVariable(name.getString(), type.getTomType().getString(), type2.getTomType().getString(), variable.getOption().getOptionList()); 
				}
			} else {
				multiplicityMap.put(name, variable);
				set.add(name);
			}
		}
	return set;
	}
  
	private void messageErrorIncoherentVariable(String name, String type, String type2, OptionList options) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = findOriginTrackingLine(options);
                ensureOriginTrackingLine(line);
		String s = "Bad variable type for '"+name+"': it has both type '"+type+"' and '"+type2+"' in structure declared line "+declLine;
		messageError(line,s);
	}
 	 
	private void messageRuleErrorUnknownVariable(Collection variableCollectionRhs, Option rewriteRuleOrgTrack) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = rewriteRuleOrgTrack.getLine();
		String s = "Unknown variable(s) " +variableCollectionRhs+ " used in right part of %rule declared line "+declLine;
		messageError(line,s);
	}
 	 
	private void messageRuleErrorBadRhsVariable(String name, String type, String type2, Option rewriteRuleOrgTrack) {
		int declLine = currentTomStructureOrgTrack.getLine();
		int line = rewriteRuleOrgTrack.getLine();    
		String s = "Alone variable '"+name+"' has type '"+type+"' instead of type '"+type2+"' in right part of %rule declared line "+declLine;
		messageError(line,s);
	}		

    /** GLOBALS */
  private String extractType(TomSymbol symbol) {
    TomType type = getSymbolCodomain(symbol);
    return getTomType(type);
  }

  private void messageError(int line, String msg) {
    String s = "\n"+msg+"\n-- Error occured at line: " + line +" in file: "+currentTomStructureOrgTrack.getFileName().getString()+"\n";
    errorMessage.add(s);
    addError(input, msg, currentTomStructureOrgTrack.getFileName().getString(), line, 0);
  }
    
  private int findOriginTrackingLine(String name, OptionList optionList) {
     {  OptionList tom_match24_1 = null; tom_match24_1 = ( OptionList) optionList;_match24_pattern1: {  Option tom_absvar4 = null; if(tom_is_fun_sym_concOption(tom_match24_1)) {  OptionList tom_match24_1_begin1 = null;  OptionList tom_match24_1_end1 = null;  OptionList tom_match24_1_list1 = null; tom_match24_1_list1 = ( OptionList) tom_match24_1; tom_match24_1_begin1 = ( OptionList) tom_match24_1_list1; tom_match24_1_end1 = ( OptionList) tom_match24_1_list1; do { if(!(tom_is_empty_OptionList(tom_match24_1_list1))) { tom_absvar4 = ( Option) tom_get_head_OptionList(tom_match24_1_list1); tom_match24_1_list1 = ( OptionList) tom_get_tail_OptionList(tom_match24_1_list1); {  Option tom_match25_1 = null; tom_match25_1 = ( Option) tom_absvar4;_match25_pattern1: {  int line;  String str = null; if(tom_is_fun_sym_OriginTracking(tom_match25_1)) {  TomName tom_match25_1_1 = null;  int tom_match25_1_2; tom_match25_1_1 = ( TomName) tom_get_slot_OriginTracking_astName(tom_match25_1); tom_match25_1_2 = ( int) tom_get_slot_OriginTracking_line(tom_match25_1); if(tom_is_fun_sym_Name(tom_match25_1_1)) {  String tom_match25_1_1_1 = null; tom_match25_1_1_1 = ( String) tom_get_slot_Name_string(tom_match25_1_1); str = ( String) tom_match25_1_1_1; line = ( int) tom_match25_1_2;
  if(str.equals(name)) {return line;}  } }} } } if(!(tom_is_empty_OptionList(tom_match24_1_end1))) { tom_match24_1_end1 = ( OptionList) tom_get_tail_OptionList(tom_match24_1_end1); } tom_match24_1_list1 = ( OptionList) tom_match24_1_end1; } while(!(tom_is_empty_OptionList(tom_match24_1_list1))); }} }
 
    addError(input, "findOriginTrackingLine:  not found", input.getInputFileName(), 0, 0);
    System.out.println("findOriginTrackingLine: '" + name + "' not found in " + optionList);
    return -1;
  }
  
  private int findOriginTrackingLine(OptionList optionList) {
     {  OptionList tom_match26_1 = null; tom_match26_1 = ( OptionList) optionList;_match26_pattern1: {  Option tom_absvar5 = null; if(tom_is_fun_sym_concOption(tom_match26_1)) {  OptionList tom_match26_1_begin1 = null;  OptionList tom_match26_1_end1 = null;  OptionList tom_match26_1_list1 = null; tom_match26_1_list1 = ( OptionList) tom_match26_1; tom_match26_1_begin1 = ( OptionList) tom_match26_1_list1; tom_match26_1_end1 = ( OptionList) tom_match26_1_list1; do { if(!(tom_is_empty_OptionList(tom_match26_1_list1))) { tom_absvar5 = ( Option) tom_get_head_OptionList(tom_match26_1_list1); tom_match26_1_list1 = ( OptionList) tom_get_tail_OptionList(tom_match26_1_list1); {  Option tom_match27_1 = null; tom_match27_1 = ( Option) tom_absvar5;_match27_pattern1: {  int line; if(tom_is_fun_sym_OriginTracking(tom_match27_1)) {  int tom_match27_1_2; tom_match27_1_2 = ( int) tom_get_slot_OriginTracking_line(tom_match27_1); line = ( int) tom_match27_1_2;
  return line;  }} } } if(!(tom_is_empty_OptionList(tom_match26_1_end1))) { tom_match26_1_end1 = ( OptionList) tom_get_tail_OptionList(tom_match26_1_end1); } tom_match26_1_list1 = ( OptionList) tom_match26_1_end1; } while(!(tom_is_empty_OptionList(tom_match26_1_list1))); }} }
 
    return -1;
  }

  private void ensureOriginTrackingLine(int line) {
    if(line < 0) {
      addError(input, "findOriginTrackingLine:  not found", input.getInputFileName(), 0, 0);
      System.out.println("findOriginTrackingLine: not found ");
        //throw new TomRuntimeException(new Throwable("foo"));

    }
  }
  
  public TermDescription analyseTomTerm(TomTerm term) {
    String termName, type;
    int termClass, decLine;
    matchblock:{
       {  TomTerm tom_match28_1 = null; tom_match28_1 = ( TomTerm) term;_match28_pattern1: {  String name = null;  OptionList options = null; if(tom_is_fun_sym_Appl(tom_match28_1)) {  Option tom_match28_1_1 = null;  TomName tom_match28_1_2 = null; tom_match28_1_1 = ( Option) tom_get_slot_Appl_option(tom_match28_1); tom_match28_1_2 = ( TomName) tom_get_slot_Appl_astName(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1; if(tom_is_fun_sym_Name(tom_match28_1_2)) {  String tom_match28_1_2_1 = null; tom_match28_1_2_1 = ( String) tom_get_slot_Name_string(tom_match28_1_2); name = ( String) tom_match28_1_2_1;
 
          termClass = APPL;
          decLine = findOriginTrackingLine(options);
          type = extractType(getSymbol(name));     
          termName = name;
          break matchblock;
         } } }}_match28_pattern2: {  String name = null;  OptionList options = null; if(tom_is_fun_sym_RecordAppl(tom_match28_1)) {  Option tom_match28_1_1 = null;  TomName tom_match28_1_2 = null; tom_match28_1_1 = ( Option) tom_get_slot_RecordAppl_option(tom_match28_1); tom_match28_1_2 = ( TomName) tom_get_slot_RecordAppl_astName(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1; if(tom_is_fun_sym_Name(tom_match28_1_2)) {  String tom_match28_1_2_1 = null; tom_match28_1_2_1 = ( String) tom_get_slot_Name_string(tom_match28_1_2); name = ( String) tom_match28_1_2_1;
 
          termClass = RECORD_APPL;
          decLine = findOriginTrackingLine(options);
          type = extractType(getSymbol(name));     
          termName = name;
          break matchblock;
         } } }}_match28_pattern3: {  OptionList options = null; if(tom_is_fun_sym_XMLAppl(tom_match28_1)) {  Option tom_match28_1_1 = null; tom_match28_1_1 = ( Option) tom_get_slot_XMLAppl_option(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1;
 
          termClass = XML_APPL;
          decLine = findOriginTrackingLine(options);
          type = extractType(getSymbol(Constants.ELEMENT_NODE));
          termName = Constants.ELEMENT_NODE;
          break matchblock;
         } }}_match28_pattern4: {  OptionList options = null; if(tom_is_fun_sym_Placeholder(tom_match28_1)) {  Option tom_match28_1_1 = null; tom_match28_1_1 = ( Option) tom_get_slot_Placeholder_option(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1;
 
          termClass = PLACE_HOLDER;
          decLine = findOriginTrackingLine(options);
          type = null;     
          termName = "*";
          break matchblock;
         } }}_match28_pattern5: {  String name = null;  OptionList options = null; if(tom_is_fun_sym_VariableStar(tom_match28_1)) {  Option tom_match28_1_1 = null;  TomName tom_match28_1_2 = null; tom_match28_1_1 = ( Option) tom_get_slot_VariableStar_option(tom_match28_1); tom_match28_1_2 = ( TomName) tom_get_slot_VariableStar_astName(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1; if(tom_is_fun_sym_Name(tom_match28_1_2)) {  String tom_match28_1_2_1 = null; tom_match28_1_2_1 = ( String) tom_get_slot_Name_string(tom_match28_1_2); name = ( String) tom_match28_1_2_1;
  
          termClass = VARIABLE_STAR;
          decLine = findOriginTrackingLine(options);
          type = null;     
          termName = name+"*";
          break matchblock;
         } } }}_match28_pattern6: {  OptionList options = null; if(tom_is_fun_sym_UnamedVariableStar(tom_match28_1)) {  Option tom_match28_1_1 = null; tom_match28_1_1 = ( Option) tom_get_slot_UnamedVariableStar_option(tom_match28_1); if(tom_is_fun_sym_Option(tom_match28_1_1)) {  OptionList tom_match28_1_1_1 = null; tom_match28_1_1_1 = ( OptionList) tom_get_slot_Option_optionList(tom_match28_1_1); options = ( OptionList) tom_match28_1_1_1;
 
          termClass = UNAMED_VARIABLE_STAR;
          decLine = findOriginTrackingLine(options);
          type = null;     
          termName = "_*";
          break matchblock;
         } }}_match28_pattern7: {
 
          System.out.println("Strange term in pattern "+term);
          throw new TomRuntimeException(new Throwable("Strange Term "+term));
        } }
 
    }
    return new TermDescription(termClass, termName, decLine, type);	
  }
  
} //class TomChecker
