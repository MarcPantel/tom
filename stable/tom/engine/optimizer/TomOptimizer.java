/* Generated by TOM (version 2.6alpha): Do not edit this file *//*
 * 
 * TOM - To One Matching Compiler
 * 
 * Copyright (c) 2000-2008, INRIA
 * Nancy, France.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 * 
 * Pierre-Etienne Moreau  e-mail: Pierre-Etienne.Moreau@loria.fr
 *
 **/

package tom.engine.optimizer;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

import tom.engine.TomBase;

import tom.engine.adt.tomsignature.*;
import tom.engine.adt.tomconstraint.types.*;
import tom.engine.adt.tomdeclaration.types.*;
import tom.engine.adt.tomexpression.types.*;
import tom.engine.adt.tominstruction.types.*;
import tom.engine.adt.tomname.types.*;
import tom.engine.adt.tomoption.types.*;
import tom.engine.adt.tomsignature.types.*;
import tom.engine.adt.tomterm.types.*;
import tom.engine.adt.tomslot.types.*;
import tom.engine.adt.tomtype.types.*;

import tom.engine.TomMessage;
import tom.engine.tools.TomGenericPlugin;
import tom.engine.tools.PILFactory;
import tom.engine.tools.Tools;
import tom.platform.OptionParser;
import tom.platform.adt.platformoption.types.PlatformOptionList;

import tom.library.sl.*;

/**
 * The TomOptimizer plugin.
 */
public class TomOptimizer extends TomGenericPlugin {

  /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */  /* Generated by TOM (version 2.6alpha): Do not edit this file */    private static   tom.engine.adt.tominstruction.types.InstructionList  tom_append_list_concInstruction( tom.engine.adt.tominstruction.types.InstructionList l1,  tom.engine.adt.tominstruction.types.InstructionList  l2) {     if( l1.isEmptyconcInstruction() ) {       return l2;     } else if( l2.isEmptyconcInstruction() ) {       return l1;     } else if(  l1.getTailconcInstruction() .isEmptyconcInstruction() ) {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,l2) ;     } else {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,tom_append_list_concInstruction( l1.getTailconcInstruction() ,l2)) ;     }   }   private static   tom.engine.adt.tominstruction.types.InstructionList  tom_get_slice_concInstruction( tom.engine.adt.tominstruction.types.InstructionList  begin,  tom.engine.adt.tominstruction.types.InstructionList  end, tom.engine.adt.tominstruction.types.InstructionList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyconcInstruction()  ||  (end== tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( begin.getHeadconcInstruction() ,( tom.engine.adt.tominstruction.types.InstructionList )tom_get_slice_concInstruction( begin.getTailconcInstruction() ,end,tail)) ;   }    /* Generated by TOM (version 2.6alpha): Do not edit this file */             /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */   private static   tom.library.sl.Strategy  tom_append_list_Sequence( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Sequence) )) {       if(( ((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Sequence(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Sequence( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin):new tom.library.sl.Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)) );   }      private static   tom.library.sl.Strategy  tom_append_list_Choice( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 ==null )) {       return l2;     } else if(( l2 ==null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Choice) )) {       if(( ((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )) ==null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Choice(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Choice( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end ==null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin):new tom.library.sl.Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)) );   }      private static   tom.library.sl.Strategy  tom_append_list_SequenceId( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.SequenceId) )) {       if(( ((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.SequenceId(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_SequenceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin):new tom.library.sl.SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)) );   }      private static   tom.library.sl.Strategy  tom_append_list_ChoiceId( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 ==null )) {       return l2;     } else if(( l2 ==null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.ChoiceId) )) {       if(( ((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )) ==null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1):new tom.library.sl.ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1):new tom.library.sl.ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1),tom_append_list_ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.ChoiceId(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_ChoiceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end ==null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.FIRST) ):begin):new tom.library.sl.ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),end,tail)) );   }    /* Generated by TOM (version 2.6alpha): Do not edit this file */ /* Generated by TOM (version 2.6alpha): Do not edit this file */private static  tom.library.sl.Strategy  tom_make_Try( tom.library.sl.Strategy  v) { return ( ( (( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )==null)?v:new tom.library.sl.Choice(v,( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )) ) );}private static  tom.library.sl.Strategy  tom_make_TopDown( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}private static  tom.library.sl.Strategy  tom_make_TopDownCollect( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),tom_make_Try(( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) ))) ) );}private static  tom.library.sl.Strategy  tom_make_RepeatId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) )) ) );}private static  tom.library.sl.Strategy  tom_make_OnceTopDownId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.ChoiceId(( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.ChoiceId(v,( (( null )==null)?( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.ChoiceId(( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}private static  tom.library.sl.Strategy  tom_make_InnermostId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )) )) ) );}   /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */ /* Generated by TOM (version 2.6alpha): Do not edit this file */   private static java.util.ArrayList concArrayListAppend(Object o, java.util.ArrayList l) {   java.util.ArrayList res = (java.util.ArrayList)l.clone();   res.add(o);   return res; } /* Generated by TOM (version 2.6alpha): Do not edit this file *//* Generated by TOM (version 2.6alpha): Do not edit this file */   private static java.util.HashSet hashSetAppend(Object o, java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   res.add(o);   return res; }  private static Object hashSetGetHead(java.util.HashSet s) {   java.util.Iterator it = s.iterator();   return it.next(); }  private static java.util.HashSet hashSetGetTail(java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   java.util.Iterator it = s.iterator();   res.remove(it.next());   return res; } 







  /** some output suffixes */
  private static final String OPTIMIZED_SUFFIX = ".tfix.optimized";

  /** the declared options string*/
  private static final String DECLARED_OPTIONS = 
    "<options>" + 
    "<boolean name='optimize' altName='O' description='Optimized generated code' value='false'/>" +
    "<boolean name='optimize2' altName='O2' description='Optimized generated code' value='false'/>" +
    "<boolean name='prettyPIL' altName='pil' description='PrettyPrint IL' value='false'/>" +
    "</options>";

  public void optionChanged(String optionName, Object optionValue) {
    if(optionName.equals("optimize2") && ((Boolean)optionValue).booleanValue() ) { 
      setOptionValue("pretty", Boolean.TRUE);        
    }
  }

  // this static field is necessary for %strategy instructions that generate static code
  private static PILFactory factory = new PILFactory();
  private static Logger logger = Logger.getLogger("tom.engine.optimizer.TomOptimizer");

  /** Constructor */
  public TomOptimizer() {
    super("TomOptimizer");
  }

  public void run() {
    if(getOptionBooleanValue("optimize") || getOptionBooleanValue("optimize2")) {
      // Initialize strategies

      Strategy optStrategy2 = ( (( (( null )==null)?tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
            )
          :new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
            )
          ,( null )) )==null)?tom_make_InnermostId(( (( (( null )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( null )) )==null)?tom_make_RepeatId(tom_make_NopElimAndFlatten()):new tom.library.sl.ChoiceId(tom_make_RepeatId(tom_make_NopElimAndFlatten()),( (( null )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( null )) )) )):new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( null )) )==null)?tom_make_RepeatId(tom_make_NopElimAndFlatten()):new tom.library.sl.ChoiceId(tom_make_RepeatId(tom_make_NopElimAndFlatten()),( (( null )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( null )) )) )),( (( null )==null)?tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
            )
          :new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
            )
          ,( null )) )) )






;

      long startChrono = System.currentTimeMillis();
      boolean intermediate = getOptionBooleanValue("intermediate");
      try {
        TomTerm renamedTerm = (TomTerm)getWorkingTerm();

        if(getOptionBooleanValue("optimize2")) {          
          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
          renamedTerm = (TomTerm) tom_make_InnermostId(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )).visit(renamedTerm);
          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
        } else {
          if(getOptionBooleanValue("optimize")) {
            renamedTerm = (TomTerm) tom_make_InnermostId(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )).visit(renamedTerm);
          }
        }
        setWorkingTerm(renamedTerm);

        // verbose
        logger.log(Level.INFO, TomMessage.tomOptimizationPhase.getMessage(),
            Integer.valueOf((int)(System.currentTimeMillis()-startChrono)) );
      } catch (Exception e) {
        logger.log( Level.SEVERE, TomMessage.exceptionMessage.getMessage(),
            new Object[]{"TomOptimizer", getStreamManager().getInputFileName(), e.getMessage()} );

        e.printStackTrace();
        return;
      }
      if(intermediate) {
        Tools.generateOutput(getStreamManager().getOutputFileName() + OPTIMIZED_SUFFIX, 
            (TomTerm)getWorkingTerm() );
      }
    } else {
      // not active plugin
      logger.log(Level.INFO, "The optimizer is not activated and thus WILL NOT RUN.");
    }
    if(getOptionBooleanValue("prettyPIL")) {
      System.out.println(factory.prettyPrintCompiledMatch(factory.remove((TomTerm)getWorkingTerm())));
    }

  }

  public PlatformOptionList getDeclaredOptionList() {
    return OptionParser.xmlToOptionList(TomOptimizer.DECLARED_OPTIONS);
  }

  private static String extractRealName(String name) {
    if(name.startsWith("tom_")) {
      return name.substring(4);
    }
    return name;
  }

  /* strategies for LetRef inlining */
  // comp = special( comp, basecase(comp,fail()) )
  private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRef( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) { return 
 (
      tom_make_Try(( new tom.library.sl.Mu(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetRefSpecialCase(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetRefBaseCase(( new tom.library.sl.All(( new tom.library.sl.MuVar("comp") )) ),variableName,info),variableName,info)
            ) ))










      ) ;}




  private static class InfoVariableLetRef {

    public tom.library.sl.Position lastRead;
    public Expression lastAssignment;
    public tom.library.sl.Position lastAssignmentPosition;
    public HashSet<TomName> lastAssignmentVariables= new HashSet();
    public int readCount=0;

    public void setlastvalue(Expression newassignment,tom.library.sl.Position newassignmentpos) {
      lastAssignment=newassignment;
      lastAssignmentPosition=newassignmentpos;
      lastAssignmentVariables.clear();
      try {
        tom_make_TopDownCollect(tom_make_findRefVariable(lastAssignmentVariables)).visitLight(newassignment);
      } catch(tom.library.sl.VisitFailure e) {
        logger.log( Level.SEVERE, "Error during collecting variables in "+newassignment);
      }
    }

    public InfoVariableLetRef() {}

    public InfoVariableLetRef(Expression lastAssignment, tom.library.sl.Position lastAssignmentPosition) {
      setlastvalue(lastAssignment,lastAssignmentPosition);
    } 

  }

  private static class findRefVariable extends tom.library.sl.BasicStrategy {private  java.util.HashSet  set;public findRefVariable( java.util.HashSet  set) {super(( new tom.library.sl.Identity() ));this.set=set;}public  java.util.HashSet  getset() {return set;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch195NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch195NameNumber_freshVar_1=tomMatch195NameNumberfreshSubject_1;if ( (tomMatch195NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Ref) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch195NameNumber_freshVar_0= tomMatch195NameNumber_freshVar_1.getTomTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch195NameNumber_freshVar_3=tomMatch195NameNumber_freshVar_0;{ boolean tomMatch195NameNumber_freshVar_4= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch195NameNumber_freshVar_2= null ;if ( (tomMatch195NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch195NameNumber_freshVar_4= true ;tomMatch195NameNumber_freshVar_2= tomMatch195NameNumber_freshVar_3.getAstName() ;}} else {if ( (tomMatch195NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch195NameNumber_freshVar_4= true ;tomMatch195NameNumber_freshVar_2= tomMatch195NameNumber_freshVar_3.getAstName() ;}}}if ((tomMatch195NameNumber_freshVar_4 ==  true )) {if ( true ) {


        set.add(tomMatch195NameNumber_freshVar_2);
        //stop to visit this branch (like "return false" with traversal) 
        throw new tom.library.sl.VisitFailure();
      }}}}}}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomterm.types.TomTerm )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_findRefVariable( java.util.HashSet  t0) { return new findRefVariable(t0);}



  //case where failure is used to cut branches
  private static class computeOccurencesLetRefSpecialCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  goOnCase;private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariableLetRef  info;public computeOccurencesLetRefSpecialCase( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) {super(defaultCase);this.goOnCase=goOnCase;this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() {return goOnCase;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariableLetRef  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getgoOnCase();stratChilds[2] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);goOnCase = ( tom.library.sl.Strategy ) children[1];defaultCase = ( tom.library.sl.Strategy ) children[2];return this;}public int getChildCount() {return 3;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumber_freshVar_0=tomMatch196NameNumberfreshSubject_1;if ( (tomMatch196NameNumber_freshVar_0 instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {if ( true ) {


        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumber_freshVar_4=tomMatch196NameNumberfreshSubject_1;if ( (tomMatch196NameNumber_freshVar_4 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch196NameNumber_freshVar_1= tomMatch196NameNumber_freshVar_4.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch196NameNumber_freshVar_2= tomMatch196NameNumber_freshVar_4.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumber_freshVar_3= tomMatch196NameNumber_freshVar_4.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch196NameNumber_freshVar_6=tomMatch196NameNumber_freshVar_1;if ( (tomMatch196NameNumber_freshVar_6 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch196NameNumber_freshVar_5= tomMatch196NameNumber_freshVar_6.getAstName() ;{  tom.engine.adt.tomname.types.TomName  tom_varname=tomMatch196NameNumber_freshVar_5;if ( true ) {


        if(tom_varname.equals(variableName)) {
          info.setlastvalue(tomMatch196NameNumber_freshVar_2,getEnvironment().getPosition());
        } else {
          if(info.lastAssignmentVariables.contains(tom_varname)) {
            info.lastAssignment = null;
            info.lastAssignmentPosition = null;
            info.lastAssignmentVariables.clear();
          }
        }
        /* recursive call of the current strategy on src */
        Environment current = getEnvironment();
        current.down(2);
        goOnCase.visit(current);
        current.up();
        /* recursive call of the current strategy on inst */
        current.down(3);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch196NameNumber_freshVar_9=tomMatch196NameNumberfreshSubject_1;if ( (tomMatch196NameNumber_freshVar_9 instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch196NameNumber_freshVar_7= tomMatch196NameNumber_freshVar_9.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch196NameNumber_freshVar_8= tomMatch196NameNumber_freshVar_9.getSource() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch196NameNumber_freshVar_11=tomMatch196NameNumber_freshVar_7;if ( (tomMatch196NameNumber_freshVar_11 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch196NameNumber_freshVar_10= tomMatch196NameNumber_freshVar_11.getAstName() ;{  tom.engine.adt.tomname.types.TomName  tom_varname=tomMatch196NameNumber_freshVar_10;if ( true ) {


        if(tom_varname.equals(variableName)) {
          info.setlastvalue(tomMatch196NameNumber_freshVar_8,getEnvironment().getPosition());
        } else {
          if(info.lastAssignmentVariables.contains(tom_varname)) {
            info.lastAssignment = null;
            info.lastAssignmentPosition = null;
            info.lastAssignmentVariables.clear();
          }
        }
        /* recursive call of the current strategy on src */
        Environment current = getEnvironment();
        current.down(2);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRefSpecialCase( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariableLetRef  t3) { return new computeOccurencesLetRefSpecialCase(t0,t1,t2,t3);}private static class computeOccurencesLetRefBaseCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariableLetRef  info;public computeOccurencesLetRefBaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) {super(defaultCase);this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariableLetRef  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch197NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch197NameNumber_freshVar_1=tomMatch197NameNumberfreshSubject_1;{ boolean tomMatch197NameNumber_freshVar_2= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch197NameNumber_freshVar_0= null ;if ( (tomMatch197NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch197NameNumber_freshVar_2= true ;tomMatch197NameNumber_freshVar_0= tomMatch197NameNumber_freshVar_1.getAstName() ;}} else {if ( (tomMatch197NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch197NameNumber_freshVar_2= true ;tomMatch197NameNumber_freshVar_0= tomMatch197NameNumber_freshVar_1.getAstName() ;}}}if ((tomMatch197NameNumber_freshVar_2 ==  true )) {if ( true ) {






 
        if(variableName == tomMatch197NameNumber_freshVar_0) {
          info.readCount++;
          info.lastRead=getEnvironment().getPosition(); 
          if (info.readCount==2) { throw new VisitFailure(); }
        }  
      }}}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomterm.types.TomTerm )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRefBaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariableLetRef  t2) { return new computeOccurencesLetRefBaseCase(t0,t1,t2);}



  /* strategies for Let inlining */
  // comp = special1(special2(all(comp),base(all(comp),fail())),fail())
  private static  tom.library.sl.Strategy  tom_make_computeOccurencesLet( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) { return 
 (
      tom_make_Try(( new tom.library.sl.Mu(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetSpecialCase1(tom_make_computeOccurencesLetSpecialCase2(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetBaseCase(( new tom.library.sl.All(( new tom.library.sl.MuVar("comp") )) ),variableName,info),variableName,info),info)
            ) ))











 )
    ;}






  private static class InfoVariableLet {

    public tom.library.sl.Position lastRead;
    public HashSet<TomName> assignmentVariables= new HashSet();
    public int readCount=0;
    public boolean modifiedAssignmentVariables=false;

    public void setlastvalue(Expression newassignment) {
      assignmentVariables.clear();
      try {
        tom_make_TopDownCollect(tom_make_findRefVariable(assignmentVariables)).visitLight(newassignment);
      } catch(tom.library.sl.VisitFailure e) {
        logger.log( Level.SEVERE, "Error during collecting variables in "+newassignment);
      }
    }

    public InfoVariableLet(Expression assignment) { setlastvalue(assignment); } 

    public InfoVariableLet() {}

  }

  private static class computeOccurencesLetSpecialCase1 extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  InfoVariableLet  info;public computeOccurencesLetSpecialCase1( tom.library.sl.Strategy  defaultCase,  InfoVariableLet  info) {super(defaultCase);this.defaultCase=defaultCase;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  InfoVariableLet  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch198NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch198NameNumber_freshVar_1=tomMatch198NameNumberfreshSubject_1;{ boolean tomMatch198NameNumber_freshVar_4= false ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch198NameNumber_freshVar_0= null ;if ( (tomMatch198NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) {{tomMatch198NameNumber_freshVar_4= true ;tomMatch198NameNumber_freshVar_0= tomMatch198NameNumber_freshVar_1.getVariable() ;}} else {if ( (tomMatch198NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{tomMatch198NameNumber_freshVar_4= true ;tomMatch198NameNumber_freshVar_0= tomMatch198NameNumber_freshVar_1.getVariable() ;}}}if ((tomMatch198NameNumber_freshVar_4 ==  true )) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch198NameNumber_freshVar_3=tomMatch198NameNumber_freshVar_0;if ( (tomMatch198NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch198NameNumber_freshVar_2= tomMatch198NameNumber_freshVar_3.getAstName() ;if ( true ) {


        if(info.assignmentVariables.contains(tomMatch198NameNumber_freshVar_2)) {
          info.modifiedAssignmentVariables=true;
          throw new tom.library.sl.VisitFailure();
        }
      }}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetSpecialCase1( tom.library.sl.Strategy  t0,  InfoVariableLet  t1) { return new computeOccurencesLetSpecialCase1(t0,t1);}private static class computeOccurencesLetSpecialCase2 extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  goOnCase;private  tom.library.sl.Strategy  cutCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariableLet  info;public computeOccurencesLetSpecialCase2( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  cutCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) {super(cutCase);this.goOnCase=goOnCase;this.cutCase=cutCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() {return goOnCase;}public  tom.library.sl.Strategy  getcutCase() {return cutCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariableLet  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getgoOnCase();stratChilds[2] = getcutCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);goOnCase = ( tom.library.sl.Strategy ) children[1];cutCase = ( tom.library.sl.Strategy ) children[2];return this;}public int getChildCount() {return 3;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getcutCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: cutCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch199NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch199NameNumber_freshVar_0=tomMatch199NameNumberfreshSubject_1;if ( (tomMatch199NameNumber_freshVar_0 instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {if ( true ) {






        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch199NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch199NameNumber_freshVar_2=tomMatch199NameNumberfreshSubject_1;{ boolean tomMatch199NameNumber_freshVar_5= false ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch199NameNumber_freshVar_1= null ;if ( (tomMatch199NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) {{tomMatch199NameNumber_freshVar_5= true ;tomMatch199NameNumber_freshVar_1= tomMatch199NameNumber_freshVar_2.getVariable() ;}} else {if ( (tomMatch199NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{tomMatch199NameNumber_freshVar_5= true ;tomMatch199NameNumber_freshVar_1= tomMatch199NameNumber_freshVar_2.getVariable() ;}}}if ((tomMatch199NameNumber_freshVar_5 ==  true )) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch199NameNumber_freshVar_4=tomMatch199NameNumber_freshVar_1;if ( (tomMatch199NameNumber_freshVar_4 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch199NameNumber_freshVar_3= tomMatch199NameNumber_freshVar_4.getAstName() ;if ( true ) {



        if (variableName.equals(tomMatch199NameNumber_freshVar_3)) {
          logger.log( Level.SEVERE, "TomOptimizer: Assignment cannot be done for the variable "+variableName+" declared in a let", new Object[]{} );
        }
      }}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetSpecialCase2( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariableLet  t3) { return new computeOccurencesLetSpecialCase2(t0,t1,t2,t3);}private static class computeOccurencesLetBaseCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariableLet  info;public computeOccurencesLetBaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) {super(defaultCase);this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariableLet  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch200NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch200NameNumber_freshVar_1=tomMatch200NameNumberfreshSubject_1;{ boolean tomMatch200NameNumber_freshVar_2= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch200NameNumber_freshVar_0= null ;if ( (tomMatch200NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch200NameNumber_freshVar_2= true ;tomMatch200NameNumber_freshVar_0= tomMatch200NameNumber_freshVar_1.getAstName() ;}} else {if ( (tomMatch200NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch200NameNumber_freshVar_2= true ;tomMatch200NameNumber_freshVar_0= tomMatch200NameNumber_freshVar_1.getAstName() ;}}}if ((tomMatch200NameNumber_freshVar_2 ==  true )) {if ( true ) {





 
        if(variableName == tomMatch200NameNumber_freshVar_0) {
          info.readCount++;
          info.lastRead = getEnvironment().getPosition(); 
          if (info.readCount==2) { throw new VisitFailure(); }
        } 
      }}}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomterm.types.TomTerm )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetBaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariableLet  t2) { return new computeOccurencesLetBaseCase(t0,t1,t2);}



  /* 
   * rename variable1 into variable2
   */
  private static  tom.library.sl.Strategy  tom_make_renameVariable( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) { return 
 (tom_make_TopDown(tom_make_renameVariableOnce(variable1,variable2)) );}private static class renameVariableOnce extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomname.types.TomName  variable1;private  tom.engine.adt.tomname.types.TomName  variable2;public renameVariableOnce( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) {super(( new tom.library.sl.Identity() ));this.variable1=variable1;this.variable2=variable2;}public  tom.engine.adt.tomname.types.TomName  getvariable1() {return variable1;}public  tom.engine.adt.tomname.types.TomName  getvariable2() {return variable2;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch201NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch201NameNumber_freshVar_1=tomMatch201NameNumberfreshSubject_1;{ boolean tomMatch201NameNumber_freshVar_2= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch201NameNumber_freshVar_0= null ;if ( (tomMatch201NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch201NameNumber_freshVar_2= true ;tomMatch201NameNumber_freshVar_0= tomMatch201NameNumber_freshVar_1.getAstName() ;}} else {if ( (tomMatch201NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch201NameNumber_freshVar_2= true ;tomMatch201NameNumber_freshVar_0= tomMatch201NameNumber_freshVar_1.getAstName() ;}}}if ((tomMatch201NameNumber_freshVar_2 ==  true )) {if ( true ) {





        if(variable1 == tomMatch201NameNumber_freshVar_0) {
          return tomMatch201NameNumberfreshSubject_1.setAstName(variable2);
        }
      }}}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomterm.types.TomTerm )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_renameVariableOnce( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomname.types.TomName  t1) { return new renameVariableOnce(t0,t1);}private static  tom.library.sl.Strategy  tom_make_CleanAssign( tom.engine.adt.tomname.types.TomName  varname) { return 




 (tom_make_TopDown(tom_make_CleanAssignOnce(varname))) ;}private static class CleanAssignOnce extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomname.types.TomName  varname;public CleanAssignOnce( tom.engine.adt.tomname.types.TomName  varname) {super(( new tom.library.sl.Identity() ));this.varname=varname;}public  tom.engine.adt.tomname.types.TomName  getvarname() {return varname;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch202NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch202NameNumber_freshVar_3=tomMatch202NameNumberfreshSubject_1;if ( (tomMatch202NameNumber_freshVar_3 instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch202NameNumber_freshVar_0= tomMatch202NameNumber_freshVar_3.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch202NameNumber_freshVar_1= tomMatch202NameNumber_freshVar_3.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch202NameNumber_freshVar_2= tomMatch202NameNumber_freshVar_3.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch202NameNumber_freshVar_5=tomMatch202NameNumber_freshVar_0;{ boolean tomMatch202NameNumber_freshVar_6= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch202NameNumber_freshVar_4= null ;if ( (tomMatch202NameNumber_freshVar_5 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch202NameNumber_freshVar_6= true ;tomMatch202NameNumber_freshVar_4= tomMatch202NameNumber_freshVar_5.getAstName() ;}} else {if ( (tomMatch202NameNumber_freshVar_5 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch202NameNumber_freshVar_6= true ;tomMatch202NameNumber_freshVar_4= tomMatch202NameNumber_freshVar_5.getAstName() ;}}}if ((tomMatch202NameNumber_freshVar_6 ==  true )) {if ( true ) {





        if (tomMatch202NameNumber_freshVar_4.equals(varname)) { return tomMatch202NameNumber_freshVar_2; }
      }}}}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_CleanAssignOnce( tom.engine.adt.tomname.types.TomName  t0) { return new CleanAssignOnce(t0);}



  private static boolean compare(tom.library.sl.Visitable term1, tom.library.sl.Visitable term2) {
    return factory.remove(term1)==factory.remove(term2);
  }

  private static class Inline extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomconstraint.types.Constraint  context;public Inline( tom.engine.adt.tomconstraint.types.Constraint  context) {super(( new tom.library.sl.Identity() ));this.context=context;}public  tom.engine.adt.tomconstraint.types.Constraint  getcontext() {return context;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_1=tomMatch203NameNumberfreshSubject_1;if ( (tomMatch203NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch203NameNumber_freshVar_0= tomMatch203NameNumber_freshVar_1.getAstExpression() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch203NameNumber_freshVar_3=tomMatch203NameNumber_freshVar_0;if ( (tomMatch203NameNumber_freshVar_3 instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_2= tomMatch203NameNumber_freshVar_3.getAstTerm() ;if ( true ) {

 return tomMatch203NameNumber_freshVar_2; }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_7=tomMatch203NameNumberfreshSubject_1;if ( (tomMatch203NameNumber_freshVar_7 instanceof tom.engine.adt.tomterm.types.tomterm.BuildAppendList) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch203NameNumber_freshVar_4= tomMatch203NameNumber_freshVar_7.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_5= tomMatch203NameNumber_freshVar_7.getHeadTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_6= tomMatch203NameNumber_freshVar_7.getTailTerm() ;{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch203NameNumber_freshVar_4;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_9=tomMatch203NameNumber_freshVar_5;if ( (tomMatch203NameNumber_freshVar_9 instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch203NameNumber_freshVar_8= tomMatch203NameNumber_freshVar_9.getAstExpression() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch203NameNumber_freshVar_14=tomMatch203NameNumber_freshVar_8;if ( (tomMatch203NameNumber_freshVar_14 instanceof tom.engine.adt.tomexpression.types.expression.GetSliceList) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch203NameNumber_freshVar_10= tomMatch203NameNumber_freshVar_14.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_11= tomMatch203NameNumber_freshVar_14.getVariableBeginAST() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_12= tomMatch203NameNumber_freshVar_14.getVariableEndAST() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch203NameNumber_freshVar_13= tomMatch203NameNumber_freshVar_14.getTail() ;{  tom.engine.adt.tomname.types.TomName  tomMatch203NameNumber_freshVar_15=tomMatch203NameNumber_freshVar_10;if ( (tomMatch203NameNumber_freshVar_15==tom_name) ) {if ( true ) {



        return  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make( tom.engine.adt.tomexpression.types.expression.GetSliceList.make(tom_name, tomMatch203NameNumber_freshVar_11, tomMatch203NameNumber_freshVar_12,  tom.engine.adt.tomterm.types.tomterm.BuildAppendList.make(tom_name, tomMatch203NameNumber_freshVar_13, tomMatch203NameNumber_freshVar_6) ) ) ;
      }}}}}}}}}}}}}}}}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomexpression.types.Expression  visit_Expression( tom.engine.adt.tomexpression.types.Expression  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch204NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch204NameNumber_freshVar_1=tomMatch204NameNumberfreshSubject_1;if ( (tomMatch204NameNumber_freshVar_1 instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch204NameNumber_freshVar_0= tomMatch204NameNumber_freshVar_1.getAstTerm() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch204NameNumber_freshVar_3=tomMatch204NameNumber_freshVar_0;if ( (tomMatch204NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch204NameNumber_freshVar_2= tomMatch204NameNumber_freshVar_3.getAstExpression() ;if ( true ) {



 return tomMatch204NameNumber_freshVar_2; }}}}}}}}}}return _visit_Expression(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_1=tomMatch205NameNumberfreshSubject_1;if ( (tomMatch205NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {{  tom.engine.adt.tomconstraint.types.Constraint  tomMatch205NameNumber_freshVar_0= tomMatch205NameNumber_freshVar_1.getPositivePattern() ;if ( true ) {




        context = tomMatch205NameNumber_freshVar_0;
        //System.out.println("found context = " + context);
        return tomMatch205NameNumberfreshSubject_1;
      }}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_5=tomMatch205NameNumberfreshSubject_1;if ( (tomMatch205NameNumber_freshVar_5 instanceof tom.engine.adt.tominstruction.types.instruction.LetRef) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_2= tomMatch205NameNumber_freshVar_5.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch205NameNumber_freshVar_3= tomMatch205NameNumber_freshVar_5.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_4= tomMatch205NameNumber_freshVar_5.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_7=tomMatch205NameNumber_freshVar_2;{ boolean tomMatch205NameNumber_freshVar_10= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch205NameNumber_freshVar_6= null ;if ( (tomMatch205NameNumber_freshVar_7 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch205NameNumber_freshVar_10= true ;tomMatch205NameNumber_freshVar_6= tomMatch205NameNumber_freshVar_7.getAstName() ;}} else {if ( (tomMatch205NameNumber_freshVar_7 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch205NameNumber_freshVar_10= true ;tomMatch205NameNumber_freshVar_6= tomMatch205NameNumber_freshVar_7.getAstName() ;}}}if ((tomMatch205NameNumber_freshVar_10 ==  true )) {{  tom.engine.adt.tomname.types.TomName  tomMatch205NameNumber_freshVar_9=tomMatch205NameNumber_freshVar_6;if ( (tomMatch205NameNumber_freshVar_9 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch205NameNumber_freshVar_8= tomMatch205NameNumber_freshVar_9.getString() ;{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch205NameNumber_freshVar_6;{  tom.engine.adt.tominstruction.types.Instruction  tom_body=tomMatch205NameNumber_freshVar_4;if ( true ) {






        /*
         * do not optimize Variable(TomNumber...) because LetRef X*=GetTail(X*) in ...
         * is not correctly handled 
         * we must check that X notin exp
         */
        String varName = "";
        {if ( (tom_name instanceof tom.engine.adt.tomname.types.TomName) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch206NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )tom_name);{  tom.engine.adt.tomname.types.TomName  tomMatch206NameNumber_freshVar_1=tomMatch206NameNumberfreshSubject_1;if ( (tomMatch206NameNumber_freshVar_1 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch206NameNumber_freshVar_0= tomMatch206NameNumber_freshVar_1.getString() ;if ( true ) { varName = extractRealName(tomMatch206NameNumber_freshVar_0); }}}}}}}

        //`findOccurencesUpTo(name,list,2).visitLight(`body);
        InfoVariableLetRef info = new InfoVariableLetRef(tomMatch205NameNumber_freshVar_3,getEnvironment().getPosition());
        tom_make_computeOccurencesLetRef(tom_name,info).visit(tom_body);
        int mult = info.readCount;
        tom.library.sl.Position readPos = info.lastRead;
        TomTerm value =  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(info.lastAssignment) ;
        // 0 -> unused variable
        // suppress the letref and all the corresponding letassigns in the body
        if(mult == 0) {
          // why this test?
          if(varName.length() > 0) {
            // TODO: check variable occurence in TypedAction
            info = new InfoVariableLetRef();
            tom_make_computeOccurencesLetRef(tom_name,info).visit(context);
            if(info.readCount<=1 && !varName.startsWith("_")) {
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch205NameNumber_freshVar_2.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,varName);
              logger.log( Level.INFO,
                  TomMessage.remove.getMessage(),
                  new Object[]{ Integer.valueOf(mult), varName });
            }
          }
          //remove all the unused letassign in the letref body
          return (Instruction) tom_make_CleanAssign(tom_name).visitLight(tom_body);
        } else if(mult == 1) {
          //  `findOccurencesUpTo(name,list,2).visitLight(`exp);
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the read
          if(info.lastAssignment!=null) {
            //test if the last assignment is not in a conditional sub-block
            //relatively to the variable use
            tom.library.sl.Position src = info.lastRead;
            tom.library.sl.Position dest = info.lastAssignmentPosition;
            // find the positive part of src-dest
            tom.library.sl.Position positivePart = (tom.library.sl.Position) dest.sub(src).getCanonicalPath();
            while(positivePart.length()>0 && positivePart.getHead()<0) {
              positivePart = (tom.library.sl.Position) positivePart.getTail();
            }
            // find the common ancestor of src and dest
            tom.library.sl.Position commonAncestor = (tom.library.sl.Position) dest.add(positivePart.inverse()).getCanonicalPath();
            try {
              //this strategy fails if  from common ancestor and along the path positivePart 
              //there is an instruction If, WhileDo or DoWhile
              commonAncestor.getOmega(positivePart.getOmegaPath(( new tom.library.sl.Not(( (( (( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile(),( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_If():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_If(),( (( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile(),( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )) )) )) ))).visit(tom_body);
              if(varName.length() > 0) {
                logger.log( Level.INFO,
                    TomMessage.inline.getMessage(),
                    new Object[]{ Integer.valueOf(mult), varName });
              }
              //System.out.println("replace1: " + `var + "\nby: " + `exp);
              return (Instruction) ( (( (( null )==null)?tom_make_CleanAssign(tom_name):new tom.library.sl.Sequence(tom_make_CleanAssign(tom_name),( null )) )==null)?readPos.getReplace(value):new tom.library.sl.Sequence(readPos.getReplace(value),( (( null )==null)?tom_make_CleanAssign(tom_name):new tom.library.sl.Sequence(tom_make_CleanAssign(tom_name),( null )) )) ).visitLight(tom_body);
            }catch(VisitFailure e) {
              if(varName.length() > 0) {
                logger.log( Level.INFO,
                    TomMessage.noInline.getMessage(),
                    new Object[]{ Integer.valueOf(mult), varName });
              }
            }
          } else {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.noInline.getMessage(),
                  new Object[]{ Integer.valueOf(mult), varName });
            }
          }
        } else {
          /* do nothing: traversal() */
          if(varName.length() > 0) {
            logger.log( Level.INFO,
                TomMessage.doNothing.getMessage(),
                new Object[]{ Integer.valueOf(mult), varName });
          }
        }
      }}}}}}}}}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_14=tomMatch205NameNumberfreshSubject_1;if ( (tomMatch205NameNumber_freshVar_14 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_11= tomMatch205NameNumber_freshVar_14.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch205NameNumber_freshVar_12= tomMatch205NameNumber_freshVar_14.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_13= tomMatch205NameNumber_freshVar_14.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_16=tomMatch205NameNumber_freshVar_11;{ boolean tomMatch205NameNumber_freshVar_19= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch205NameNumber_freshVar_15= null ;if ( (tomMatch205NameNumber_freshVar_16 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch205NameNumber_freshVar_19= true ;tomMatch205NameNumber_freshVar_15= tomMatch205NameNumber_freshVar_16.getAstName() ;}} else {if ( (tomMatch205NameNumber_freshVar_16 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch205NameNumber_freshVar_19= true ;tomMatch205NameNumber_freshVar_15= tomMatch205NameNumber_freshVar_16.getAstName() ;}}}if ((tomMatch205NameNumber_freshVar_19 ==  true )) {{  tom.engine.adt.tomname.types.TomName  tomMatch205NameNumber_freshVar_18=tomMatch205NameNumber_freshVar_15;if ( (tomMatch205NameNumber_freshVar_18 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch205NameNumber_freshVar_17= tomMatch205NameNumber_freshVar_18.getString() ;{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch205NameNumber_freshVar_15;{  tom.engine.adt.tomexpression.types.Expression  tom_exp=tomMatch205NameNumber_freshVar_12;{  tom.engine.adt.tominstruction.types.Instruction  tom_body=tomMatch205NameNumber_freshVar_13;if ( true ) {







        /*
         * do not optimize Variable(TomNumber...) because LetRef X*=GetTail(X*) in ...
         * is not correctly handled 
         * we must check that X notin exp
         */
        String varName = "";
        {if ( (tom_name instanceof tom.engine.adt.tomname.types.TomName) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch207NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )tom_name);{  tom.engine.adt.tomname.types.TomName  tomMatch207NameNumber_freshVar_1=tomMatch207NameNumberfreshSubject_1;if ( (tomMatch207NameNumber_freshVar_1 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {{  String  tomMatch207NameNumber_freshVar_0= tomMatch207NameNumber_freshVar_1.getString() ;if ( true ) {
 varName = extractRealName(tomMatch207NameNumber_freshVar_0); }}}}}}}


        //`findOccurencesUpTo(name,list,2).visitLight(`body);
        InfoVariableLet info = new InfoVariableLet(tom_exp);
        tom_make_computeOccurencesLet(tom_name,info).visit(tom_body);
        int mult = info.readCount;
        tom.library.sl.Position readPos = info.lastRead;
        // 0 -> unused variable
        // suppress the letref and all the corresponding letassigns in the body
        if(mult == 0) {
          // why this test?
          if(varName.length() > 0) {
            // TODO: check variable occurence in TypedAction
            info = new InfoVariableLet();
            tom_make_computeOccurencesLet(tom_name,info).visit(context);
            if(info.readCount<=1 && !varName.startsWith("_")) {
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch205NameNumber_freshVar_11.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,varName);
              logger.log( Level.INFO,
                  TomMessage.remove.getMessage(),
                  new Object[]{ Integer.valueOf(mult), varName });
            }
          }
          //remove all the unused letassign in the letref body
          return tom_body;
        } else if(mult == 1) {
          //  `findOccurencesUpTo(name,list,2).visitLight(`exp);
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the read
          if(! info.modifiedAssignmentVariables) {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.inline.getMessage(),
                  new Object[]{ Integer.valueOf(mult), varName });
            }
            return (Instruction) readPos.getReplace( tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(tom_exp) ).visitLight(tom_body);
          } else {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.noInline.getMessage(),
                  new Object[]{ Integer.valueOf(mult), varName });
            }
          }
        } else {
          /* do nothing: traversal() */
          if(varName.length() > 0) {
            logger.log( Level.INFO,
                TomMessage.doNothing.getMessage(),
                new Object[]{ Integer.valueOf(mult), varName });
          }
        }
      }}}}}}}}}}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_23=tomMatch205NameNumberfreshSubject_1;if ( (tomMatch205NameNumber_freshVar_23 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_20= tomMatch205NameNumber_freshVar_23.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch205NameNumber_freshVar_21= tomMatch205NameNumber_freshVar_23.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch205NameNumber_freshVar_22= tomMatch205NameNumber_freshVar_23.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch205NameNumber_freshVar_24=tomMatch205NameNumber_freshVar_20;{ boolean tomMatch205NameNumber_freshVar_25= false ;if ( (tomMatch205NameNumber_freshVar_24 instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariable) ) {tomMatch205NameNumber_freshVar_25= true ;} else {if ( (tomMatch205NameNumber_freshVar_24 instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariableStar) ) {tomMatch205NameNumber_freshVar_25= true ;}}if ((tomMatch205NameNumber_freshVar_25 ==  true )) {if ( true ) {


        return tomMatch205NameNumber_freshVar_22; 
      }}}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tomexpression.types.Expression  _visit_Expression( tom.engine.adt.tomexpression.types.Expression  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomexpression.types.Expression )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomexpression.types.Expression )any.visitLight(arg,introspector));} }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomterm.types.TomTerm )any.visitLight(arg,introspector));} }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomexpression.types.Expression) ) {return visit_Expression((( tom.engine.adt.tomexpression.types.Expression )v),introspector);}if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector);}if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_Inline( tom.engine.adt.tomconstraint.types.Constraint  t0) { return new Inline(t0);}private static class NopElimAndFlatten extends tom.library.sl.BasicStrategy {public NopElimAndFlatten() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_1=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_0= tomMatch208NameNumber_freshVar_1.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_2=tomMatch208NameNumber_freshVar_0;if ( ((tomMatch208NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch208NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_begin_4=tomMatch208NameNumber_freshVar_2;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_end_5=tomMatch208NameNumber_freshVar_2;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_C1=tom_get_slice_concInstruction(tomMatch208NameNumber_begin_4,tomMatch208NameNumber_end_5, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_3=tomMatch208NameNumber_end_5;if (!( tomMatch208NameNumber_freshVar_3.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_9= tomMatch208NameNumber_freshVar_3.getHeadconcInstruction() ;if ( (tomMatch208NameNumber_freshVar_9 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_8= tomMatch208NameNumber_freshVar_9.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_6= tomMatch208NameNumber_freshVar_3.getTailconcInstruction() ;if ( true ) {







        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "flatten");     
        return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_C1,tom_append_list_concInstruction(tomMatch208NameNumber_freshVar_8,tom_append_list_concInstruction(tomMatch208NameNumber_freshVar_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )))) ;
      }}}}}}}}if ( tomMatch208NameNumber_end_5.isEmptyconcInstruction() ) {tomMatch208NameNumber_end_5=tomMatch208NameNumber_begin_4;} else {tomMatch208NameNumber_end_5= tomMatch208NameNumber_end_5.getTailconcInstruction() ;}}} while(!( (tomMatch208NameNumber_end_5==tomMatch208NameNumber_begin_4) ));}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_11=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_11 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_10= tomMatch208NameNumber_freshVar_11.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_12=tomMatch208NameNumber_freshVar_10;if ( ((tomMatch208NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch208NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_begin_14=tomMatch208NameNumber_freshVar_12;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_end_15=tomMatch208NameNumber_freshVar_12;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_C1=tom_get_slice_concInstruction(tomMatch208NameNumber_begin_14,tomMatch208NameNumber_end_15, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_13=tomMatch208NameNumber_end_15;if (!( tomMatch208NameNumber_freshVar_13.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_18= tomMatch208NameNumber_freshVar_13.getHeadconcInstruction() ;if ( (tomMatch208NameNumber_freshVar_18 instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_16= tomMatch208NameNumber_freshVar_13.getTailconcInstruction() ;if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "nop-elim");     
        return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_C1,tom_append_list_concInstruction(tomMatch208NameNumber_freshVar_16, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ))) ;
      }}}}}}}if ( tomMatch208NameNumber_end_15.isEmptyconcInstruction() ) {tomMatch208NameNumber_end_15=tomMatch208NameNumber_begin_14;} else {tomMatch208NameNumber_end_15= tomMatch208NameNumber_end_15.getTailconcInstruction() ;}}} while(!( (tomMatch208NameNumber_end_15==tomMatch208NameNumber_begin_14) ));}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_20=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_20 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_19= tomMatch208NameNumber_freshVar_20.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_21=tomMatch208NameNumber_freshVar_19;if ( ((tomMatch208NameNumber_freshVar_21 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch208NameNumber_freshVar_21 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if ( tomMatch208NameNumber_freshVar_21.isEmptyconcInstruction() ) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "abstractblock-elim1");     
        return  tom.engine.adt.tominstruction.types.instruction.Nop.make() ;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_23=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_23 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_22= tomMatch208NameNumber_freshVar_23.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_24=tomMatch208NameNumber_freshVar_22;if ( ((tomMatch208NameNumber_freshVar_24 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch208NameNumber_freshVar_24 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if (!( tomMatch208NameNumber_freshVar_24.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tom_i= tomMatch208NameNumber_freshVar_24.getHeadconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch208NameNumber_freshVar_25= tomMatch208NameNumber_freshVar_24.getTailconcInstruction() ;if ( tomMatch208NameNumber_freshVar_25.isEmptyconcInstruction() ) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "abstractblock-elim2");     
        return tom_i;
      }}}}}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_28=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_28 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch208NameNumber_freshVar_26= tomMatch208NameNumber_freshVar_28.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_27= tomMatch208NameNumber_freshVar_28.getSuccesInst() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch208NameNumber_freshVar_29=tomMatch208NameNumber_freshVar_26;if ( (tomMatch208NameNumber_freshVar_29 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "iftrue-elim");     
        return tomMatch208NameNumber_freshVar_27;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_32=tomMatch208NameNumberfreshSubject_1;if ( (tomMatch208NameNumber_freshVar_32 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch208NameNumber_freshVar_30= tomMatch208NameNumber_freshVar_32.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch208NameNumber_freshVar_31= tomMatch208NameNumber_freshVar_32.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch208NameNumber_freshVar_33=tomMatch208NameNumber_freshVar_30;if ( (tomMatch208NameNumber_freshVar_33 instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "iffalse-elim");     
        return tomMatch208NameNumber_freshVar_31;
      }}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_NopElimAndFlatten() { return new NopElimAndFlatten();}





  /*
   * two expressions are incompatible when they cannot be true a the same time
   */ 
  private boolean incompatible(Expression c1, Expression c2) {
    try {
      Expression res = (Expression) tom_make_InnermostId(tom_make_NormExpr(this)).visitLight( tom.engine.adt.tomexpression.types.expression.And.make(c1, c2) );
      return res == tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
    } catch(tom.library.sl.VisitFailure e) {
      return false;
    }
  }

  private static class IfSwapping extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public IfSwapping( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_1=tomMatch209NameNumberfreshSubject_1;if ( (tomMatch209NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_freshVar_0= tomMatch209NameNumber_freshVar_1.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_freshVar_2=tomMatch209NameNumber_freshVar_0;if ( ((tomMatch209NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch209NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_begin_4=tomMatch209NameNumber_freshVar_2;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_end_5=tomMatch209NameNumber_freshVar_2;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch209NameNumber_begin_4,tomMatch209NameNumber_end_5, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_freshVar_3=tomMatch209NameNumber_end_5;if (!( tomMatch209NameNumber_freshVar_3.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_12= tomMatch209NameNumber_freshVar_3.getHeadconcInstruction() ;if ( (tomMatch209NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch209NameNumber_freshVar_9= tomMatch209NameNumber_freshVar_12.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_10= tomMatch209NameNumber_freshVar_12.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_11= tomMatch209NameNumber_freshVar_12.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch209NameNumber_freshVar_9;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_13=tomMatch209NameNumber_freshVar_11;if ( (tomMatch209NameNumber_freshVar_13 instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {{  tom.engine.adt.tominstruction.types.Instruction  tom_I1= tomMatch209NameNumber_freshVar_3.getHeadconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_freshVar_6= tomMatch209NameNumber_freshVar_3.getTailconcInstruction() ;if (!( tomMatch209NameNumber_freshVar_6.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_17= tomMatch209NameNumber_freshVar_6.getHeadconcInstruction() ;if ( (tomMatch209NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch209NameNumber_freshVar_14= tomMatch209NameNumber_freshVar_17.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_15= tomMatch209NameNumber_freshVar_17.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_16= tomMatch209NameNumber_freshVar_17.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tom_cond2=tomMatch209NameNumber_freshVar_14;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch209NameNumber_freshVar_18=tomMatch209NameNumber_freshVar_16;if ( (tomMatch209NameNumber_freshVar_18 instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {{  tom.engine.adt.tominstruction.types.Instruction  tom_I2= tomMatch209NameNumber_freshVar_6.getHeadconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch209NameNumber_freshVar_7= tomMatch209NameNumber_freshVar_6.getTailconcInstruction() ;if ( true ) {


        String s1 = factory.prettyPrint(factory.remove(tom_cond1));
        String s2 = factory.prettyPrint(factory.remove(tom_cond2));
        if(s1.compareTo(s2) < 0) {
          /* swap two incompatible conditions */
          if(optimizer.incompatible(tom_cond1,tom_cond2)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), new Object[]{"if-swapping"});     
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_I2, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_I1,tom_append_list_concInstruction(tomMatch209NameNumber_freshVar_7, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) ) )) ;
          }
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}if ( tomMatch209NameNumber_end_5.isEmptyconcInstruction() ) {tomMatch209NameNumber_end_5=tomMatch209NameNumber_begin_4;} else {tomMatch209NameNumber_end_5= tomMatch209NameNumber_end_5.getTailconcInstruction() ;}}} while(!( (tomMatch209NameNumber_end_5==tomMatch209NameNumber_begin_4) ));}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_IfSwapping( TomOptimizer  t0) { return new IfSwapping(t0);}private static class BlockFusion extends tom.library.sl.BasicStrategy {public BlockFusion() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumber_freshVar_1=tomMatch210NameNumberfreshSubject_1;if ( (tomMatch210NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_freshVar_0= tomMatch210NameNumber_freshVar_1.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_freshVar_2=tomMatch210NameNumber_freshVar_0;if ( ((tomMatch210NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch210NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_begin_4=tomMatch210NameNumber_freshVar_2;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_end_5=tomMatch210NameNumber_freshVar_2;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch210NameNumber_begin_4,tomMatch210NameNumber_end_5, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_freshVar_3=tomMatch210NameNumber_end_5;if (!( tomMatch210NameNumber_freshVar_3.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumber_freshVar_12= tomMatch210NameNumber_freshVar_3.getHeadconcInstruction() ;if ( (tomMatch210NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumber_freshVar_9= tomMatch210NameNumber_freshVar_12.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch210NameNumber_freshVar_10= tomMatch210NameNumber_freshVar_12.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumber_freshVar_11= tomMatch210NameNumber_freshVar_12.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumber_freshVar_14=tomMatch210NameNumber_freshVar_9;{ boolean tomMatch210NameNumber_freshVar_22= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch210NameNumber_freshVar_13= null ;if ( (tomMatch210NameNumber_freshVar_14 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch210NameNumber_freshVar_22= true ;tomMatch210NameNumber_freshVar_13= tomMatch210NameNumber_freshVar_14.getAstName() ;}} else {if ( (tomMatch210NameNumber_freshVar_14 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch210NameNumber_freshVar_22= true ;tomMatch210NameNumber_freshVar_13= tomMatch210NameNumber_freshVar_14.getAstName() ;}}}if ((tomMatch210NameNumber_freshVar_22 ==  true )) {{  tom.engine.adt.tomname.types.TomName  tom_name1=tomMatch210NameNumber_freshVar_13;{  tom.engine.adt.tomterm.types.TomTerm  tom_var1=tomMatch210NameNumber_freshVar_9;{  tom.engine.adt.tomexpression.types.Expression  tom_term1=tomMatch210NameNumber_freshVar_10;{  tom.engine.adt.tominstruction.types.Instruction  tom_body1=tomMatch210NameNumber_freshVar_11;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_freshVar_6= tomMatch210NameNumber_freshVar_3.getTailconcInstruction() ;if (!( tomMatch210NameNumber_freshVar_6.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumber_freshVar_18= tomMatch210NameNumber_freshVar_6.getHeadconcInstruction() ;if ( (tomMatch210NameNumber_freshVar_18 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumber_freshVar_15= tomMatch210NameNumber_freshVar_18.getVariable() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch210NameNumber_freshVar_16= tomMatch210NameNumber_freshVar_18.getSource() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch210NameNumber_freshVar_17= tomMatch210NameNumber_freshVar_18.getAstInstruction() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumber_freshVar_20=tomMatch210NameNumber_freshVar_15;{ boolean tomMatch210NameNumber_freshVar_21= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch210NameNumber_freshVar_19= null ;if ( (tomMatch210NameNumber_freshVar_20 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch210NameNumber_freshVar_21= true ;tomMatch210NameNumber_freshVar_19= tomMatch210NameNumber_freshVar_20.getAstName() ;}} else {if ( (tomMatch210NameNumber_freshVar_20 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch210NameNumber_freshVar_21= true ;tomMatch210NameNumber_freshVar_19= tomMatch210NameNumber_freshVar_20.getAstName() ;}}}if ((tomMatch210NameNumber_freshVar_21 ==  true )) {{  tom.engine.adt.tominstruction.types.Instruction  tom_body2=tomMatch210NameNumber_freshVar_17;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch210NameNumber_freshVar_7= tomMatch210NameNumber_freshVar_6.getTailconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tom_X2=tomMatch210NameNumber_freshVar_7;if ( true ) {









        /* Fusion de 2 blocs Let contigus instanciant deux variables egales */
        if(compare(tom_term1,tomMatch210NameNumber_freshVar_16)) {
          if(compare(tom_var1,tomMatch210NameNumber_freshVar_15)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{"block-fusion1"});     
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.Let.make(tom_var1, tom_term1,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_body1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_body2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tom_X2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
          } else {
            InfoVariableLet info = new InfoVariableLet();
            //  `findOccurencesUpTo(name1,list,2).visitLight(`body2);
            tom_make_computeOccurencesLet(tom_name1,info).visitLight(tom_body2);
            int mult = info.readCount; 
            if(mult==0){
              logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                  new Object[]{"block-fusion2"});    
              Instruction newBody2 =  (Instruction)(tom_make_renameVariable(tomMatch210NameNumber_freshVar_19,tom_name1).visitLight(tom_body2));
              return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.Let.make(tom_var1, tom_term1,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_body1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(newBody2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tom_X2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
            }
          }
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if ( tomMatch210NameNumber_end_5.isEmptyconcInstruction() ) {tomMatch210NameNumber_end_5=tomMatch210NameNumber_begin_4;} else {tomMatch210NameNumber_end_5= tomMatch210NameNumber_end_5.getTailconcInstruction() ;}}} while(!( (tomMatch210NameNumber_end_5==tomMatch210NameNumber_begin_4) ));}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_BlockFusion() { return new BlockFusion();}private static class IfFusion extends tom.library.sl.BasicStrategy {public IfFusion() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_1=tomMatch211NameNumberfreshSubject_1;if ( (tomMatch211NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_freshVar_0= tomMatch211NameNumber_freshVar_1.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_freshVar_2=tomMatch211NameNumber_freshVar_0;if ( ((tomMatch211NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch211NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_begin_4=tomMatch211NameNumber_freshVar_2;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_end_5=tomMatch211NameNumber_freshVar_2;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch211NameNumber_begin_4,tomMatch211NameNumber_end_5, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_freshVar_3=tomMatch211NameNumber_end_5;if (!( tomMatch211NameNumber_freshVar_3.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_12= tomMatch211NameNumber_freshVar_3.getHeadconcInstruction() ;if ( (tomMatch211NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch211NameNumber_freshVar_9= tomMatch211NameNumber_freshVar_12.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_10= tomMatch211NameNumber_freshVar_12.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_11= tomMatch211NameNumber_freshVar_12.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch211NameNumber_freshVar_9;{  tom.engine.adt.tominstruction.types.Instruction  tom_success1=tomMatch211NameNumber_freshVar_10;{  tom.engine.adt.tominstruction.types.Instruction  tom_failure1=tomMatch211NameNumber_freshVar_11;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_freshVar_6= tomMatch211NameNumber_freshVar_3.getTailconcInstruction() ;if (!( tomMatch211NameNumber_freshVar_6.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_16= tomMatch211NameNumber_freshVar_6.getHeadconcInstruction() ;if ( (tomMatch211NameNumber_freshVar_16 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch211NameNumber_freshVar_13= tomMatch211NameNumber_freshVar_16.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_14= tomMatch211NameNumber_freshVar_16.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_15= tomMatch211NameNumber_freshVar_16.getFailureInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tom_success2=tomMatch211NameNumber_freshVar_14;{  tom.engine.adt.tominstruction.types.Instruction  tom_failure2=tomMatch211NameNumber_freshVar_15;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch211NameNumber_freshVar_7= tomMatch211NameNumber_freshVar_6.getTailconcInstruction() ;{  tom.engine.adt.tominstruction.types.InstructionList  tom_X2=tomMatch211NameNumber_freshVar_7;if ( true ) {









        /* Fusion de 2 blocs If gardes par la meme condition */
        if(compare(tom_cond1,tomMatch211NameNumber_freshVar_13)) {
          if(tom_failure1.isNop() && tom_failure2.isNop()) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{"if-fusion1"});
            Instruction res =  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tom_cond1,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_success1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_success2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ,  tom.engine.adt.tominstruction.types.instruction.Nop.make() ) ,tom_append_list_concInstruction(tom_X2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
            //System.out.println(res);

            return res;
          } else {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{ "if-fusion2"});
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tom_cond1,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_success1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_success2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_failure1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tom_failure2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tom_X2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
          }
        }
      }}}}}}}}}}}}}}}}}}}}}}}if ( tomMatch211NameNumber_end_5.isEmptyconcInstruction() ) {tomMatch211NameNumber_end_5=tomMatch211NameNumber_begin_4;} else {tomMatch211NameNumber_end_5= tomMatch211NameNumber_end_5.getTailconcInstruction() ;}}} while(!( (tomMatch211NameNumber_end_5==tomMatch211NameNumber_begin_4) ));}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_IfFusion() { return new IfFusion();}private static class InterBlock extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public InterBlock( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_1=tomMatch212NameNumberfreshSubject_1;if ( (tomMatch212NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_freshVar_0= tomMatch212NameNumber_freshVar_1.getInstList() ;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_freshVar_2=tomMatch212NameNumber_freshVar_0;if ( ((tomMatch212NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch212NameNumber_freshVar_2 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_begin_4=tomMatch212NameNumber_freshVar_2;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_end_5=tomMatch212NameNumber_freshVar_2;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch212NameNumber_begin_4,tomMatch212NameNumber_end_5, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_freshVar_3=tomMatch212NameNumber_end_5;if (!( tomMatch212NameNumber_freshVar_3.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_12= tomMatch212NameNumber_freshVar_3.getHeadconcInstruction() ;if ( (tomMatch212NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch212NameNumber_freshVar_9= tomMatch212NameNumber_freshVar_12.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_10= tomMatch212NameNumber_freshVar_12.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_11= tomMatch212NameNumber_freshVar_12.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch212NameNumber_freshVar_9;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_freshVar_6= tomMatch212NameNumber_freshVar_3.getTailconcInstruction() ;if (!( tomMatch212NameNumber_freshVar_6.isEmptyconcInstruction() )) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_16= tomMatch212NameNumber_freshVar_6.getHeadconcInstruction() ;if ( (tomMatch212NameNumber_freshVar_16 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch212NameNumber_freshVar_13= tomMatch212NameNumber_freshVar_16.getCondition() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_14= tomMatch212NameNumber_freshVar_16.getSuccesInst() ;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_15= tomMatch212NameNumber_freshVar_16.getFailureInst() ;{  tom.engine.adt.tomexpression.types.Expression  tom_cond2=tomMatch212NameNumber_freshVar_13;{  tom.engine.adt.tominstruction.types.Instruction  tomMatch212NameNumber_freshVar_17=tomMatch212NameNumber_freshVar_15;if ( (tomMatch212NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch212NameNumber_freshVar_7= tomMatch212NameNumber_freshVar_6.getTailconcInstruction() ;if ( true ) {










        if(optimizer.incompatible(tom_cond1,tom_cond2)) {
          logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), new Object[]{"inter-block"});
          return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tom_cond1, tomMatch212NameNumber_freshVar_10,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch212NameNumber_freshVar_11, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tom_cond2, tomMatch212NameNumber_freshVar_14,  tom.engine.adt.tominstruction.types.instruction.Nop.make() ) , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tomMatch212NameNumber_freshVar_7, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
        }  
      }}}}}}}}}}}}}}}}}}}}}if ( tomMatch212NameNumber_end_5.isEmptyconcInstruction() ) {tomMatch212NameNumber_end_5=tomMatch212NameNumber_begin_4;} else {tomMatch212NameNumber_end_5= tomMatch212NameNumber_end_5.getTailconcInstruction() ;}}} while(!( (tomMatch212NameNumber_end_5==tomMatch212NameNumber_begin_4) ));}}}}}}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return (( tom.engine.adt.tominstruction.types.Instruction )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_InterBlock( TomOptimizer  t0) { return new InterBlock(t0);}private static class NormExpr extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public NormExpr( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomexpression.types.Expression  visit_Expression( tom.engine.adt.tomexpression.types.Expression  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_2=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_2 instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_0= tomMatch213NameNumber_freshVar_2.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_1= tomMatch213NameNumber_freshVar_2.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_3=tomMatch213NameNumber_freshVar_1;if ( (tomMatch213NameNumber_freshVar_3 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {






        return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_6=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_6 instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_4= tomMatch213NameNumber_freshVar_6.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_5= tomMatch213NameNumber_freshVar_6.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_7=tomMatch213NameNumber_freshVar_4;if ( (tomMatch213NameNumber_freshVar_7 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {

        return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_10=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_10 instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_8= tomMatch213NameNumber_freshVar_10.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_9= tomMatch213NameNumber_freshVar_10.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_11=tomMatch213NameNumber_freshVar_9;if ( (tomMatch213NameNumber_freshVar_11 instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {if ( true ) {

        return tomMatch213NameNumber_freshVar_8;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_14=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_14 instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_12= tomMatch213NameNumber_freshVar_14.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_13= tomMatch213NameNumber_freshVar_14.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_15=tomMatch213NameNumber_freshVar_12;if ( (tomMatch213NameNumber_freshVar_15 instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {if ( true ) {

        return tomMatch213NameNumber_freshVar_13;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_18=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_18 instanceof tom.engine.adt.tomexpression.types.expression.And) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_16= tomMatch213NameNumber_freshVar_18.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_17= tomMatch213NameNumber_freshVar_18.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_19=tomMatch213NameNumber_freshVar_16;if ( (tomMatch213NameNumber_freshVar_19 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {

        return tomMatch213NameNumber_freshVar_17;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_22=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_22 instanceof tom.engine.adt.tomexpression.types.expression.And) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_20= tomMatch213NameNumber_freshVar_22.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_21= tomMatch213NameNumber_freshVar_22.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_23=tomMatch213NameNumber_freshVar_21;if ( (tomMatch213NameNumber_freshVar_23 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {

        return tomMatch213NameNumber_freshVar_20;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_26=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_26 instanceof tom.engine.adt.tomexpression.types.expression.And) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_24= tomMatch213NameNumber_freshVar_26.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_25= tomMatch213NameNumber_freshVar_26.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_27=tomMatch213NameNumber_freshVar_24;if ( (tomMatch213NameNumber_freshVar_27 instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {if ( true ) {

        return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_30=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_30 instanceof tom.engine.adt.tomexpression.types.expression.And) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_28= tomMatch213NameNumber_freshVar_30.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_29= tomMatch213NameNumber_freshVar_30.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_31=tomMatch213NameNumber_freshVar_28;if ( (tomMatch213NameNumber_freshVar_31 instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {if ( true ) {

        return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
      }}}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_35=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_35 instanceof tom.engine.adt.tomexpression.types.expression.EqualTerm) ) {{  tom.engine.adt.tomtype.types.TomType  tomMatch213NameNumber_freshVar_32= tomMatch213NameNumber_freshVar_35.getTomType() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_33= tomMatch213NameNumber_freshVar_35.getKid1() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_34= tomMatch213NameNumber_freshVar_35.getKid2() ;if ( true ) {

        //System.out.println("kid1 = " + `kid1);
        //System.out.println("kid2 = " + `kid2);
        if(compare(tomMatch213NameNumber_freshVar_33,tomMatch213NameNumber_freshVar_34)){
          return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;
        } else {
          return tomMatch213NameNumberfreshSubject_1;
        }
      }}}}}}}}if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_38=tomMatch213NameNumberfreshSubject_1;if ( (tomMatch213NameNumber_freshVar_38 instanceof tom.engine.adt.tomexpression.types.expression.And) ) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_36= tomMatch213NameNumber_freshVar_38.getArg1() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_37= tomMatch213NameNumber_freshVar_38.getArg2() ;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_41=tomMatch213NameNumber_freshVar_36;if ( (tomMatch213NameNumber_freshVar_41 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch213NameNumber_freshVar_39= tomMatch213NameNumber_freshVar_41.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_40= tomMatch213NameNumber_freshVar_41.getVariable() ;{  tom.engine.adt.tomname.types.TomName  tom_name1=tomMatch213NameNumber_freshVar_39;{  tom.engine.adt.tomterm.types.TomTerm  tom_term=tomMatch213NameNumber_freshVar_40;{  tom.engine.adt.tomexpression.types.Expression  tomMatch213NameNumber_freshVar_44=tomMatch213NameNumber_freshVar_37;if ( (tomMatch213NameNumber_freshVar_44 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) {{  tom.engine.adt.tomname.types.TomName  tomMatch213NameNumber_freshVar_42= tomMatch213NameNumber_freshVar_44.getAstName() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_43= tomMatch213NameNumber_freshVar_44.getVariable() ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_45=tomMatch213NameNumber_freshVar_43;if ( (tomMatch213NameNumber_freshVar_45==tom_term) ) {if ( true ) {

        if(tom_name1==tomMatch213NameNumber_freshVar_42) {
          return  tom.engine.adt.tomexpression.types.expression.IsFsym.make(tom_name1, tom_term) ;
        }
        /*
         * may be true for list operator with domain=codomain
         * two if_sym(f)==is_fsym(g) may be true due to mapping
         */
        TomSymbol tomSymbol = optimizer.symbolTable().getSymbolFromName(tom_name1.getString());
        if(TomBase.isListOperator(tomSymbol) || TomBase.isArrayOperator(tomSymbol)) {
          //System.out.println("symbol = " + tomSymbol);
          TomType domain = TomBase.getSymbolDomain(tomSymbol).getHeadconcTomType();
          TomType codomain = TomBase.getSymbolCodomain(tomSymbol);
          if(domain!=codomain) {
            return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
          }
        } else {
          return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
        }
        return tomMatch213NameNumberfreshSubject_1;
      }}}}}}}}}}}}}}}}}}}}return _visit_Expression(tom__arg,introspector); }public  tom.engine.adt.tomexpression.types.Expression  _visit_Expression( tom.engine.adt.tomexpression.types.Expression  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomexpression.types.Expression )any.visit(environment,introspector));} else {return (( tom.engine.adt.tomexpression.types.Expression )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomexpression.types.Expression) ) {return visit_Expression((( tom.engine.adt.tomexpression.types.Expression )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_NormExpr( TomOptimizer  t0) { return new NormExpr(t0);}



} // class TomOptimizer
