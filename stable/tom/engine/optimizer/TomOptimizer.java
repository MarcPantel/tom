/* Generated by TOM (version 2.5): Do not edit this file *//*
 * 
 * TOM - To One Matching Compiler
 * 
 * Copyright (c) 2000-2007, INRIA
 * Nancy, France.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 * 
 * Pierre-Etienne Moreau  e-mail: Pierre-Etienne.Moreau@loria.fr
 *
 **/

package tom.engine.optimizer;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

import tom.engine.TomBase;

import tom.engine.adt.tomsignature.*;
import tom.engine.adt.tomconstraint.types.*;
import tom.engine.adt.tomdeclaration.types.*;
import tom.engine.adt.tomexpression.types.*;
import tom.engine.adt.tominstruction.types.*;
import tom.engine.adt.tomname.types.*;
import tom.engine.adt.tomoption.types.*;
import tom.engine.adt.tomsignature.types.*;
import tom.engine.adt.tomterm.types.*;
import tom.engine.adt.tomslot.types.*;
import tom.engine.adt.tomtype.types.*;

import tom.engine.TomMessage;
import tom.engine.tools.TomGenericPlugin;
import tom.engine.tools.PILFactory;
import tom.engine.tools.Tools;
import tom.platform.OptionParser;
import tom.platform.adt.platformoption.types.PlatformOptionList;

import tom.library.sl.*;

/**
 * The TomOptimizer plugin.
 */
public class TomOptimizer extends TomGenericPlugin {

  /* Generated by TOM (version 2.5): Do not edit this file *//* Generated by TOM (version 2.5): Do not edit this file *//* Generated by TOM (version 2.5): Do not edit this file */ private static boolean tom_equal_term_String(String t1, String t2) { return  (t1.equals(t2)) ;}private static boolean tom_is_sort_String(String t) { return  t instanceof String ;}  /* Generated by TOM (version 2.5): Do not edit this file */ private static boolean tom_equal_term_Instruction(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Instruction(Object t) { return  t instanceof tom.engine.adt.tominstruction.types.Instruction ;}private static boolean tom_equal_term_InstructionList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_InstructionList(Object t) { return  t instanceof tom.engine.adt.tominstruction.types.InstructionList ;}private static boolean tom_equal_term_TomType(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomType(Object t) { return  t instanceof tom.engine.adt.tomtype.types.TomType ;}private static boolean tom_equal_term_TomName(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomName(Object t) { return  t instanceof tom.engine.adt.tomname.types.TomName ;}private static boolean tom_equal_term_Expression(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Expression(Object t) { return  t instanceof tom.engine.adt.tomexpression.types.Expression ;}private static boolean tom_equal_term_Pattern(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_Pattern(Object t) { return  t instanceof tom.engine.adt.tomterm.types.Pattern ;}private static boolean tom_equal_term_TomList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomList(Object t) { return  t instanceof tom.engine.adt.tomterm.types.TomList ;}private static boolean tom_equal_term_TomTerm(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_TomTerm(Object t) { return  t instanceof tom.engine.adt.tomterm.types.TomTerm ;}private static boolean tom_equal_term_PatternList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_PatternList(Object t) { return  t instanceof tom.engine.adt.tomterm.types.PatternList ;}private static boolean tom_equal_term_OptionList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_OptionList(Object t) { return  t instanceof tom.engine.adt.tomoption.types.OptionList ;}private static boolean tom_equal_term_ConstraintList(Object t1, Object t2) { return  t1.equals(t2) ;}private static boolean tom_is_sort_ConstraintList(Object t) { return  t instanceof tom.engine.adt.tomconstraint.types.ConstraintList ;}private static boolean tom_is_fun_sym_If( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.If ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_make_If( tom.engine.adt.tomexpression.types.Expression  t0,  tom.engine.adt.tominstruction.types.Instruction  t1,  tom.engine.adt.tominstruction.types.Instruction  t2) { return  tom.engine.adt.tominstruction.types.instruction.If.make(t0, t1, t2) ; }private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_If_Condition( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getCondition() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_If_SuccesInst( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSuccesInst() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_If_FailureInst( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getFailureInst() ;}private static boolean tom_is_fun_sym_Assign( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.Assign ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_Assign_Variable( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getVariable() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_Assign_Source( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSource() ;}private static boolean tom_is_fun_sym_Let( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.Let ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_make_Let( tom.engine.adt.tomterm.types.TomTerm  t0,  tom.engine.adt.tomexpression.types.Expression  t1,  tom.engine.adt.tominstruction.types.Instruction  t2) { return  tom.engine.adt.tominstruction.types.instruction.Let.make(t0, t1, t2) ; }private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_Let_Variable( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getVariable() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_Let_Source( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSource() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_Let_AstInstruction( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getAstInstruction() ;}private static boolean tom_is_fun_sym_LetRef( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.LetRef ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_LetRef_Variable( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getVariable() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_LetRef_Source( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSource() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_LetRef_AstInstruction( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getAstInstruction() ;}private static boolean tom_is_fun_sym_LetAssign( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.LetAssign ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_LetAssign_Variable( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getVariable() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_LetAssign_Source( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getSource() ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_LetAssign_AstInstruction( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getAstInstruction() ;}private static boolean tom_is_fun_sym_Nop( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.Nop ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_make_Nop() { return  tom.engine.adt.tominstruction.types.instruction.Nop.make() ; }private static boolean tom_is_fun_sym_AbstractBlock( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_make_AbstractBlock( tom.engine.adt.tominstruction.types.InstructionList  t0) { return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(t0) ; }private static  tom.engine.adt.tominstruction.types.InstructionList  tom_get_slot_AbstractBlock_InstList( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getInstList() ;}private static boolean tom_is_fun_sym_TypedAction( tom.engine.adt.tominstruction.types.Instruction  t) { return  t instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction ;}private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_slot_TypedAction_AstInstruction( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getAstInstruction() ;}private static  tom.engine.adt.tomterm.types.Pattern  tom_get_slot_TypedAction_PositivePattern( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getPositivePattern() ;}private static  tom.engine.adt.tomterm.types.PatternList  tom_get_slot_TypedAction_NegativePatternList( tom.engine.adt.tominstruction.types.Instruction  t) { return  t.getNegativePatternList() ;}private static boolean tom_is_fun_sym_Name( tom.engine.adt.tomname.types.TomName  t) { return  t instanceof tom.engine.adt.tomname.types.tomname.Name ;}private static  String  tom_get_slot_Name_String( tom.engine.adt.tomname.types.TomName  t) { return  t.getString() ;}private static boolean tom_is_fun_sym_TomTermToExpression( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_TomTermToExpression_AstTerm( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getAstTerm() ;}private static boolean tom_is_fun_sym_And( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.And ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_make_And( tom.engine.adt.tomexpression.types.Expression  t0,  tom.engine.adt.tomexpression.types.Expression  t1) { return  tom.engine.adt.tomexpression.types.expression.And.make(t0, t1) ; }private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_And_Arg1( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getArg1() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_And_Arg2( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getArg2() ;}private static boolean tom_is_fun_sym_Or( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.Or ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_Or_Arg1( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getArg1() ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_Or_Arg2( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getArg2() ;}private static boolean tom_is_fun_sym_TrueTL( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.TrueTL ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_make_TrueTL() { return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ; }private static boolean tom_is_fun_sym_FalseTL( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.FalseTL ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_make_FalseTL() { return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ; }private static boolean tom_is_fun_sym_EqualTerm( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.EqualTerm ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_EqualTerm_TomType( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getTomType() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_EqualTerm_Kid1( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getKid1() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_EqualTerm_Kid2( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getKid2() ;}private static boolean tom_is_fun_sym_IsFsym( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.IsFsym ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_make_IsFsym( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomterm.types.TomTerm  t1) { return  tom.engine.adt.tomexpression.types.expression.IsFsym.make(t0, t1) ; }private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_IsFsym_AstName( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_IsFsym_Variable( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getVariable() ;}private static boolean tom_is_fun_sym_GetSliceList( tom.engine.adt.tomexpression.types.Expression  t) { return  t instanceof tom.engine.adt.tomexpression.types.expression.GetSliceList ;}private static  tom.engine.adt.tomexpression.types.Expression  tom_make_GetSliceList( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomterm.types.TomTerm  t1,  tom.engine.adt.tomterm.types.TomTerm  t2,  tom.engine.adt.tomterm.types.TomTerm  t3) { return  tom.engine.adt.tomexpression.types.expression.GetSliceList.make(t0, t1, t2, t3) ; }private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_GetSliceList_AstName( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_GetSliceList_VariableBeginAST( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getVariableBeginAST() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_GetSliceList_VariableEndAST( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getVariableEndAST() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_GetSliceList_Tail( tom.engine.adt.tomexpression.types.Expression  t) { return  t.getTail() ;}private static boolean tom_is_fun_sym_Pattern( tom.engine.adt.tomterm.types.Pattern  t) { return  t instanceof tom.engine.adt.tomterm.types.pattern.Pattern ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_Pattern_SubjectList( tom.engine.adt.tomterm.types.Pattern  t) { return  t.getSubjectList() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_slot_Pattern_TomList( tom.engine.adt.tomterm.types.Pattern  t) { return  t.getTomList() ;}private static boolean tom_is_fun_sym_Variable( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.Variable ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_Variable_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_Variable_AstName( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_Variable_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_Variable_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_VariableStar( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_VariableStar_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_VariableStar_AstName( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_VariableStar_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_VariableStar_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_UnamedVariable( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariable ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_UnamedVariable_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_UnamedVariable_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_UnamedVariable_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_UnamedVariableStar( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariableStar ;}private static  tom.engine.adt.tomoption.types.OptionList  tom_get_slot_UnamedVariableStar_Option( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getOption() ;}private static  tom.engine.adt.tomtype.types.TomType  tom_get_slot_UnamedVariableStar_AstType( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstType() ;}private static  tom.engine.adt.tomconstraint.types.ConstraintList  tom_get_slot_UnamedVariableStar_Constraints( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getConstraints() ;}private static boolean tom_is_fun_sym_ExpressionToTomTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_ExpressionToTomTerm( tom.engine.adt.tomexpression.types.Expression  t0) { return  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(t0) ; }private static  tom.engine.adt.tomexpression.types.Expression  tom_get_slot_ExpressionToTomTerm_AstExpression( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstExpression() ;}private static boolean tom_is_fun_sym_Ref( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.Ref ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_Ref_TomTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getTomTerm() ;}private static boolean tom_is_fun_sym_BuildAppendList( tom.engine.adt.tomterm.types.TomTerm  t) { return  t instanceof tom.engine.adt.tomterm.types.tomterm.BuildAppendList ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_make_BuildAppendList( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomterm.types.TomTerm  t1,  tom.engine.adt.tomterm.types.TomTerm  t2) { return  tom.engine.adt.tomterm.types.tomterm.BuildAppendList.make(t0, t1, t2) ; }private static  tom.engine.adt.tomname.types.TomName  tom_get_slot_BuildAppendList_AstName( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getAstName() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_BuildAppendList_HeadTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getHeadTerm() ;}private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_slot_BuildAppendList_TailTerm( tom.engine.adt.tomterm.types.TomTerm  t) { return  t.getTailTerm() ;}private static boolean tom_is_fun_sym_concInstruction( tom.engine.adt.tominstruction.types.InstructionList  t) { return  t instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction || t instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction ;}private static  tom.engine.adt.tominstruction.types.InstructionList  tom_empty_list_concInstruction() { return  tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ; }private static  tom.engine.adt.tominstruction.types.InstructionList  tom_cons_list_concInstruction( tom.engine.adt.tominstruction.types.Instruction  e,  tom.engine.adt.tominstruction.types.InstructionList  l) { return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(e,l) ; }private static  tom.engine.adt.tominstruction.types.Instruction  tom_get_head_concInstruction_InstructionList( tom.engine.adt.tominstruction.types.InstructionList  l) { return  l.getHeadconcInstruction() ;}private static  tom.engine.adt.tominstruction.types.InstructionList  tom_get_tail_concInstruction_InstructionList( tom.engine.adt.tominstruction.types.InstructionList  l) { return  l.getTailconcInstruction() ;}private static boolean tom_is_empty_concInstruction_InstructionList( tom.engine.adt.tominstruction.types.InstructionList  l) { return  l.isEmptyconcInstruction() ;}   private static   tom.engine.adt.tominstruction.types.InstructionList  tom_append_list_concInstruction( tom.engine.adt.tominstruction.types.InstructionList l1,  tom.engine.adt.tominstruction.types.InstructionList  l2) {     if(tom_is_empty_concInstruction_InstructionList(l1)) {       return l2;     } else if(tom_is_empty_concInstruction_InstructionList(l2)) {       return l1;     } else if(tom_is_empty_concInstruction_InstructionList(tom_get_tail_concInstruction_InstructionList(l1))) {       return ( tom.engine.adt.tominstruction.types.InstructionList )tom_cons_list_concInstruction(tom_get_head_concInstruction_InstructionList(l1),l2);     } else {       return ( tom.engine.adt.tominstruction.types.InstructionList )tom_cons_list_concInstruction(tom_get_head_concInstruction_InstructionList(l1),tom_append_list_concInstruction(tom_get_tail_concInstruction_InstructionList(l1),l2));     }   }   private static   tom.engine.adt.tominstruction.types.InstructionList  tom_get_slice_concInstruction( tom.engine.adt.tominstruction.types.InstructionList  begin,  tom.engine.adt.tominstruction.types.InstructionList  end, tom.engine.adt.tominstruction.types.InstructionList  tail) {     if(tom_equal_term_InstructionList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tominstruction.types.InstructionList )tom_cons_list_concInstruction(tom_get_head_concInstruction_InstructionList(begin),( tom.engine.adt.tominstruction.types.InstructionList )tom_get_slice_concInstruction(tom_get_tail_concInstruction_InstructionList(begin),end,tail));     }   }   private static boolean tom_is_fun_sym_concTomTerm( tom.engine.adt.tomterm.types.TomList  t) { return  t instanceof tom.engine.adt.tomterm.types.tomlist.ConsconcTomTerm || t instanceof tom.engine.adt.tomterm.types.tomlist.EmptyconcTomTerm ;}private static  tom.engine.adt.tomterm.types.TomList  tom_empty_list_concTomTerm() { return  tom.engine.adt.tomterm.types.tomlist.EmptyconcTomTerm.make() ; }private static  tom.engine.adt.tomterm.types.TomList  tom_cons_list_concTomTerm( tom.engine.adt.tomterm.types.TomTerm  e,  tom.engine.adt.tomterm.types.TomList  l) { return  tom.engine.adt.tomterm.types.tomlist.ConsconcTomTerm.make(e,l) ; }private static  tom.engine.adt.tomterm.types.TomTerm  tom_get_head_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.getHeadconcTomTerm() ;}private static  tom.engine.adt.tomterm.types.TomList  tom_get_tail_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.getTailconcTomTerm() ;}private static boolean tom_is_empty_concTomTerm_TomList( tom.engine.adt.tomterm.types.TomList  l) { return  l.isEmptyconcTomTerm() ;}   private static   tom.engine.adt.tomterm.types.TomList  tom_append_list_concTomTerm( tom.engine.adt.tomterm.types.TomList l1,  tom.engine.adt.tomterm.types.TomList  l2) {     if(tom_is_empty_concTomTerm_TomList(l1)) {       return l2;     } else if(tom_is_empty_concTomTerm_TomList(l2)) {       return l1;     } else if(tom_is_empty_concTomTerm_TomList(tom_get_tail_concTomTerm_TomList(l1))) {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(l1),l2);     } else {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(l1),tom_append_list_concTomTerm(tom_get_tail_concTomTerm_TomList(l1),l2));     }   }   private static   tom.engine.adt.tomterm.types.TomList  tom_get_slice_concTomTerm( tom.engine.adt.tomterm.types.TomList  begin,  tom.engine.adt.tomterm.types.TomList  end, tom.engine.adt.tomterm.types.TomList  tail) {     if(tom_equal_term_TomList(begin,end)) {       return tail;     } else {       return ( tom.engine.adt.tomterm.types.TomList )tom_cons_list_concTomTerm(tom_get_head_concTomTerm_TomList(begin),( tom.engine.adt.tomterm.types.TomList )tom_get_slice_concTomTerm(tom_get_tail_concTomTerm_TomList(begin),end,tail));     }   }    
  //%include{ ../adt/tomsignature/_TomSignature.tom }
  /* Generated by TOM (version 2.5): Do not edit this file */private static boolean tom_equal_term_Strategy(Object t1, Object t2) { return t1.equals(t2);}private static boolean tom_is_sort_Strategy(Object t) { return  t instanceof tom.library.sl.Strategy ;}/* Generated by TOM (version 2.5): Do not edit this file */private static  tom.library.sl.Strategy  tom_make_mu( tom.library.sl.Strategy  var,  tom.library.sl.Strategy  v) { return  new tom.library.sl.Mu(var,v) ; }private static  tom.library.sl.Strategy  tom_make_MuVar( String  name) { return  new tom.library.sl.MuVar(name) ; }private static  tom.library.sl.Strategy  tom_make_Identity() { return  new tom.library.sl.Identity() ; }private static  tom.library.sl.Strategy  tom_make_All( tom.library.sl.Strategy  v) { return  new tom.library.sl.All(v) ; }private static boolean tom_is_fun_sym_Sequence( tom.library.sl.Strategy  t) { return  (t instanceof tom.library.sl.Sequence) ;}private static  tom.library.sl.Strategy  tom_empty_list_Sequence() { return  null ; }private static  tom.library.sl.Strategy  tom_cons_list_Sequence( tom.library.sl.Strategy  head,  tom.library.sl.Strategy  tail) { return  (tail==null)?head:new tom.library.sl.Sequence(head,tail) ; }private static  tom.library.sl.Strategy  tom_get_head_Sequence_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.Sequence.FIRST) ;}private static  tom.library.sl.Strategy  tom_get_tail_Sequence_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.Sequence.THEN) ;}private static boolean tom_is_empty_Sequence_Strategy( tom.library.sl.Strategy  t) { return  t == null ;}   private static   tom.library.sl.Strategy  tom_append_list_Sequence( tom.library.sl.Strategy l1,  tom.library.sl.Strategy  l2) {     if(tom_is_empty_Sequence_Strategy(l1)) {       return l2;     } else if(tom_is_empty_Sequence_Strategy(l2)) {       return l1;     } else if(tom_is_fun_sym_Sequence(l1)) {       if(tom_is_empty_Sequence_Strategy(((tom_is_fun_sym_Sequence(l1))?tom_get_tail_Sequence_Strategy(l1):tom_empty_list_Sequence()))) {         return ( tom.library.sl.Strategy )tom_cons_list_Sequence(((tom_is_fun_sym_Sequence(l1))?tom_get_head_Sequence_Strategy(l1):l1),l2);       } else {         return ( tom.library.sl.Strategy )tom_cons_list_Sequence(((tom_is_fun_sym_Sequence(l1))?tom_get_head_Sequence_Strategy(l1):l1),tom_append_list_Sequence(((tom_is_fun_sym_Sequence(l1))?tom_get_tail_Sequence_Strategy(l1):tom_empty_list_Sequence()),l2));       }     } else {       return ( tom.library.sl.Strategy )tom_cons_list_Sequence(l1, l2);     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Sequence( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if(tom_equal_term_Strategy(begin,end)) {       return tail;     } else {       return ( tom.library.sl.Strategy )tom_cons_list_Sequence(((tom_is_fun_sym_Sequence(begin))?tom_get_head_Sequence_Strategy(begin):begin),( tom.library.sl.Strategy )tom_get_slice_Sequence(((tom_is_fun_sym_Sequence(begin))?tom_get_tail_Sequence_Strategy(begin):tom_empty_list_Sequence()),end,tail));     }   }   private static boolean tom_is_fun_sym_Choice( tom.library.sl.Strategy  t) { return  (t instanceof tom.library.sl.Choice) ;}private static  tom.library.sl.Strategy  tom_empty_list_Choice() { return  null ; }private static  tom.library.sl.Strategy  tom_cons_list_Choice( tom.library.sl.Strategy  head,  tom.library.sl.Strategy  tail) { return  (tail==null)?head:new tom.library.sl.Choice(head,tail) ; }private static  tom.library.sl.Strategy  tom_get_head_Choice_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.Choice.FIRST) ;}private static  tom.library.sl.Strategy  tom_get_tail_Choice_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.Choice.THEN) ;}private static boolean tom_is_empty_Choice_Strategy( tom.library.sl.Strategy  t) { return  t ==null ;}   private static   tom.library.sl.Strategy  tom_append_list_Choice( tom.library.sl.Strategy l1,  tom.library.sl.Strategy  l2) {     if(tom_is_empty_Choice_Strategy(l1)) {       return l2;     } else if(tom_is_empty_Choice_Strategy(l2)) {       return l1;     } else if(tom_is_fun_sym_Choice(l1)) {       if(tom_is_empty_Choice_Strategy(((tom_is_fun_sym_Choice(l1))?tom_get_tail_Choice_Strategy(l1):tom_empty_list_Choice()))) {         return ( tom.library.sl.Strategy )tom_cons_list_Choice(((tom_is_fun_sym_Choice(l1))?tom_get_head_Choice_Strategy(l1):l1),l2);       } else {         return ( tom.library.sl.Strategy )tom_cons_list_Choice(((tom_is_fun_sym_Choice(l1))?tom_get_head_Choice_Strategy(l1):l1),tom_append_list_Choice(((tom_is_fun_sym_Choice(l1))?tom_get_tail_Choice_Strategy(l1):tom_empty_list_Choice()),l2));       }     } else {       return ( tom.library.sl.Strategy )tom_cons_list_Choice(l1, l2);     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Choice( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if(tom_equal_term_Strategy(begin,end)) {       return tail;     } else {       return ( tom.library.sl.Strategy )tom_cons_list_Choice(((tom_is_fun_sym_Choice(begin))?tom_get_head_Choice_Strategy(begin):begin),( tom.library.sl.Strategy )tom_get_slice_Choice(((tom_is_fun_sym_Choice(begin))?tom_get_tail_Choice_Strategy(begin):tom_empty_list_Choice()),end,tail));     }   }   private static boolean tom_is_fun_sym_SequenceId( tom.library.sl.Strategy  t) { return  (t instanceof tom.library.sl.SequenceId) ;}private static  tom.library.sl.Strategy  tom_empty_list_SequenceId() { return  null ; }private static  tom.library.sl.Strategy  tom_cons_list_SequenceId( tom.library.sl.Strategy  head,  tom.library.sl.Strategy  tail) { return  (tail==null)?head:new tom.library.sl.SequenceId(head,tail) ; }private static  tom.library.sl.Strategy  tom_get_head_SequenceId_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.SequenceId.FIRST) ;}private static  tom.library.sl.Strategy  tom_get_tail_SequenceId_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.SequenceId.THEN) ;}private static boolean tom_is_empty_SequenceId_Strategy( tom.library.sl.Strategy  t) { return  t == null ;}   private static   tom.library.sl.Strategy  tom_append_list_SequenceId( tom.library.sl.Strategy l1,  tom.library.sl.Strategy  l2) {     if(tom_is_empty_SequenceId_Strategy(l1)) {       return l2;     } else if(tom_is_empty_SequenceId_Strategy(l2)) {       return l1;     } else if(tom_is_fun_sym_SequenceId(l1)) {       if(tom_is_empty_SequenceId_Strategy(((tom_is_fun_sym_SequenceId(l1))?tom_get_tail_SequenceId_Strategy(l1):tom_empty_list_SequenceId()))) {         return ( tom.library.sl.Strategy )tom_cons_list_SequenceId(((tom_is_fun_sym_SequenceId(l1))?tom_get_head_SequenceId_Strategy(l1):l1),l2);       } else {         return ( tom.library.sl.Strategy )tom_cons_list_SequenceId(((tom_is_fun_sym_SequenceId(l1))?tom_get_head_SequenceId_Strategy(l1):l1),tom_append_list_SequenceId(((tom_is_fun_sym_SequenceId(l1))?tom_get_tail_SequenceId_Strategy(l1):tom_empty_list_SequenceId()),l2));       }     } else {       return ( tom.library.sl.Strategy )tom_cons_list_SequenceId(l1, l2);     }   }   private static   tom.library.sl.Strategy  tom_get_slice_SequenceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if(tom_equal_term_Strategy(begin,end)) {       return tail;     } else {       return ( tom.library.sl.Strategy )tom_cons_list_SequenceId(((tom_is_fun_sym_SequenceId(begin))?tom_get_head_SequenceId_Strategy(begin):begin),( tom.library.sl.Strategy )tom_get_slice_SequenceId(((tom_is_fun_sym_SequenceId(begin))?tom_get_tail_SequenceId_Strategy(begin):tom_empty_list_SequenceId()),end,tail));     }   }   private static boolean tom_is_fun_sym_ChoiceId( tom.library.sl.Strategy  t) { return  (t instanceof tom.library.sl.ChoiceId) ;}private static  tom.library.sl.Strategy  tom_empty_list_ChoiceId() { return  null ; }private static  tom.library.sl.Strategy  tom_cons_list_ChoiceId( tom.library.sl.Strategy  head,  tom.library.sl.Strategy  tail) { return  (tail==null)?head:new tom.library.sl.ChoiceId(head,tail) ; }private static  tom.library.sl.Strategy  tom_get_head_ChoiceId_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.ChoiceId.FIRST) ;}private static  tom.library.sl.Strategy  tom_get_tail_ChoiceId_Strategy( tom.library.sl.Strategy  t) { return  (tom.library.sl.Strategy)t.getChildAt(tom.library.sl.ChoiceId.THEN) ;}private static boolean tom_is_empty_ChoiceId_Strategy( tom.library.sl.Strategy  t) { return  t ==null ;}   private static   tom.library.sl.Strategy  tom_append_list_ChoiceId( tom.library.sl.Strategy l1,  tom.library.sl.Strategy  l2) {     if(tom_is_empty_ChoiceId_Strategy(l1)) {       return l2;     } else if(tom_is_empty_ChoiceId_Strategy(l2)) {       return l1;     } else if(tom_is_fun_sym_ChoiceId(l1)) {       if(tom_is_empty_ChoiceId_Strategy(((tom_is_fun_sym_ChoiceId(l1))?tom_get_tail_ChoiceId_Strategy(l1):tom_empty_list_ChoiceId()))) {         return ( tom.library.sl.Strategy )tom_cons_list_ChoiceId(((tom_is_fun_sym_ChoiceId(l1))?tom_get_head_ChoiceId_Strategy(l1):l1),l2);       } else {         return ( tom.library.sl.Strategy )tom_cons_list_ChoiceId(((tom_is_fun_sym_ChoiceId(l1))?tom_get_head_ChoiceId_Strategy(l1):l1),tom_append_list_ChoiceId(((tom_is_fun_sym_ChoiceId(l1))?tom_get_tail_ChoiceId_Strategy(l1):tom_empty_list_ChoiceId()),l2));       }     } else {       return ( tom.library.sl.Strategy )tom_cons_list_ChoiceId(l1, l2);     }   }   private static   tom.library.sl.Strategy  tom_get_slice_ChoiceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if(tom_equal_term_Strategy(begin,end)) {       return tail;     } else {       return ( tom.library.sl.Strategy )tom_cons_list_ChoiceId(((tom_is_fun_sym_ChoiceId(begin))?tom_get_head_ChoiceId_Strategy(begin):begin),( tom.library.sl.Strategy )tom_get_slice_ChoiceId(((tom_is_fun_sym_ChoiceId(begin))?tom_get_tail_ChoiceId_Strategy(begin):tom_empty_list_ChoiceId()),end,tail));     }   }   private static  tom.library.sl.Strategy  tom_make_OneId( tom.library.sl.Strategy  v) { return  new tom.library.sl.OneId(v) ; } /* Generated by TOM (version 2.5): Do not edit this file */ /* Generated by TOM (version 2.5): Do not edit this file */private static  tom.library.sl.Strategy  tom_make_Try( tom.library.sl.Strategy  v) { return tom_cons_list_Choice(v,tom_cons_list_Choice(tom_make_Identity(),tom_empty_list_Choice())) ; }private static  tom.library.sl.Strategy  tom_make_TopDown( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("_x"),tom_cons_list_Sequence(v,tom_cons_list_Sequence(tom_make_All(tom_make_MuVar("_x")),tom_empty_list_Sequence()))) ; }private static  tom.library.sl.Strategy  tom_make_TopDownCollect( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("_x"),tom_make_Try(tom_cons_list_Sequence(v,tom_cons_list_Sequence(tom_make_All(tom_make_MuVar("_x")),tom_empty_list_Sequence())))) ; }private static  tom.library.sl.Strategy  tom_make_RepeatId( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("_x"),tom_cons_list_SequenceId(v,tom_cons_list_SequenceId(tom_make_MuVar("_x"),tom_empty_list_SequenceId()))) ; }private static  tom.library.sl.Strategy  tom_make_InnermostId( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("_x"),tom_cons_list_Sequence(tom_make_All(tom_make_MuVar("_x")),tom_cons_list_Sequence(tom_cons_list_SequenceId(v,tom_cons_list_SequenceId(tom_make_MuVar("_x"),tom_empty_list_SequenceId())),tom_empty_list_Sequence()))) ; }private static  tom.library.sl.Strategy  tom_make_OnceTopDownId( tom.library.sl.Strategy  v) { return tom_make_mu(tom_make_MuVar("_x"),tom_cons_list_ChoiceId(v,tom_cons_list_ChoiceId(tom_make_OneId(tom_make_MuVar("_x")),tom_empty_list_ChoiceId()))) ; }   /* Generated by TOM (version 2.5): Do not edit this file *//* Generated by TOM (version 2.5): Do not edit this file */ /* Generated by TOM (version 2.5): Do not edit this file */   private static java.util.ArrayList concArrayListAppend(Object o, java.util.ArrayList l) {   java.util.ArrayList res = (java.util.ArrayList)l.clone();   res.add(o);   return res; } /* Generated by TOM (version 2.5): Do not edit this file *//* Generated by TOM (version 2.5): Do not edit this file */private static boolean tom_equal_term_HashSet(Object l1, Object l2) { return  l1.equals(l2) ;}private static boolean tom_is_sort_HashSet(Object t) { return  t instanceof java.util.HashSet ;}   private static java.util.HashSet hashSetAppend(Object o, java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   res.add(o);   return res; }  private static Object hashSetGetHead(java.util.HashSet s) {   java.util.Iterator it = s.iterator();   return it.next(); }  private static java.util.HashSet hashSetGetTail(java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   java.util.Iterator it = s.iterator();   res.remove(it.next());   return res; } private static boolean tom_is_sort_TomOptimizer(Object t) { return 





 t instanceof TomOptimizer ;}


  /** some output suffixes */
  private static final String OPTIMIZED_SUFFIX = ".tfix.optimized";

  /** the declared options string*/
  private static final String DECLARED_OPTIONS = "<options>" + 
    "<boolean name='optimize' altName='O' description='Optimized generated code' value='false'/>" +
    "<boolean name='optimize2' altName='O2' description='Optimized generated code' value='false'/>" +
    "<boolean name='prettyPIL' altName='pil' description='PrettyPrint IL' value='false'/>" +
    "</options>";

  public void optionChanged(String optionName, Object optionValue) {
    if(optionName.equals("optimize2") && ((Boolean)optionValue).booleanValue() ) { 
      setOptionValue("pretty", Boolean.TRUE);        
    }
  }

  // this static field is necessary for %strategy instructions that generate static code
  private static PILFactory factory = new PILFactory();
  private static Logger logger = Logger.getLogger("tom.engine.optimizer.TomOptimizer");

  /** Constructor */
  public TomOptimizer() {
    super("TomOptimizer");
  }

  public void run() {
    if(getOptionBooleanValue("optimize") || getOptionBooleanValue("optimize2")) {
      // Initialize strategies

      Strategy optStrategy2 = tom_cons_list_Sequence(tom_make_InnermostId(tom_cons_list_ChoiceId(tom_make_RepeatId(tom_make_NopElimAndFlatten()),tom_cons_list_ChoiceId(tom_make_NormExpr(this),tom_empty_list_ChoiceId()))),tom_cons_list_Sequence(tom_make_InnermostId(tom_cons_list_ChoiceId(tom_cons_list_Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),tom_cons_list_Sequence(tom_make_RepeatId(tom_cons_list_SequenceId(tom_cons_list_ChoiceId(tom_make_BlockFusion(),tom_cons_list_ChoiceId(tom_make_IfFusion(),tom_empty_list_ChoiceId())),tom_cons_list_SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),tom_empty_list_SequenceId()))),tom_empty_list_Sequence())),tom_cons_list_ChoiceId(tom_cons_list_SequenceId(tom_make_InterBlock(this),tom_cons_list_SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),tom_empty_list_SequenceId())),tom_empty_list_ChoiceId()))
            )
          ,tom_empty_list_Sequence()))






;

      long startChrono = System.currentTimeMillis();
      boolean intermediate = getOptionBooleanValue("intermediate");
      try {
        TomTerm renamedTerm = (TomTerm)getWorkingTerm();

        if(getOptionBooleanValue("optimize2")) {          
          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
          renamedTerm = (TomTerm) tom_make_InnermostId(tom_make_Inline(tom_empty_list_concTomTerm())).visitLight(renamedTerm);
          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
        } else {
          if(getOptionBooleanValue("optimize")) {
            renamedTerm = (TomTerm) tom_make_InnermostId(tom_make_Inline(tom_empty_list_concTomTerm())).visitLight(renamedTerm);
          }
        }
        setWorkingTerm(renamedTerm);

        // verbose
        logger.log(Level.INFO, TomMessage.tomOptimizationPhase.getMessage(),
            new Integer((int)(System.currentTimeMillis()-startChrono)) );
      } catch (Exception e) {
        logger.log( Level.SEVERE, TomMessage.exceptionMessage.getMessage(),
            new Object[]{"TomOptimizer", getStreamManager().getInputFileName(), e.getMessage()} );

        e.printStackTrace();
        return;
      }
      if(intermediate) {
        Tools.generateOutput(getStreamManager().getOutputFileName() + OPTIMIZED_SUFFIX, 
            (TomTerm)getWorkingTerm() );
      }
    } else {
      // not active plugin
      logger.log(Level.INFO, "The optimizer is not activated and thus WILL NOT RUN.");
    }
    if(getOptionBooleanValue("prettyPIL")) {
      System.out.println(factory.prettyPrintCompiledMatch(factory.remove((TomTerm)getWorkingTerm())));
    }

  }

  public PlatformOptionList getDeclaredOptionList() {
    return OptionParser.xmlToOptionList(TomOptimizer.DECLARED_OPTIONS);
  }

  private static String extractRealName(String name) {
    if(name.startsWith("tom_")) {
      return name.substring(4);
    }
    return name;
  }

  private static class findRefVariable extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  java.util.HashSet  set; public findRefVariable( java.util.HashSet  set) { super(tom_make_Identity());this.set=set;}public  java.util.HashSet  getset() { return set;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);if (tom_is_fun_sym_Ref(tomMatch210NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch210NameNumber_freshVar_0=tom_get_slot_Ref_TomTerm(tomMatch210NameNumberfreshSubject_1);{ boolean tomMatch210NameNumber_freshVar_2= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch210NameNumber_freshVar_1= null ;if (tom_is_fun_sym_Variable(tomMatch210NameNumber_freshVar_0)) {{tomMatch210NameNumber_freshVar_2= true ;tomMatch210NameNumber_freshVar_1=tom_get_slot_Variable_AstName(tomMatch210NameNumber_freshVar_0);}} else {if (tom_is_fun_sym_VariableStar(tomMatch210NameNumber_freshVar_0)) {{tomMatch210NameNumber_freshVar_2= true ;tomMatch210NameNumber_freshVar_1=tom_get_slot_VariableStar_AstName(tomMatch210NameNumber_freshVar_0);}}}if ((tomMatch210NameNumber_freshVar_2 ==  true )) {if ( true ) {


        set.add(tomMatch210NameNumber_freshVar_1);
        //stop to visit this branch (like "return false" with traversal) 
        throw new tom.library.sl.VisitFailure();
      }}}}}}}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_findRefVariable( java.util.HashSet  t0) { return new findRefVariable(t0); }




  /* strategies for LetRef inlining */
  // comp = special( comp, basecase(comp,fail()) )
  private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRef( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) { return tom_make_Try(tom_make_mu(tom_make_MuVar("comp"),tom_make_computeOccurencesLetRefSpecialCase(tom_make_MuVar("comp"),tom_make_computeOccurencesLetRefBaseCase(tom_make_All(tom_make_MuVar("comp")),variableName,info),variableName,info)
         ))












    ; }




  private static class InfoVariableLetRef {

    public tom.library.sl.Position lastRead;
    public Expression lastAssignment;
    public HashSet<TomName> lastAssignmentVariables= new HashSet();
    public int readCount=0;

    public void setlastvalue(Expression newassignment) {
      lastAssignment=newassignment;
      lastAssignmentVariables.clear();
      try {
        tom_make_TopDownCollect(tom_make_findRefVariable(lastAssignmentVariables)).visitLight(newassignment);
      } catch(tom.library.sl.VisitFailure e) {
        logger.log( Level.SEVERE, "Error during collecting variables in "+newassignment);
      }
    }

    public InfoVariableLetRef() {}

    public InfoVariableLetRef(Expression lastAssignment) {
      setlastvalue(lastAssignment);
    } 

  }


  //case where failure is used to cut branches
  // FIXME: tom should accept "extends [variable]", replace "Sequence(defaultCase,Identity())" by "defaultCase" when possible
  private static class computeOccurencesLetRefSpecialCase extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.library.sl.Strategy  goOnCase; private  tom.library.sl.Strategy  defaultCase; private  tom.engine.adt.tomname.types.TomName  variableName; private  InfoVariableLetRef  info; public computeOccurencesLetRefSpecialCase( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) { super(tom_cons_list_Sequence(defaultCase,tom_cons_list_Sequence(tom_make_Identity(),tom_empty_list_Sequence())));this.goOnCase=goOnCase;this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() { return goOnCase;}public  tom.library.sl.Strategy  getdefaultCase() { return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() { return variableName;}public  InfoVariableLetRef  getinfo() { return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 3; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_TypedAction(tomMatch211NameNumberfreshSubject_1)) {if ( true ) {


        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}if (tom_is_fun_sym_LetAssign(tomMatch211NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch211NameNumber_freshVar_0=tom_get_slot_LetAssign_Variable(tomMatch211NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch211NameNumber_freshVar_1=tom_get_slot_LetAssign_Source(tomMatch211NameNumberfreshSubject_1);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch211NameNumber_freshVar_2=tom_get_slot_LetAssign_AstInstruction(tomMatch211NameNumberfreshSubject_1);if (tom_is_fun_sym_Variable(tomMatch211NameNumber_freshVar_0)) {{  tom.engine.adt.tomname.types.TomName  tomMatch211NameNumber_freshVar_3=tom_get_slot_Variable_AstName(tomMatch211NameNumber_freshVar_0);{  tom.engine.adt.tomname.types.TomName  tom_varname=tomMatch211NameNumber_freshVar_3;if ( true ) {


        if (tom_varname.equals(variableName)) {
          info.setlastvalue(tomMatch211NameNumber_freshVar_1);
        }
        else {
          if (info.lastAssignmentVariables.contains(tom_varname)) {
            info.lastAssignment = null;
            info.lastAssignmentVariables.clear();
          }
        }
        /* recursive call of the current strategy on src */
        Environment current = getEnvironment();
        current.down(2);
        goOnCase.visit(current);
        current.up();
        /* recursive call of the current strategy on inst */
        current.down(3);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}}}}if (tom_is_fun_sym_Assign(tomMatch211NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch211NameNumber_freshVar_4=tom_get_slot_Assign_Variable(tomMatch211NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch211NameNumber_freshVar_5=tom_get_slot_Assign_Source(tomMatch211NameNumberfreshSubject_1);if (tom_is_fun_sym_Variable(tomMatch211NameNumber_freshVar_4)) {{  tom.engine.adt.tomname.types.TomName  tomMatch211NameNumber_freshVar_6=tom_get_slot_Variable_AstName(tomMatch211NameNumber_freshVar_4);{  tom.engine.adt.tomname.types.TomName  tom_varname=tomMatch211NameNumber_freshVar_6;if ( true ) {



        if (tom_varname.equals(variableName)) {
          info.setlastvalue(tomMatch211NameNumber_freshVar_5);
        } else {
          if (info.lastAssignmentVariables.contains(tom_varname)) {
            info.lastAssignment = null;
            info.lastAssignmentVariables.clear();
          }
        }
        /* recursive call of the current strategy on src */
        Environment current = getEnvironment();
        current.down(2);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRefSpecialCase( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariableLetRef  t3) { return new computeOccurencesLetRefSpecialCase(t0,t1,t2,t3); }




  // FIXME: tom should accept "extends [variable]", replace "Sequence(defaultCase,Identity())" by "defaultCase" when possible
  private static class computeOccurencesLetRefBaseCase extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.library.sl.Strategy  defaultCase; private  tom.engine.adt.tomname.types.TomName  variableName; private  InfoVariableLetRef  info; public computeOccurencesLetRefBaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLetRef  info) { super(tom_cons_list_Sequence(defaultCase,tom_cons_list_Sequence(tom_make_Identity(),tom_empty_list_Sequence())));this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() { return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() { return variableName;}public  InfoVariableLetRef  getinfo() { return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 2; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch212NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{ boolean tomMatch212NameNumber_freshVar_1= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch212NameNumber_freshVar_0= null ;if (tom_is_fun_sym_Variable(tomMatch212NameNumberfreshSubject_1)) {{tomMatch212NameNumber_freshVar_1= true ;tomMatch212NameNumber_freshVar_0=tom_get_slot_Variable_AstName(tomMatch212NameNumberfreshSubject_1);}} else {if (tom_is_fun_sym_VariableStar(tomMatch212NameNumberfreshSubject_1)) {{tomMatch212NameNumber_freshVar_1= true ;tomMatch212NameNumber_freshVar_0=tom_get_slot_VariableStar_AstName(tomMatch212NameNumberfreshSubject_1);}}}if ((tomMatch212NameNumber_freshVar_1 ==  true )) {if ( true ) {

 
        if(variableName == tomMatch212NameNumber_freshVar_0) {
          info.readCount++;
          info.lastRead=getEnvironment().getPosition(); 
          if (info.readCount==2) { throw new VisitFailure(); }
        }  
      }}}}}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRefBaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariableLetRef  t2) { return new computeOccurencesLetRefBaseCase(t0,t1,t2); }



  /* strategies for Let inlining */
  // comp = special1(special2(all(comp),base(all(comp),fail())),fail())
  private static  tom.library.sl.Strategy  tom_make_computeOccurencesLet( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) { return tom_make_Try(tom_make_mu(tom_make_MuVar("comp"),tom_make_computeOccurencesLetSpecialCase1(tom_make_computeOccurencesLetSpecialCase2(tom_make_MuVar("comp"),tom_make_computeOccurencesLetBaseCase(tom_make_All(tom_make_MuVar("comp")),variableName,info),variableName,info),info)
          ))













 
    ; }






  private static class InfoVariableLet {

    public tom.library.sl.Position lastRead;
    public HashSet<TomName> assignmentVariables= new HashSet();
    public int readCount=0;
    public boolean modifiedAssignmentVariables=false;

    public void setlastvalue(Expression newassignment) {
      assignmentVariables.clear();
      try {
        tom_make_TopDownCollect(tom_make_findRefVariable(assignmentVariables)).visitLight(newassignment);
      } catch(tom.library.sl.VisitFailure e) {
        logger.log( Level.SEVERE, "Error during collecting variables in "+newassignment);
      }
    }

    public InfoVariableLet(Expression assignment) { setlastvalue(assignment); } 

    public InfoVariableLet() {}

  }

  // FIXME: tom should accept "extends [variable]", replace "Sequence(defaultCase,Identity())" by "defaultCase" when possible
  private static class computeOccurencesLetSpecialCase1 extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.library.sl.Strategy  defaultCase; private  InfoVariableLet  info; public computeOccurencesLetSpecialCase1( tom.library.sl.Strategy  defaultCase,  InfoVariableLet  info) { super(tom_cons_list_Sequence(defaultCase,tom_cons_list_Sequence(tom_make_Identity(),tom_empty_list_Sequence())));this.defaultCase=defaultCase;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() { return defaultCase;}public  InfoVariableLet  getinfo() { return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 2; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch213NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);{ boolean tomMatch213NameNumber_freshVar_2= false ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch213NameNumber_freshVar_0= null ;if (tom_is_fun_sym_Assign(tomMatch213NameNumberfreshSubject_1)) {{tomMatch213NameNumber_freshVar_2= true ;tomMatch213NameNumber_freshVar_0=tom_get_slot_Assign_Variable(tomMatch213NameNumberfreshSubject_1);}} else {if (tom_is_fun_sym_LetAssign(tomMatch213NameNumberfreshSubject_1)) {{tomMatch213NameNumber_freshVar_2= true ;tomMatch213NameNumber_freshVar_0=tom_get_slot_LetAssign_Variable(tomMatch213NameNumberfreshSubject_1);}}}if ((tomMatch213NameNumber_freshVar_2 ==  true )) {if (tom_is_fun_sym_Variable(tomMatch213NameNumber_freshVar_0)) {{  tom.engine.adt.tomname.types.TomName  tomMatch213NameNumber_freshVar_1=tom_get_slot_Variable_AstName(tomMatch213NameNumber_freshVar_0);if ( true ) {


        if (info.assignmentVariables.contains(tomMatch213NameNumber_freshVar_1)) {
          info.modifiedAssignmentVariables=true;
          throw new tom.library.sl.VisitFailure();
        }
      }}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetSpecialCase1( tom.library.sl.Strategy  t0,  InfoVariableLet  t1) { return new computeOccurencesLetSpecialCase1(t0,t1); }

 

  // FIXME: tom should accept "extends [variable]", replace "Sequence(cutCase,Identity())" by "cutCase" when possible
  private static class computeOccurencesLetSpecialCase2 extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.library.sl.Strategy  goOnCase; private  tom.library.sl.Strategy  cutCase; private  tom.engine.adt.tomname.types.TomName  variableName; private  InfoVariableLet  info; public computeOccurencesLetSpecialCase2( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  cutCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) { super(tom_cons_list_Sequence(cutCase,tom_cons_list_Sequence(tom_make_Identity(),tom_empty_list_Sequence())));this.goOnCase=goOnCase;this.cutCase=cutCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() { return goOnCase;}public  tom.library.sl.Strategy  getcutCase() { return cutCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() { return variableName;}public  InfoVariableLet  getinfo() { return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 3; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getcutCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: cutCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch214NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_TypedAction(tomMatch214NameNumberfreshSubject_1)) {if ( true ) {


        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        goOnCase.visit(current);
        current.up();
        return (Instruction) current.getSubject();
      }}{ boolean tomMatch214NameNumber_freshVar_2= false ;{  tom.engine.adt.tomterm.types.TomTerm  tomMatch214NameNumber_freshVar_0= null ;if (tom_is_fun_sym_Assign(tomMatch214NameNumberfreshSubject_1)) {{tomMatch214NameNumber_freshVar_2= true ;tomMatch214NameNumber_freshVar_0=tom_get_slot_Assign_Variable(tomMatch214NameNumberfreshSubject_1);}} else {if (tom_is_fun_sym_LetAssign(tomMatch214NameNumberfreshSubject_1)) {{tomMatch214NameNumber_freshVar_2= true ;tomMatch214NameNumber_freshVar_0=tom_get_slot_LetAssign_Variable(tomMatch214NameNumberfreshSubject_1);}}}if ((tomMatch214NameNumber_freshVar_2 ==  true )) {if (tom_is_fun_sym_Variable(tomMatch214NameNumber_freshVar_0)) {{  tom.engine.adt.tomname.types.TomName  tomMatch214NameNumber_freshVar_1=tom_get_slot_Variable_AstName(tomMatch214NameNumber_freshVar_0);if ( true ) {



        if (variableName.equals(tomMatch214NameNumber_freshVar_1)) {
          logger.log( Level.SEVERE, "TomOptimizer: Assignment cannot be done for the variable "+variableName+" declared in a let", new Object[]{} );
        }
      }}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetSpecialCase2( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariableLet  t3) { return new computeOccurencesLetSpecialCase2(t0,t1,t2,t3); }



  // FIXME: tom should accept "extends [variable]", replace "Sequence(cutCase,Identity())" by "cutCase" when possible
  private static class computeOccurencesLetBaseCase extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.library.sl.Strategy  defaultCase; private  tom.engine.adt.tomname.types.TomName  variableName; private  InfoVariableLet  info; public computeOccurencesLetBaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariableLet  info) { super(tom_cons_list_Sequence(defaultCase,tom_cons_list_Sequence(tom_make_Identity(),tom_empty_list_Sequence())));this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() { return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() { return variableName;}public  InfoVariableLet  getinfo() { return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 2; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch215NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{ boolean tomMatch215NameNumber_freshVar_1= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch215NameNumber_freshVar_0= null ;if (tom_is_fun_sym_Variable(tomMatch215NameNumberfreshSubject_1)) {{tomMatch215NameNumber_freshVar_1= true ;tomMatch215NameNumber_freshVar_0=tom_get_slot_Variable_AstName(tomMatch215NameNumberfreshSubject_1);}} else {if (tom_is_fun_sym_VariableStar(tomMatch215NameNumberfreshSubject_1)) {{tomMatch215NameNumber_freshVar_1= true ;tomMatch215NameNumber_freshVar_0=tom_get_slot_VariableStar_AstName(tomMatch215NameNumberfreshSubject_1);}}}if ((tomMatch215NameNumber_freshVar_1 ==  true )) {if ( true ) {

 
        if(variableName == tomMatch215NameNumber_freshVar_0) {
          info.readCount++;
          info.lastRead = getEnvironment().getPosition(); 
          if (info.readCount==2) { throw new VisitFailure(); }
        } 
      }}}}}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_computeOccurencesLetBaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariableLet  t2) { return new computeOccurencesLetBaseCase(t0,t1,t2); }



  /* 
   * rename variable1 into variable2
   */
  private static  tom.library.sl.Strategy  tom_make_renameVariable( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) { return tom_make_TopDown(tom_make_renameVariableOnce(variable1,variable2))
; }private static class renameVariableOnce extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.engine.adt.tomname.types.TomName  variable1; private  tom.engine.adt.tomname.types.TomName  variable2; public renameVariableOnce( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) { super(tom_make_Identity());this.variable1=variable1;this.variable2=variable2;}public  tom.engine.adt.tomname.types.TomName  getvariable1() { return variable1;}public  tom.engine.adt.tomname.types.TomName  getvariable2() { return variable2;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch216NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);{ boolean tomMatch216NameNumber_freshVar_1= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch216NameNumber_freshVar_0= null ;if (tom_is_fun_sym_Variable(tomMatch216NameNumberfreshSubject_1)) {{tomMatch216NameNumber_freshVar_1= true ;tomMatch216NameNumber_freshVar_0=tom_get_slot_Variable_AstName(tomMatch216NameNumberfreshSubject_1);}} else {if (tom_is_fun_sym_VariableStar(tomMatch216NameNumberfreshSubject_1)) {{tomMatch216NameNumber_freshVar_1= true ;tomMatch216NameNumber_freshVar_0=tom_get_slot_VariableStar_AstName(tomMatch216NameNumberfreshSubject_1);}}}if ((tomMatch216NameNumber_freshVar_1 ==  true )) {if ( true ) {





        if(variable1 == tomMatch216NameNumber_freshVar_0) {
          return tomMatch216NameNumberfreshSubject_1.setAstName(variable2);
        }
      }}}}}}return super.visit_TomTerm(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_renameVariableOnce( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomname.types.TomName  t1) { return new renameVariableOnce(t0,t1); }private static  tom.library.sl.Strategy  tom_make_CleanAssign( tom.engine.adt.tomname.types.TomName  varname) { return tom_make_TopDown(tom_make_CleanAssignOnce(varname))




; }private static class CleanAssignOnce extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.engine.adt.tomname.types.TomName  varname; public CleanAssignOnce( tom.engine.adt.tomname.types.TomName  varname) { super(tom_make_Identity());this.varname=varname;}public  tom.engine.adt.tomname.types.TomName  getvarname() { return varname;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch217NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_LetAssign(tomMatch217NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch217NameNumber_freshVar_0=tom_get_slot_LetAssign_Variable(tomMatch217NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch217NameNumber_freshVar_1=tom_get_slot_LetAssign_Source(tomMatch217NameNumberfreshSubject_1);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch217NameNumber_freshVar_2=tom_get_slot_LetAssign_AstInstruction(tomMatch217NameNumberfreshSubject_1);{ boolean tomMatch217NameNumber_freshVar_4= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch217NameNumber_freshVar_3= null ;if (tom_is_fun_sym_Variable(tomMatch217NameNumber_freshVar_0)) {{tomMatch217NameNumber_freshVar_4= true ;tomMatch217NameNumber_freshVar_3=tom_get_slot_Variable_AstName(tomMatch217NameNumber_freshVar_0);}} else {if (tom_is_fun_sym_VariableStar(tomMatch217NameNumber_freshVar_0)) {{tomMatch217NameNumber_freshVar_4= true ;tomMatch217NameNumber_freshVar_3=tom_get_slot_VariableStar_AstName(tomMatch217NameNumber_freshVar_0);}}}if ((tomMatch217NameNumber_freshVar_4 ==  true )) {if ( true ) {





        if (tomMatch217NameNumber_freshVar_3.equals(varname)) { return tomMatch217NameNumber_freshVar_2; }
      }}}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_CleanAssignOnce( tom.engine.adt.tomname.types.TomName  t0) { return new CleanAssignOnce(t0); }



  private static boolean compare(tom.library.sl.Visitable term1, tom.library.sl.Visitable term2) {
    return factory.remove(term1)==factory.remove(term2);
  }

  private static class Inline extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  tom.engine.adt.tomterm.types.TomList  context; public Inline( tom.engine.adt.tomterm.types.TomList  context) { super(tom_make_Identity());this.context=context;}public  tom.engine.adt.tomterm.types.TomList  getcontext() { return context;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_TomTerm(tom__arg)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumberfreshSubject_1=(( tom.engine.adt.tomterm.types.TomTerm )tom__arg);if (tom_is_fun_sym_ExpressionToTomTerm(tomMatch218NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch218NameNumber_freshVar_0=tom_get_slot_ExpressionToTomTerm_AstExpression(tomMatch218NameNumberfreshSubject_1);if (tom_is_fun_sym_TomTermToExpression(tomMatch218NameNumber_freshVar_0)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_1=tom_get_slot_TomTermToExpression_AstTerm(tomMatch218NameNumber_freshVar_0);if ( true ) {

 return tomMatch218NameNumber_freshVar_1; }}}}}if (tom_is_fun_sym_BuildAppendList(tomMatch218NameNumberfreshSubject_1)) {{  tom.engine.adt.tomname.types.TomName  tomMatch218NameNumber_freshVar_2=tom_get_slot_BuildAppendList_AstName(tomMatch218NameNumberfreshSubject_1);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_3=tom_get_slot_BuildAppendList_HeadTerm(tomMatch218NameNumberfreshSubject_1);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_4=tom_get_slot_BuildAppendList_TailTerm(tomMatch218NameNumberfreshSubject_1);{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch218NameNumber_freshVar_2;if (tom_is_fun_sym_ExpressionToTomTerm(tomMatch218NameNumber_freshVar_3)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch218NameNumber_freshVar_5=tom_get_slot_ExpressionToTomTerm_AstExpression(tomMatch218NameNumber_freshVar_3);if (tom_is_fun_sym_GetSliceList(tomMatch218NameNumber_freshVar_5)) {{  tom.engine.adt.tomname.types.TomName  tomMatch218NameNumber_freshVar_6=tom_get_slot_GetSliceList_AstName(tomMatch218NameNumber_freshVar_5);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_7=tom_get_slot_GetSliceList_VariableBeginAST(tomMatch218NameNumber_freshVar_5);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_8=tom_get_slot_GetSliceList_VariableEndAST(tomMatch218NameNumber_freshVar_5);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch218NameNumber_freshVar_9=tom_get_slot_GetSliceList_Tail(tomMatch218NameNumber_freshVar_5);if (tom_equal_term_TomName(tomMatch218NameNumber_freshVar_2, tomMatch218NameNumber_freshVar_6)) {if ( true ) {



        return tom_make_ExpressionToTomTerm(tom_make_GetSliceList(tom_name,tomMatch218NameNumber_freshVar_7,tomMatch218NameNumber_freshVar_8,tom_make_BuildAppendList(tom_name,tomMatch218NameNumber_freshVar_9,tomMatch218NameNumber_freshVar_4)));
      }}}}}}}}}}}}}}}}return super.visit_TomTerm(tom__arg); }public  tom.engine.adt.tomexpression.types.Expression  visit_Expression( tom.engine.adt.tomexpression.types.Expression  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Expression(tom__arg)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch219NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);if (tom_is_fun_sym_TomTermToExpression(tomMatch219NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch219NameNumber_freshVar_0=tom_get_slot_TomTermToExpression_AstTerm(tomMatch219NameNumberfreshSubject_1);if (tom_is_fun_sym_ExpressionToTomTerm(tomMatch219NameNumber_freshVar_0)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch219NameNumber_freshVar_1=tom_get_slot_ExpressionToTomTerm_AstExpression(tomMatch219NameNumber_freshVar_0);if ( true ) {



 return tomMatch219NameNumber_freshVar_1; }}}}}}}return super.visit_Expression(tom__arg); }public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch222NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_TypedAction(tomMatch222NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.Pattern  tomMatch222NameNumber_freshVar_0=tom_get_slot_TypedAction_PositivePattern(tomMatch222NameNumberfreshSubject_1);if (tom_is_fun_sym_Pattern(tomMatch222NameNumber_freshVar_0)) {{  tom.engine.adt.tomterm.types.TomList  tomMatch222NameNumber_freshVar_1=tom_get_slot_Pattern_TomList(tomMatch222NameNumber_freshVar_0);if ( true ) {





        context = tomMatch222NameNumber_freshVar_1;
        //System.out.println("found context = " + context);
        return tomMatch222NameNumberfreshSubject_1;
      }}}}}if (tom_is_fun_sym_LetRef(tomMatch222NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch222NameNumber_freshVar_2=tom_get_slot_LetRef_Variable(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch222NameNumber_freshVar_3=tom_get_slot_LetRef_Source(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch222NameNumber_freshVar_4=tom_get_slot_LetRef_AstInstruction(tomMatch222NameNumberfreshSubject_1);{ boolean tomMatch222NameNumber_freshVar_7= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch222NameNumber_freshVar_5= null ;if (tom_is_fun_sym_Variable(tomMatch222NameNumber_freshVar_2)) {{tomMatch222NameNumber_freshVar_7= true ;tomMatch222NameNumber_freshVar_5=tom_get_slot_Variable_AstName(tomMatch222NameNumber_freshVar_2);}} else {if (tom_is_fun_sym_VariableStar(tomMatch222NameNumber_freshVar_2)) {{tomMatch222NameNumber_freshVar_7= true ;tomMatch222NameNumber_freshVar_5=tom_get_slot_VariableStar_AstName(tomMatch222NameNumber_freshVar_2);}}}if ((tomMatch222NameNumber_freshVar_7 ==  true )) {if (tom_is_fun_sym_Name(tomMatch222NameNumber_freshVar_5)) {{  String  tomMatch222NameNumber_freshVar_6=tom_get_slot_Name_String(tomMatch222NameNumber_freshVar_5);{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch222NameNumber_freshVar_5;{  tom.engine.adt.tominstruction.types.Instruction  tom_body=tomMatch222NameNumber_freshVar_4;if ( true ) {







        /*
         * do not optimize Variable(TomNumber...) because LetRef X*=GetTail(X*) in ...
         * is not correctly handled 
         * we must check that X notin exp
         */
        String varName = "";
        if (tom_is_sort_TomName(tom_name)) {{  tom.engine.adt.tomname.types.TomName  tomMatch220NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )tom_name);if (tom_is_fun_sym_Name(tomMatch220NameNumberfreshSubject_1)) {{  String  tomMatch220NameNumber_freshVar_0=tom_get_slot_Name_String(tomMatch220NameNumberfreshSubject_1);if ( true ) { varName = tomMatch220NameNumber_freshVar_0; }}}}}

        //`findOccurencesUpTo(name,list,2).visitLight(`body);
        InfoVariableLetRef info = new InfoVariableLetRef(tomMatch222NameNumber_freshVar_3);
        tom_make_computeOccurencesLetRef(tom_name,info).visit(tom_body);
        int mult = info.readCount;
        tom.library.sl.Position readPos = info.lastRead;
        TomTerm value = tom_make_ExpressionToTomTerm(info.lastAssignment);
        // 0 -> unused variable
        // suppress the letref and all the corresponding letassigns in the body
        if(mult == 0) {
          // why this test?
          if(varName.length() > 0) {
            // TODO: check variable occurence in TypedAction
            info = new InfoVariableLetRef();
            tom_make_computeOccurencesLetRef(tom_name,info).visit(context);
            if(info.readCount<=1) {
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch222NameNumber_freshVar_2.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,extractRealName(varName));
              logger.log( Level.INFO,
                  TomMessage.remove.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
          }
          //remove all the unused letassign in the letref body
          return (Instruction) tom_make_CleanAssign(tom_name).visitLight(tom_body);
        } else if(mult == 1) {
          //  `findOccurencesUpTo(name,list,2).visitLight(`exp);
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the read
          if(info.lastAssignment!=null) {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.inline.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
            //System.out.println("replace1: " + `var + "\nby: " + `exp);
            return (Instruction) tom_cons_list_Sequence(readPos.getReplace(value),tom_cons_list_Sequence(tom_make_CleanAssign(tom_name),tom_empty_list_Sequence())).visitLight(tom_body);
          } else {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.noInline.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
          }
        } else {
          /* do nothing: traversal() */
          if(varName.length() > 0) {
            logger.log( Level.INFO,
                TomMessage.doNothing.getMessage(),
                new Object[]{ new Integer(mult), extractRealName(varName) });
          }
        }
      }}}}}}}}}}}}if (tom_is_fun_sym_Let(tomMatch222NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch222NameNumber_freshVar_8=tom_get_slot_Let_Variable(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch222NameNumber_freshVar_9=tom_get_slot_Let_Source(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch222NameNumber_freshVar_10=tom_get_slot_Let_AstInstruction(tomMatch222NameNumberfreshSubject_1);{ boolean tomMatch222NameNumber_freshVar_13= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch222NameNumber_freshVar_11= null ;if (tom_is_fun_sym_Variable(tomMatch222NameNumber_freshVar_8)) {{tomMatch222NameNumber_freshVar_13= true ;tomMatch222NameNumber_freshVar_11=tom_get_slot_Variable_AstName(tomMatch222NameNumber_freshVar_8);}} else {if (tom_is_fun_sym_VariableStar(tomMatch222NameNumber_freshVar_8)) {{tomMatch222NameNumber_freshVar_13= true ;tomMatch222NameNumber_freshVar_11=tom_get_slot_VariableStar_AstName(tomMatch222NameNumber_freshVar_8);}}}if ((tomMatch222NameNumber_freshVar_13 ==  true )) {if (tom_is_fun_sym_Name(tomMatch222NameNumber_freshVar_11)) {{  String  tomMatch222NameNumber_freshVar_12=tom_get_slot_Name_String(tomMatch222NameNumber_freshVar_11);{  tom.engine.adt.tomname.types.TomName  tom_name=tomMatch222NameNumber_freshVar_11;{  tom.engine.adt.tomexpression.types.Expression  tom_exp=tomMatch222NameNumber_freshVar_9;{  tom.engine.adt.tominstruction.types.Instruction  tom_body=tomMatch222NameNumber_freshVar_10;if ( true ) {







        /*
         * do not optimize Variable(TomNumber...) because LetRef X*=GetTail(X*) in ...
         * is not correctly handled 
         * we must check that X notin exp
         */
        String varName = "";
        if (tom_is_sort_TomName(tom_name)) {{  tom.engine.adt.tomname.types.TomName  tomMatch221NameNumberfreshSubject_1=(( tom.engine.adt.tomname.types.TomName )tom_name);if (tom_is_fun_sym_Name(tomMatch221NameNumberfreshSubject_1)) {{  String  tomMatch221NameNumber_freshVar_0=tom_get_slot_Name_String(tomMatch221NameNumberfreshSubject_1);if ( true ) {
 varName = tomMatch221NameNumber_freshVar_0; }}}}}


        //`findOccurencesUpTo(name,list,2).visitLight(`body);
        InfoVariableLet info = new InfoVariableLet(tom_exp);
        tom_make_computeOccurencesLet(tom_name,info).visit(tom_body);
        int mult = info.readCount;
        tom.library.sl.Position readPos = info.lastRead;
        // 0 -> unused variable
        // suppress the letref and all the corresponding letassigns in the body
        if(mult == 0) {
          // why this test?
          if(varName.length() > 0) {
            // TODO: check variable occurence in TypedAction
            info = new InfoVariableLet();
            tom_make_computeOccurencesLet(tom_name,info).visit(context);
            if(info.readCount<=1) {
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch222NameNumber_freshVar_8.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,extractRealName(varName));
              logger.log( Level.INFO,
                  TomMessage.remove.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
          }
          //remove all the unused letassign in the letref body
          return tom_body;
        } else if(mult == 1) {
          //  `findOccurencesUpTo(name,list,2).visitLight(`exp);
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the read
          if(! info.modifiedAssignmentVariables) {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.inline.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
            return (Instruction) readPos.getReplace(tom_make_ExpressionToTomTerm(tom_exp)).visitLight(tom_body);
          } else {
            if(varName.length() > 0) {
              logger.log( Level.INFO,
                  TomMessage.noInline.getMessage(),
                  new Object[]{ new Integer(mult), extractRealName(varName) });
            }
          }
        } else {
          /* do nothing: traversal() */
          if(varName.length() > 0) {
            logger.log( Level.INFO,
                TomMessage.doNothing.getMessage(),
                new Object[]{ new Integer(mult), extractRealName(varName) });
          }
        }
      }}}}}}}}}}}}}if (tom_is_fun_sym_Let(tomMatch222NameNumberfreshSubject_1)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch222NameNumber_freshVar_14=tom_get_slot_Let_Variable(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch222NameNumber_freshVar_15=tom_get_slot_Let_Source(tomMatch222NameNumberfreshSubject_1);{  tom.engine.adt.tominstruction.types.Instruction  tomMatch222NameNumber_freshVar_16=tom_get_slot_Let_AstInstruction(tomMatch222NameNumberfreshSubject_1);{ boolean tomMatch222NameNumber_freshVar_17= false ;if (tom_is_fun_sym_UnamedVariable(tomMatch222NameNumber_freshVar_14)) {tomMatch222NameNumber_freshVar_17= true ;} else {if (tom_is_fun_sym_UnamedVariableStar(tomMatch222NameNumber_freshVar_14)) {tomMatch222NameNumber_freshVar_17= true ;}}if ((tomMatch222NameNumber_freshVar_17 ==  true )) {if ( true ) {


        return tomMatch222NameNumber_freshVar_16; 
      }}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_Inline( tom.engine.adt.tomterm.types.TomList  t0) { return new Inline(t0); }private static class NopElimAndFlatten extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {public NopElimAndFlatten() { super(tom_make_Identity());}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch223NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_AbstractBlock(tomMatch223NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_0=tom_get_slot_AbstractBlock_InstList(tomMatch223NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch223NameNumber_freshVar_0)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_1=tomMatch223NameNumber_freshVar_0;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_begin_3=tomMatch223NameNumber_freshVar_1;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_end_4=tomMatch223NameNumber_freshVar_1;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_2=tomMatch223NameNumber_end_4;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_2))) {if (tom_is_fun_sym_AbstractBlock(tom_get_head_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_2))) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_25=tom_get_slot_AbstractBlock_InstList(tom_get_head_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_5=tom_get_tail_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_2);if ( true ) {








        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "flatten");     
        return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch223NameNumber_begin_3,tomMatch223NameNumber_end_4,tom_empty_list_concInstruction()),tom_append_list_concInstruction(tomMatch223NameNumber_freshVar_25,tom_append_list_concInstruction(tomMatch223NameNumber_freshVar_5,tom_empty_list_concInstruction()))));
      }}}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_end_4)) {tomMatch223NameNumber_end_4=tomMatch223NameNumber_begin_3;} else {tomMatch223NameNumber_end_4=tom_get_tail_concInstruction_InstructionList(tomMatch223NameNumber_end_4);}}} while(!(tom_equal_term_InstructionList(tomMatch223NameNumber_end_4, tomMatch223NameNumber_begin_3)));}}}}}}if (tom_is_fun_sym_AbstractBlock(tomMatch223NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_46=tom_get_slot_AbstractBlock_InstList(tomMatch223NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch223NameNumber_freshVar_46)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_47=tomMatch223NameNumber_freshVar_46;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_begin_49=tomMatch223NameNumber_freshVar_47;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_end_50=tomMatch223NameNumber_freshVar_47;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_48=tomMatch223NameNumber_end_50;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_48))) {if (tom_is_fun_sym_Nop(tom_get_head_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_48))) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_51=tom_get_tail_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_48);if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "nop-elim");     
        return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch223NameNumber_begin_49,tomMatch223NameNumber_end_50,tom_empty_list_concInstruction()),tom_append_list_concInstruction(tomMatch223NameNumber_freshVar_51,tom_empty_list_concInstruction())));
      }}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_end_50)) {tomMatch223NameNumber_end_50=tomMatch223NameNumber_begin_49;} else {tomMatch223NameNumber_end_50=tom_get_tail_concInstruction_InstructionList(tomMatch223NameNumber_end_50);}}} while(!(tom_equal_term_InstructionList(tomMatch223NameNumber_end_50, tomMatch223NameNumber_begin_49)));}}}}}}if (tom_is_fun_sym_AbstractBlock(tomMatch223NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_89=tom_get_slot_AbstractBlock_InstList(tomMatch223NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch223NameNumber_freshVar_89)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_90=tomMatch223NameNumber_freshVar_89;if (tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_90)) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "abstractblock-elim1");     
        return tom_make_Nop();
      }}}}}}if (tom_is_fun_sym_AbstractBlock(tomMatch223NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_91=tom_get_slot_AbstractBlock_InstList(tomMatch223NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch223NameNumber_freshVar_91)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_92=tomMatch223NameNumber_freshVar_91;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_92))) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch223NameNumber_freshVar_93=tom_get_tail_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_92);if (tom_is_empty_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_93)) {if ( true ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
            "abstractblock-elim2");     
        return tom_get_head_concInstruction_InstructionList(tomMatch223NameNumber_freshVar_92);
      }}}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_NopElimAndFlatten() { return new NopElimAndFlatten(); }




  /*
   * two expressions are incompatible when they cannot be true a the same time
   */ 
  private boolean incompatible(Expression c1, Expression c2) {
    try {
      Expression res = (Expression) tom_make_InnermostId(tom_make_NormExpr(this)).visitLight(tom_make_And(c1,c2));
      return res ==tom_make_FalseTL();
    } catch(tom.library.sl.VisitFailure e) {
      return false;
    }
  }

  private static class IfSwapping extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  TomOptimizer  optimizer; public IfSwapping( TomOptimizer  optimizer) { super(tom_make_Identity());this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() { return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch224NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_AbstractBlock(tomMatch224NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_freshVar_0=tom_get_slot_AbstractBlock_InstList(tomMatch224NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch224NameNumber_freshVar_0)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_freshVar_1=tomMatch224NameNumber_freshVar_0;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_begin_3=tomMatch224NameNumber_freshVar_1;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_end_4=tomMatch224NameNumber_freshVar_1;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_freshVar_2=tomMatch224NameNumber_end_4;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch224NameNumber_freshVar_29=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch224NameNumber_freshVar_30=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch224NameNumber_freshVar_31=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2));{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch224NameNumber_freshVar_29;if (tom_is_fun_sym_Nop(tomMatch224NameNumber_freshVar_31)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_freshVar_5=tom_get_tail_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2);if (!(tom_is_empty_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch224NameNumber_freshVar_32=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch224NameNumber_freshVar_33=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch224NameNumber_freshVar_34=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5));{  tom.engine.adt.tomexpression.types.Expression  tom_cond2=tomMatch224NameNumber_freshVar_32;if (tom_is_fun_sym_Nop(tomMatch224NameNumber_freshVar_34)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch224NameNumber_freshVar_6=tom_get_tail_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5);if ( true ) {


        String s1 = factory.prettyPrint(factory.remove(tom_cond1));
        String s2 = factory.prettyPrint(factory.remove(tom_cond2));
        if(s1.compareTo(s2) < 0) {
          /* swap two incompatible conditions */
          if(optimizer.incompatible(tom_cond1,tom_cond2)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), new Object[]{"if-swapping"});     
            return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch224NameNumber_begin_3,tomMatch224NameNumber_end_4,tom_empty_list_concInstruction()),tom_cons_list_concInstruction(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_5),tom_cons_list_concInstruction(tom_get_head_concInstruction_InstructionList(tomMatch224NameNumber_freshVar_2),tom_append_list_concInstruction(tomMatch224NameNumber_freshVar_6,tom_empty_list_concInstruction())))));
          }
        }
      }}}}}}}}}}}}}}}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch224NameNumber_end_4)) {tomMatch224NameNumber_end_4=tomMatch224NameNumber_begin_3;} else {tomMatch224NameNumber_end_4=tom_get_tail_concInstruction_InstructionList(tomMatch224NameNumber_end_4);}}} while(!(tom_equal_term_InstructionList(tomMatch224NameNumber_end_4, tomMatch224NameNumber_begin_3)));}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_IfSwapping( TomOptimizer  t0) { return new IfSwapping(t0); }private static class BlockFusion extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {public BlockFusion() { super(tom_make_Identity());}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch225NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_AbstractBlock(tomMatch225NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_freshVar_0=tom_get_slot_AbstractBlock_InstList(tomMatch225NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch225NameNumber_freshVar_0)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_freshVar_1=tomMatch225NameNumber_freshVar_0;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_begin_3=tomMatch225NameNumber_freshVar_1;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_end_4=tomMatch225NameNumber_freshVar_1;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch225NameNumber_begin_3,tomMatch225NameNumber_end_4,tom_empty_list_concInstruction());{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_freshVar_2=tomMatch225NameNumber_end_4;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2))) {if (tom_is_fun_sym_Let(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2))) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch225NameNumber_freshVar_29=tom_get_slot_Let_Variable(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2));{  tom.engine.adt.tomexpression.types.Expression  tomMatch225NameNumber_freshVar_30=tom_get_slot_Let_Source(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch225NameNumber_freshVar_31=tom_get_slot_Let_AstInstruction(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2));{ boolean tomMatch225NameNumber_freshVar_75= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch225NameNumber_freshVar_32= null ;if (tom_is_fun_sym_Variable(tomMatch225NameNumber_freshVar_29)) {{tomMatch225NameNumber_freshVar_75= true ;tomMatch225NameNumber_freshVar_32=tom_get_slot_Variable_AstName(tomMatch225NameNumber_freshVar_29);}} else {if (tom_is_fun_sym_VariableStar(tomMatch225NameNumber_freshVar_29)) {{tomMatch225NameNumber_freshVar_75= true ;tomMatch225NameNumber_freshVar_32=tom_get_slot_VariableStar_AstName(tomMatch225NameNumber_freshVar_29);}}}if ((tomMatch225NameNumber_freshVar_75 ==  true )) {{  tom.engine.adt.tomname.types.TomName  tom_name1=tomMatch225NameNumber_freshVar_32;{  tom.engine.adt.tomterm.types.TomTerm  tom_var1=tomMatch225NameNumber_freshVar_29;{  tom.engine.adt.tomexpression.types.Expression  tom_term1=tomMatch225NameNumber_freshVar_30;{  tom.engine.adt.tominstruction.types.Instruction  tom_body1=tomMatch225NameNumber_freshVar_31;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_freshVar_5=tom_get_tail_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_2);if (!(tom_is_empty_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5))) {if (tom_is_fun_sym_Let(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5))) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch225NameNumber_freshVar_33=tom_get_slot_Let_Variable(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5));{  tom.engine.adt.tomexpression.types.Expression  tomMatch225NameNumber_freshVar_34=tom_get_slot_Let_Source(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch225NameNumber_freshVar_35=tom_get_slot_Let_AstInstruction(tom_get_head_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5));{ boolean tomMatch225NameNumber_freshVar_74= false ;{  tom.engine.adt.tomname.types.TomName  tomMatch225NameNumber_freshVar_36= null ;if (tom_is_fun_sym_Variable(tomMatch225NameNumber_freshVar_33)) {{tomMatch225NameNumber_freshVar_74= true ;tomMatch225NameNumber_freshVar_36=tom_get_slot_Variable_AstName(tomMatch225NameNumber_freshVar_33);}} else {if (tom_is_fun_sym_VariableStar(tomMatch225NameNumber_freshVar_33)) {{tomMatch225NameNumber_freshVar_74= true ;tomMatch225NameNumber_freshVar_36=tom_get_slot_VariableStar_AstName(tomMatch225NameNumber_freshVar_33);}}}if ((tomMatch225NameNumber_freshVar_74 ==  true )) {{  tom.engine.adt.tominstruction.types.Instruction  tom_body2=tomMatch225NameNumber_freshVar_35;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch225NameNumber_freshVar_6=tom_get_tail_concInstruction_InstructionList(tomMatch225NameNumber_freshVar_5);{  tom.engine.adt.tominstruction.types.InstructionList  tom_X2=tomMatch225NameNumber_freshVar_6;if ( true ) {









        /* Fusion de 2 blocs Let contigus instanciant deux variables egales */
        if(compare(tom_term1,tomMatch225NameNumber_freshVar_34)) {
          if(compare(tom_var1,tomMatch225NameNumber_freshVar_33)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{"block-fusion1"});     
            return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_X1,tom_cons_list_concInstruction(tom_make_Let(tom_var1,tom_term1,tom_make_AbstractBlock(tom_cons_list_concInstruction(tom_body1,tom_cons_list_concInstruction(tom_body2,tom_empty_list_concInstruction())))),tom_append_list_concInstruction(tom_X2,tom_empty_list_concInstruction()))));
          } else {
            InfoVariableLet info = new InfoVariableLet();
            //  `findOccurencesUpTo(name1,list,2).visitLight(`body2);
            tom_make_computeOccurencesLet(tom_name1,info).visitLight(tom_body2);
            int mult = info.readCount; 
            if(mult==0){
              logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                  new Object[]{"block-fusion2"});    
              Instruction newBody2 =  (Instruction)(tom_make_renameVariable(tomMatch225NameNumber_freshVar_36,tom_name1).visitLight(tom_body2));
              return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_X1,tom_cons_list_concInstruction(tom_make_Let(tom_var1,tom_term1,tom_make_AbstractBlock(tom_cons_list_concInstruction(tom_body1,tom_cons_list_concInstruction(newBody2,tom_empty_list_concInstruction())))),tom_append_list_concInstruction(tom_X2,tom_empty_list_concInstruction()))));
            }
          }
        }
      }}}}}}}}}}}}}}}}}}}}}}}}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch225NameNumber_end_4)) {tomMatch225NameNumber_end_4=tomMatch225NameNumber_begin_3;} else {tomMatch225NameNumber_end_4=tom_get_tail_concInstruction_InstructionList(tomMatch225NameNumber_end_4);}}} while(!(tom_equal_term_InstructionList(tomMatch225NameNumber_end_4, tomMatch225NameNumber_begin_3)));}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_BlockFusion() { return new BlockFusion(); }private static class IfFusion extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {public IfFusion() { super(tom_make_Identity());}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch226NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_AbstractBlock(tomMatch226NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_freshVar_0=tom_get_slot_AbstractBlock_InstList(tomMatch226NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch226NameNumber_freshVar_0)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_freshVar_1=tomMatch226NameNumber_freshVar_0;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_begin_3=tomMatch226NameNumber_freshVar_1;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_end_4=tomMatch226NameNumber_freshVar_1;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch226NameNumber_begin_3,tomMatch226NameNumber_end_4,tom_empty_list_concInstruction());{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_freshVar_2=tomMatch226NameNumber_end_4;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch226NameNumber_freshVar_29=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch226NameNumber_freshVar_30=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch226NameNumber_freshVar_31=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2));{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch226NameNumber_freshVar_29;{  tom.engine.adt.tominstruction.types.Instruction  tom_success1=tomMatch226NameNumber_freshVar_30;{  tom.engine.adt.tominstruction.types.Instruction  tom_failure1=tomMatch226NameNumber_freshVar_31;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_freshVar_5=tom_get_tail_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_2);if (!(tom_is_empty_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch226NameNumber_freshVar_32=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch226NameNumber_freshVar_33=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch226NameNumber_freshVar_34=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tom_success2=tomMatch226NameNumber_freshVar_33;{  tom.engine.adt.tominstruction.types.Instruction  tom_failure2=tomMatch226NameNumber_freshVar_34;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch226NameNumber_freshVar_6=tom_get_tail_concInstruction_InstructionList(tomMatch226NameNumber_freshVar_5);{  tom.engine.adt.tominstruction.types.InstructionList  tom_X2=tomMatch226NameNumber_freshVar_6;if ( true ) {









        /* Fusion de 2 blocs If gardes par la meme condition */
        if(compare(tom_cond1,tomMatch226NameNumber_freshVar_32)) {
          if(tom_failure1.isNop() && tom_failure2.isNop()) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{"if-fusion1"});
            Instruction res = tom_make_AbstractBlock(tom_append_list_concInstruction(tom_X1,tom_cons_list_concInstruction(tom_make_If(tom_cond1,tom_make_AbstractBlock(tom_cons_list_concInstruction(tom_success1,tom_cons_list_concInstruction(tom_success2,tom_empty_list_concInstruction()))),tom_make_Nop()),tom_append_list_concInstruction(tom_X2,tom_empty_list_concInstruction()))));
            //System.out.println(res);

            return res;
          } else {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(),
                new Object[]{ "if-fusion2"});
            return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_X1,tom_cons_list_concInstruction(tom_make_If(tom_cond1,tom_make_AbstractBlock(tom_cons_list_concInstruction(tom_success1,tom_cons_list_concInstruction(tom_success2,tom_empty_list_concInstruction()))),tom_make_AbstractBlock(tom_cons_list_concInstruction(tom_failure1,tom_cons_list_concInstruction(tom_failure2,tom_empty_list_concInstruction())))),tom_append_list_concInstruction(tom_X2,tom_empty_list_concInstruction()))));
          }
        }
      }}}}}}}}}}}}}}}}}}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch226NameNumber_end_4)) {tomMatch226NameNumber_end_4=tomMatch226NameNumber_begin_3;} else {tomMatch226NameNumber_end_4=tom_get_tail_concInstruction_InstructionList(tomMatch226NameNumber_end_4);}}} while(!(tom_equal_term_InstructionList(tomMatch226NameNumber_end_4, tomMatch226NameNumber_begin_3)));}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_IfFusion() { return new IfFusion(); }private static class InterBlock extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  TomOptimizer  optimizer; public InterBlock( TomOptimizer  optimizer) { super(tom_make_Identity());this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() { return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Instruction(tom__arg)) {{  tom.engine.adt.tominstruction.types.Instruction  tomMatch227NameNumberfreshSubject_1=(( tom.engine.adt.tominstruction.types.Instruction )tom__arg);if (tom_is_fun_sym_AbstractBlock(tomMatch227NameNumberfreshSubject_1)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_freshVar_0=tom_get_slot_AbstractBlock_InstList(tomMatch227NameNumberfreshSubject_1);if (tom_is_fun_sym_concInstruction(tomMatch227NameNumber_freshVar_0)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_freshVar_1=tomMatch227NameNumber_freshVar_0;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_begin_3=tomMatch227NameNumber_freshVar_1;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_end_4=tomMatch227NameNumber_freshVar_1;do {{{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_freshVar_2=tomMatch227NameNumber_end_4;if (!(tom_is_empty_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch227NameNumber_freshVar_29=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch227NameNumber_freshVar_30=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch227NameNumber_freshVar_31=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2));{  tom.engine.adt.tomexpression.types.Expression  tom_cond1=tomMatch227NameNumber_freshVar_29;{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_freshVar_5=tom_get_tail_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_2);if (!(tom_is_empty_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5))) {if (tom_is_fun_sym_If(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5))) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch227NameNumber_freshVar_32=tom_get_slot_If_Condition(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch227NameNumber_freshVar_33=tom_get_slot_If_SuccesInst(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5));{  tom.engine.adt.tominstruction.types.Instruction  tomMatch227NameNumber_freshVar_34=tom_get_slot_If_FailureInst(tom_get_head_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5));{  tom.engine.adt.tomexpression.types.Expression  tom_cond2=tomMatch227NameNumber_freshVar_32;if (tom_is_fun_sym_Nop(tomMatch227NameNumber_freshVar_34)) {{  tom.engine.adt.tominstruction.types.InstructionList  tomMatch227NameNumber_freshVar_6=tom_get_tail_concInstruction_InstructionList(tomMatch227NameNumber_freshVar_5);if ( true ) {










        if(optimizer.incompatible(tom_cond1,tom_cond2)) {
          logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), new Object[]{"inter-block"});
          return tom_make_AbstractBlock(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch227NameNumber_begin_3,tomMatch227NameNumber_end_4,tom_empty_list_concInstruction()),tom_cons_list_concInstruction(tom_make_If(tom_cond1,tomMatch227NameNumber_freshVar_30,tom_make_AbstractBlock(tom_cons_list_concInstruction(tomMatch227NameNumber_freshVar_31,tom_cons_list_concInstruction(tom_make_If(tom_cond2,tomMatch227NameNumber_freshVar_33,tom_make_Nop()),tom_empty_list_concInstruction())))),tom_append_list_concInstruction(tomMatch227NameNumber_freshVar_6,tom_empty_list_concInstruction()))));
        }  
      }}}}}}}}}}}}}}}}}if (tom_is_empty_concInstruction_InstructionList(tomMatch227NameNumber_end_4)) {tomMatch227NameNumber_end_4=tomMatch227NameNumber_begin_3;} else {tomMatch227NameNumber_end_4=tom_get_tail_concInstruction_InstructionList(tomMatch227NameNumber_end_4);}}} while(!(tom_equal_term_InstructionList(tomMatch227NameNumber_end_4, tomMatch227NameNumber_begin_3)));}}}}}}}}return super.visit_Instruction(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_InterBlock( TomOptimizer  t0) { return new InterBlock(t0); }private static class NormExpr extends  tom.engine.adt.tomsignature.TomSignatureBasicStrategy  {private  TomOptimizer  optimizer; public NormExpr( TomOptimizer  optimizer) { super(tom_make_Identity());this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() { return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];for (int i = 0; i < getChildCount(); i++) {stratChilds[i]=getChildAt(i);}return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {for (int i = 0; i < getChildCount(); i++) {setChildAt(i,children[i]);}return this;}public int getChildCount() { return 1; }public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomexpression.types.Expression  visit_Expression( tom.engine.adt.tomexpression.types.Expression  tom__arg) throws tom.library.sl.VisitFailure {if (tom_is_sort_Expression(tom__arg)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumberfreshSubject_1=(( tom.engine.adt.tomexpression.types.Expression )tom__arg);if (tom_is_fun_sym_Or(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_0=tom_get_slot_Or_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_1=tom_get_slot_Or_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_TrueTL(tomMatch228NameNumber_freshVar_1)) {if ( true ) {






        return tom_make_TrueTL();
      }}}}}if (tom_is_fun_sym_Or(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_2=tom_get_slot_Or_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_3=tom_get_slot_Or_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_TrueTL(tomMatch228NameNumber_freshVar_2)) {if ( true ) {

        return tom_make_TrueTL();
      }}}}}if (tom_is_fun_sym_Or(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_4=tom_get_slot_Or_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_5=tom_get_slot_Or_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_FalseTL(tomMatch228NameNumber_freshVar_5)) {if ( true ) {

        return tomMatch228NameNumber_freshVar_4;
      }}}}}if (tom_is_fun_sym_Or(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_6=tom_get_slot_Or_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_7=tom_get_slot_Or_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_FalseTL(tomMatch228NameNumber_freshVar_6)) {if ( true ) {

        return tomMatch228NameNumber_freshVar_7;
      }}}}}if (tom_is_fun_sym_And(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_8=tom_get_slot_And_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_9=tom_get_slot_And_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_TrueTL(tomMatch228NameNumber_freshVar_8)) {if ( true ) {

        return tomMatch228NameNumber_freshVar_9;
      }}}}}if (tom_is_fun_sym_And(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_10=tom_get_slot_And_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_11=tom_get_slot_And_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_TrueTL(tomMatch228NameNumber_freshVar_11)) {if ( true ) {

        return tomMatch228NameNumber_freshVar_10;
      }}}}}if (tom_is_fun_sym_And(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_12=tom_get_slot_And_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_13=tom_get_slot_And_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_FalseTL(tomMatch228NameNumber_freshVar_12)) {if ( true ) {

        return tom_make_FalseTL();
      }}}}}if (tom_is_fun_sym_And(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_14=tom_get_slot_And_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_15=tom_get_slot_And_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_TrueTL(tomMatch228NameNumber_freshVar_14)) {if ( true ) {

        return tom_make_FalseTL();
      }}}}}if (tom_is_fun_sym_EqualTerm(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomtype.types.TomType  tomMatch228NameNumber_freshVar_16=tom_get_slot_EqualTerm_TomType(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch228NameNumber_freshVar_17=tom_get_slot_EqualTerm_Kid1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch228NameNumber_freshVar_18=tom_get_slot_EqualTerm_Kid2(tomMatch228NameNumberfreshSubject_1);if ( true ) {

        //System.out.println("kid1 = " + `kid1);
        //System.out.println("kid2 = " + `kid2);
        if(compare(tomMatch228NameNumber_freshVar_17,tomMatch228NameNumber_freshVar_18)){
          return tom_make_TrueTL();
        } else {
          return tomMatch228NameNumberfreshSubject_1;
        }
      }}}}}if (tom_is_fun_sym_And(tomMatch228NameNumberfreshSubject_1)) {{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_19=tom_get_slot_And_Arg1(tomMatch228NameNumberfreshSubject_1);{  tom.engine.adt.tomexpression.types.Expression  tomMatch228NameNumber_freshVar_20=tom_get_slot_And_Arg2(tomMatch228NameNumberfreshSubject_1);if (tom_is_fun_sym_IsFsym(tomMatch228NameNumber_freshVar_19)) {{  tom.engine.adt.tomterm.types.TomTerm  tomMatch228NameNumber_freshVar_22=tom_get_slot_IsFsym_Variable(tomMatch228NameNumber_freshVar_19);{  tom.engine.adt.tomname.types.TomName  tomMatch228NameNumber_freshVar_21=tom_get_slot_IsFsym_AstName(tomMatch228NameNumber_freshVar_19);{  tom.engine.adt.tomname.types.TomName  tom_name1=tomMatch228NameNumber_freshVar_21;if (tom_is_fun_sym_IsFsym(tomMatch228NameNumber_freshVar_20)) {{  tom.engine.adt.tomname.types.TomName  tomMatch228NameNumber_freshVar_23=tom_get_slot_IsFsym_AstName(tomMatch228NameNumber_freshVar_20);{  tom.engine.adt.tomterm.types.TomTerm  tomMatch228NameNumber_freshVar_24=tom_get_slot_IsFsym_Variable(tomMatch228NameNumber_freshVar_20);if (tom_equal_term_TomTerm(tomMatch228NameNumber_freshVar_22, tomMatch228NameNumber_freshVar_24)) {if ( true ) {

        if(tom_name1==tomMatch228NameNumber_freshVar_23) {
          return tom_make_IsFsym(tom_name1,tomMatch228NameNumber_freshVar_22);
        }
        /*
         * may be true for list operator with domain=codomain
         * two if_sym(f)==is_fsym(g) may be true due to mapping
         */
        TomSymbol tomSymbol = optimizer.symbolTable().getSymbolFromName(tom_name1.getString());
        if(TomBase.isListOperator(tomSymbol) || TomBase.isArrayOperator(tomSymbol)) {
          //System.out.println("symbol = " + tomSymbol);
          TomType domain = TomBase.getSymbolDomain(tomSymbol).getHeadconcTomType();
          TomType codomain = TomBase.getSymbolCodomain(tomSymbol);
          if(domain!=codomain) {
            return tom_make_FalseTL();
          }
        } else {
          return tom_make_FalseTL();
        }
        return tomMatch228NameNumberfreshSubject_1;
      }}}}}}}}}}}}}}return super.visit_Expression(tom__arg); }}private static  tom.library.sl.Strategy  tom_make_NormExpr( TomOptimizer  t0) { return new NormExpr(t0); }



} // class TomOptimizer
