/* Generated by TOM (version 2.6): Do not edit this file *//*
 * 
 * TOM - To One Matching Compiler
 * 
 * Copyright (c) 2000-2008, INRIA
 * Nancy, France.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 * 
 * Pierre-Etienne Moreau  e-mail: Pierre-Etienne.Moreau@loria.fr
 *
 **/

package tom.engine.optimizer;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

import tom.engine.TomBase;

import tom.engine.adt.tomsignature.*;
import tom.engine.adt.tomconstraint.types.*;
import tom.engine.adt.tomdeclaration.types.*;
import tom.engine.adt.tomexpression.types.*;
import tom.engine.adt.tominstruction.types.*;
import tom.engine.adt.tomname.types.*;
import tom.engine.adt.tomoption.types.*;
import tom.engine.adt.tomsignature.types.*;
import tom.engine.adt.tomterm.types.*;
import tom.engine.adt.tomslot.types.*;
import tom.engine.adt.tomtype.types.*;

import tom.engine.TomMessage;
import tom.engine.tools.TomGenericPlugin;
import tom.engine.tools.PILFactory;
import tom.engine.tools.Tools;
import tom.platform.OptionParser;
import tom.platform.adt.platformoption.types.PlatformOptionList;

import tom.library.sl.*;

/**
 * The TomOptimizer plugin.
 */
public class TomOptimizer extends TomGenericPlugin {

  /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */  /* Generated by TOM (version 2.6): Do not edit this file */    public static   tom.engine.adt.tominstruction.types.InstructionList  tom_append_list_concInstruction( tom.engine.adt.tominstruction.types.InstructionList l1,  tom.engine.adt.tominstruction.types.InstructionList  l2) {     if( l1.isEmptyconcInstruction() ) {       return l2;     } else if( l2.isEmptyconcInstruction() ) {       return l1;     } else if(  l1.getTailconcInstruction() .isEmptyconcInstruction() ) {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,l2) ;     } else {       return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( l1.getHeadconcInstruction() ,tom_append_list_concInstruction( l1.getTailconcInstruction() ,l2)) ;     }   }   public static   tom.engine.adt.tominstruction.types.InstructionList  tom_get_slice_concInstruction( tom.engine.adt.tominstruction.types.InstructionList  begin,  tom.engine.adt.tominstruction.types.InstructionList  end, tom.engine.adt.tominstruction.types.InstructionList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyconcInstruction()  ||  (end== tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( begin.getHeadconcInstruction() ,( tom.engine.adt.tominstruction.types.InstructionList )tom_get_slice_concInstruction( begin.getTailconcInstruction() ,end,tail)) ;   }    /* Generated by TOM (version 2.6): Do not edit this file */             /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */   public static   tom.library.sl.Strategy  tom_append_list_Sequence( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Sequence) )) {       if(( ((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Sequence(l1,l2) );     }   }   public static   tom.library.sl.Strategy  tom_get_slice_Sequence( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin):new tom.library.sl.Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)) );   }      public static   tom.library.sl.Strategy  tom_append_list_Choice( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 ==null )) {       return l2;     } else if(( l2 ==null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Choice) )) {       if(( ((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )) ==null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1):new tom.library.sl.Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.FIRST) ):l1),tom_append_list_Choice(((( (l1 instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Choice.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Choice(l1,l2) );     }   }   public static   tom.library.sl.Strategy  tom_get_slice_Choice( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end ==null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin):new tom.library.sl.Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Choice(((( (begin instanceof tom.library.sl.Choice) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Choice.THEN) ):( null )),end,tail)) );   }      public static   tom.library.sl.Strategy  tom_append_list_SequenceId( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.SequenceId) )) {       if(( ((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1):new tom.library.sl.SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.FIRST) ):l1),tom_append_list_SequenceId(((( (l1 instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.SequenceId(l1,l2) );     }   }   public static   tom.library.sl.Strategy  tom_get_slice_SequenceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin):new tom.library.sl.SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_SequenceId(((( (begin instanceof tom.library.sl.SequenceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.SequenceId.THEN) ):( null )),end,tail)) );   }      public static   tom.library.sl.Strategy  tom_append_list_ChoiceId( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 ==null )) {       return l2;     } else if(( l2 ==null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.ChoiceId) )) {       if(( ((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )) ==null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1):new tom.library.sl.ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1):new tom.library.sl.ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.FIRST) ):l1),tom_append_list_ChoiceId(((( (l1 instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.ChoiceId(l1,l2) );     }   }   public static   tom.library.sl.Strategy  tom_get_slice_ChoiceId( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end ==null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.FIRST) ):begin):new tom.library.sl.ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_ChoiceId(((( (begin instanceof tom.library.sl.ChoiceId) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.ChoiceId.THEN) ):( null )),end,tail)) );   }    /* Generated by TOM (version 2.6): Do not edit this file */ /* Generated by TOM (version 2.6): Do not edit this file */public static  tom.library.sl.Strategy  tom_make_Try( tom.library.sl.Strategy  v) { return ( ( (( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )==null)?v:new tom.library.sl.Choice(v,( (( null )==null)?( new tom.library.sl.Identity() ):new tom.library.sl.Choice(( new tom.library.sl.Identity() ),( null )) )) ) );}public static  tom.library.sl.Strategy  tom_make_TopDown( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}public static  tom.library.sl.Strategy  tom_make_TopDownCollect( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),tom_make_Try(( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) ))) ) );}public static  tom.library.sl.Strategy  tom_make_BottomUp( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?v:new tom.library.sl.Sequence(v,( null )) )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( (( null )==null)?v:new tom.library.sl.Sequence(v,( null )) )) )) ) );}public static  tom.library.sl.Strategy  tom_make_RepeatId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) )) ) );}public static  tom.library.sl.Strategy  tom_make_OnceTopDownId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.ChoiceId(( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.ChoiceId(v,( (( null )==null)?( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.ChoiceId(( new tom.library.sl.OneId(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}public static  tom.library.sl.Strategy  tom_make_InnermostId( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( (( null )==null)?( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ):new tom.library.sl.Sequence(( (( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )==null)?v:new tom.library.sl.SequenceId(v,( (( null )==null)?( new tom.library.sl.MuVar("_x") ):new tom.library.sl.SequenceId(( new tom.library.sl.MuVar("_x") ),( null )) )) ),( null )) )) )) ) );}   /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */ /* Generated by TOM (version 2.6): Do not edit this file */   private static java.util.ArrayList concArrayListAppend(Object o, java.util.ArrayList l) {   java.util.ArrayList res = (java.util.ArrayList)l.clone();   res.add(o);   return res; } /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */   private static java.util.HashSet hashSetAppend(Object o, java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   res.add(o);   return res; }  private static Object hashSetGetHead(java.util.HashSet s) {   java.util.Iterator it = s.iterator();   return it.next(); }  private static java.util.HashSet hashSetGetTail(java.util.HashSet s) {   java.util.HashSet res = (java.util.HashSet) s.clone();   java.util.Iterator it = s.iterator();   res.remove(it.next());   return res; } 







  /** some output suffixes */
  private static final String OPTIMIZED_SUFFIX = ".tfix.optimized";

  /** the declared options string*/
  private static final String DECLARED_OPTIONS = 
    "<options>" + 
    "<boolean name='optimize' altName='O' description='Optimize generated code: perform inlining' value='true'/>" +
    "<boolean name='optimize2' altName='O2' description='Optimize generated code: discrimination tree' value='false'/>" +
    "<boolean name='prettyPIL' altName='pil' description='PrettyPrint IL' value='false'/>" +
    "</options>";

  public PlatformOptionList getDeclaredOptionList() {
    return OptionParser.xmlToOptionList(TomOptimizer.DECLARED_OPTIONS);
  }

  public void optionChanged(String optionName, Object optionValue) {
    if(optionName.equals("optimize2") && ((Boolean)optionValue).booleanValue() ) {
      setOptionValue("pretty", Boolean.TRUE);
    }
  }

  // this static field is necessary for %strategy instructions that generate static code
  private static PILFactory factory = new PILFactory();
  private static Logger logger = Logger.getLogger("tom.engine.optimizer.TomOptimizer");
  private static void info(TomMessage msg, int value, String name) {
    logger.log( Level.INFO, msg.getMessage(), new Object[]{ Integer.valueOf(value), name });
  }

  /** Constructor */
  public TomOptimizer() {
    super("TomOptimizer");
  }

  public void run(Map informationTracker) {
    //System.out.println("(debug) I'm in the Tom optimizer : TSM"+getStreamManager().toString());
    if(getOptionBooleanValue("optimize") || getOptionBooleanValue("optimize2")) {
      /* Initialize strategies */
      long startChrono = System.currentTimeMillis();
      boolean intermediate = getOptionBooleanValue("intermediate");
      try {
        TomTerm renamedTerm = (TomTerm)getWorkingTerm();
        if(getOptionBooleanValue("optimize2")) {
          Strategy optStrategy2 = ( (( (( null )==null)?tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
                )
              :new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
                )
              ,( null )) )==null)?tom_make_InnermostId(( (( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )) )):new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )) )),( (( null )==null)?tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
                )
              :new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )==null)?( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )==null)?tom_make_RepeatId(tom_make_IfSwapping(this)):new tom.library.sl.Sequence(tom_make_RepeatId(tom_make_IfSwapping(this)),( (( null )==null)?tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )):new tom.library.sl.Sequence(tom_make_RepeatId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )==null)?( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ):new tom.library.sl.SequenceId(( (( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )==null)?tom_make_BlockFusion():new tom.library.sl.ChoiceId(tom_make_BlockFusion(),( (( null )==null)?tom_make_IfFusion():new tom.library.sl.ChoiceId(tom_make_IfFusion(),( null )) )) ),( (( null )==null)?tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_NopElimAndFlatten()),( null )) )) )),( null )) )) ),( (( null )==null)?( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ):new tom.library.sl.ChoiceId(( (( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )==null)?tom_make_InterBlock(this):new tom.library.sl.SequenceId(tom_make_InterBlock(this),( (( null )==null)?tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())):new tom.library.sl.SequenceId(tom_make_OnceTopDownId(tom_make_RepeatId(tom_make_NopElimAndFlatten())),( null )) )) ),( null )) )) )
                )
              ,( null )) )) )






;

          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
          renamedTerm = (TomTerm) tom_make_BottomUp(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )).visit(renamedTerm);
          renamedTerm = (TomTerm) optStrategy2.visitLight(renamedTerm);
        } else if(getOptionBooleanValue("optimize")) {
          Strategy optStrategy = ( (( (( null )==null)?tom_make_BottomUp(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )):new tom.library.sl.Sequence(tom_make_BottomUp(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )),( null )) )==null)?tom_make_InnermostId(( (( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )) )):new tom.library.sl.Sequence(tom_make_InnermostId(( (( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )==null)?tom_make_NormExpr(this):new tom.library.sl.ChoiceId(tom_make_NormExpr(this),( (( null )==null)?tom_make_NopElimAndFlatten():new tom.library.sl.ChoiceId(tom_make_NopElimAndFlatten(),( null )) )) )),( (( null )==null)?tom_make_BottomUp(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )):new tom.library.sl.Sequence(tom_make_BottomUp(tom_make_Inline( tom.engine.adt.tomconstraint.types.constraint.TrueConstraint.make() )),( null )) )) )

;

          renamedTerm = (TomTerm) optStrategy.visit(renamedTerm);
        }
        setWorkingTerm(renamedTerm);

        // verbose
        logger.log(Level.INFO, TomMessage.tomOptimizationPhase.getMessage(),
            Integer.valueOf((int)(System.currentTimeMillis()-startChrono)) );
      } catch (Exception e) {
        logger.log( Level.SEVERE, TomMessage.exceptionMessage.getMessage(),
            new Object[]{"TomOptimizer", getStreamManager().getInputFileName(), e.getMessage()} );

        e.printStackTrace();
         return;
      }
      if(intermediate) {
        Tools.generateOutput(getStreamManager().getOutputFileName() + OPTIMIZED_SUFFIX, 
            (TomTerm)getWorkingTerm() );
      }
    } else {
      // not active plugin
      logger.log(Level.INFO, "The optimizer is not activated and thus WILL NOT RUN.");
    }
    if(getOptionBooleanValue("prettyPIL")) {
      System.out.println(factory.prettyPrintCompiledMatch(factory.remove((TomTerm)getWorkingTerm())));
    }
  }

  private final static String PREFIX = "tom_";
  private static String extractRealName(String name) {
    if(name.startsWith(PREFIX)) {
      return name.substring(PREFIX.length());
    }
    return name;
  }

  public static class Inline extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomconstraint.types.Constraint  context;public Inline( tom.engine.adt.tomconstraint.types.Constraint  context) {super(( new tom.library.sl.Identity() ));this.context=context;}public  tom.engine.adt.tomconstraint.types.Constraint  getcontext() {return context;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.BuildAppendList) ) { tom.engine.adt.tomname.types.TomName  tomMatch1NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ; tom.engine.adt.tomterm.types.TomTerm  tomMatch1NameNumber_freshVar_2= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getHeadTerm() ;if ( (tomMatch1NameNumber_freshVar_2 instanceof tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch1NameNumber_freshVar_5= tomMatch1NameNumber_freshVar_2.getAstExpression() ;if ( (tomMatch1NameNumber_freshVar_5 instanceof tom.engine.adt.tomexpression.types.expression.GetSliceList) ) {if ( ( tomMatch1NameNumber_freshVar_5.getAstName() ==tomMatch1NameNumber_freshVar_1) ) {



        return  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make( tom.engine.adt.tomexpression.types.expression.GetSliceList.make(tomMatch1NameNumber_freshVar_1,  tomMatch1NameNumber_freshVar_5.getVariableBeginAST() ,  tomMatch1NameNumber_freshVar_5.getVariableEndAST() ,  tom.engine.adt.tomterm.types.tomterm.BuildAppendList.make(tomMatch1NameNumber_freshVar_1,  tomMatch1NameNumber_freshVar_5.getTail() ,  (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getTailTerm() ) ) ) ;
      }}}}}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {




        context =  (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getPositivePattern() ;
        //System.out.println("found context = " + context);
        return (( tom.engine.adt.tominstruction.types.Instruction )tom__arg);
      }}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_4= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;boolean tomMatch2NameNumber_freshVar_9= false ;if ( (tomMatch2NameNumber_freshVar_4 instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariable) ) {tomMatch2NameNumber_freshVar_9= true ;} else {if ( (tomMatch2NameNumber_freshVar_4 instanceof tom.engine.adt.tomterm.types.tomterm.UnamedVariableStar) ) {tomMatch2NameNumber_freshVar_9= true ;}}if ((tomMatch2NameNumber_freshVar_9 ==  true )) {









        return  (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getAstInstruction() ; 
      }}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_13= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ; tom.engine.adt.tomexpression.types.Expression  tomMatch2NameNumber_freshVar_14= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSource() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch2NameNumber_freshVar_15= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getAstInstruction() ;boolean tomMatch2NameNumber_freshVar_31= false ; tom.engine.adt.tomname.types.TomName  tomMatch2NameNumber_freshVar_17= null ;if ( (tomMatch2NameNumber_freshVar_13 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch2NameNumber_freshVar_31= true ;tomMatch2NameNumber_freshVar_17= tomMatch2NameNumber_freshVar_13.getAstName() ;}} else {if ( (tomMatch2NameNumber_freshVar_13 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch2NameNumber_freshVar_31= true ;tomMatch2NameNumber_freshVar_17= tomMatch2NameNumber_freshVar_13.getAstName() ;}}}if ((tomMatch2NameNumber_freshVar_31 ==  true )) {if ( (tomMatch2NameNumber_freshVar_14 instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tomMatch2NameNumber_freshVar_14) instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_19= (( tom.engine.adt.tomexpression.types.Expression )tomMatch2NameNumber_freshVar_14).getAstTerm() ;boolean tomMatch2NameNumber_freshVar_29= false ; tom.engine.adt.tomname.types.TomName  tomMatch2NameNumber_freshVar_21= null ;if ( (tomMatch2NameNumber_freshVar_19 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch2NameNumber_freshVar_29= true ;tomMatch2NameNumber_freshVar_21= tomMatch2NameNumber_freshVar_19.getAstName() ;}} else {if ( (tomMatch2NameNumber_freshVar_19 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch2NameNumber_freshVar_29= true ;tomMatch2NameNumber_freshVar_21= tomMatch2NameNumber_freshVar_19.getAstName() ;}}}if ((tomMatch2NameNumber_freshVar_29 ==  true )) {




          return (Instruction) tom_make_TopDown(tom_make_replaceVariableByExpression(tomMatch2NameNumber_freshVar_17,tomMatch2NameNumber_freshVar_14)).visitLight(tomMatch2NameNumber_freshVar_15);
      }}}if ( (tomMatch2NameNumber_freshVar_14 instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tomMatch2NameNumber_freshVar_14) instanceof tom.engine.adt.tomexpression.types.expression.Cast) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch2NameNumber_freshVar_23= (( tom.engine.adt.tomexpression.types.Expression )tomMatch2NameNumber_freshVar_14).getSource() ;if ( (tomMatch2NameNumber_freshVar_23 instanceof tom.engine.adt.tomexpression.types.expression.TomTermToExpression) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_25= tomMatch2NameNumber_freshVar_23.getAstTerm() ;boolean tomMatch2NameNumber_freshVar_30= false ; tom.engine.adt.tomname.types.TomName  tomMatch2NameNumber_freshVar_27= null ;if ( (tomMatch2NameNumber_freshVar_25 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch2NameNumber_freshVar_30= true ;tomMatch2NameNumber_freshVar_27= tomMatch2NameNumber_freshVar_25.getAstName() ;}} else {if ( (tomMatch2NameNumber_freshVar_25 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch2NameNumber_freshVar_30= true ;tomMatch2NameNumber_freshVar_27= tomMatch2NameNumber_freshVar_25.getAstName() ;}}}if ((tomMatch2NameNumber_freshVar_30 ==  true )) {           return (Instruction) tom_make_TopDown(tom_make_replaceVariableByExpression(tomMatch2NameNumber_freshVar_17,tomMatch2NameNumber_freshVar_14)).visitLight(tomMatch2NameNumber_freshVar_15);       }}}}}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_33= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ; tom.engine.adt.tomexpression.types.Expression  tomMatch2NameNumber_freshVar_34= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSource() ;boolean tomMatch2NameNumber_freshVar_39= false ; tom.engine.adt.tomname.types.TomName  tomMatch2NameNumber_freshVar_37= null ;if ( (tomMatch2NameNumber_freshVar_33 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch2NameNumber_freshVar_39= true ;tomMatch2NameNumber_freshVar_37= tomMatch2NameNumber_freshVar_33.getAstName() ;}} else {if ( (tomMatch2NameNumber_freshVar_33 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch2NameNumber_freshVar_39= true ;tomMatch2NameNumber_freshVar_37= tomMatch2NameNumber_freshVar_33.getAstName() ;}}}if ((tomMatch2NameNumber_freshVar_39 ==  true )) {


        String varName = ""; // real name of the variable (i.e. without the tom_ prefix)
        {{if ( (tomMatch2NameNumber_freshVar_37 instanceof tom.engine.adt.tomname.types.TomName) ) {if ( ((( tom.engine.adt.tomname.types.TomName )tomMatch2NameNumber_freshVar_37) instanceof tom.engine.adt.tomname.types.tomname.Name) ) {
 varName = extractRealName( (( tom.engine.adt.tomname.types.TomName )tomMatch2NameNumber_freshVar_37).getString() ); }}}}


        // count the occurend of name
        // and inspect the body to 
        InfoVariable infoBody = new InfoVariable();
        infoBody.setAssignment(tomMatch2NameNumber_freshVar_34,getPosition());
        getEnvironment().down(3); // 3 = body
        tom_make_computeOccurencesLet(tomMatch2NameNumber_freshVar_37,infoBody).visit(getEnvironment());
        getEnvironment().up();

        int mult = infoBody.readCount;
        if(mult == 0) { // name is not used
          // suppress the Let
          if(varName.length() > 0) {
            // varName is not empty when the variable is a user defined variable (with a name)
            // and not a variable generated by the compiler itself
            // TODO: check variable occurence in TypedAction
            InfoVariable infoContext = new InfoVariable();
            tom_make_computeOccurencesLet(tomMatch2NameNumber_freshVar_37,infoContext).visit(context);
            if(infoContext.readCount<=1 && !varName.startsWith("_")) {
              // variables introduced by renaming starts with a '_'
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch2NameNumber_freshVar_33.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,varName);
              info(TomMessage.remove,mult,varName);
            }
          }
          return  (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getAstInstruction() ;
        } else if(mult == 1) {
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the read
          if(!infoBody.modifiedAssignmentVariables) {
            if(varName.length() > 0) {
              info(TomMessage.inline,mult,varName);
            }
            Position current = getPosition();
            getEnvironment().goToPosition(infoBody.usePosition);
            getEnvironment().setSubject( tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(tomMatch2NameNumber_freshVar_34) );
            getEnvironment().goToPosition(current);
            Instruction newlet = (Instruction) getEnvironment().getSubject();
            // return only the body
            return (Instruction) newlet.getChildAt(2);
          } else {
            if(varName.length() > 0) {
              info(TomMessage.noInline,mult,varName);
            }
          }
        } else {
          /* do nothing */
          if(varName.length() > 0) {
            info(TomMessage.doNothing,mult,varName);
          }
        }
      }}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.LetRef) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch2NameNumber_freshVar_41= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;boolean tomMatch2NameNumber_freshVar_48= false ; tom.engine.adt.tomname.types.TomName  tomMatch2NameNumber_freshVar_45= null ;if ( (tomMatch2NameNumber_freshVar_41 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch2NameNumber_freshVar_48= true ;tomMatch2NameNumber_freshVar_45= tomMatch2NameNumber_freshVar_41.getAstName() ;}} else {if ( (tomMatch2NameNumber_freshVar_41 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch2NameNumber_freshVar_48= true ;tomMatch2NameNumber_freshVar_45= tomMatch2NameNumber_freshVar_41.getAstName() ;}}}if ((tomMatch2NameNumber_freshVar_48 ==  true )) {if ( (tomMatch2NameNumber_freshVar_45 instanceof tom.engine.adt.tomname.types.tomname.Name) ) {






        /*
         * do not optimize Variable(TomNumber...) because LetRef X*=GetTail(X*) in ...
         * is not correctly handled 
         * we must check that X notin exp
         */
        String varName = "";
        {{if ( (tomMatch2NameNumber_freshVar_45 instanceof tom.engine.adt.tomname.types.TomName) ) {if ( ((( tom.engine.adt.tomname.types.TomName )tomMatch2NameNumber_freshVar_45) instanceof tom.engine.adt.tomname.types.tomname.Name) ) {
 varName = extractRealName( (( tom.engine.adt.tomname.types.TomName )tomMatch2NameNumber_freshVar_45).getString() ); }}}}


        InfoVariable info = new InfoVariable();
        info.setAssignment( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSource() ,getPosition());
        getEnvironment().down(3);
        //computeOccurencesLetRef on the body
        tom_make_computeOccurencesLetRef(tomMatch2NameNumber_freshVar_45,info).visit(getEnvironment());
        getEnvironment().up();
        int mult = info.readCount;
        Position readPos = info.usePosition;
        TomTerm value =  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(info.assignment) ;

        //System.out.println(`name + " --> " + mult);
        // 0 -> unused variable
        // suppress the letref and all the corresponding letassigns in the body
        if(mult == 0) {
          // why this test?
          if(varName.length() > 0) {
            // TODO: check variable occurence in TypedAction
            info = new InfoVariable();
            tom_make_computeOccurencesLetRef(tomMatch2NameNumber_freshVar_45,info).visit(context);
            if(info.readCount<=1 && !varName.startsWith("_")) {
              // verify linearity in case of variables from the pattern
              // warning to indicate that this var is unused in the rhs
              Option orgTrack = TomBase.findOriginTracking(tomMatch2NameNumber_freshVar_41.getOption());
              TomMessage.warning(logger,orgTrack.getFileName(), orgTrack.getLine(),
                  TomMessage.unusedVariable,varName);
              info(TomMessage.remove,mult,varName);
            }
          }
          return (Instruction) tom_make_CleanAssign(tomMatch2NameNumber_freshVar_45).visitLight( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getAstInstruction() );
        } else if(mult == 1) {
          //test if variables contained in the exp to assign have not been
          //modified between the last assignment and the use
          if(info.assignment!=null) {
            //test if the last assignment is not in a conditional sub-block
            //relatively to the variable use
            Position src = info.usePosition;
            Position dest = info.assignmentPosition;

            // find the positive part of src-dest
            Position positivePart = (Position) dest.sub(src).getCanonicalPath();
            while(positivePart.length()>0 && positivePart.getHead()<0) {
              positivePart = (Position) positivePart.getTail();
            }
            // find the common ancestor of src and dest
            Position commonAncestor = (Position) dest.add(positivePart.inverse()).getCanonicalPath();
            Position current = getPosition();
            getEnvironment().goToPosition(commonAncestor);
            try {
              //this strategy fails if from common ancestor and along the path
              //positivePart there is an instruction If, WhileDo or DoWhile
              positivePart.getOmegaPath(( new tom.library.sl.Not(( (( (( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile(),( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_If():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_If(),( (( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_DoWhile(),( (( null )==null)? new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo():new tom.library.sl.Choice( new tom.engine.adt.tominstruction.strategy.instruction.Is_WhileDo(),( null )) )) )) )) )).visit(getEnvironment());
              if(varName.length() > 0) {
                info(TomMessage.inline,mult,varName);
              }
              getEnvironment().goToPosition(readPos);
              getEnvironment().setSubject(value);
              getEnvironment().goToPosition(current);
              tom_make_CleanAssign(tomMatch2NameNumber_freshVar_45).visit(getEnvironment());
              Instruction newletref = (Instruction) getEnvironment().getSubject();
              // return only the body
              //System.out.println("inlineletref");
              return (Instruction) newletref.getChildAt(2);
            } catch(VisitFailure e) {
              getEnvironment().goToPosition(current);
              if(varName.length() > 0) {
                info(TomMessage.noInline,mult,varName);
              }
            }
          } else {
            if(varName.length() > 0) {
              info(TomMessage.noInline,mult,varName);
            }
          }
        } else {
          /* do nothing: traversal() */
          if(varName.length() > 0) {
            info(TomMessage.doNothing,mult,varName);
          }
        }
      }}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_Inline( tom.engine.adt.tomconstraint.types.Constraint  t0) { return new Inline(t0);}






  private static class InfoVariable {

    private HashSet<TomName> assignmentVariables = new HashSet();
    public int readCount=0;
    public boolean modifiedAssignmentVariables=false; // true when exp depends on a variable which is modified by Assign
    public Position usePosition; // position where is used the variable
    /*
     * for LetRef
     */
    private Position assignmentPosition;
    private Expression assignment;

    public InfoVariable() {}

    public void setAssignment(Expression newAssignment,Position newAssignmentPosition) {
      assignment = newAssignment;
      assignmentPosition = newAssignmentPosition;
      assignmentVariables.clear();
      try {
        tom_make_TopDownCollect(tom_make_CollectVariable(assignmentVariables)).visitLight(newAssignment);
      } catch(VisitFailure e) {
        logger.log( Level.SEVERE, "Error during collecting variables in "+newAssignment);
      }
    }

    public Set getAssignmentVariables() {
      return assignmentVariables;
    }

    public void clear() {
      assignment = null;
      assignmentPosition = null;
      assignmentVariables.clear();
    }

  }

  public static class CollectVariable extends tom.library.sl.BasicStrategy {private  java.util.HashSet  set;public CollectVariable( java.util.HashSet  set) {super(( new tom.library.sl.Identity() ));this.set=set;}public  java.util.HashSet  getset() {return set;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {boolean tomMatch5NameNumber_freshVar_3= false ; tom.engine.adt.tomname.types.TomName  tomMatch5NameNumber_freshVar_1= null ;if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch5NameNumber_freshVar_3= true ;tomMatch5NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}} else {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch5NameNumber_freshVar_3= true ;tomMatch5NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}}}if ((tomMatch5NameNumber_freshVar_3 ==  true )) {


        set.add(tomMatch5NameNumber_freshVar_1);
        //stop to visit this branch (like "return false" with traversal) 
        throw new VisitFailure();
      }}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_CollectVariable( java.util.HashSet  t0) { return new CollectVariable(t0);}



  /* strategies for Let inlining (using cps) */
  // comp = AssignCase(TypedActionCase(comp,BaseCase(all(comp),fail())),fail())
  public static  tom.library.sl.Strategy  tom_make_computeOccurencesLet( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) { return tom_make_Try(( new tom.library.sl.Mu(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurenceLet_AssignCase(tom_make_computeOccurenceLet_TypedActionCase(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurenceLet_BaseCase(( new tom.library.sl.All(( new tom.library.sl.MuVar("comp") )) ),variableName,info),variableName,info),info)
            ) )
          )












 
    ;}


  /*
   * check if a variable appearing in an expression (in Let x <- exp ...)
   * is modified (by Assign)
   */
  public static class computeOccurenceLet_AssignCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  InfoVariable  info;public computeOccurenceLet_AssignCase( tom.library.sl.Strategy  defaultCase,  InfoVariable  info) {super(defaultCase);this.defaultCase=defaultCase;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  InfoVariable  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch6NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;if ( (tomMatch6NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {


        if(info.getAssignmentVariables().contains( tomMatch6NameNumber_freshVar_1.getAstName() )) {
          info.modifiedAssignmentVariables=true;
          throw new VisitFailure();
        }
      }}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_computeOccurenceLet_AssignCase( tom.library.sl.Strategy  t0,  InfoVariable  t1) { return new computeOccurenceLet_AssignCase(t0,t1);}public static class computeOccurenceLet_TypedActionCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  goOnCase;private  tom.library.sl.Strategy  cutCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariable  info;public computeOccurenceLet_TypedActionCase( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  cutCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) {super(cutCase);this.goOnCase=goOnCase;this.cutCase=cutCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() {return goOnCase;}public  tom.library.sl.Strategy  getcutCase() {return cutCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariable  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getgoOnCase();stratChilds[2] = getcutCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);goOnCase = ( tom.library.sl.Strategy ) children[1];cutCase = ( tom.library.sl.Strategy ) children[2];return this;}public int getChildCount() {return 3;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getcutCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: cutCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {






        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        try {
          goOnCase.visit(current);
          current.up();
          return (Instruction) current.getSubject();
        } catch (VisitFailure e) {
          current.upLocal();
          throw new VisitFailure();
        }
      }}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch7NameNumber_freshVar_3= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;if ( (tomMatch7NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {



        if(variableName.equals( tomMatch7NameNumber_freshVar_3.getAstName() )) {
          logger.log( Level.SEVERE, "TomOptimizer: Assignment cannot be done for the variable "+variableName+" declared in a let", new Object[]{} );
        }
      }}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_computeOccurenceLet_TypedActionCase( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariable  t3) { return new computeOccurenceLet_TypedActionCase(t0,t1,t2,t3);}



  /*
   * when variableName is encountered, its position is stored
   * if it appears more than once, the computation is stopped because there is no possible inlining
   */
  public static class computeOccurenceLet_BaseCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariable  info;public computeOccurenceLet_BaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) {super(defaultCase);this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariable  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {boolean tomMatch8NameNumber_freshVar_3= false ; tom.engine.adt.tomname.types.TomName  tomMatch8NameNumber_freshVar_1= null ;if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch8NameNumber_freshVar_3= true ;tomMatch8NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}} else {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch8NameNumber_freshVar_3= true ;tomMatch8NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}}}if ((tomMatch8NameNumber_freshVar_3 ==  true )) {

 
        if(variableName == tomMatch8NameNumber_freshVar_1) {
          info.usePosition = getPosition(); 
          info.readCount++;
          if(info.readCount==2) { throw new VisitFailure(); }
        } 
      }}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_computeOccurenceLet_BaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariable  t2) { return new computeOccurenceLet_BaseCase(t0,t1,t2);}



  /* strategies for LetRef inlining (using cps) */
  // comp = special( comp, Basecase(comp,fail()) )
  public static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRef( tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) { return 
 (
        tom_make_Try(( new tom.library.sl.Mu(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetRef_CutCase(( new tom.library.sl.MuVar("comp") ),tom_make_computeOccurencesLetRef_BaseCase(( new tom.library.sl.All(( new tom.library.sl.MuVar("comp") )) ),variableName,info),variableName,info)
            ) ))










        ) ;}


  //cases where failure is used to cut branches
  public static class computeOccurencesLetRef_CutCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  goOnCase;private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariable  info;public computeOccurencesLetRef_CutCase( tom.library.sl.Strategy  goOnCase,  tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) {super(defaultCase);this.goOnCase=goOnCase;this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getgoOnCase() {return goOnCase;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariable  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getgoOnCase();stratChilds[2] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);goOnCase = ( tom.library.sl.Strategy ) children[1];defaultCase = ( tom.library.sl.Strategy ) children[2];return this;}public int getChildCount() {return 3;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getgoOnCase();case 2: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: goOnCase = ( tom.library.sl.Strategy )child; return this;case 2: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.TypedAction) ) {


        /* recursive call of the current strategy on the first child */
        Environment current = getEnvironment();
        current.down(1);
        try {
          goOnCase.visit(current);
          current.up();
          return (Instruction) current.getSubject();
        } catch (VisitFailure e) {
          current.upLocal();
          throw new VisitFailure();
        }
      }}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch9NameNumber_freshVar_3= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;if ( (tomMatch9NameNumber_freshVar_3 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) { tom.engine.adt.tomname.types.TomName  tomMatch9NameNumber_freshVar_6= tomMatch9NameNumber_freshVar_3.getAstName() ;


        if(variableName == tomMatch9NameNumber_freshVar_6) {
          info.setAssignment( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSource() ,getPosition());
        } else {
          if(info.getAssignmentVariables().contains(tomMatch9NameNumber_freshVar_6)) {
            info.clear();
         }
        }
        /* recursive call of the current strategy on src */
        Environment current = getEnvironment();
        try {
          current.down(2);
          goOnCase.visit(current);
          current.up();
          return (Instruction) current.getSubject();
        } catch (VisitFailure e) {
          current.upLocal();
          throw new VisitFailure();
        }
      }}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRef_CutCase( tom.library.sl.Strategy  t0,  tom.library.sl.Strategy  t1,  tom.engine.adt.tomname.types.TomName  t2,  InfoVariable  t3) { return new computeOccurencesLetRef_CutCase(t0,t1,t2,t3);}public static class computeOccurencesLetRef_BaseCase extends tom.library.sl.BasicStrategy {private  tom.library.sl.Strategy  defaultCase;private  tom.engine.adt.tomname.types.TomName  variableName;private  InfoVariable  info;public computeOccurencesLetRef_BaseCase( tom.library.sl.Strategy  defaultCase,  tom.engine.adt.tomname.types.TomName  variableName,  InfoVariable  info) {super(defaultCase);this.defaultCase=defaultCase;this.variableName=variableName;this.info=info;}public  tom.library.sl.Strategy  getdefaultCase() {return defaultCase;}public  tom.engine.adt.tomname.types.TomName  getvariableName() {return variableName;}public  InfoVariable  getinfo() {return info;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);stratChilds[1] = getdefaultCase();return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);defaultCase = ( tom.library.sl.Strategy ) children[1];return this;}public int getChildCount() {return 2;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);case 1: return getdefaultCase();default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);case 1: defaultCase = ( tom.library.sl.Strategy )child; return this;default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {boolean tomMatch10NameNumber_freshVar_3= false ; tom.engine.adt.tomname.types.TomName  tomMatch10NameNumber_freshVar_1= null ;if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch10NameNumber_freshVar_3= true ;tomMatch10NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}} else {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch10NameNumber_freshVar_3= true ;tomMatch10NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}}}if ((tomMatch10NameNumber_freshVar_3 ==  true )) {






 
        if(variableName == tomMatch10NameNumber_freshVar_1) {
          info.readCount++;
          info.usePosition = getPosition(); 
          if(info.readCount==2) { 
            throw new VisitFailure(); 
          }
        }  
      }}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_computeOccurencesLetRef_BaseCase( tom.library.sl.Strategy  t0,  tom.engine.adt.tomname.types.TomName  t1,  InfoVariable  t2) { return new computeOccurencesLetRef_BaseCase(t0,t1,t2);}



  /* 
   * rename variable1 into variable2
   */
  public static  tom.library.sl.Strategy  tom_make_renameVariable( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) { return 
 (tom_make_TopDown(tom_make_renameVariableOnce(variable1,variable2)) ) ;}public static class renameVariableOnce extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomname.types.TomName  variable1;private  tom.engine.adt.tomname.types.TomName  variable2;public renameVariableOnce( tom.engine.adt.tomname.types.TomName  variable1,  tom.engine.adt.tomname.types.TomName  variable2) {super(( new tom.library.sl.Identity() ));this.variable1=variable1;this.variable2=variable2;}public  tom.engine.adt.tomname.types.TomName  getvariable1() {return variable1;}public  tom.engine.adt.tomname.types.TomName  getvariable2() {return variable2;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {boolean tomMatch11NameNumber_freshVar_3= false ; tom.engine.adt.tomname.types.TomName  tomMatch11NameNumber_freshVar_1= null ;if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch11NameNumber_freshVar_3= true ;tomMatch11NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}} else {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch11NameNumber_freshVar_3= true ;tomMatch11NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}}}if ((tomMatch11NameNumber_freshVar_3 ==  true )) {





        if(variable1 == tomMatch11NameNumber_freshVar_1) {
          return (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).setAstName(variable2);
        }
      }}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_renameVariableOnce( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomname.types.TomName  t1) { return new renameVariableOnce(t0,t1);}public static class replaceVariableByExpression extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomname.types.TomName  variable;private  tom.engine.adt.tomexpression.types.Expression  exp;public replaceVariableByExpression( tom.engine.adt.tomname.types.TomName  variable,  tom.engine.adt.tomexpression.types.Expression  exp) {super(( new tom.library.sl.Identity() ));this.variable=variable;this.exp=exp;}public  tom.engine.adt.tomname.types.TomName  getvariable() {return variable;}public  tom.engine.adt.tomexpression.types.Expression  getexp() {return exp;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomterm.types.TomTerm  visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomterm.types.TomTerm) ) {boolean tomMatch12NameNumber_freshVar_3= false ; tom.engine.adt.tomname.types.TomName  tomMatch12NameNumber_freshVar_1= null ;if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch12NameNumber_freshVar_3= true ;tomMatch12NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}} else {if ( ((( tom.engine.adt.tomterm.types.TomTerm )tom__arg) instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch12NameNumber_freshVar_3= true ;tomMatch12NameNumber_freshVar_1= (( tom.engine.adt.tomterm.types.TomTerm )tom__arg).getAstName() ;}}}if ((tomMatch12NameNumber_freshVar_3 ==  true )) {






        if(variable == tomMatch12NameNumber_freshVar_1) {
          return  tom.engine.adt.tomterm.types.tomterm.ExpressionToTomTerm.make(exp) ;
        }
      }}}}return _visit_TomTerm(tom__arg,introspector); }public  tom.engine.adt.tomterm.types.TomTerm  _visit_TomTerm( tom.engine.adt.tomterm.types.TomTerm  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomterm.types.TomTerm )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomterm.types.TomTerm) ) {return ((T)visit_TomTerm((( tom.engine.adt.tomterm.types.TomTerm )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_replaceVariableByExpression( tom.engine.adt.tomname.types.TomName  t0,  tom.engine.adt.tomexpression.types.Expression  t1) { return new replaceVariableByExpression(t0,t1);}public static  tom.library.sl.Strategy  tom_make_CleanAssign( tom.engine.adt.tomname.types.TomName  varname) { return 




 (tom_make_TopDown(tom_make_CleanAssignOnce(varname))) ;}public static class CleanAssignOnce extends tom.library.sl.BasicStrategy {private  tom.engine.adt.tomname.types.TomName  varname;public CleanAssignOnce( tom.engine.adt.tomname.types.TomName  varname) {super(( new tom.library.sl.Identity() ));this.varname=varname;}public  tom.engine.adt.tomname.types.TomName  getvarname() {return varname;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.Assign) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch13NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getVariable() ;boolean tomMatch13NameNumber_freshVar_6= false ; tom.engine.adt.tomname.types.TomName  tomMatch13NameNumber_freshVar_4= null ;if ( (tomMatch13NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch13NameNumber_freshVar_6= true ;tomMatch13NameNumber_freshVar_4= tomMatch13NameNumber_freshVar_1.getAstName() ;}} else {if ( (tomMatch13NameNumber_freshVar_1 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch13NameNumber_freshVar_6= true ;tomMatch13NameNumber_freshVar_4= tomMatch13NameNumber_freshVar_1.getAstName() ;}}}if ((tomMatch13NameNumber_freshVar_6 ==  true )) {





        if(tomMatch13NameNumber_freshVar_4.equals(varname)) { return  tom.engine.adt.tominstruction.types.instruction.Nop.make() ; }
      }}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_CleanAssignOnce( tom.engine.adt.tomname.types.TomName  t0) { return new CleanAssignOnce(t0);}



  private static boolean compare(tom.library.sl.Visitable term1, tom.library.sl.Visitable term2) {
    return factory.remove(term1)==factory.remove(term2);
  }

  public static class NopElimAndFlatten extends tom.library.sl.BasicStrategy {public NopElimAndFlatten() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch14NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch14NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_end_6=tomMatch14NameNumber_freshVar_1;do {{if (!( tomMatch14NameNumber_end_6.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch14NameNumber_freshVar_10= tomMatch14NameNumber_end_6.getHeadconcInstruction() ;if ( (tomMatch14NameNumber_freshVar_10 instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) {



        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "flatten");     
        return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch14NameNumber_freshVar_1,tomMatch14NameNumber_end_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ),tom_append_list_concInstruction( tomMatch14NameNumber_freshVar_10.getInstList() ,tom_append_list_concInstruction( tomMatch14NameNumber_end_6.getTailconcInstruction() , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )))) ;
      }}if ( tomMatch14NameNumber_end_6.isEmptyconcInstruction() ) {tomMatch14NameNumber_end_6=tomMatch14NameNumber_freshVar_1;} else {tomMatch14NameNumber_end_6= tomMatch14NameNumber_end_6.getTailconcInstruction() ;}}} while(!( (tomMatch14NameNumber_end_6==tomMatch14NameNumber_freshVar_1) ));}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_freshVar_12= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch14NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch14NameNumber_freshVar_12 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_end_17=tomMatch14NameNumber_freshVar_12;do {{if (!( tomMatch14NameNumber_end_17.isEmptyconcInstruction() )) {if ( ( tomMatch14NameNumber_end_17.getHeadconcInstruction()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "nop-elim");     
        return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch14NameNumber_freshVar_12,tomMatch14NameNumber_end_17, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ),tom_append_list_concInstruction( tomMatch14NameNumber_end_17.getTailconcInstruction() , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ))) ;
      }}if ( tomMatch14NameNumber_end_17.isEmptyconcInstruction() ) {tomMatch14NameNumber_end_17=tomMatch14NameNumber_freshVar_12;} else {tomMatch14NameNumber_end_17= tomMatch14NameNumber_end_17.getTailconcInstruction() ;}}} while(!( (tomMatch14NameNumber_end_17==tomMatch14NameNumber_freshVar_12) ));}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_freshVar_22= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch14NameNumber_freshVar_22 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch14NameNumber_freshVar_22 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if ( tomMatch14NameNumber_freshVar_22.isEmptyconcInstruction() ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "abstractblock-elim1");     
        return  tom.engine.adt.tominstruction.types.instruction.Nop.make() ;
      }}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch14NameNumber_freshVar_26= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch14NameNumber_freshVar_26 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch14NameNumber_freshVar_26 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) {if (!( tomMatch14NameNumber_freshVar_26.isEmptyconcInstruction() )) {if (  tomMatch14NameNumber_freshVar_26.getTailconcInstruction() .isEmptyconcInstruction() ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "abstractblock-elim2");     
        return  tomMatch14NameNumber_freshVar_26.getHeadconcInstruction() ;
      }}}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {if ( ( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSuccesInst()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {if ( ( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getFailureInst()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "ifnopnop-elim");     
        return  tom.engine.adt.tominstruction.types.instruction.Nop.make() ;
      }}}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {if ( ( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getCondition()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "iftrue-elim");     
        return  (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getSuccesInst() ;
      }}}}{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.If) ) {if ( ( (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getCondition()  instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {


        logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "iffalse-elim");     
        return  (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getFailureInst() ;
      }}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_NopElimAndFlatten() { return new NopElimAndFlatten();}





  /*
   * two expressions are incompatible when they cannot be true a the same time
   */ 
  private boolean incompatible(Expression c1, Expression c2) {
    try {
      Expression res = (Expression) tom_make_InnermostId(tom_make_NormExpr(this)).visitLight( tom.engine.adt.tomexpression.types.expression.And.make(c1, c2) );
      return res == tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
    } catch(VisitFailure e) {
      return false;
    }
  }

  public static class IfSwapping extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public IfSwapping( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch15NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch15NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch15NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch15NameNumber_end_6=tomMatch15NameNumber_freshVar_1;do {{if (!( tomMatch15NameNumber_end_6.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch15NameNumber_freshVar_13= tomMatch15NameNumber_end_6.getHeadconcInstruction() ;if ( (tomMatch15NameNumber_freshVar_13 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch15NameNumber_freshVar_10= tomMatch15NameNumber_freshVar_13.getCondition() ;if ( ( tomMatch15NameNumber_freshVar_13.getFailureInst()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch15NameNumber_freshVar_7= tomMatch15NameNumber_end_6.getTailconcInstruction() ;if (!( tomMatch15NameNumber_freshVar_7.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch15NameNumber_freshVar_18= tomMatch15NameNumber_freshVar_7.getHeadconcInstruction() ;if ( (tomMatch15NameNumber_freshVar_18 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch15NameNumber_freshVar_15= tomMatch15NameNumber_freshVar_18.getCondition() ;if ( ( tomMatch15NameNumber_freshVar_18.getFailureInst()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {


        String s1 = factory.prettyPrint(factory.remove(tomMatch15NameNumber_freshVar_10));
        String s2 = factory.prettyPrint(factory.remove(tomMatch15NameNumber_freshVar_15));
        if(s1.compareTo(s2) < 0) {
          /* swap two incompatible conditions */
          if(optimizer.incompatible(tomMatch15NameNumber_freshVar_10,tomMatch15NameNumber_freshVar_15)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "if-swapping");     
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch15NameNumber_freshVar_1,tomMatch15NameNumber_end_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ), tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tomMatch15NameNumber_freshVar_7.getHeadconcInstruction() , tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tomMatch15NameNumber_end_6.getHeadconcInstruction() ,tom_append_list_concInstruction( tomMatch15NameNumber_freshVar_7.getTailconcInstruction() , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) ) )) ;
          }
        }
      }}}}}}if ( tomMatch15NameNumber_end_6.isEmptyconcInstruction() ) {tomMatch15NameNumber_end_6=tomMatch15NameNumber_freshVar_1;} else {tomMatch15NameNumber_end_6= tomMatch15NameNumber_end_6.getTailconcInstruction() ;}}} while(!( (tomMatch15NameNumber_end_6==tomMatch15NameNumber_freshVar_1) ));}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_IfSwapping( TomOptimizer  t0) { return new IfSwapping(t0);}public static class BlockFusion extends tom.library.sl.BasicStrategy {public BlockFusion() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch16NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch16NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch16NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch16NameNumber_end_6=tomMatch16NameNumber_freshVar_1;do {{ tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch16NameNumber_freshVar_1,tomMatch16NameNumber_end_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );if (!( tomMatch16NameNumber_end_6.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch16NameNumber_freshVar_13= tomMatch16NameNumber_end_6.getHeadconcInstruction() ;if ( (tomMatch16NameNumber_freshVar_13 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch16NameNumber_freshVar_10= tomMatch16NameNumber_freshVar_13.getVariable() ; tom.engine.adt.tomexpression.types.Expression  tomMatch16NameNumber_freshVar_11= tomMatch16NameNumber_freshVar_13.getSource() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch16NameNumber_freshVar_12= tomMatch16NameNumber_freshVar_13.getAstInstruction() ;boolean tomMatch16NameNumber_freshVar_23= false ; tom.engine.adt.tomname.types.TomName  tomMatch16NameNumber_freshVar_14= null ;if ( (tomMatch16NameNumber_freshVar_10 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch16NameNumber_freshVar_23= true ;tomMatch16NameNumber_freshVar_14= tomMatch16NameNumber_freshVar_10.getAstName() ;}} else {if ( (tomMatch16NameNumber_freshVar_10 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch16NameNumber_freshVar_23= true ;tomMatch16NameNumber_freshVar_14= tomMatch16NameNumber_freshVar_10.getAstName() ;}}}if ((tomMatch16NameNumber_freshVar_23 ==  true )) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch16NameNumber_freshVar_7= tomMatch16NameNumber_end_6.getTailconcInstruction() ;if (!( tomMatch16NameNumber_freshVar_7.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch16NameNumber_freshVar_19= tomMatch16NameNumber_freshVar_7.getHeadconcInstruction() ;if ( (tomMatch16NameNumber_freshVar_19 instanceof tom.engine.adt.tominstruction.types.instruction.Let) ) { tom.engine.adt.tomterm.types.TomTerm  tomMatch16NameNumber_freshVar_16= tomMatch16NameNumber_freshVar_19.getVariable() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch16NameNumber_freshVar_18= tomMatch16NameNumber_freshVar_19.getAstInstruction() ;boolean tomMatch16NameNumber_freshVar_22= false ; tom.engine.adt.tomname.types.TomName  tomMatch16NameNumber_freshVar_20= null ;if ( (tomMatch16NameNumber_freshVar_16 instanceof tom.engine.adt.tomterm.types.tomterm.Variable) ) {{tomMatch16NameNumber_freshVar_22= true ;tomMatch16NameNumber_freshVar_20= tomMatch16NameNumber_freshVar_16.getAstName() ;}} else {if ( (tomMatch16NameNumber_freshVar_16 instanceof tom.engine.adt.tomterm.types.tomterm.VariableStar) ) {{tomMatch16NameNumber_freshVar_22= true ;tomMatch16NameNumber_freshVar_20= tomMatch16NameNumber_freshVar_16.getAstName() ;}}}if ((tomMatch16NameNumber_freshVar_22 ==  true )) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch16NameNumber_freshVar_8= tomMatch16NameNumber_freshVar_7.getTailconcInstruction() ;









        /* Fusion de 2 blocs Let contigus instanciant deux variables egales */
        if(compare(tomMatch16NameNumber_freshVar_11, tomMatch16NameNumber_freshVar_19.getSource() )) {
          if(compare(tomMatch16NameNumber_freshVar_10,tomMatch16NameNumber_freshVar_16)) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "block-fusion1");
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.Let.make(tomMatch16NameNumber_freshVar_10, tomMatch16NameNumber_freshVar_11,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch16NameNumber_freshVar_12, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch16NameNumber_freshVar_18, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tomMatch16NameNumber_freshVar_8, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
          } else {
            InfoVariable info = new InfoVariable();
            tom_make_computeOccurencesLet(tomMatch16NameNumber_freshVar_14,info).visit(tomMatch16NameNumber_freshVar_18);
            int mult = info.readCount; 
            if(mult==0) {
              logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "block-fusion2");
              Instruction newBody2 =  (Instruction)(tom_make_renameVariable(tomMatch16NameNumber_freshVar_20,tomMatch16NameNumber_freshVar_14).visitLight(tomMatch16NameNumber_freshVar_18));
              return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.Let.make(tomMatch16NameNumber_freshVar_10, tomMatch16NameNumber_freshVar_11,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch16NameNumber_freshVar_12, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(newBody2, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tomMatch16NameNumber_freshVar_8, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
            }
          }
        }
      }}}}}}if ( tomMatch16NameNumber_end_6.isEmptyconcInstruction() ) {tomMatch16NameNumber_end_6=tomMatch16NameNumber_freshVar_1;} else {tomMatch16NameNumber_end_6= tomMatch16NameNumber_end_6.getTailconcInstruction() ;}}} while(!( (tomMatch16NameNumber_end_6==tomMatch16NameNumber_freshVar_1) ));}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_BlockFusion() { return new BlockFusion();}public static class IfFusion extends tom.library.sl.BasicStrategy {public IfFusion() {super(( new tom.library.sl.Identity() ));}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch17NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch17NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch17NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch17NameNumber_end_6=tomMatch17NameNumber_freshVar_1;do {{ tom.engine.adt.tominstruction.types.InstructionList  tom_X1=tom_get_slice_concInstruction(tomMatch17NameNumber_freshVar_1,tomMatch17NameNumber_end_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() );if (!( tomMatch17NameNumber_end_6.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_13= tomMatch17NameNumber_end_6.getHeadconcInstruction() ;if ( (tomMatch17NameNumber_freshVar_13 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch17NameNumber_freshVar_10= tomMatch17NameNumber_freshVar_13.getCondition() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_11= tomMatch17NameNumber_freshVar_13.getSuccesInst() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_12= tomMatch17NameNumber_freshVar_13.getFailureInst() ; tom.engine.adt.tominstruction.types.InstructionList  tomMatch17NameNumber_freshVar_7= tomMatch17NameNumber_end_6.getTailconcInstruction() ;if (!( tomMatch17NameNumber_freshVar_7.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_17= tomMatch17NameNumber_freshVar_7.getHeadconcInstruction() ;if ( (tomMatch17NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_15= tomMatch17NameNumber_freshVar_17.getSuccesInst() ; tom.engine.adt.tominstruction.types.Instruction  tomMatch17NameNumber_freshVar_16= tomMatch17NameNumber_freshVar_17.getFailureInst() ; tom.engine.adt.tominstruction.types.InstructionList  tomMatch17NameNumber_freshVar_8= tomMatch17NameNumber_freshVar_7.getTailconcInstruction() ;









        /* Fusion de 2 blocs If gardes par la meme condition */
        if(compare(tomMatch17NameNumber_freshVar_10, tomMatch17NameNumber_freshVar_17.getCondition() )) {
          if(tomMatch17NameNumber_freshVar_12.isNop() && tomMatch17NameNumber_freshVar_16.isNop()) {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "if-fusion1");
            Instruction res =  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tomMatch17NameNumber_freshVar_10,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_11, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_15, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ,  tom.engine.adt.tominstruction.types.instruction.Nop.make() ) ,tom_append_list_concInstruction(tomMatch17NameNumber_freshVar_8, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
            //System.out.println(res);

            return res;
          } else {
            logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "if-fusion2");
            return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_X1, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tomMatch17NameNumber_freshVar_10,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_11, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_15, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_12, tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make(tomMatch17NameNumber_freshVar_16, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction(tomMatch17NameNumber_freshVar_8, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
          }
        }
      }}}}if ( tomMatch17NameNumber_end_6.isEmptyconcInstruction() ) {tomMatch17NameNumber_end_6=tomMatch17NameNumber_freshVar_1;} else {tomMatch17NameNumber_end_6= tomMatch17NameNumber_end_6.getTailconcInstruction() ;}}} while(!( (tomMatch17NameNumber_end_6==tomMatch17NameNumber_freshVar_1) ));}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_IfFusion() { return new IfFusion();}public static class InterBlock extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public InterBlock( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tominstruction.types.Instruction  visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tominstruction.types.Instruction) ) {if ( ((( tom.engine.adt.tominstruction.types.Instruction )tom__arg) instanceof tom.engine.adt.tominstruction.types.instruction.AbstractBlock) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch18NameNumber_freshVar_1= (( tom.engine.adt.tominstruction.types.Instruction )tom__arg).getInstList() ;if ( ((tomMatch18NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction) || (tomMatch18NameNumber_freshVar_1 instanceof tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction)) ) { tom.engine.adt.tominstruction.types.InstructionList  tomMatch18NameNumber_end_6=tomMatch18NameNumber_freshVar_1;do {{if (!( tomMatch18NameNumber_end_6.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch18NameNumber_freshVar_13= tomMatch18NameNumber_end_6.getHeadconcInstruction() ;if ( (tomMatch18NameNumber_freshVar_13 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch18NameNumber_freshVar_10= tomMatch18NameNumber_freshVar_13.getCondition() ; tom.engine.adt.tominstruction.types.InstructionList  tomMatch18NameNumber_freshVar_7= tomMatch18NameNumber_end_6.getTailconcInstruction() ;if (!( tomMatch18NameNumber_freshVar_7.isEmptyconcInstruction() )) { tom.engine.adt.tominstruction.types.Instruction  tomMatch18NameNumber_freshVar_17= tomMatch18NameNumber_freshVar_7.getHeadconcInstruction() ;if ( (tomMatch18NameNumber_freshVar_17 instanceof tom.engine.adt.tominstruction.types.instruction.If) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch18NameNumber_freshVar_14= tomMatch18NameNumber_freshVar_17.getCondition() ;if ( ( tomMatch18NameNumber_freshVar_17.getFailureInst()  instanceof tom.engine.adt.tominstruction.types.instruction.Nop) ) {










        if(optimizer.incompatible(tomMatch18NameNumber_freshVar_10,tomMatch18NameNumber_freshVar_14)) {
          logger.log( Level.INFO, TomMessage.tomOptimizationType.getMessage(), "inter-block");
          return  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make(tom_append_list_concInstruction(tom_get_slice_concInstruction(tomMatch18NameNumber_freshVar_1,tomMatch18NameNumber_end_6, tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ), tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tomMatch18NameNumber_freshVar_10,  tomMatch18NameNumber_freshVar_13.getSuccesInst() ,  tom.engine.adt.tominstruction.types.instruction.AbstractBlock.make( tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tomMatch18NameNumber_freshVar_13.getFailureInst() , tom.engine.adt.tominstruction.types.instructionlist.ConsconcInstruction.make( tom.engine.adt.tominstruction.types.instruction.If.make(tomMatch18NameNumber_freshVar_14,  tomMatch18NameNumber_freshVar_17.getSuccesInst() ,  tom.engine.adt.tominstruction.types.instruction.Nop.make() ) , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() ) ) ) ) ,tom_append_list_concInstruction( tomMatch18NameNumber_freshVar_7.getTailconcInstruction() , tom.engine.adt.tominstruction.types.instructionlist.EmptyconcInstruction.make() )) )) ;
        }  
      }}}}}if ( tomMatch18NameNumber_end_6.isEmptyconcInstruction() ) {tomMatch18NameNumber_end_6=tomMatch18NameNumber_freshVar_1;} else {tomMatch18NameNumber_end_6= tomMatch18NameNumber_end_6.getTailconcInstruction() ;}}} while(!( (tomMatch18NameNumber_end_6==tomMatch18NameNumber_freshVar_1) ));}}}}}return _visit_Instruction(tom__arg,introspector); }public  tom.engine.adt.tominstruction.types.Instruction  _visit_Instruction( tom.engine.adt.tominstruction.types.Instruction  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tominstruction.types.Instruction )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tominstruction.types.Instruction) ) {return ((T)visit_Instruction((( tom.engine.adt.tominstruction.types.Instruction )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_InterBlock( TomOptimizer  t0) { return new InterBlock(t0);}public static class NormExpr extends tom.library.sl.BasicStrategy {private  TomOptimizer  optimizer;public NormExpr( TomOptimizer  optimizer) {super(( new tom.library.sl.Identity() ));this.optimizer=optimizer;}public  TomOptimizer  getoptimizer() {return optimizer;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.engine.adt.tomexpression.types.Expression  visit_Expression( tom.engine.adt.tomexpression.types.Expression  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2()  instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {return  (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.Or) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1()  instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {return  (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.And) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {return  (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.And) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {return  (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.And) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1()  instanceof tom.engine.adt.tomexpression.types.expression.FalseTL) ) {return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.And) ) {if ( ( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1()  instanceof tom.engine.adt.tomexpression.types.expression.TrueTL) ) {return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;}}}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.EqualTerm) ) {















        //System.out.println("kid1 = " + `kid1);
        //System.out.println("kid2 = " + `kid2);
        if(compare( (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getKid1() , (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getKid2() )) {
          return  tom.engine.adt.tomexpression.types.expression.TrueTL.make() ;
        } else {
          return (( tom.engine.adt.tomexpression.types.Expression )tom__arg);
        }
      }}}{if ( (tom__arg instanceof tom.engine.adt.tomexpression.types.Expression) ) {if ( ((( tom.engine.adt.tomexpression.types.Expression )tom__arg) instanceof tom.engine.adt.tomexpression.types.expression.And) ) { tom.engine.adt.tomexpression.types.Expression  tomMatch19NameNumber_freshVar_46= (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg1() ; tom.engine.adt.tomexpression.types.Expression  tomMatch19NameNumber_freshVar_47= (( tom.engine.adt.tomexpression.types.Expression )tom__arg).getArg2() ;if ( (tomMatch19NameNumber_freshVar_46 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) { tom.engine.adt.tomname.types.TomName  tomMatch19NameNumber_freshVar_49= tomMatch19NameNumber_freshVar_46.getAstName() ; tom.engine.adt.tomterm.types.TomTerm  tomMatch19NameNumber_freshVar_50= tomMatch19NameNumber_freshVar_46.getVariable() ;if ( (tomMatch19NameNumber_freshVar_47 instanceof tom.engine.adt.tomexpression.types.expression.IsFsym) ) {if ( ( tomMatch19NameNumber_freshVar_47.getVariable() ==tomMatch19NameNumber_freshVar_50) ) {


        if(tomMatch19NameNumber_freshVar_49== tomMatch19NameNumber_freshVar_47.getAstName() ) {
          return  tom.engine.adt.tomexpression.types.expression.IsFsym.make(tomMatch19NameNumber_freshVar_49, tomMatch19NameNumber_freshVar_50) ;
        }
        /*
         * may be true for list operator with domain=codomain
         * two if_sym(f)==is_fsym(g) may be true due to mapping
         */
        TomSymbol tomSymbol = optimizer.symbolTable().getSymbolFromName(tomMatch19NameNumber_freshVar_49.getString());
        if(TomBase.isListOperator(tomSymbol) || TomBase.isArrayOperator(tomSymbol)) {
          TomType domain = TomBase.getSymbolDomain(tomSymbol).getHeadconcTomType();
          TomType codomain = TomBase.getSymbolCodomain(tomSymbol);
          if(domain!=codomain) {
            return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
          }
        } else {
          return  tom.engine.adt.tomexpression.types.expression.FalseTL.make() ;
        }
        return (( tom.engine.adt.tomexpression.types.Expression )tom__arg);
      }}}}}}}return _visit_Expression(tom__arg,introspector); }public  tom.engine.adt.tomexpression.types.Expression  _visit_Expression( tom.engine.adt.tomexpression.types.Expression  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.engine.adt.tomexpression.types.Expression )any.visit(environment,introspector));} else {return any.visitLight(arg,introspector);} }public <T> T visitLight(T v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.engine.adt.tomexpression.types.Expression) ) {return ((T)visit_Expression((( tom.engine.adt.tomexpression.types.Expression )v),introspector));}if (!((environment ==  null ))) {return ((T)any.visit(environment,introspector));} else {return any.visitLight(v,introspector);} }}public static  tom.library.sl.Strategy  tom_make_NormExpr( TomOptimizer  t0) { return new NormExpr(t0);}



} // class TomOptimizer
