/* Generated by TOM (version 2.6): Do not edit this file *//*
 *
 * GOM
 *
 * Copyright (c) 2007-2008, INRIA
 * Nancy, France.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
 *
 * Antoine Reilles  e-mail: Antoine.Reilles@loria.fr
 *
 **/

package tom.gom.expander.rule;

import org.antlr.runtime.CommonTokenStream;
import org.antlr.runtime.ANTLRStringStream;
import org.antlr.runtime.tree.Tree;
import tom.gom.adt.rule.RuleTree;
import tom.gom.adt.rule.RuleAdaptor;
import java.util.logging.Level;
import java.util.Map;
import java.util.HashMap;
import java.util.Iterator;
import java.util.logging.Logger;
import tom.gom.GomMessage;
import tom.gom.adt.gom.types.*;
import tom.gom.adt.rule.types.*;
import tom.gom.tools.error.GomRuntimeException;

public class RuleExpander {

  /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */  /* Generated by TOM (version 2.6): Do not edit this file */    private static   tom.gom.adt.gom.types.HookDeclList  tom_append_list_ConcHookDecl( tom.gom.adt.gom.types.HookDeclList l1,  tom.gom.adt.gom.types.HookDeclList  l2) {     if( l1.isEmptyConcHookDecl() ) {       return l2;     } else if( l2.isEmptyConcHookDecl() ) {       return l1;     } else if(  l1.getTailConcHookDecl() .isEmptyConcHookDecl() ) {       return  tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( l1.getHeadConcHookDecl() ,l2) ;     } else {       return  tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( l1.getHeadConcHookDecl() ,tom_append_list_ConcHookDecl( l1.getTailConcHookDecl() ,l2)) ;     }   }   private static   tom.gom.adt.gom.types.HookDeclList  tom_get_slice_ConcHookDecl( tom.gom.adt.gom.types.HookDeclList  begin,  tom.gom.adt.gom.types.HookDeclList  end, tom.gom.adt.gom.types.HookDeclList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyConcHookDecl()  ||  (end== tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( begin.getHeadConcHookDecl() ,( tom.gom.adt.gom.types.HookDeclList )tom_get_slice_ConcHookDecl( begin.getTailConcHookDecl() ,end,tail)) ;   }      private static   tom.gom.adt.gom.types.SlotList  tom_append_list_ConcSlot( tom.gom.adt.gom.types.SlotList l1,  tom.gom.adt.gom.types.SlotList  l2) {     if( l1.isEmptyConcSlot() ) {       return l2;     } else if( l2.isEmptyConcSlot() ) {       return l1;     } else if(  l1.getTailConcSlot() .isEmptyConcSlot() ) {       return  tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( l1.getHeadConcSlot() ,l2) ;     } else {       return  tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( l1.getHeadConcSlot() ,tom_append_list_ConcSlot( l1.getTailConcSlot() ,l2)) ;     }   }   private static   tom.gom.adt.gom.types.SlotList  tom_get_slice_ConcSlot( tom.gom.adt.gom.types.SlotList  begin,  tom.gom.adt.gom.types.SlotList  end, tom.gom.adt.gom.types.SlotList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyConcSlot()  ||  (end== tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( begin.getHeadConcSlot() ,( tom.gom.adt.gom.types.SlotList )tom_get_slice_ConcSlot( begin.getTailConcSlot() ,end,tail)) ;   }    /* Generated by TOM (version 2.6): Do not edit this file */   private static   tom.gom.adt.rule.types.RuleList  tom_append_list_RuleList( tom.gom.adt.rule.types.RuleList l1,  tom.gom.adt.rule.types.RuleList  l2) {     if( l1.isEmptyRuleList() ) {       return l2;     } else if( l2.isEmptyRuleList() ) {       return l1;     } else if(  l1.getTailRuleList() .isEmptyRuleList() ) {       return  tom.gom.adt.rule.types.rulelist.ConsRuleList.make( l1.getHeadRuleList() ,l2) ;     } else {       return  tom.gom.adt.rule.types.rulelist.ConsRuleList.make( l1.getHeadRuleList() ,tom_append_list_RuleList( l1.getTailRuleList() ,l2)) ;     }   }   private static   tom.gom.adt.rule.types.RuleList  tom_get_slice_RuleList( tom.gom.adt.rule.types.RuleList  begin,  tom.gom.adt.rule.types.RuleList  end, tom.gom.adt.rule.types.RuleList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyRuleList()  ||  (end== tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.rule.types.rulelist.ConsRuleList.make( begin.getHeadRuleList() ,( tom.gom.adt.rule.types.RuleList )tom_get_slice_RuleList( begin.getTailRuleList() ,end,tail)) ;   }      private static   tom.gom.adt.rule.types.TermList  tom_append_list_TermList( tom.gom.adt.rule.types.TermList l1,  tom.gom.adt.rule.types.TermList  l2) {     if( l1.isEmptyTermList() ) {       return l2;     } else if( l2.isEmptyTermList() ) {       return l1;     } else if(  l1.getTailTermList() .isEmptyTermList() ) {       return  tom.gom.adt.rule.types.termlist.ConsTermList.make( l1.getHeadTermList() ,l2) ;     } else {       return  tom.gom.adt.rule.types.termlist.ConsTermList.make( l1.getHeadTermList() ,tom_append_list_TermList( l1.getTailTermList() ,l2)) ;     }   }   private static   tom.gom.adt.rule.types.TermList  tom_get_slice_TermList( tom.gom.adt.rule.types.TermList  begin,  tom.gom.adt.rule.types.TermList  end, tom.gom.adt.rule.types.TermList  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyTermList()  ||  (end== tom.gom.adt.rule.types.termlist.EmptyTermList.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.rule.types.termlist.ConsTermList.make( begin.getHeadTermList() ,( tom.gom.adt.rule.types.TermList )tom_get_slice_TermList( begin.getTailTermList() ,end,tail)) ;   }      private static   tom.gom.adt.rule.types.Condition  tom_append_list_CondAnd( tom.gom.adt.rule.types.Condition  l1,  tom.gom.adt.rule.types.Condition  l2) {     if( l1.isEmptyCondAnd() ) {       return l2;     } else if( l2.isEmptyCondAnd() ) {       return l1;     } else if( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) ) {       if( (( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? l1.getTailCondAnd() : tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ).isEmptyCondAnd() ) {         return  tom.gom.adt.rule.types.condition.ConsCondAnd.make((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? l1.getHeadCondAnd() :l1),l2) ;       } else {         return  tom.gom.adt.rule.types.condition.ConsCondAnd.make((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? l1.getHeadCondAnd() :l1),tom_append_list_CondAnd((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? l1.getTailCondAnd() : tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ),l2)) ;       }     } else {       return  tom.gom.adt.rule.types.condition.ConsCondAnd.make(l1,l2) ;     }   }   private static   tom.gom.adt.rule.types.Condition  tom_get_slice_CondAnd( tom.gom.adt.rule.types.Condition  begin,  tom.gom.adt.rule.types.Condition  end, tom.gom.adt.rule.types.Condition  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyCondAnd()  ||  (end== tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.rule.types.condition.ConsCondAnd.make((( ((begin instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (begin instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? begin.getHeadCondAnd() :begin),( tom.gom.adt.rule.types.Condition )tom_get_slice_CondAnd((( ((begin instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (begin instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )? begin.getTailCondAnd() : tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ),end,tail)) ;   }      private static   tom.gom.adt.rule.types.Condition  tom_append_list_CondOr( tom.gom.adt.rule.types.Condition  l1,  tom.gom.adt.rule.types.Condition  l2) {     if( l1.isEmptyCondOr() ) {       return l2;     } else if( l2.isEmptyCondOr() ) {       return l1;     } else if( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) ) {       if( (( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? l1.getTailCondOr() : tom.gom.adt.rule.types.condition.EmptyCondOr.make() ).isEmptyCondOr() ) {         return  tom.gom.adt.rule.types.condition.ConsCondOr.make((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? l1.getHeadCondOr() :l1),l2) ;       } else {         return  tom.gom.adt.rule.types.condition.ConsCondOr.make((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? l1.getHeadCondOr() :l1),tom_append_list_CondOr((( ((l1 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (l1 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? l1.getTailCondOr() : tom.gom.adt.rule.types.condition.EmptyCondOr.make() ),l2)) ;       }     } else {       return  tom.gom.adt.rule.types.condition.ConsCondOr.make(l1,l2) ;     }   }   private static   tom.gom.adt.rule.types.Condition  tom_get_slice_CondOr( tom.gom.adt.rule.types.Condition  begin,  tom.gom.adt.rule.types.Condition  end, tom.gom.adt.rule.types.Condition  tail) {     if( (begin==end) ) {       return tail;     } else if( (end==tail)  && ( end.isEmptyCondOr()  ||  (end== tom.gom.adt.rule.types.condition.EmptyCondOr.make() ) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return  tom.gom.adt.rule.types.condition.ConsCondOr.make((( ((begin instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (begin instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? begin.getHeadCondOr() :begin),( tom.gom.adt.rule.types.Condition )tom_get_slice_CondOr((( ((begin instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (begin instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )? begin.getTailCondOr() : tom.gom.adt.rule.types.condition.EmptyCondOr.make() ),end,tail)) ;   }    /* Generated by TOM (version 2.6): Do not edit this file *//* Generated by TOM (version 2.6): Do not edit this file */   private static   tom.library.sl.Strategy  tom_append_list_Sequence( tom.library.sl.Strategy  l1,  tom.library.sl.Strategy  l2) {     if(( l1 == null )) {       return l2;     } else if(( l2 == null )) {       return l1;     } else if(( (l1 instanceof tom.library.sl.Sequence) )) {       if(( ((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )) == null )) {         return ( (l2==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),l2) );       } else {         return ( (tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)==null)?((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1):new tom.library.sl.Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.FIRST) ):l1),tom_append_list_Sequence(((( (l1 instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)l1.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),l2)) );       }     } else {       return ( (l2==null)?l1:new tom.library.sl.Sequence(l1,l2) );     }   }   private static   tom.library.sl.Strategy  tom_get_slice_Sequence( tom.library.sl.Strategy  begin,  tom.library.sl.Strategy  end, tom.library.sl.Strategy  tail) {     if( (begin.equals(end)) ) {       return tail;     } else if( (end.equals(tail))  && (( end == null ) ||  (end.equals(( null ))) )) {       /* code to avoid a call to make, and thus to avoid looping during list-matching */       return begin;     }     return ( (( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)==null)?((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin):new tom.library.sl.Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.FIRST) ):begin),( tom.library.sl.Strategy )tom_get_slice_Sequence(((( (begin instanceof tom.library.sl.Sequence) ))?( (tom.library.sl.Strategy)begin.getChildAt(tom.library.sl.Sequence.THEN) ):( null )),end,tail)) );   }    /* Generated by TOM (version 2.6): Do not edit this file */ /* Generated by TOM (version 2.6): Do not edit this file */private static  tom.library.sl.Strategy  tom_make_TopDown( tom.library.sl.Strategy  v) { return ( ( new tom.library.sl.Mu(( new tom.library.sl.MuVar("_x") ),( (( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )==null)?v:new tom.library.sl.Sequence(v,( (( null )==null)?( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ):new tom.library.sl.Sequence(( new tom.library.sl.All(( new tom.library.sl.MuVar("_x") )) ),( null )) )) )) ) );}   



  private ModuleList moduleList;

  public RuleExpander(ModuleList data) {
    this.moduleList = data;
  }

  public HookDeclList expandRules(String ruleCode) {
    RuleLexer lexer = new RuleLexer(new ANTLRStringStream(ruleCode));
    CommonTokenStream tokens = new CommonTokenStream(lexer);
    RuleParser parser = new RuleParser(tokens);
    parser.setTreeAdaptor(new RuleAdaptor());
    RuleList rulelist =  tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ;
    try {
      RuleTree ast = (RuleTree) parser.ruleset().getTree();
      rulelist = (RuleList) ast.getTerm();
    } catch (org.antlr.runtime.RecognitionException e) {
      getLogger().log(Level.SEVERE, "Cannot parse rules",
          new Object[]{});
      return  tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ;
    }
    return expand(rulelist);
  }

  protected HookDeclList expand(RuleList rulelist) {
    HookDeclList hookList =  tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ;
    /* collect all rules for a given symbol */
    Map rulesForOperator = new HashMap();
    {{ Object tomMatch512NameNumber_freshVar_0=rulelist;if ( (tomMatch512NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.RuleList) ) {{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.RuleList )tomMatch512NameNumber_freshVar_0);{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumber_freshVar_1=tomMatch512NameNumberfreshSubject_1;if ( ((tomMatch512NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.rulelist.ConsRuleList) || (tomMatch512NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.rulelist.EmptyRuleList)) ) {{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumber_begin_3=tomMatch512NameNumber_freshVar_1;{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumber_end_4=tomMatch512NameNumber_freshVar_1;do {{{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumber_freshVar_2=tomMatch512NameNumber_end_4;if (!( tomMatch512NameNumber_freshVar_2.isEmptyRuleList() )) {{  tom.gom.adt.rule.types.Rule  tomMatch512NameNumber_freshVar_8= tomMatch512NameNumber_freshVar_2.getHeadRuleList() ;{ boolean tomMatch512NameNumber_freshVar_11= false ;{  tom.gom.adt.rule.types.Term  tomMatch512NameNumber_freshVar_7= null ;if ( (tomMatch512NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{tomMatch512NameNumber_freshVar_11= true ;tomMatch512NameNumber_freshVar_7= tomMatch512NameNumber_freshVar_8.getlhs() ;}} else {if ( (tomMatch512NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{tomMatch512NameNumber_freshVar_11= true ;tomMatch512NameNumber_freshVar_7= tomMatch512NameNumber_freshVar_8.getlhs() ;}}}if ((tomMatch512NameNumber_freshVar_11 ==  true )) {{  tom.gom.adt.rule.types.Term  tomMatch512NameNumber_freshVar_10=tomMatch512NameNumber_freshVar_7;if ( (tomMatch512NameNumber_freshVar_10 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  String  tomMatch512NameNumber_freshVar_9= tomMatch512NameNumber_freshVar_10.getsymbol() ;{  tom.gom.adt.rule.types.Rule  tom_rl= tomMatch512NameNumber_freshVar_2.getHeadRuleList() ;{  tom.gom.adt.rule.types.RuleList  tomMatch512NameNumber_freshVar_5= tomMatch512NameNumber_freshVar_2.getTailRuleList() ;if ( true ) {

        OperatorDecl decl = getOperatorDecl(tomMatch512NameNumber_freshVar_9);
        if(null!=decl) {
          RuleList rules = (RuleList) rulesForOperator.get(decl);
          if (null == rules) {
            rulesForOperator.put(decl, tom.gom.adt.rule.types.rulelist.ConsRuleList.make(tom_rl, tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ) );
          } else {
            rulesForOperator.put(decl,tom_append_list_RuleList(rules, tom.gom.adt.rule.types.rulelist.ConsRuleList.make(tom_rl, tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ) ));
          }
        } else {
          getLogger().log(Level.WARNING, "Discard rule \"{0}\"",
              new Object[]{/*XXX:prettyprint*/(tom_rl)});
        }
      }}}}}}}}}}}}if ( tomMatch512NameNumber_end_4.isEmptyRuleList() ) {tomMatch512NameNumber_end_4=tomMatch512NameNumber_begin_3;} else {tomMatch512NameNumber_end_4= tomMatch512NameNumber_end_4.getTailRuleList() ;}}} while(!( (tomMatch512NameNumber_end_4==tomMatch512NameNumber_begin_3) ));}}}}}}}}

    /* Generate a construction hook for each constructor */
    Iterator it = rulesForOperator.keySet().iterator();
    while (it.hasNext()) {
      OperatorDecl opDecl = (OperatorDecl) it.next();
      TypedProduction prod = opDecl.getProd();
      {{ Object tomMatch513NameNumber_freshVar_0=prod;if ( (tomMatch513NameNumber_freshVar_0 instanceof tom.gom.adt.gom.types.TypedProduction) ) {{  tom.gom.adt.gom.types.TypedProduction  tomMatch513NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.TypedProduction )tomMatch513NameNumber_freshVar_0);{  tom.gom.adt.gom.types.TypedProduction  tomMatch513NameNumber_freshVar_2=tomMatch513NameNumberfreshSubject_1;if ( (tomMatch513NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.typedproduction.Slots) ) {{  tom.gom.adt.gom.types.SlotList  tomMatch513NameNumber_freshVar_1= tomMatch513NameNumber_freshVar_2.getSlots() ;if ( true ) {


          SlotList args = opArgs(tomMatch513NameNumber_freshVar_1,1);
          String hookCode =
            generateHookCode(args, (RuleList) rulesForOperator.get(opDecl));
          hookList =
            tom_append_list_ConcHookDecl(hookList, tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( tom.gom.adt.gom.types.hookdecl.MakeHookDecl.make( tom.gom.adt.gom.types.decl.CutOperator.make(opDecl) , args,  tom.gom.adt.code.types.code.Code.make(hookCode) ,  tom.gom.adt.gom.types.hookkind.HookKind.make("rules") ) , tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ) )
;
        }}}}}}}{ Object tomMatch513NameNumber_freshVar_3=prod;if ( (tomMatch513NameNumber_freshVar_3 instanceof tom.gom.adt.gom.types.TypedProduction) ) {{  tom.gom.adt.gom.types.TypedProduction  tomMatch513NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.TypedProduction )tomMatch513NameNumber_freshVar_3);{  tom.gom.adt.gom.types.TypedProduction  tomMatch513NameNumber_freshVar_5=tomMatch513NameNumberfreshSubject_1;if ( (tomMatch513NameNumber_freshVar_5 instanceof tom.gom.adt.gom.types.typedproduction.Variadic) ) {{  tom.gom.adt.gom.types.SortDecl  tomMatch513NameNumber_freshVar_4= tomMatch513NameNumber_freshVar_5.getSort() ;if ( true ) {


          RuleList rules = (RuleList) rulesForOperator.get(opDecl);
          /* Handle rules for empty: there should be at least one */
          int count = 0;
          RuleList nonEmptyRules = rules;
          {{ Object tomMatch514NameNumber_freshVar_0=rules;if ( (tomMatch514NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.RuleList) ) {{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.RuleList )tomMatch514NameNumber_freshVar_0);{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumber_freshVar_1=tomMatch514NameNumberfreshSubject_1;if ( ((tomMatch514NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.rulelist.ConsRuleList) || (tomMatch514NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.rulelist.EmptyRuleList)) ) {{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumber_begin_3=tomMatch514NameNumber_freshVar_1;{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumber_end_4=tomMatch514NameNumber_freshVar_1;do {{{  tom.gom.adt.rule.types.RuleList  tom_R1=tom_get_slice_RuleList(tomMatch514NameNumber_begin_3,tomMatch514NameNumber_end_4, tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() );{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumber_freshVar_2=tomMatch514NameNumber_end_4;if (!( tomMatch514NameNumber_freshVar_2.isEmptyRuleList() )) {{  tom.gom.adt.rule.types.Rule  tomMatch514NameNumber_freshVar_8= tomMatch514NameNumber_freshVar_2.getHeadRuleList() ;{ boolean tomMatch514NameNumber_freshVar_12= false ;{  tom.gom.adt.rule.types.Term  tomMatch514NameNumber_freshVar_7= null ;if ( (tomMatch514NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{tomMatch514NameNumber_freshVar_12= true ;tomMatch514NameNumber_freshVar_7= tomMatch514NameNumber_freshVar_8.getlhs() ;}} else {if ( (tomMatch514NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{tomMatch514NameNumber_freshVar_12= true ;tomMatch514NameNumber_freshVar_7= tomMatch514NameNumber_freshVar_8.getlhs() ;}}}if ((tomMatch514NameNumber_freshVar_12 ==  true )) {{  tom.gom.adt.rule.types.Term  tomMatch514NameNumber_freshVar_10=tomMatch514NameNumber_freshVar_7;if ( (tomMatch514NameNumber_freshVar_10 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  tom.gom.adt.rule.types.TermList  tomMatch514NameNumber_freshVar_9= tomMatch514NameNumber_freshVar_10.getargs() ;{  tom.gom.adt.rule.types.TermList  tomMatch514NameNumber_freshVar_11=tomMatch514NameNumber_freshVar_9;if ( ((tomMatch514NameNumber_freshVar_11 instanceof tom.gom.adt.rule.types.termlist.ConsTermList) || (tomMatch514NameNumber_freshVar_11 instanceof tom.gom.adt.rule.types.termlist.EmptyTermList)) ) {if ( tomMatch514NameNumber_freshVar_11.isEmptyTermList() ) {{  tom.gom.adt.rule.types.Rule  tom_rule= tomMatch514NameNumber_freshVar_2.getHeadRuleList() ;{  tom.gom.adt.rule.types.RuleList  tomMatch514NameNumber_freshVar_5= tomMatch514NameNumber_freshVar_2.getTailRuleList() ;if ( true ) {



              count++;
              nonEmptyRules = tom_append_list_RuleList(tom_R1,tom_append_list_RuleList(tomMatch514NameNumber_freshVar_5, tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ));
              String hookCode =
                generateHookCode( tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() , tom.gom.adt.rule.types.rulelist.ConsRuleList.make(tom_rule, tom.gom.adt.rule.types.rulelist.EmptyRuleList.make() ) );
              hookList =
                tom_append_list_ConcHookDecl(hookList, tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( tom.gom.adt.gom.types.hookdecl.MakeHookDecl.make( tom.gom.adt.gom.types.decl.CutOperator.make(opDecl) ,  tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() ,  tom.gom.adt.code.types.code.Code.make(hookCode) ,  tom.gom.adt.gom.types.hookkind.HookKind.make("rules") ) , tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ) )
;
            }}}}}}}}}}}}}}}}if ( tomMatch514NameNumber_end_4.isEmptyRuleList() ) {tomMatch514NameNumber_end_4=tomMatch514NameNumber_begin_3;} else {tomMatch514NameNumber_end_4= tomMatch514NameNumber_end_4.getTailRuleList() ;}}} while(!( (tomMatch514NameNumber_end_4==tomMatch514NameNumber_begin_3) ));}}}}}}}}

          if (count>1) {
            getLogger().log(Level.WARNING, "Multiple rules for empty {0}",
                new Object[]{ opDecl.getName() });
          }
          /* Then handle rules for insert */
          if (!nonEmptyRules.isEmptyRuleList()) {
            SlotList args =  tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( tom.gom.adt.gom.types.slot.Slot.make("head", tomMatch513NameNumber_freshVar_4) , tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( tom.gom.adt.gom.types.slot.Slot.make("tail", opDecl.getSort()) , tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() ) ) ;
            String hookCode =
              generateVariadicHookCode(args, nonEmptyRules);
            hookList =
              tom_append_list_ConcHookDecl(hookList, tom.gom.adt.gom.types.hookdecllist.ConsConcHookDecl.make( tom.gom.adt.gom.types.hookdecl.MakeHookDecl.make( tom.gom.adt.gom.types.decl.CutOperator.make(opDecl) , args,  tom.gom.adt.code.types.code.Code.make(hookCode) ,  tom.gom.adt.gom.types.hookkind.HookKind.make("rules") ) , tom.gom.adt.gom.types.hookdecllist.EmptyConcHookDecl.make() ) )
;
          }
        }}}}}}}}

    }
    return hookList;
  }

  private String generateHookCode(SlotList slotList, RuleList ruleList) {
    StringBuilder output = new StringBuilder();
    if(slotList.isEmptyConcSlot()) {
      while(!ruleList.isEmptyRuleList()) {
        Rule rule = ruleList.getHeadRuleList();
        ruleList = ruleList.getTailRuleList();
        {{ Object tomMatch515NameNumber_freshVar_0=rule;if ( (tomMatch515NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch515NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch515NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Rule  tomMatch515NameNumber_freshVar_3=tomMatch515NameNumberfreshSubject_1;if ( (tomMatch515NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_1= tomMatch515NameNumber_freshVar_3.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_2= tomMatch515NameNumber_freshVar_3.getrhs() ;{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_4=tomMatch515NameNumber_freshVar_1;if ( (tomMatch515NameNumber_freshVar_4 instanceof tom.gom.adt.rule.types.term.Appl) ) {if ( true ) {

            output.append("    return `");
            genTerm(tomMatch515NameNumber_freshVar_2,output);
            output.append(";\n");
          }}}}}}}}}}{ Object tomMatch515NameNumber_freshVar_5=rule;if ( (tomMatch515NameNumber_freshVar_5 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch515NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch515NameNumber_freshVar_5);{  tom.gom.adt.rule.types.Rule  tomMatch515NameNumber_freshVar_9=tomMatch515NameNumberfreshSubject_1;if ( (tomMatch515NameNumber_freshVar_9 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_6= tomMatch515NameNumber_freshVar_9.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_7= tomMatch515NameNumber_freshVar_9.getrhs() ;{  tom.gom.adt.rule.types.Condition  tomMatch515NameNumber_freshVar_8= tomMatch515NameNumber_freshVar_9.getcond() ;{  tom.gom.adt.rule.types.Term  tomMatch515NameNumber_freshVar_10=tomMatch515NameNumber_freshVar_6;if ( (tomMatch515NameNumber_freshVar_10 instanceof tom.gom.adt.rule.types.term.Appl) ) {if ( true ) {

            output.append("    %match{\n");
            genCondition(tomMatch515NameNumber_freshVar_8,output);
            output.append(" -> { return `");
            genTerm(tomMatch515NameNumber_freshVar_7,output);
            output.append("; }\n");
            output.append("}\n");
          }}}}}}}}}}}}

      }

    } else {
      output.append("    %match(");
      matchArgs(slotList,output,1);
      output.append(") {\n");
      while(!ruleList.isEmptyRuleList()) {
        Rule rule = ruleList.getHeadRuleList();
        ruleList = ruleList.getTailRuleList();
        {{ Object tomMatch516NameNumber_freshVar_0=rule;if ( (tomMatch516NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch516NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch516NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Rule  tomMatch516NameNumber_freshVar_3=tomMatch516NameNumberfreshSubject_1;if ( (tomMatch516NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_1= tomMatch516NameNumber_freshVar_3.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_2= tomMatch516NameNumber_freshVar_3.getrhs() ;{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_5=tomMatch516NameNumber_freshVar_1;if ( (tomMatch516NameNumber_freshVar_5 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  tom.gom.adt.rule.types.TermList  tomMatch516NameNumber_freshVar_4= tomMatch516NameNumber_freshVar_5.getargs() ;if ( true ) {

            genTermList(tomMatch516NameNumber_freshVar_4,output);
            output.append(" -> { return `");
            genTerm(tomMatch516NameNumber_freshVar_2,output);
            output.append("; }\n");
          }}}}}}}}}}}{ Object tomMatch516NameNumber_freshVar_6=rule;if ( (tomMatch516NameNumber_freshVar_6 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch516NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch516NameNumber_freshVar_6);{  tom.gom.adt.rule.types.Rule  tomMatch516NameNumber_freshVar_10=tomMatch516NameNumberfreshSubject_1;if ( (tomMatch516NameNumber_freshVar_10 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_7= tomMatch516NameNumber_freshVar_10.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_8= tomMatch516NameNumber_freshVar_10.getrhs() ;{  tom.gom.adt.rule.types.Condition  tomMatch516NameNumber_freshVar_9= tomMatch516NameNumber_freshVar_10.getcond() ;{  tom.gom.adt.rule.types.Term  tomMatch516NameNumber_freshVar_12=tomMatch516NameNumber_freshVar_7;if ( (tomMatch516NameNumber_freshVar_12 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  tom.gom.adt.rule.types.TermList  tomMatch516NameNumber_freshVar_11= tomMatch516NameNumber_freshVar_12.getargs() ;if ( true ) {

            genTermList(tomMatch516NameNumber_freshVar_11,output);
            output.append(" && ");
            genCondition(tomMatch516NameNumber_freshVar_9,output);
            output.append(" -> { return `");
            genTerm(tomMatch516NameNumber_freshVar_8,output);
            output.append("; }\n");
          }}}}}}}}}}}}}

      }
      output.append("    }\n");
    }
    return output.toString();
  }

  private String generateVariadicHookCode(SlotList slotList, RuleList ruleList) {
    StringBuilder output = new StringBuilder();
    output.append("    %match(realMake(head,tail)) {\n");
    while(!ruleList.isEmptyRuleList()) {
      Rule rule = ruleList.getHeadRuleList();
      ruleList = ruleList.getTailRuleList();
      {{ Object tomMatch517NameNumber_freshVar_0=rule;if ( (tomMatch517NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch517NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch517NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Rule  tomMatch517NameNumber_freshVar_2=tomMatch517NameNumberfreshSubject_1;{ boolean tomMatch517NameNumber_freshVar_11= false ;{  tom.gom.adt.rule.types.Term  tomMatch517NameNumber_freshVar_1= null ;if ( (tomMatch517NameNumber_freshVar_2 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{tomMatch517NameNumber_freshVar_11= true ;tomMatch517NameNumber_freshVar_1= tomMatch517NameNumber_freshVar_2.getlhs() ;}} else {if ( (tomMatch517NameNumber_freshVar_2 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{tomMatch517NameNumber_freshVar_11= true ;tomMatch517NameNumber_freshVar_1= tomMatch517NameNumber_freshVar_2.getlhs() ;}}}if ((tomMatch517NameNumber_freshVar_11 ==  true )) {{  tom.gom.adt.rule.types.Term  tomMatch517NameNumber_freshVar_5=tomMatch517NameNumber_freshVar_1;if ( (tomMatch517NameNumber_freshVar_5 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  String  tomMatch517NameNumber_freshVar_3= tomMatch517NameNumber_freshVar_5.getsymbol() ;{  tom.gom.adt.rule.types.TermList  tomMatch517NameNumber_freshVar_4= tomMatch517NameNumber_freshVar_5.getargs() ;{  tom.gom.adt.rule.types.TermList  tomMatch517NameNumber_freshVar_6=tomMatch517NameNumber_freshVar_4;if ( ((tomMatch517NameNumber_freshVar_6 instanceof tom.gom.adt.rule.types.termlist.ConsTermList) || (tomMatch517NameNumber_freshVar_6 instanceof tom.gom.adt.rule.types.termlist.EmptyTermList)) ) {if (!( tomMatch517NameNumber_freshVar_6.isEmptyTermList() )) {{  tom.gom.adt.rule.types.Term  tomMatch517NameNumber_freshVar_9= tomMatch517NameNumber_freshVar_6.getHeadTermList() ;{ boolean tomMatch517NameNumber_freshVar_10= false ;if ( (tomMatch517NameNumber_freshVar_9 instanceof tom.gom.adt.rule.types.term.UnnamedVarStar) ) {tomMatch517NameNumber_freshVar_10= true ;} else {if ( (tomMatch517NameNumber_freshVar_9 instanceof tom.gom.adt.rule.types.term.VarStar) ) {tomMatch517NameNumber_freshVar_10= true ;}}if ((tomMatch517NameNumber_freshVar_10 ==  true )) {{  tom.gom.adt.rule.types.Term  tom_var= tomMatch517NameNumber_freshVar_6.getHeadTermList() ;{  tom.gom.adt.rule.types.TermList  tomMatch517NameNumber_freshVar_7= tomMatch517NameNumber_freshVar_6.getTailTermList() ;if ( true ) {

            String varname = "_";
            {{ Object tomMatch518NameNumber_freshVar_0=tom_var;if ( (tomMatch518NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch518NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch518NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Term  tomMatch518NameNumber_freshVar_2=tomMatch518NameNumberfreshSubject_1;if ( (tomMatch518NameNumber_freshVar_2 instanceof tom.gom.adt.rule.types.term.VarStar) ) {{  String  tomMatch518NameNumber_freshVar_1= tomMatch518NameNumber_freshVar_2.getname() ;if ( true ) {
 varname = tomMatch518NameNumber_freshVar_1; }}}}}}}}
 
            getLogger().log(Level.WARNING, GomMessage.variadicRuleStartingWithStar.getMessage(),
                    new Object[]{(tomMatch517NameNumber_freshVar_3),varname});
        }}}}}}}}}}}}}}}}}}}}}{{ Object tomMatch519NameNumber_freshVar_0=rule;if ( (tomMatch519NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch519NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch519NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Rule  tomMatch519NameNumber_freshVar_3=tomMatch519NameNumberfreshSubject_1;if ( (tomMatch519NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.rule.Rule) ) {{  tom.gom.adt.rule.types.Term  tomMatch519NameNumber_freshVar_1= tomMatch519NameNumber_freshVar_3.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch519NameNumber_freshVar_2= tomMatch519NameNumber_freshVar_3.getrhs() ;if ( true ) {



          genTerm(tomMatch519NameNumber_freshVar_1,output);
          output.append(" -> { return `");
          genTerm(tomMatch519NameNumber_freshVar_2,output);
          output.append("; }\n");
        }}}}}}}}{ Object tomMatch519NameNumber_freshVar_4=rule;if ( (tomMatch519NameNumber_freshVar_4 instanceof tom.gom.adt.rule.types.Rule) ) {{  tom.gom.adt.rule.types.Rule  tomMatch519NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Rule )tomMatch519NameNumber_freshVar_4);{  tom.gom.adt.rule.types.Rule  tomMatch519NameNumber_freshVar_8=tomMatch519NameNumberfreshSubject_1;if ( (tomMatch519NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.rule.ConditionalRule) ) {{  tom.gom.adt.rule.types.Term  tomMatch519NameNumber_freshVar_5= tomMatch519NameNumber_freshVar_8.getlhs() ;{  tom.gom.adt.rule.types.Term  tomMatch519NameNumber_freshVar_6= tomMatch519NameNumber_freshVar_8.getrhs() ;{  tom.gom.adt.rule.types.Condition  tomMatch519NameNumber_freshVar_7= tomMatch519NameNumber_freshVar_8.getcond() ;if ( true ) {

          genTerm(tomMatch519NameNumber_freshVar_5,output);
          output.append(" && ");
          genCondition(tomMatch519NameNumber_freshVar_7,output);
          output.append(" -> { return `");
          genTerm(tomMatch519NameNumber_freshVar_6,output);
          output.append("; }\n");
        }}}}}}}}}}

    }
    output.append("    }\n");
    return output.toString();
  }
  private void genTermList(TermList list, StringBuilder output) {
    {{ Object tomMatch520NameNumber_freshVar_0=list;if ( (tomMatch520NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.TermList) ) {{  tom.gom.adt.rule.types.TermList  tomMatch520NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.TermList )tomMatch520NameNumber_freshVar_0);{  tom.gom.adt.rule.types.TermList  tomMatch520NameNumber_freshVar_1=tomMatch520NameNumberfreshSubject_1;if ( ((tomMatch520NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.termlist.ConsTermList) || (tomMatch520NameNumber_freshVar_1 instanceof tom.gom.adt.rule.types.termlist.EmptyTermList)) ) {if ( tomMatch520NameNumber_freshVar_1.isEmptyTermList() ) {if ( true ) {
 return; }}}}}}}{ Object tomMatch520NameNumber_freshVar_2=list;if ( (tomMatch520NameNumber_freshVar_2 instanceof tom.gom.adt.rule.types.TermList) ) {{  tom.gom.adt.rule.types.TermList  tomMatch520NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.TermList )tomMatch520NameNumber_freshVar_2);{  tom.gom.adt.rule.types.TermList  tomMatch520NameNumber_freshVar_3=tomMatch520NameNumberfreshSubject_1;if ( ((tomMatch520NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.termlist.ConsTermList) || (tomMatch520NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.termlist.EmptyTermList)) ) {if (!( tomMatch520NameNumber_freshVar_3.isEmptyTermList() )) {{  tom.gom.adt.rule.types.Term  tom_h= tomMatch520NameNumber_freshVar_3.getHeadTermList() ;{  tom.gom.adt.rule.types.TermList  tomMatch520NameNumber_freshVar_4= tomMatch520NameNumber_freshVar_3.getTailTermList() ;{  tom.gom.adt.rule.types.TermList  tom_t=tomMatch520NameNumber_freshVar_4;if ( true ) {

        genTerm(tom_h,output);
        if (!tom_t.isEmptyTermList()) {
          output.append(", ");
        }
        genTermList(tom_t,output);
      }}}}}}}}}}}

  }

  private void genTerm(Term termArg, StringBuilder output) {
    {{ Object tomMatch521NameNumber_freshVar_0=termArg;if ( (tomMatch521NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_3=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.term.Appl) ) {{  String  tomMatch521NameNumber_freshVar_1= tomMatch521NameNumber_freshVar_3.getsymbol() ;{  tom.gom.adt.rule.types.TermList  tomMatch521NameNumber_freshVar_2= tomMatch521NameNumber_freshVar_3.getargs() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_1);
        output.append("(");
        genTermList(tomMatch521NameNumber_freshVar_2, output);
        output.append(")");
      }}}}}}}}{ Object tomMatch521NameNumber_freshVar_4=termArg;if ( (tomMatch521NameNumber_freshVar_4 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_4);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_7=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_7 instanceof tom.gom.adt.rule.types.term.At) ) {{  String  tomMatch521NameNumber_freshVar_5= tomMatch521NameNumber_freshVar_7.getname() ;{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_6= tomMatch521NameNumber_freshVar_7.getterm() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_5);
        output.append("@");
        genTerm(tomMatch521NameNumber_freshVar_6,output);
      }}}}}}}}{ Object tomMatch521NameNumber_freshVar_8=termArg;if ( (tomMatch521NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_8);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_10=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_10 instanceof tom.gom.adt.rule.types.term.Anti) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_9= tomMatch521NameNumber_freshVar_10.getterm() ;if ( true ) {

        output.append("!");
        genTerm(tomMatch521NameNumber_freshVar_9,output);
      }}}}}}}{ Object tomMatch521NameNumber_freshVar_11=termArg;if ( (tomMatch521NameNumber_freshVar_11 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_11);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_12=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_12 instanceof tom.gom.adt.rule.types.term.UnnamedVar) ) {if ( true ) {

        output.append("_");
      }}}}}}{ Object tomMatch521NameNumber_freshVar_13=termArg;if ( (tomMatch521NameNumber_freshVar_13 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_13);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_14=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_14 instanceof tom.gom.adt.rule.types.term.UnnamedVarStar) ) {if ( true ) {

        output.append("_*");
      }}}}}}{ Object tomMatch521NameNumber_freshVar_15=termArg;if ( (tomMatch521NameNumber_freshVar_15 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_15);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_17=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_17 instanceof tom.gom.adt.rule.types.term.Var) ) {{  String  tomMatch521NameNumber_freshVar_16= tomMatch521NameNumber_freshVar_17.getname() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_16);
      }}}}}}}{ Object tomMatch521NameNumber_freshVar_18=termArg;if ( (tomMatch521NameNumber_freshVar_18 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_18);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_20=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_20 instanceof tom.gom.adt.rule.types.term.VarStar) ) {{  String  tomMatch521NameNumber_freshVar_19= tomMatch521NameNumber_freshVar_20.getname() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_19);
        output.append("*");
      }}}}}}}{ Object tomMatch521NameNumber_freshVar_21=termArg;if ( (tomMatch521NameNumber_freshVar_21 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_21);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_23=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_23 instanceof tom.gom.adt.rule.types.term.BuiltinInt) ) {{  int  tomMatch521NameNumber_freshVar_22= tomMatch521NameNumber_freshVar_23.geti() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_22);
      }}}}}}}{ Object tomMatch521NameNumber_freshVar_24=termArg;if ( (tomMatch521NameNumber_freshVar_24 instanceof tom.gom.adt.rule.types.Term) ) {{  tom.gom.adt.rule.types.Term  tomMatch521NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Term )tomMatch521NameNumber_freshVar_24);{  tom.gom.adt.rule.types.Term  tomMatch521NameNumber_freshVar_26=tomMatch521NameNumberfreshSubject_1;if ( (tomMatch521NameNumber_freshVar_26 instanceof tom.gom.adt.rule.types.term.BuiltinString) ) {{  String  tomMatch521NameNumber_freshVar_25= tomMatch521NameNumber_freshVar_26.gets() ;if ( true ) {

        output.append(tomMatch521NameNumber_freshVar_25);
      }}}}}}}}

  }

  private void genCondition(Condition cond, StringBuilder output) {
    {{ Object tomMatch522NameNumber_freshVar_0=cond;if ( (tomMatch522NameNumber_freshVar_0 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_0);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_3=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_3 instanceof tom.gom.adt.rule.types.condition.CondEquals) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_1= tomMatch522NameNumber_freshVar_3.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_2= tomMatch522NameNumber_freshVar_3.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_1,output);
        output.append(" == ");
        genTerm(tomMatch522NameNumber_freshVar_2,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_4=cond;if ( (tomMatch522NameNumber_freshVar_4 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_4);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_7=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_7 instanceof tom.gom.adt.rule.types.condition.CondNotEquals) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_5= tomMatch522NameNumber_freshVar_7.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_6= tomMatch522NameNumber_freshVar_7.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_5,output);
        output.append(" != ");
        genTerm(tomMatch522NameNumber_freshVar_6,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_8=cond;if ( (tomMatch522NameNumber_freshVar_8 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_8);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_11=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_11 instanceof tom.gom.adt.rule.types.condition.CondLessEquals) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_9= tomMatch522NameNumber_freshVar_11.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_10= tomMatch522NameNumber_freshVar_11.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_9,output);
        output.append(" <= ");
        genTerm(tomMatch522NameNumber_freshVar_10,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_12=cond;if ( (tomMatch522NameNumber_freshVar_12 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_12);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_15=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_15 instanceof tom.gom.adt.rule.types.condition.CondLessThan) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_13= tomMatch522NameNumber_freshVar_15.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_14= tomMatch522NameNumber_freshVar_15.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_13,output);
        output.append(" < ");
        genTerm(tomMatch522NameNumber_freshVar_14,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_16=cond;if ( (tomMatch522NameNumber_freshVar_16 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_16);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_19=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_19 instanceof tom.gom.adt.rule.types.condition.CondGreaterEquals) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_17= tomMatch522NameNumber_freshVar_19.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_18= tomMatch522NameNumber_freshVar_19.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_17,output);
        output.append(" >= ");
        genTerm(tomMatch522NameNumber_freshVar_18,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_20=cond;if ( (tomMatch522NameNumber_freshVar_20 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_20);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_23=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_23 instanceof tom.gom.adt.rule.types.condition.CondGreaterThan) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_21= tomMatch522NameNumber_freshVar_23.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_22= tomMatch522NameNumber_freshVar_23.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_21,output);
        output.append(" > ");
        genTerm(tomMatch522NameNumber_freshVar_22,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_24=cond;if ( (tomMatch522NameNumber_freshVar_24 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_24);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_27=tomMatch522NameNumberfreshSubject_1;if ( (tomMatch522NameNumber_freshVar_27 instanceof tom.gom.adt.rule.types.condition.CondMatch) ) {{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_25= tomMatch522NameNumber_freshVar_27.gett1() ;{  tom.gom.adt.rule.types.Term  tomMatch522NameNumber_freshVar_26= tomMatch522NameNumber_freshVar_27.gett2() ;if ( true ) {

        genTerm(tomMatch522NameNumber_freshVar_25,output);
        output.append(" << ");
        genTerm(tomMatch522NameNumber_freshVar_26,output);
      }}}}}}}}{ Object tomMatch522NameNumber_freshVar_28=cond;if ( (tomMatch522NameNumber_freshVar_28 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_28);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_29=tomMatch522NameNumberfreshSubject_1;if ( ((tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) ) {if (!( (  tomMatch522NameNumber_freshVar_29.isEmptyCondAnd()  ||  (tomMatch522NameNumber_freshVar_29== tom.gom.adt.rule.types.condition.EmptyCondAnd.make() )  ) )) {{  tom.gom.adt.rule.types.Condition  tom_head=(( ((tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )?( tomMatch522NameNumber_freshVar_29.getHeadCondAnd() ):(tomMatch522NameNumber_freshVar_29));{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_30=(( ((tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.ConsCondAnd) || (tomMatch522NameNumber_freshVar_29 instanceof tom.gom.adt.rule.types.condition.EmptyCondAnd)) )?( tomMatch522NameNumber_freshVar_29.getTailCondAnd() ):( tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ));{  tom.gom.adt.rule.types.Condition  tom_tail=tomMatch522NameNumber_freshVar_30;if ( true ) {

        if(tom_tail !=  tom.gom.adt.rule.types.condition.EmptyCondAnd.make() ) {
          output.append("(");
          genCondition(tom_head,output);
          output.append(" && ");
          genCondition(tom_tail,output);
          output.append(")");
        } else {
          genCondition(tom_head,output);
        }
      }}}}}}}}}}{ Object tomMatch522NameNumber_freshVar_32=cond;if ( (tomMatch522NameNumber_freshVar_32 instanceof tom.gom.adt.rule.types.Condition) ) {{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumberfreshSubject_1=(( tom.gom.adt.rule.types.Condition )tomMatch522NameNumber_freshVar_32);{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_33=tomMatch522NameNumberfreshSubject_1;if ( ((tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) ) {if (!( (  tomMatch522NameNumber_freshVar_33.isEmptyCondOr()  ||  (tomMatch522NameNumber_freshVar_33== tom.gom.adt.rule.types.condition.EmptyCondOr.make() )  ) )) {{  tom.gom.adt.rule.types.Condition  tom_head=(( ((tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )?( tomMatch522NameNumber_freshVar_33.getHeadCondOr() ):(tomMatch522NameNumber_freshVar_33));{  tom.gom.adt.rule.types.Condition  tomMatch522NameNumber_freshVar_34=(( ((tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.ConsCondOr) || (tomMatch522NameNumber_freshVar_33 instanceof tom.gom.adt.rule.types.condition.EmptyCondOr)) )?( tomMatch522NameNumber_freshVar_33.getTailCondOr() ):( tom.gom.adt.rule.types.condition.EmptyCondOr.make() ));{  tom.gom.adt.rule.types.Condition  tom_tail=tomMatch522NameNumber_freshVar_34;if ( true ) {

        if(tom_tail !=  tom.gom.adt.rule.types.condition.EmptyCondOr.make() ) {
          output.append("(");
          genCondition(tom_head,output);
          output.append(" || ");
          genCondition(tom_tail,output);
          output.append(")");
        } else {
          genCondition(tom_head,output);
        }
      }}}}}}}}}}}

  }

  private void matchArgs(SlotList sl, StringBuilder output, int count) {
    {{ Object tomMatch523NameNumber_freshVar_0=sl;if ( (tomMatch523NameNumber_freshVar_0 instanceof tom.gom.adt.gom.types.SlotList) ) {{  tom.gom.adt.gom.types.SlotList  tomMatch523NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.SlotList )tomMatch523NameNumber_freshVar_0);{  tom.gom.adt.gom.types.SlotList  tomMatch523NameNumber_freshVar_1=tomMatch523NameNumberfreshSubject_1;if ( ((tomMatch523NameNumber_freshVar_1 instanceof tom.gom.adt.gom.types.slotlist.ConsConcSlot) || (tomMatch523NameNumber_freshVar_1 instanceof tom.gom.adt.gom.types.slotlist.EmptyConcSlot)) ) {if ( tomMatch523NameNumber_freshVar_1.isEmptyConcSlot() ) {if ( true ) {
 return; }}}}}}}{ Object tomMatch523NameNumber_freshVar_2=sl;if ( (tomMatch523NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.SlotList) ) {{  tom.gom.adt.gom.types.SlotList  tomMatch523NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.SlotList )tomMatch523NameNumber_freshVar_2);{  tom.gom.adt.gom.types.SlotList  tomMatch523NameNumber_freshVar_3=tomMatch523NameNumberfreshSubject_1;if ( ((tomMatch523NameNumber_freshVar_3 instanceof tom.gom.adt.gom.types.slotlist.ConsConcSlot) || (tomMatch523NameNumber_freshVar_3 instanceof tom.gom.adt.gom.types.slotlist.EmptyConcSlot)) ) {if (!( tomMatch523NameNumber_freshVar_3.isEmptyConcSlot() )) {{  tom.gom.adt.gom.types.Slot  tomMatch523NameNumber_freshVar_7= tomMatch523NameNumber_freshVar_3.getHeadConcSlot() ;if ( (tomMatch523NameNumber_freshVar_7 instanceof tom.gom.adt.gom.types.slot.Slot) ) {{  tom.gom.adt.gom.types.SortDecl  tomMatch523NameNumber_freshVar_6= tomMatch523NameNumber_freshVar_7.getSort() ;{  tom.gom.adt.gom.types.SlotList  tomMatch523NameNumber_freshVar_4= tomMatch523NameNumber_freshVar_3.getTailConcSlot() ;{  tom.gom.adt.gom.types.SlotList  tom_t=tomMatch523NameNumber_freshVar_4;if ( true ) {{{ Object tomMatch524NameNumber_freshVar_0=tomMatch523NameNumber_freshVar_6;if ( (tomMatch524NameNumber_freshVar_0 instanceof tom.gom.adt.gom.types.SortDecl) ) {{  tom.gom.adt.gom.types.SortDecl  tomMatch524NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.SortDecl )tomMatch524NameNumber_freshVar_0);{  tom.gom.adt.gom.types.SortDecl  tomMatch524NameNumber_freshVar_2=tomMatch524NameNumberfreshSubject_1;{ boolean tomMatch524NameNumber_freshVar_3= false ;{  String  tomMatch524NameNumber_freshVar_1= "" ;if ( (tomMatch524NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.sortdecl.SortDecl) ) {{tomMatch524NameNumber_freshVar_3= true ;tomMatch524NameNumber_freshVar_1= tomMatch524NameNumber_freshVar_2.getName() ;}} else {if ( (tomMatch524NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.sortdecl.BuiltinSortDecl) ) {{tomMatch524NameNumber_freshVar_3= true ;tomMatch524NameNumber_freshVar_1= tomMatch524NameNumber_freshVar_2.getName() ;}}}if ((tomMatch524NameNumber_freshVar_3 ==  true )) {if ( true ) {



            output.append(tomMatch524NameNumber_freshVar_1);
            output.append(" arg_"+count);
          }}}}}}}}}

        if (!tom_t.isEmptyConcSlot()) {
          output.append(", ");
        }
        matchArgs(tom_t,output,count+1);
      }}}}}}}}}}}}}

  }

  private SlotList opArgs(SlotList slots, int count) {
    {{ Object tomMatch525NameNumber_freshVar_0=slots;if ( (tomMatch525NameNumber_freshVar_0 instanceof tom.gom.adt.gom.types.SlotList) ) {{  tom.gom.adt.gom.types.SlotList  tomMatch525NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.SlotList )tomMatch525NameNumber_freshVar_0);{  tom.gom.adt.gom.types.SlotList  tomMatch525NameNumber_freshVar_1=tomMatch525NameNumberfreshSubject_1;if ( ((tomMatch525NameNumber_freshVar_1 instanceof tom.gom.adt.gom.types.slotlist.ConsConcSlot) || (tomMatch525NameNumber_freshVar_1 instanceof tom.gom.adt.gom.types.slotlist.EmptyConcSlot)) ) {if ( tomMatch525NameNumber_freshVar_1.isEmptyConcSlot() ) {if ( true ) {

        return  tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() ;
      }}}}}}}{ Object tomMatch525NameNumber_freshVar_2=slots;if ( (tomMatch525NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.SlotList) ) {{  tom.gom.adt.gom.types.SlotList  tomMatch525NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.SlotList )tomMatch525NameNumber_freshVar_2);{  tom.gom.adt.gom.types.SlotList  tomMatch525NameNumber_freshVar_3=tomMatch525NameNumberfreshSubject_1;if ( ((tomMatch525NameNumber_freshVar_3 instanceof tom.gom.adt.gom.types.slotlist.ConsConcSlot) || (tomMatch525NameNumber_freshVar_3 instanceof tom.gom.adt.gom.types.slotlist.EmptyConcSlot)) ) {if (!( tomMatch525NameNumber_freshVar_3.isEmptyConcSlot() )) {{  tom.gom.adt.gom.types.Slot  tomMatch525NameNumber_freshVar_7= tomMatch525NameNumber_freshVar_3.getHeadConcSlot() ;if ( (tomMatch525NameNumber_freshVar_7 instanceof tom.gom.adt.gom.types.slot.Slot) ) {{  tom.gom.adt.gom.types.SortDecl  tomMatch525NameNumber_freshVar_6= tomMatch525NameNumber_freshVar_7.getSort() ;{  tom.gom.adt.gom.types.SlotList  tomMatch525NameNumber_freshVar_4= tomMatch525NameNumber_freshVar_3.getTailConcSlot() ;if ( true ) {

        SlotList tail = opArgs(tomMatch525NameNumber_freshVar_4,count+1);
        return  tom.gom.adt.gom.types.slotlist.ConsConcSlot.make( tom.gom.adt.gom.types.slot.Slot.make("arg_"+count, tomMatch525NameNumber_freshVar_6) ,tom_append_list_ConcSlot(tail, tom.gom.adt.gom.types.slotlist.EmptyConcSlot.make() )) ;
      }}}}}}}}}}}}

    throw new GomRuntimeException("RuleExpander:opArgs failed "+slots);
  }
  protected OperatorDecl getOperatorDecl(String name) {
    OperatorDecl decl = null;
    OpRef ref = new OpRef();
    try {
      tom_make_TopDown(tom_make_GetOperatorDecl(ref,name)).visit(moduleList);
    } catch (tom.library.sl.VisitFailure e) {
      throw new GomRuntimeException("Unexpected strategy failure!");
    }
    if (ref.val == null) {
      getLogger().log(Level.SEVERE, "Unknown constructor {0}",
          new Object[]{name});
    }
    return ref.val;
  }
  static class OpRef { OperatorDecl val; }
  private static class GetOperatorDecl extends tom.library.sl.BasicStrategy {private  OpRef  opref;private  String  opName;public GetOperatorDecl( OpRef  opref,  String  opName) {super(( new tom.library.sl.Identity() ));this.opref=opref;this.opName=opName;}public  OpRef  getopref() {return opref;}public  String  getopName() {return opName;}public tom.library.sl.Visitable[] getChildren() {tom.library.sl.Visitable[] stratChilds = new tom.library.sl.Visitable[getChildCount()];stratChilds[0] = super.getChildAt(0);return stratChilds;}public tom.library.sl.Visitable setChildren(tom.library.sl.Visitable[] children) {super.setChildAt(0, children[0]);return this;}public int getChildCount() {return 1;}public tom.library.sl.Visitable getChildAt(int index) {switch (index) {case 0: return super.getChildAt(0);default: throw new IndexOutOfBoundsException();}}public tom.library.sl.Visitable setChildAt(int index, tom.library.sl.Visitable child) {switch (index) {case 0: return super.setChildAt(0, child);default: throw new IndexOutOfBoundsException();}}public  tom.gom.adt.gom.types.OperatorDecl  visit_OperatorDecl( tom.gom.adt.gom.types.OperatorDecl  tom__arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {{{ Object tomMatch526NameNumber_freshVar_0=tom__arg;if ( (tomMatch526NameNumber_freshVar_0 instanceof tom.gom.adt.gom.types.OperatorDecl) ) {{  tom.gom.adt.gom.types.OperatorDecl  tomMatch526NameNumberfreshSubject_1=(( tom.gom.adt.gom.types.OperatorDecl )tomMatch526NameNumber_freshVar_0);{  tom.gom.adt.gom.types.OperatorDecl  tomMatch526NameNumber_freshVar_2=tomMatch526NameNumberfreshSubject_1;if ( (tomMatch526NameNumber_freshVar_2 instanceof tom.gom.adt.gom.types.operatordecl.OperatorDecl) ) {{  String  tomMatch526NameNumber_freshVar_1= tomMatch526NameNumber_freshVar_2.getName() ;if ( true ) {






        if (tomMatch526NameNumber_freshVar_1.equals(opName)) {
          opref.val = tomMatch526NameNumberfreshSubject_1;
        }
      }}}}}}}}return _visit_OperatorDecl(tom__arg,introspector); }public  tom.gom.adt.gom.types.OperatorDecl  _visit_OperatorDecl( tom.gom.adt.gom.types.OperatorDecl  arg, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if (!((environment ==  null ))) {return (( tom.gom.adt.gom.types.OperatorDecl )any.visit(environment,introspector));} else {return (( tom.gom.adt.gom.types.OperatorDecl )any.visitLight(arg,introspector));} }public Object visitLight(Object v, tom.library.sl.Introspector introspector) throws tom.library.sl.VisitFailure {if ( (v instanceof tom.gom.adt.gom.types.OperatorDecl) ) {return visit_OperatorDecl((( tom.gom.adt.gom.types.OperatorDecl )v),introspector);}if (!((environment ==  null ))) {return any.visit(environment,introspector);} else {return any.visitLight(v,introspector);} }}private static  tom.library.sl.Strategy  tom_make_GetOperatorDecl( OpRef  t0,  String  t1) { return new GetOperatorDecl(t0,t1);}



  private Logger getLogger() {
    return Logger.getLogger(getClass().getName());
  }
}
